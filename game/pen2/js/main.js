/*
 TweenJS
 Visit http://createjs.com/ for documentation, updates and examples.

 Copyright (c) 2010 gskinner.com, inc.

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
 Platform.js
 Copyright 2014-2020 Benjamin Tan
 Copyright 2011-2013 John-David Dalton
 Available under MIT license
*/
this.createjs=this.createjs||{};createjs.extend=function(g,e){function d(){this.constructor=g}d.prototype=e.prototype;return g.prototype=new d};this.createjs=this.createjs||{};createjs.promote=function(g,e){var d=g.prototype,m=Object.getPrototypeOf&&Object.getPrototypeOf(d)||d.__proto__;if(m){d[(e+="_")+"constructor"]=m.constructor;for(var a in m)d.hasOwnProperty(a)&&"function"==typeof m[a]&&(d[e+a]=m[a])}return g};this.createjs=this.createjs||{};
createjs.deprecate=function(g,e){return function(){var d="Deprecated property or method '"+e+"'. See docs for info.";console&&(console.warn?console.warn(d):console.log(d));return g&&g.apply(this,arguments)}};this.createjs=this.createjs||{};
(function(){function g(d,m,a){this.type=d;this.currentTarget=this.target=null;this.eventPhase=0;this.bubbles=!!m;this.cancelable=!!a;this.timeStamp=(new Date).getTime();this.removed=this.immediatePropagationStopped=this.propagationStopped=this.defaultPrevented=!1}var e=g.prototype;e.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0};e.stopPropagation=function(){this.propagationStopped=!0};e.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=
!0};e.remove=function(){this.removed=!0};e.clone=function(){return new g(this.type,this.bubbles,this.cancelable)};e.set=function(d){for(var m in d)this[m]=d[m];return this};e.toString=function(){return"[Event (type="+this.type+")]"};createjs.Event=g})();this.createjs=this.createjs||{};
(function(){function g(){this._captureListeners=this._listeners=null}var e=g.prototype;g.initialize=function(d){d.addEventListener=e.addEventListener;d.on=e.on;d.removeEventListener=d.off=e.removeEventListener;d.removeAllEventListeners=e.removeAllEventListeners;d.hasEventListener=e.hasEventListener;d.dispatchEvent=e.dispatchEvent;d._dispatchEvent=e._dispatchEvent;d.willTrigger=e.willTrigger};e.addEventListener=function(d,m,a){var c=a?this._captureListeners=this._captureListeners||{}:this._listeners=
this._listeners||{};var b=c[d];b&&this.removeEventListener(d,m,a);(b=c[d])?b.push(m):c[d]=[m];return m};e.on=function(d,m,a,c,b,k){m.handleEvent&&(a=a||m,m=m.handleEvent);a=a||this;return this.addEventListener(d,function(h){m.call(a,h,b);c&&h.remove()},k)};e.removeEventListener=function(d,m,a){if(a=a?this._captureListeners:this._listeners){var c=a[d];if(c)for(var b=0,k=c.length;b<k;b++)if(c[b]==m){1==k?delete a[d]:c.splice(b,1);break}}};e.off=e.removeEventListener;e.removeAllEventListeners=function(d){d?
(this._listeners&&delete this._listeners[d],this._captureListeners&&delete this._captureListeners[d]):this._listeners=this._captureListeners=null};e.dispatchEvent=function(d,m,a){if("string"==typeof d){var c=this._listeners;if(!(m||c&&c[d]))return!0;d=new createjs.Event(d,m,a)}else d.target&&d.clone&&(d=d.clone());try{d.target=this}catch(b){}if(d.bubbles&&this.parent){a=this;for(m=[a];a.parent;)m.push(a=a.parent);c=m.length;for(a=c-1;0<=a&&!d.propagationStopped;a--)m[a]._dispatchEvent(d,1+(0==a));
for(a=1;a<c&&!d.propagationStopped;a++)m[a]._dispatchEvent(d,3)}else this._dispatchEvent(d,2);return!d.defaultPrevented};e.hasEventListener=function(d){var m=this._listeners,a=this._captureListeners;return!!(m&&m[d]||a&&a[d])};e.willTrigger=function(d){for(var m=this;m;){if(m.hasEventListener(d))return!0;m=m.parent}return!1};e.toString=function(){return"[EventDispatcher]"};e._dispatchEvent=function(d,m){var a,c,b=2>=m?this._captureListeners:this._listeners;if(d&&b&&(c=b[d.type])&&(a=c.length)){try{d.currentTarget=
this}catch(h){}try{d.eventPhase=m|0}catch(h){}d.removed=!1;c=c.slice();for(b=0;b<a&&!d.immediatePropagationStopped;b++){var k=c[b];k.handleEvent?k.handleEvent(d):k(d);d.removed&&(this.off(d.type,k,1==m),d.removed=!1)}}2===m&&this._dispatchEvent(d,2.1)};createjs.EventDispatcher=g})();this.createjs=this.createjs||{};
(function(){function g(){throw"Ticker cannot be instantiated.";}g.RAF_SYNCHED="synched";g.RAF="raf";g.TIMEOUT="timeout";g.timingMode=null;g.maxDelta=0;g.paused=!1;g.removeEventListener=null;g.removeAllEventListeners=null;g.dispatchEvent=null;g.hasEventListener=null;g._listeners=null;createjs.EventDispatcher.initialize(g);g._addEventListener=g.addEventListener;g.addEventListener=function(){!g._inited&&g.init();return g._addEventListener.apply(g,arguments)};g._inited=!1;g._startTime=0;g._pausedTime=
0;g._ticks=0;g._pausedTicks=0;g._interval=50;g._lastTime=0;g._times=null;g._tickTimes=null;g._timerId=null;g._raf=!0;g._setInterval=function(m){g._interval=m;g._inited&&g._setupTick()};g.setInterval=createjs.deprecate(g._setInterval,"Ticker.setInterval");g._getInterval=function(){return g._interval};g.getInterval=createjs.deprecate(g._getInterval,"Ticker.getInterval");g._setFPS=function(m){g._setInterval(1E3/m)};g.setFPS=createjs.deprecate(g._setFPS,"Ticker.setFPS");g._getFPS=function(){return 1E3/
g._interval};g.getFPS=createjs.deprecate(g._getFPS,"Ticker.getFPS");try{Object.defineProperties(g,{interval:{get:g._getInterval,set:g._setInterval},framerate:{get:g._getFPS,set:g._setFPS}})}catch(m){console.log(m)}g.init=function(){g._inited||(g._inited=!0,g._times=[],g._tickTimes=[],g._startTime=g._getTime(),g._times.push(g._lastTime=0),g.interval=g._interval)};g.reset=function(){if(g._raf){var m=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||
window.msCancelAnimationFrame;m&&m(g._timerId)}else clearTimeout(g._timerId);g.removeAllEventListeners("tick");g._timerId=g._times=g._tickTimes=null;g._startTime=g._lastTime=g._ticks=g._pausedTime=0;g._inited=!1};g.getMeasuredTickTime=function(m){var a=0,c=g._tickTimes;if(!c||1>c.length)return-1;m=Math.min(c.length,m||g._getFPS()|0);for(var b=0;b<m;b++)a+=c[b];return a/m};g.getMeasuredFPS=function(m){var a=g._times;if(!a||2>a.length)return-1;m=Math.min(a.length-1,m||g._getFPS()|0);return 1E3/((a[0]-
a[m])/m)};g.getTime=function(m){return g._startTime?g._getTime()-(m?g._pausedTime:0):-1};g.getEventTime=function(m){return g._startTime?(g._lastTime||g._startTime)-(m?g._pausedTime:0):-1};g.getTicks=function(m){return g._ticks-(m?g._pausedTicks:0)};g._handleSynch=function(){g._timerId=null;g._setupTick();g._getTime()-g._lastTime>=.97*(g._interval-1)&&g._tick()};g._handleRAF=function(){g._timerId=null;g._setupTick();g._tick()};g._handleTimeout=function(){g._timerId=null;g._setupTick();g._tick()};g._setupTick=
function(){if(null==g._timerId){var m=g.timingMode;if(m==g.RAF_SYNCHED||m==g.RAF){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(a){g._timerId=a(m==g.RAF?g._handleRAF:g._handleSynch);g._raf=!0;return}}g._raf=!1;g._timerId=setTimeout(g._handleTimeout,g._interval)}};g._tick=function(){var m=g.paused,a=g._getTime(),c=a-g._lastTime;g._lastTime=a;g._ticks++;m&&(g._pausedTicks++,g._pausedTime+=
c);if(g.hasEventListener("tick")){var b=new createjs.Event("tick"),k=g.maxDelta;b.delta=k&&c>k?k:c;b.paused=m;b.time=a;b.runTime=a-g._pausedTime;g.dispatchEvent(b)}for(g._tickTimes.unshift(g._getTime()-a);100<g._tickTimes.length;)g._tickTimes.pop();for(g._times.unshift(a);100<g._times.length;)g._times.pop()};var e=window,d=e.performance.now||e.performance.mozNow||e.performance.msNow||e.performance.oNow||e.performance.webkitNow;g._getTime=function(){return(d&&d.call(e.performance)||(new Date).getTime())-
g._startTime};createjs.Ticker=g})();this.createjs=this.createjs||{};
(function(){function g(d){this.EventDispatcher_constructor();this.ignoreGlobalPause=!1;this.loop=0;this.bounce=this.reversed=this.useTicks=!1;this.timeScale=1;this.position=this.duration=0;this.rawPosition=-1;this._paused=!0;this._labelList=this._labels=this._parent=this._prev=this._next=null;d&&(this.useTicks=!!d.useTicks,this.ignoreGlobalPause=!!d.ignoreGlobalPause,this.loop=!0===d.loop?-1:d.loop||0,this.reversed=!!d.reversed,this.bounce=!!d.bounce,this.timeScale=d.timeScale||1,d.onChange&&this.addEventListener("change",
d.onChange),d.onComplete&&this.addEventListener("complete",d.onComplete))}var e=createjs.extend(g,createjs.EventDispatcher);e._setPaused=function(d){createjs.Tween._register(this,d);return this};e.setPaused=createjs.deprecate(e._setPaused,"AbstractTween.setPaused");e._getPaused=function(){return this._paused};e.getPaused=createjs.deprecate(e._getPaused,"AbstactTween.getPaused");e._getCurrentLabel=function(d){var m=this.getLabels();null==d&&(d=this.position);for(var a=0,c=m.length;a<c&&!(d<m[a].position);a++);
return 0===a?null:m[a-1].label};e.getCurrentLabel=createjs.deprecate(e._getCurrentLabel,"AbstractTween.getCurrentLabel");try{Object.defineProperties(e,{paused:{set:e._setPaused,get:e._getPaused},currentLabel:{get:e._getCurrentLabel}})}catch(d){}e.advance=function(d,m){this.setPosition(this.rawPosition+d*this.timeScale,m)};e.setPosition=function(d,m,a,c){var b=this.duration,k=this.loop,h=this.rawPosition,f=0;0>d&&(d=0);if(0===b){var l=!0;if(-1!==h)return l}else{var p=d/b|0;f=d-p*b;(l=-1!==k&&d>=k*
b+b)&&(d=(f=b)*(p=k)+b);if(d===h)return l;!this.reversed!==!(this.bounce&&p%2)&&(f=b-f)}this.position=f;this.rawPosition=d;this._updatePosition(a,l);l&&(this.paused=!0);c&&c(this);m||this._runActions(h,d,a,!a&&-1===h);this.dispatchEvent("change");l&&this.dispatchEvent("complete")};e.calculatePosition=function(d){var m=this.duration,a=this.loop,c=0;if(0===m)return 0;-1!==a&&d>=a*m+m?(d=m,c=a):0>d?d=0:(c=d/m|0,d-=c*m);return!this.reversed!==!(this.bounce&&c%2)?m-d:d};e.getLabels=function(){var d=this._labelList;
if(!d){d=this._labelList=[];var m=this._labels,a;for(a in m)d.push({label:a,position:m[a]});d.sort(function(c,b){return c.position-b.position})}return d};e.setLabels=function(d){this._labels=d;this._labelList=null};e.addLabel=function(d,m){this._labels||(this._labels={});this._labels[d]=m;var a=this._labelList;if(a){for(var c=0,b=a.length;c<b&&!(m<a[c].position);c++);a.splice(c,0,{label:d,position:m})}};e.gotoAndPlay=function(d){this.paused=!1;this._goto(d)};e.gotoAndStop=function(d){this.paused=
!0;this._goto(d)};e.resolve=function(d){var m=Number(d);isNaN(m)&&(m=this._labels&&this._labels[d]);return m};e.toString=function(){return"[AbstractTween]"};e.clone=function(){throw"AbstractTween can not be cloned.";};e._init=function(d){d&&d.paused||(this.paused=!1);d&&null!=d.position&&this.setPosition(d.position)};e._updatePosition=function(d,m){};e._goto=function(d){d=this.resolve(d);null!=d&&this.setPosition(d,!1,!0)};e._runActions=function(d,m,a,c){if(this._actionHead||this.tweens){var b=this.duration,
k=this.reversed,h=this.bounce,f=this.loop,l,p,q;if(0===b){var n=l=p=q=0;k=h=!1}else n=d/b|0,l=m/b|0,p=d-n*b,q=m-l*b;-1!==f&&(l>f&&(q=b,l=f),n>f&&(p=b,n=f));if(a)return this._runActionsRange(q,q,a,c);if(n!==l||p!==q||a||c){-1===n&&(n=p=0);d=d<=m;m=n;do{f=m===n?p:d?0:b;var t=m===l?q:d?b:0;!k!==!(h&&m%2)&&(f=b-f,t=b-t);if((!h||m===n||f!==t)&&this._runActionsRange(f,t,a,c||m!==n&&!h))return!0;c=!1}while(d&&++m<=l||!d&&--m>=l)}}};e._runActionsRange=function(d,m,a,c){};createjs.AbstractTween=createjs.promote(g,
"EventDispatcher")})();this.createjs=this.createjs||{};
(function(){function g(a,c){this.AbstractTween_constructor(c);this.pluginData=null;this.target=a;this.passive=!1;this._stepTail=this._stepHead=new e(null,0,0,{},null,!0);this._stepPosition=0;this._injected=this._pluginIds=this._plugins=this._actionTail=this._actionHead=null;c&&(this.pluginData=c.pluginData,c.override&&g.removeTweens(a));this.pluginData||(this.pluginData={});this._init(c)}function e(a,c,b,k,h,f){this.next=null;this.prev=a;this.t=c;this.d=b;this.props=k;this.ease=h;this.passive=f;this.index=
a?a.index+1:0}function d(a,c,b,k,h){this.next=null;this.prev=a;this.t=c;this.d=0;this.scope=b;this.funct=k;this.params=h}var m=createjs.extend(g,createjs.AbstractTween);g.IGNORE={};g._tweens=[];g._plugins=null;g._tweenHead=null;g._tweenTail=null;g.get=function(a,c){return new g(a,c)};g.tick=function(a,c){for(var b=g._tweenHead;b;){var k=b._next;c&&!b.ignoreGlobalPause||b._paused||b.advance(b.useTicks?1:a);b=k}};g.handleEvent=function(a){"tick"===a.type&&this.tick(a.delta,a.paused)};g.removeTweens=
function(a){if(a.tweenjs_count){for(var c=g._tweenHead;c;){var b=c._next;c.target===a&&g._register(c,!0);c=b}a.tweenjs_count=0}};g.removeAllTweens=function(){for(var a=g._tweenHead;a;){var c=a._next;a._paused=!0;a.target&&(a.target.tweenjs_count=0);a._next=a._prev=null;a=c}g._tweenHead=g._tweenTail=null};g.hasActiveTweens=function(a){return a?!!a.tweenjs_count:!!g._tweenHead};g._installPlugin=function(a){for(var c=a.priority=a.priority||0,b=g._plugins=g._plugins||[],k=0,h=b.length;k<h&&!(c<b[k].priority);k++);
b.splice(k,0,a)};g._register=function(a,c){var b=a.target;if(!c&&a._paused)b&&(b.tweenjs_count=b.tweenjs_count?b.tweenjs_count+1:1),(b=g._tweenTail)?(g._tweenTail=b._next=a,a._prev=b):g._tweenHead=g._tweenTail=a,!g._inited&&createjs.Ticker&&(createjs.Ticker.addEventListener("tick",g),g._inited=!0);else if(c&&!a._paused){b&&b.tweenjs_count--;b=a._next;var k=a._prev;b?b._prev=k:g._tweenTail=k;k?k._next=b:g._tweenHead=b;a._next=a._prev=null}a._paused=c};m.wait=function(a,c){0<a&&this._addStep(+a,this._stepTail.props,
null,c);return this};m.to=function(a,c,b){if(null==c||0>c)c=0;c=this._addStep(+c,null,b);this._appendProps(a,c);return this};m.label=function(a){this.addLabel(a,this.duration);return this};m.call=function(a,c,b){return this._addAction(b||this.target,a,c||[this])};m.set=function(a,c){return this._addAction(c||this.target,this._set,[a])};m.play=function(a){return this._addAction(a||this,this._set,[{paused:!1}])};m.pause=function(a){return this._addAction(a||this,this._set,[{paused:!0}])};m.w=m.wait;
m.t=m.to;m.c=m.call;m.s=m.set;m.toString=function(){return"[Tween]"};m.clone=function(){throw"Tween can not be cloned.";};m._addPlugin=function(a){var c=this._pluginIds||(this._pluginIds={}),b=a.ID;if(b&&!c[b]){c[b]=!0;c=this._plugins||(this._plugins=[]);b=a.priority||0;for(var k=0,h=c.length;k<h;k++)if(b<c[k].priority){c.splice(k,0,a);return}c.push(a)}};m._updatePosition=function(a,c){var b=this._stepHead.next,k=this.position,h=this.duration;if(this.target&&b){for(var f=b.next;f&&f.t<=k;)b=b.next,
f=b.next;this._updateTargetProps(b,c?0===h?1:k/h:(k-b.t)/b.d,c)}this._stepPosition=b?k-b.t:0};m._updateTargetProps=function(a,c,b){if(!(this.passive=!!a.passive)){var k,h=a.prev.props,f=a.props;if(k=a.ease)c=k(c,0,1,1);k=this._plugins;var l;a:for(l in h){var p=h[l];var q=f[l];p=p!==q&&"number"===typeof p?p+(q-p)*c:1<=c?q:p;if(k){q=0;for(var n=k.length;q<n;q++){var t=k[q].change(this,a,l,p,c,b);if(t===g.IGNORE)continue a;void 0!==t&&(p=t)}}this.target[l]=p}}};m._runActionsRange=function(a,c,b,k){var h=
(b=a>c)?this._actionTail:this._actionHead,f=c,l=a;b&&(f=a,l=c);for(var p=this.position;h;){var q=h.t;if(q===c||q>l&&q<f||k&&q===a)if(h.funct.apply(h.scope,h.params),p!==this.position)return!0;h=b?h.prev:h.next}};m._appendProps=function(a,c,b){var k=this._stepHead.props,h=this.target,f=g._plugins,l,p,q=c.prev,n=q.props,t=c.props||(c.props=this._cloneProps(n)),r={};for(l in a)if(a.hasOwnProperty(l)&&(r[l]=t[l]=a[l],void 0===k[l])){var u=void 0;if(f)for(p=f.length-1;0<=p;p--){var v=f[p].init(this,l,
u);void 0!==v&&(u=v);if(u===g.IGNORE){delete t[l];delete r[l];break}}u!==g.IGNORE&&(void 0===u&&(u=h[l]),n[l]=void 0===u?null:u)}for(l in r){var B;for(a=q;(B=a)&&(a=B.prev);)if(a.props!==B.props){if(void 0!==a.props[l])break;a.props[l]=n[l]}}if(!1!==b&&(f=this._plugins))for(p=f.length-1;0<=p;p--)f[p].step(this,c,r);if(b=this._injected)this._injected=null,this._appendProps(b,c,!1)};m._injectProp=function(a,c){(this._injected||(this._injected={}))[a]=c};m._addStep=function(a,c,b,k){c=new e(this._stepTail,
this.duration,a,c,b,k||!1);this.duration+=a;return this._stepTail=this._stepTail.next=c};m._addAction=function(a,c,b){a=new d(this._actionTail,this.duration,a,c,b);this._actionTail?this._actionTail.next=a:this._actionHead=a;this._actionTail=a;return this};m._set=function(a){for(var c in a)this[c]=a[c]};m._cloneProps=function(a){var c={},b;for(b in a)c[b]=a[b];return c};createjs.Tween=createjs.promote(g,"AbstractTween")})();this.createjs=this.createjs||{};
(function(){function g(d){if(d instanceof Array||null==d&&1<arguments.length){var m=d;var a=arguments[1];d=arguments[2]}else d&&(m=d.tweens,a=d.labels);this.AbstractTween_constructor(d);this.tweens=[];m&&this.addTween.apply(this,m);this.setLabels(a);this._init(d)}var e=createjs.extend(g,createjs.AbstractTween);e.addTween=function(d){d._parent&&d._parent.removeTween(d);var m=arguments.length;if(1<m){for(var a=0;a<m;a++)this.addTween(arguments[a]);return arguments[m-1]}if(0===m)return null;this.tweens.push(d);
d._parent=this;d.paused=!0;m=d.duration;0<d.loop&&(m*=d.loop+1);m>this.duration&&(this.duration=m);0<=this.rawPosition&&d.setPosition(this.rawPosition);return d};e.removeTween=function(d){var m=arguments.length;if(1<m){for(var a=!0,c=0;c<m;c++)a=a&&this.removeTween(arguments[c]);return a}if(0===m)return!0;m=this.tweens;for(c=m.length;c--;)if(m[c]===d)return m.splice(c,1),d._parent=null,d.duration>=this.duration&&this.updateDuration(),!0;return!1};e.updateDuration=function(){for(var d=this.duration=
0,m=this.tweens.length;d<m;d++){var a=this.tweens[d],c=a.duration;0<a.loop&&(c*=a.loop+1);c>this.duration&&(this.duration=c)}};e.toString=function(){return"[Timeline]"};e.clone=function(){throw"Timeline can not be cloned.";};e._updatePosition=function(d,m){for(var a=this.position,c=0,b=this.tweens.length;c<b;c++)this.tweens[c].setPosition(a,!0,d)};e._runActionsRange=function(d,m,a,c){for(var b=this.position,k=0,h=this.tweens.length;k<h;k++)if(this.tweens[k]._runActions(d,m,a,c),b!==this.position)return!0};
createjs.Timeline=createjs.promote(g,"AbstractTween")})();this.createjs=this.createjs||{};
(function(){function g(){throw"Ease cannot be instantiated.";}g.linear=function(e){return e};g.none=g.linear;g.get=function(e){-1>e?e=-1:1<e&&(e=1);return function(d){return 0==e?d:0>e?d*(d*-e+1+e):d*((2-d)*e+(1-e))}};g.getPowIn=function(e){return function(d){return Math.pow(d,e)}};g.getPowOut=function(e){return function(d){return 1-Math.pow(1-d,e)}};g.getPowInOut=function(e){return function(d){return 1>(d*=2)?.5*Math.pow(d,e):1-.5*Math.abs(Math.pow(2-d,e))}};g.quadIn=g.getPowIn(2);g.quadOut=g.getPowOut(2);
g.quadInOut=g.getPowInOut(2);g.cubicIn=g.getPowIn(3);g.cubicOut=g.getPowOut(3);g.cubicInOut=g.getPowInOut(3);g.quartIn=g.getPowIn(4);g.quartOut=g.getPowOut(4);g.quartInOut=g.getPowInOut(4);g.quintIn=g.getPowIn(5);g.quintOut=g.getPowOut(5);g.quintInOut=g.getPowInOut(5);g.sineIn=function(e){return 1-Math.cos(e*Math.PI/2)};g.sineOut=function(e){return Math.sin(e*Math.PI/2)};g.sineInOut=function(e){return-.5*(Math.cos(Math.PI*e)-1)};g.getBackIn=function(e){return function(d){return d*d*((e+1)*d-e)}};
g.backIn=g.getBackIn(1.7);g.getBackOut=function(e){return function(d){return--d*d*((e+1)*d+e)+1}};g.backOut=g.getBackOut(1.7);g.getBackInOut=function(e){e*=1.525;return function(d){return 1>(d*=2)?.5*d*d*((e+1)*d-e):.5*((d-=2)*d*((e+1)*d+e)+2)}};g.backInOut=g.getBackInOut(1.7);g.circIn=function(e){return-(Math.sqrt(1-e*e)-1)};g.circOut=function(e){return Math.sqrt(1- --e*e)};g.circInOut=function(e){return 1>(e*=2)?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)};g.bounceIn=function(e){return 1-
g.bounceOut(1-e)};g.bounceOut=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375};g.bounceInOut=function(e){return.5>e?.5*g.bounceIn(2*e):.5*g.bounceOut(2*e-1)+.5};g.getElasticIn=function(e,d){var m=2*Math.PI;return function(a){if(0==a||1==a)return a;var c=d/m*Math.asin(1/e);return-(e*Math.pow(2,10*--a)*Math.sin((a-c)*m/d))}};g.elasticIn=g.getElasticIn(1,.3);g.getElasticOut=function(e,d){var m=2*Math.PI;
return function(a){return 0==a||1==a?a:e*Math.pow(2,-10*a)*Math.sin((a-d/m*Math.asin(1/e))*m/d)+1}};g.elasticOut=g.getElasticOut(1,.3);g.getElasticInOut=function(e,d){var m=2*Math.PI;return function(a){var c=d/m*Math.asin(1/e);return 1>(a*=2)?-.5*e*Math.pow(2,10*--a)*Math.sin((a-c)*m/d):e*Math.pow(2,-10*--a)*Math.sin((a-c)*m/d)*.5+1}};g.elasticInOut=g.getElasticInOut(1,.3*1.5);createjs.Ease=g})();this.createjs=this.createjs||{};
(function(){function g(){throw"MotionGuidePlugin cannot be instantiated.";}g.priority=0;g.ID="MotionGuide";g.install=function(){createjs.Tween._installPlugin(g);return createjs.Tween.IGNORE};g.init=function(e,d,m){"guide"==d&&e._addPlugin(g)};g.step=function(e,d,m){for(var a in m)if("guide"===a){var c=d.props.guide,b=g._solveGuideData(m.guide,c);c.valid=!b;var k=c.endData;e._injectProp("x",k.x);e._injectProp("y",k.y);if(b||!c.orient)break;c.startOffsetRot=(void 0===d.prev.props.rotation?e.target.rotation||
0:d.prev.props.rotation)-c.startData.rotation;if("fixed"==c.orient)c.endAbsRot=k.rotation+c.startOffsetRot,c.deltaRotation=0;else{b=void 0===m.rotation?e.target.rotation||0:m.rotation;k=b-c.endData.rotation-c.startOffsetRot;var h=k%360;c.endAbsRot=b;switch(c.orient){case "auto":c.deltaRotation=k;break;case "cw":c.deltaRotation=(h+360)%360+360*Math.abs(k/360|0);break;case "ccw":c.deltaRotation=(h-360)%360+-360*Math.abs(k/360|0)}}e._injectProp("rotation",c.endAbsRot)}};g.change=function(e,d,m,a,c,b){if((a=
d.props.guide)&&d.props!==d.prev.props&&a!==d.prev.props.guide){if("guide"===m&&!a.valid||"x"==m||"y"==m||"rotation"===m&&a.orient)return createjs.Tween.IGNORE;g._ratioToPositionData(c,a,e.target)}};g.debug=function(e,d,m){e=e.guide||e;var a=g._findPathProblems(e);a&&console.error("MotionGuidePlugin Error found: \n"+a);if(!d)return a;var c,b=e.path,k=b.length;d.save();d.lineCap="round";d.lineJoin="miter";d.beginPath();d.moveTo(b[0],b[1]);for(c=2;c<k;c+=4)d.quadraticCurveTo(b[c],b[c+1],b[c+2],b[c+
3]);d.strokeStyle="black";d.lineWidth=4.5;d.stroke();d.strokeStyle="white";d.lineWidth=3;d.stroke();d.closePath();b=m.length;if(m&&b){k={};var h={};g._solveGuideData(e,k);for(c=0;c<b;c++)k.orient="fixed",g._ratioToPositionData(m[c],k,h),d.beginPath(),d.moveTo(h.x,h.y),d.lineTo(h.x+9*Math.cos(.0174533*h.rotation),h.y+9*Math.sin(.0174533*h.rotation)),d.strokeStyle="black",d.lineWidth=4.5,d.stroke(),d.strokeStyle="red",d.lineWidth=3,d.stroke(),d.closePath()}d.restore();return a};g._solveGuideData=function(e,
d){var m;if(m=g.debug(e))return m;var a=d.path=e.path;d.orient=e.orient;d.subLines=[];d.totalLength=0;d.startOffsetRot=0;d.deltaRotation=0;d.startData={ratio:0};d.endData={ratio:1};d.animSpan=1;var c=a.length,b,k={};var h=a[0];var f=a[1];for(m=2;m<c;m+=4){var l=a[m];var p=a[m+1];var q=a[m+2];var n=a[m+3];var t={weightings:[],estLength:0,portion:0},r=h;var u=f;for(b=1;10>=b;b++)g._getParamsForCurve(h,f,l,p,q,n,b/10,!1,k),r=k.x-r,u=k.y-u,u=Math.sqrt(r*r+u*u),t.weightings.push(u),t.estLength+=u,r=k.x,
u=k.y;d.totalLength+=t.estLength;for(b=0;10>b;b++)u=t.estLength,t.weightings[b]/=u;d.subLines.push(t);h=q;f=n}u=d.totalLength;a=d.subLines.length;for(m=0;m<a;m++)d.subLines[m].portion=d.subLines[m].estLength/u;m=isNaN(e.start)?0:e.start;a=isNaN(e.end)?1:e.end;g._ratioToPositionData(m,d,d.startData);g._ratioToPositionData(a,d,d.endData);d.startData.ratio=m;d.endData.ratio=a;d.animSpan=d.endData.ratio-d.startData.ratio};g._ratioToPositionData=function(e,d,m){var a=d.subLines,c,b=0,k=e*d.animSpan+d.startData.ratio;
var h=a.length;for(c=0;c<h;c++){var f=a[c].portion;if(b+f>=k){var l=c;break}b+=f}void 0===l&&(l=h-1,b-=f);a=a[l].weightings;var p=f;h=a.length;for(c=0;c<h;c++){f=a[c]*p;if(b+f>=k)break;b+=f}l=4*l+2;h=d.path;g._getParamsForCurve(h[l-2],h[l-1],h[l],h[l+1],h[l+2],h[l+3],c/10+(k-b)/f*.1,d.orient,m);d.orient&&(m.rotation=.99999<=e&&1.00001>=e&&void 0!==d.endAbsRot?d.endAbsRot:m.rotation+(d.startOffsetRot+e*d.deltaRotation));return m};g._getParamsForCurve=function(e,d,m,a,c,b,k,h,f){var l=1-k;f.x=l*l*e+
2*l*k*m+k*k*c;f.y=l*l*d+2*l*k*a+k*k*b;h&&(f.rotation=57.2957795*Math.atan2((a-d)*l+(b-a)*k,(m-e)*l+(c-m)*k))};g._findPathProblems=function(e){var d=e.path,m=d&&d.length||0;if(6>m||(m-2)%4)return"\tCannot parse 'path' array due to invalid number of entries in path. There should be an odd number of points, at least 3 points, and 2 entries per point (x & y). See 'CanvasRenderingContext2D.quadraticCurveTo' for details as 'path' models a quadratic bezier.\n\nOnly [ "+(m+" ] values found. Expected: "+Math.max(4*
Math.ceil((m-2)/4)+2,6));for(var a=0;a<m;a++)if(isNaN(d[a]))return"All data in path array must be numeric";d=e.start;if(isNaN(d)&&void 0!==d)return"'start' out of bounds. Expected 0 to 1, got: "+d;d=e.end;if(isNaN(d)&&void 0!==d)return"'end' out of bounds. Expected 0 to 1, got: "+d;if((e=e.orient)&&"fixed"!=e&&"auto"!=e&&"cw"!=e&&"ccw"!=e)return'Invalid orientation value. Expected ["fixed", "auto", "cw", "ccw", undefined], got: '+e};createjs.MotionGuidePlugin=g})();this.createjs=this.createjs||{};
(function(){var g=createjs.TweenJS=createjs.TweenJS||{};g.version="1.0.0";g.buildDate="Thu, 14 Sep 2017 19:47:47 GMT"})();
(function(){var g="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},e="undefined"!==typeof module&&module.exports,d=function(){for(var c,b=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),
"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],k=0,h=b.length,f={};k<h;k++)if((c=b[k])&&c[1]in g){for(k=0;k<c.length;k++)f[b[0][k]]=c[k];return f}return!1}(),m={change:d.fullscreenchange,error:d.fullscreenerror},a={request:function(c){return new Promise(function(b,k){var h=function(){this.off("change",
h);b()}.bind(this);this.on("change",h);c=c||g.documentElement;Promise.resolve(c[d.requestFullscreen]())["catch"](k)}.bind(this))},exit:function(){return new Promise(function(c,b){if(this.isFullscreen){var k=function(){this.off("change",k);c()}.bind(this);this.on("change",k);Promise.resolve(g[d.exitFullscreen]())["catch"](b)}else c()}.bind(this))},toggle:function(c){return this.isFullscreen?this.exit():this.request(c)},onchange:function(c){this.on("change",c)},onerror:function(c){this.on("error",c)},
on:function(c,b){var k=m[c];k&&g.addEventListener(k,b,!1)},off:function(c,b){var k=m[c];k&&g.removeEventListener(k,b,!1)},raw:d};d?(Object.defineProperties(a,{isFullscreen:{get:function(){return!!g[d.fullscreenElement]}},element:{enumerable:!0,get:function(){return g[d.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!g[d.fullscreenEnabled]}}}),e?module.exports=a:window.screenfull=a):e?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})();
(function(){function g(A){A=String(A);return A.charAt(0).toUpperCase()+A.slice(1)}function e(A,J){var T=-1,R=A?A.length:0;if("number"==typeof R&&-1<R&&R<=t)for(;++T<R;)J(A[T],T,A);else m(A,J)}function d(A){A=h(A);return/^(?:webOS|i(?:OS|P))/.test(A)?A:g(A)}function m(A,J){for(var T in A)u.call(A,T)&&J(A[T],T,A)}function a(A){return null==A?g(A):v.call(A).slice(8,-1)}function c(A,J){var T=null!=A?typeof A[J]:"number";return!/^(?:boolean|number|string|undefined)$/.test(T)&&("object"==T?!!A[J]:!0)}function b(A){return String(A).replace(/([ -])(?!$)/g,
"$1?")}function k(A,J){var T=null;e(A,function(R,H){T=J(T,R,H,A)});return T}function h(A){return String(A).replace(/^ +| +$/g,"")}function f(A){function J(la){return k(la,function(fa,V){var ba=V.pattern||b(V);!fa&&(fa=RegExp("\\b"+ba+" *\\d+[.\\w_]*","i").exec(A)||RegExp("\\b"+ba+" *\\w+-[\\w]*","i").exec(A)||RegExp("\\b"+ba+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(A))&&((fa=String(V.label&&!RegExp(ba,"i").test(V.label)?V.label:fa).split("/"))[1]&&!/[\d.]+/.test(fa[0])&&(fa[0]+=" "+
fa[1]),V=V.label||V,fa=d(fa[0].replace(RegExp(ba,"i"),V).replace(RegExp("; *(?:"+V+"[_-])?","i")," ").replace(RegExp("("+V+")[-_.]?(\\w)","i"),"$1 $2")));return fa})}function T(la){return k(la,function(fa,V){return fa||(RegExp(V+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(A)||0)[1]||null})}var R=p,H=A&&"object"==typeof A&&"String"!=a(A);H&&(R=A,A=null);var U=R.navigator||{},C=U.userAgent||"";A||(A=C);var K=H?!!U.likeChrome:/\bChrome\b/.test(A)&&!/internal|\n/i.test(v.toString()),
N=H?"Object":"ScriptBridgingProxyObject",G=H?"Object":"Environment",X=H&&R.java?"JavaPackage":a(R.java),M=H?"Object":"RuntimeObject";G=(X=/\bJava/.test(X)&&R.java)&&a(R.environment)==G;var E=X?"a":"\u03b1",I=X?"b":"\u03b2",z=R.document||{},D=R.operamini||R.opera,y=r.test(y=H&&D?D["[[Class]]"]:a(D))?y:D=null,w,x=A;H=[];var F=null,Q=A==C;C=Q&&D&&"function"==typeof D.version&&D.version();var P=function(la){return k(la,function(fa,V){return fa||RegExp("\\b"+(V.pattern||b(V))+"\\b","i").exec(A)&&(V.label||
V)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),L=function(la){return k(la,function(fa,V){return fa||RegExp("\\b"+(V.pattern||b(V))+"\\b","i").exec(A)&&(V.label||V)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},
"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",
{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),W=J([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},
{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),ca=function(la){return k(la,function(fa,V,ba){return fa||
(V[W]||V[/^[a-z]+(?: +[a-z]+\b)*/i.exec(W)]||RegExp("\\b"+b(ba)+"(?:\\b|\\w*\\d)","i").exec(A))&&ba})}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},
Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),O=function(la){return k(la,function(fa,V){var ba=V.pattern||b(V);if(!fa&&(fa=RegExp("\\b"+ba+"(?:/[\\d.]+|[ \\w.]*)","i").exec(A))){var da=fa,na=V.label||V,ua={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};ba&&na&&/^Win/i.test(da)&&!/^Windows Phone /i.test(da)&&(ua=
ua[/[\d.]+$/.exec(da)])&&(da="Windows "+ua);da=String(da);ba&&na&&(da=da.replace(RegExp(ba,"i"),na));fa=da=d(da.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return fa})}(["Windows Phone",
"KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);P&&(P=[P]);/\bAndroid\b/.test(O)&&!W&&(w=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(A))&&(W=h(w[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||
null);ca&&!W?W=J([ca]):ca&&W&&(W=W.replace(RegExp("^("+b(ca)+")[-_.\\s]","i"),ca+" ").replace(RegExp("^("+b(ca)+")[-_.]?(\\w)","i"),ca+" $2"));if(w=/\bGoogle TV\b/.exec(W))W=w[0];/\bSimulator\b/i.test(A)&&(W=(W?W+" ":"")+"Simulator");"Opera Mini"==L&&/\bOPiOS\b/.test(A)&&H.push("running in Turbo/Uncompressed mode");"IE"==L&&/\blike iPhone OS\b/.test(A)?(w=f(A.replace(/like iPhone OS/,"")),ca=w.manufacturer,W=w.product):/^iP/.test(W)?(L||(L="Safari"),O="iOS"+((w=/ OS ([\d_]+)/i.exec(A))?" "+w[1].replace(/_/g,
"."):"")):"Konqueror"==L&&/^Linux\b/i.test(O)?O="Kubuntu":ca&&"Google"!=ca&&(/Chrome/.test(L)&&!/\bMobile Safari\b/i.test(A)||/\bVita\b/.test(W))||/\bAndroid\b/.test(O)&&/^Chrome/.test(L)&&/\bVersion\//i.test(A)?(L="Android Browser",O=/\bAndroid\b/.test(O)?O:"Android"):"Silk"==L?(/\bMobi/i.test(A)||(O="Android",H.unshift("desktop mode")),/Accelerated *= *true/i.test(A)&&H.unshift("accelerated")):"UC Browser"==L&&/\bUCWEB\b/.test(A)?H.push("speed mode"):"PaleMoon"==L&&(w=/\bFirefox\/([\d.]+)\b/.exec(A))?
H.push("identifying as Firefox "+w[1]):"Firefox"==L&&(w=/\b(Mobile|Tablet|TV)\b/i.exec(A))?(O||(O="Firefox OS"),W||(W=w[1])):!L||(w=!/\bMinefield\b/i.test(A)&&/\b(?:Firefox|Safari)\b/.exec(L))?(L&&!W&&/[\/,]|^[^(]+?\)/.test(A.slice(A.indexOf(w+"/")+8))&&(L=null),(w=W||ca||O)&&(W||ca||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(O))&&(L=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(O)?O:w)+" Browser")):"Electron"==L&&(w=(/\bChrome\/([\d.]+)\b/.exec(A)||0)[1])&&H.push("Chromium "+w);C||(C=T(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)",
"Version",b(L),"(?:Firefox|Minefield|NetFront)"]));if(w="iCab"==P&&3<parseFloat(C)&&"WebKit"||/\bOpera\b/.test(L)&&(/\bOPR\b/.test(A)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(A)&&!/^(?:Trident|EdgeHTML)$/.test(P)&&"WebKit"||!P&&/\bMSIE\b/i.test(A)&&("Mac OS"==O?"Tasman":"Trident")||"WebKit"==P&&/\bPlayStation\b(?! Vita\b)/i.test(L)&&"NetFront")P=[w];"IE"==L&&(w=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(A)||0)[1])?(L+=" Mobile",O="Windows Phone "+(/\+$/.test(w)?w:w+".x"),H.unshift("desktop mode")):
/\bWPDesktop\b/i.test(A)?(L="IE Mobile",O="Windows Phone 8.x",H.unshift("desktop mode"),C||(C=(/\brv:([\d.]+)/.exec(A)||0)[1])):"IE"!=L&&"Trident"==P&&(w=/\brv:([\d.]+)/.exec(A))&&(L&&H.push("identifying as "+L+(C?" "+C:"")),L="IE",C=w[1]);if(Q){if(c(R,"global"))if(X&&(w=X.lang.System,x=w.getProperty("os.arch"),O=O||w.getProperty("os.name")+" "+w.getProperty("os.version")),G){try{C=R.require("ringo/engine").version.join("."),L="RingoJS"}catch(la){(w=R.system)&&w.global.system==R.system&&(L="Narwhal",
O||(O=w[0].os||null))}L||(L="Rhino")}else"object"==typeof R.process&&!R.process.browser&&(w=R.process)&&("object"==typeof w.versions&&("string"==typeof w.versions.electron?(H.push("Node "+w.versions.node),L="Electron",C=w.versions.electron):"string"==typeof w.versions.nw&&(H.push("Chromium "+C,"Node "+w.versions.node),L="NW.js",C=w.versions.nw)),L||(L="Node.js",x=w.arch,O=w.platform,C=(C=/[\d.]+/.exec(w.version))?C[0]:null));else a(w=R.runtime)==N?(L="Adobe AIR",O=w.flash.system.Capabilities.os):
a(w=R.phantom)==M?(L="PhantomJS",C=(w=w.version||null)&&w.major+"."+w.minor+"."+w.patch):"number"==typeof z.documentMode&&(w=/\bTrident\/(\d+)/i.exec(A))?(C=[C,z.documentMode],(w=+w[1]+4)!=C[1]&&(H.push("IE "+C[1]+" mode"),P&&(P[1]=""),C[1]=w),C="IE"==L?String(C[1].toFixed(1)):C[0]):"number"==typeof z.documentMode&&/^(?:Chrome|Firefox)\b/.test(L)&&(H.push("masking as "+L+" "+C),L="IE",C="11.0",P=["Trident"],O="Windows");O=O&&d(O)}C&&(w=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(C)||/(?:alpha|beta)(?: ?\d)?/i.exec(A+
";"+(Q&&U.appMinorVersion))||/\bMinefield\b/i.test(A)&&"a")&&(F=/b/i.test(w)?"beta":"alpha",C=C.replace(RegExp(w+"\\+?$"),"")+("beta"==F?I:E)+(/\d+\+?/.exec(w)||""));if("Fennec"==L||"Firefox"==L&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(O))L="Firefox Mobile";else if("Maxthon"==L&&C)C=C.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(W))"Xbox 360"==W&&(O=null),"Xbox 360"==W&&/\bIEMobile\b/.test(A)&&H.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(L)&&(!L||W||/Browser|Mobi/.test(L))||
"Windows CE"!=O&&!/Mobi/i.test(A))if("IE"==L&&Q)try{null===R.external&&H.unshift("platform preview")}catch(la){H.unshift("embedded")}else(/\bBlackBerry\b/.test(W)||/\bBB10\b/.test(A))&&(w=(RegExp(W.replace(/ +/g," *")+"/([.\\d]+)","i").exec(A)||0)[1]||C)?(w=[w,/BB10/.test(A)],O=(w[1]?(W=null,ca="BlackBerry"):"Device Software")+" "+w[0],C=null):this!=m&&"Wii"!=W&&(Q&&D||/Opera/.test(L)&&/\b(?:MSIE|Firefox)\b/i.test(A)||"Firefox"==L&&/\bOS X (?:\d+\.){2,}/.test(O)||"IE"==L&&(O&&!/^Win/.test(O)&&5.5<
C||/\bWindows XP\b/.test(O)&&8<C||8==C&&!/\bTrident\b/.test(A)))&&!r.test(w=f.call(m,A.replace(r,"")+";"))&&w.name&&(w="ing as "+w.name+((w=w.version)?" "+w:""),r.test(L)?(/\bIE\b/.test(w)&&"Mac OS"==O&&(O=null),w="identify"+w):(w="mask"+w,L=y?d(y.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(w)&&(O=null),Q||(C=null)),P=["Presto"],H.push(w));else L+=" Mobile";if(w=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(A)||0)[1]){w=[parseFloat(w.replace(/\.(\d)$/,".0$1")),w];if("Safari"==L&&"+"==w[1].slice(-1))L=
"WebKit Nightly",F="alpha",C=w[1].slice(0,-1);else if(C==w[1]||C==(w[2]=(/\bSafari\/([\d.]+\+?)/i.exec(A)||0)[1]))C=null;w[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(A)||0)[1];537.36==w[0]&&537.36==w[2]&&28<=parseFloat(w[1])&&"WebKit"==P&&(P=["Blink"]);Q&&(K||w[1])?(P&&(P[1]="like Chrome"),w=w[1]||(w=w[0],530>w?1:532>w?2:532.05>w?3:533>w?4:534.03>w?5:534.07>w?6:534.1>w?7:534.13>w?8:534.16>w?9:534.24>w?10:534.3>w?11:535.01>w?12:535.02>w?"13+":535.07>w?15:535.11>w?16:535.19>w?17:536.05>w?18:536.1>
w?19:537.01>w?20:537.11>w?"21+":537.13>w?23:537.18>w?24:537.24>w?25:537.36>w?26:"Blink"!=P?"27":"28")):(P&&(P[1]="like Safari"),w=(w=w[0],400>w?1:500>w?2:526>w?3:533>w?4:534>w?"4+":535>w?5:537>w?6:538>w?7:601>w?8:602>w?9:604>w?10:606>w?11:608>w?12:"12"));P&&(P[1]+=" "+(w+="number"==typeof w?".x":/[.+]/.test(w)?"":"+"));"Safari"==L&&(!C||45<parseInt(C))?C=w:"Chrome"==L&&/\bHeadlessChrome/i.test(A)&&H.unshift("headless")}"Opera"==L&&(w=/\bzbov|zvav$/.exec(O))?(L+=" ",H.unshift("desktop mode"),"zvav"==
w?(L+="Mini",C=null):L+="Mobile",O=O.replace(RegExp(" *"+w+"$"),"")):"Safari"==L&&/\bChrome\b/.exec(P&&P[1])?(H.unshift("desktop mode"),L="Chrome Mobile",C=null,/\bOS X\b/.test(O)?(ca="Apple",O="iOS 4.3+"):O=null):/\bSRWare Iron\b/.test(L)&&!C&&(C=T("Chrome"));C&&0==C.indexOf(w=/[\d.]+$/.exec(O))&&-1<A.indexOf("/"+w+"-")&&(O=h(O.replace(w,"")));O&&-1!=O.indexOf(L)&&!RegExp(L+" OS").test(O)&&(O=O.replace(RegExp(" *"+b(L)+" *"),""));P&&!/\b(?:Avant|Nook)\b/.test(L)&&(/Browser|Lunascape|Maxthon/.test(L)||
"Safari"!=L&&/^iOS/.test(O)&&/\bSafari\b/.test(P[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(L)&&P[1])&&(w=P[P.length-1])&&H.push(w);H.length&&(H=["("+H.join("; ")+")"]);ca&&W&&0>W.indexOf(ca)&&H.push("on "+ca);W&&H.push((/^on /.test(H[H.length-1])?"":"on ")+W);if(O){var qa=(w=/ ([\d.+]+)$/.exec(O))&&"/"==O.charAt(O.length-w[0].length-1);O={architecture:32,family:w&&!qa?O.replace(w[0],""):O,version:w?w[1]:null,toString:function(){var la=
this.version;return this.family+(la&&!qa?" "+la:"")+(64==this.architecture?" 64-bit":"")}}}(w=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(x))&&!/\bi686\b/i.test(x)?(O&&(O.architecture=64,O.family=O.family.replace(RegExp(" *"+w),"")),L&&(/\bWOW64\b/i.test(A)||Q&&/\w(?:86|32)$/.test(U.cpuClass||U.platform)&&!/\bWin64; x64\b/i.test(A))&&H.unshift("32-bit")):O&&/^OS X/.test(O.family)&&"Chrome"==L&&39<=parseFloat(C)&&(O.architecture=64);A||(A=null);R={};R.description=A;R.layout=P&&P[0];R.manufacturer=ca;R.name=
L;R.prerelease=F;R.product=W;R.ua=A;R.version=L&&C;R.os=O||{architecture:null,family:null,version:null,toString:function(){return"null"}};R.parse=f;R.toString=function(){return this.description||""};R.version&&H.unshift(C);R.name&&H.unshift(L);O&&L&&(O!=String(O).split(" ")[0]||O!=L.split(" ")[0]&&!W)&&H.push(W?"("+O+")":"on "+O);H.length&&(R.description=H.join(" "));return R}var l={"function":!0,object:!0},p=l[typeof window]&&window||this,q=l[typeof exports]&&exports;l=l[typeof module]&&module&&
!module.nodeType&&module;var n=q&&l&&"object"==typeof global&&global;!n||n.global!==n&&n.window!==n&&n.self!==n||(p=n);var t=Math.pow(2,53)-1,r=/\bOpera/;n=Object.prototype;var u=n.hasOwnProperty,v=n.toString,B=f();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(p.platform=B,define(function(){return B})):q&&l?m(B,function(A,J){q[J]=A}):p.platform=B}).call(this);
function buildIOSMeta(){for(var g=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],e=0;e<g.length;e++){var d=document.createElement("meta");d.name=g[e].name;d.content=g[e].content;var m=window.document.head.querySelector('meta[name="'+d.name+'"]');m&&m.parentNode.removeChild(m);window.document.head.appendChild(d)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(g){return!0}}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"!==platform.name.toLowerCase()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"!==platform.name.toLowerCase()&&!iosInIframe()&&iosResize()});
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var g=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&!(g--,this._oText.font=g+"px "+this._szFont,this._oText.lineHeight=Math.round(g*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),8>g););this._iFontSize=g}},__verticalAlign:function(){if(this._bVerticalAlign){var g=this._oText.getBounds().height;this._oText.y-=
(g-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._y+this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(g){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(this._x,this._y,this._iWidth,this._iHeight),this._oContainer.addChild(this._oDebugShape));this._oText=new createjs.Text(g,
this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;switch(this._szAlign){case "center":this._oText.x=this._x+this._iWidth/2;break;case "left":this._oText.x=this._x+this._iPaddingH;break;case "right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText);
this.refreshText(g)},setVerticalAlign:function(g){this._bVerticalAlign=g},setOutline:function(g){null!==this._oText&&(this._oText.outline=g)},setShadow:function(g,e,d,m){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(g,e,d,m))},setColor:function(g){this._oText.color=g},setAlpha:function(g){this._oText.alpha=g},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getY:function(){return this._y},getFontSize:function(){return this._iFontSize},
refreshText:function(g){""===g&&(g=" ");null===this._oText&&this.__createText(g);this._oText.text=g;this._oText.font=this._iFontSize+"px "+this._szFont;this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this.__autofit();this.__updateY();this.__verticalAlign()}};
function CTLText(g,e,d,m,a,c,b,k,h,f,l,p,q,n,t,r,u){this._oContainer=g;this._x=e;this._y=d;this._iWidth=m;this._iHeight=a;this._bMultiline=r;this._iFontSize=c;this._szAlign=b;this._szColor=k;this._szFont=h;this._iPaddingH=l;this._iPaddingV=p;this._bVerticalAlign=t;this._bFitText=n;this._bDebug=u;this._oDebugShape=null;this._fLineHeightFactor=f;this._oText=null;q&&this.__createText(q)}var s_iScaleFactor=1,s_iOffsetX=0,s_iOffsetY=0,s_fInverseScaling=0,s_bIsIphone,s_bFocus=!0;
(function(g){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(g)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(g.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(g){console.log(g)}function isIpad(){var g=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!g&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints?!0:g}function isMobile(){return isIpad()?!0:jQuery.browser.mobile}
function isIOS(){for(var g="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");g.length;)if(navigator.platform===g.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function getSize(g){var e=g.toLowerCase(),d=window.document,m=d.documentElement;if(void 0===window["inner"+g])g=m["client"+g];else if(window["inner"+g]!=m["client"+g]){var a=d.createElement("body");a.id="vpw-test-b";a.style.cssText="overflow:scroll";var c=d.createElement("div");c.id="vpw-test-d";c.style.cssText="position:absolute;top:-1000px";c.innerHTML="<style>@media("+e+":"+m["client"+g]+"px){body#vpw-test-b div#vpw-test-d{"+e+":7px!important}}</style>";a.appendChild(c);m.insertBefore(a,d.head);
g=7==c["offset"+g]?m["client"+g]:window["inner"+g];m.removeChild(a)}else g=window["inner"+g];return g}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var g=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<g?g:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var g=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var e=getSize("Width");s_bFocus&&_checkOrientation(e,g);s_iScaleFactor=Math.min(g/CANVAS_HEIGHT,e/CANVAS_WIDTH);var d=Math.round(CANVAS_WIDTH*s_iScaleFactor),m=Math.round(CANVAS_HEIGHT*s_iScaleFactor);if(m<g){var a=g-m;m+=a;d+=CANVAS_WIDTH/CANVAS_HEIGHT*a}else d<e&&(a=e-d,d+=a,m+=CANVAS_HEIGHT/CANVAS_WIDTH*a);a=g/2-m/2;var c=e/2-d/2,
b=CANVAS_WIDTH/d;if(c*b<-EDGEBOARD_X||a*b<-EDGEBOARD_Y)s_iScaleFactor=Math.min(g/(CANVAS_HEIGHT-2*EDGEBOARD_Y),e/(CANVAS_WIDTH-2*EDGEBOARD_X)),d=Math.round(CANVAS_WIDTH*s_iScaleFactor),m=Math.round(CANVAS_HEIGHT*s_iScaleFactor),a=(g-m)/2,c=(e-d)/2,b=CANVAS_WIDTH/d;s_fInverseScaling=b;s_iOffsetX=-1*c*b;s_iOffsetY=-1*a*b;0<=a&&(s_iOffsetY=0);0<=c&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);
null!==s_oLevelMenu&&s_oLevelMenu.refreshButtonPos();null!==s_oSelectMenu&&s_oSelectMenu.refreshButtonPos();$("#canvas").css("width",d+"px");$("#canvas").css("height",m+"px");s_iCanvasOffsetHeight=a;0>a||(a=(g-m)/2);$("#canvas").css("top",a+"px");$("#canvas").css("left",c+"px");resizeCanvas3D();s_iCanvasResizeWidth=d;s_iCanvasResizeHeight=m;s_iCanvasOffsetWidth=c;fullscreenHandler()}}
function _checkOrientation(g,e){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(g>e?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function saveItem(g,e){localStorage.setItem(g,e)}function getItem(g){return localStorage.getItem(g)}function createBitmap(g,e,d){var m=new createjs.Bitmap(g),a=new createjs.Shape;e&&d?a.graphics.beginFill("#fff").drawRect(-e/2,-d/2,e,d):a.graphics.beginFill("#ff0").drawRect(0,0,g.width,g.height);m.hitArea=a;return m}
function createSprite(g,e,d,m,a,c){g=null!==e?new createjs.Sprite(g,e):new createjs.Sprite(g);e=new createjs.Shape;e.graphics.beginFill("#000000").drawRect(-d,-m,a,c);g.hitArea=e;return g}function randomFloatBetween(g,e,d){"undefined"===typeof d&&(d=2);return parseFloat(Math.min(g+Math.random()*(e-g),e).toFixed(d))}function shuffle(g){for(var e=g.length,d,m;0!==e;)m=Math.floor(Math.random()*e),--e,d=g[e],g[e]=g[m],g[m]=d;return g}
function formatTime(g){g/=1E3;var e=Math.floor(g/60);g=parseFloat(g-60*e).toFixed(1);var d="";d=10>e?d+("0"+e+":"):d+(e+":");return 10>g?d+("0"+g):d+g}function degreesToRadians(g){return g*Math.PI/180}function checkRectCollision(g,e){var d=getBounds(g,.9);var m=getBounds(e,.98);return calculateIntersection(d,m)}
function calculateIntersection(g,e){var d,m,a,c;var b=g.x+(d=g.width/2);var k=g.y+(m=g.height/2);var h=e.x+(a=e.width/2);var f=e.y+(c=e.height/2);b=Math.abs(b-h)-(d+a);k=Math.abs(k-f)-(m+c);return 0>b&&0>k?(b=Math.min(Math.min(g.width,e.width),-b),k=Math.min(Math.min(g.height,e.height),-k),{x:Math.max(g.x,e.x),y:Math.max(g.y,e.y),width:b,height:k,rect1:g,rect2:e}):null}
function getBounds(g,e){var d={x:Infinity,y:Infinity,width:0,height:0};if(g instanceof createjs.Container){d.x2=-Infinity;d.y2=-Infinity;var m=g.children,a=m.length,c;for(c=0;c<a;c++){var b=getBounds(m[c],1);b.x<d.x&&(d.x=b.x);b.y<d.y&&(d.y=b.y);b.x+b.width>d.x2&&(d.x2=b.x+b.width);b.y+b.height>d.y2&&(d.y2=b.y+b.height)}Infinity==d.x&&(d.x=0);Infinity==d.y&&(d.y=0);Infinity==d.x2&&(d.x2=0);Infinity==d.y2&&(d.y2=0);d.width=d.x2-d.x;d.height=d.y2-d.y;delete d.x2;delete d.y2}else{if(g instanceof createjs.Bitmap){a=
g.sourceRect||g.image;c=a.width*e;var k=a.height*e}else if(g instanceof createjs.Sprite)if(g.spriteSheet._frames&&g.spriteSheet._frames[g.currentFrame]&&g.spriteSheet._frames[g.currentFrame].image){a=g.spriteSheet.getFrame(g.currentFrame);c=a.rect.width;k=a.rect.height;m=a.regX;var h=a.regY}else d.x=g.x||0,d.y=g.y||0;else d.x=g.x||0,d.y=g.y||0;m=m||0;c=c||0;h=h||0;k=k||0;d.regX=m;d.regY=h;a=g.localToGlobal(0-m,0-h);b=g.localToGlobal(c-m,k-h);c=g.localToGlobal(c-m,0-h);m=g.localToGlobal(0-m,k-h);d.x=
Math.min(Math.min(Math.min(a.x,b.x),c.x),m.x);d.y=Math.min(Math.min(Math.min(a.y,b.y),c.y),m.y);d.width=Math.max(Math.max(Math.max(a.x,b.x),c.x),m.x)-d.x;d.height=Math.max(Math.max(Math.max(a.y,b.y),c.y),m.y)-d.y}return d}function NoClickDelay(g){this.element=g;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(g){for(var e=g.length,d,m;0<e;)m=Math.floor(Math.random()*e),e--,d=g[e],g[e]=g[m],g[m]=d;return g}
NoClickDelay.prototype={handleEvent:function(g){switch(g.type){case "touchstart":this.onTouchStart(g);break;case "touchmove":this.onTouchMove(g);break;case "touchend":this.onTouchEnd(g)}},onTouchStart:function(g){g.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(g){this.moved=!0},onTouchEnd:function(g){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){g=document.elementFromPoint(g.changedTouches[0].clientX,g.changedTouches[0].clientY);3==g.nodeType&&(g=g.parentNode);var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0);g.dispatchEvent(e)}}};
(function(){function g(d){var m={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};d=d||window.event;d.type in m?document.body.className=m[d.type]:(document.body.className=this[e]?"hidden":"visible","hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0))}var e="hidden";e in document?document.addEventListener("visibilitychange",g):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",
g):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",g):(e="msHidden")in document?document.addEventListener("msvisibilitychange",g):"onfocusin"in document?document.onfocusin=document.onfocusout=g:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=g})();function playSound(g,e,d){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[g].play(),s_aSounds[g].volume(e),s_aSounds[g].loop(d),s_aSounds[g]):null}
function stopSound(g){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[g].stop()}function setVolume(g,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[g].volume(e)}function setMute(g,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[g].mute(e)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(g){for(var e=window.location.search.substring(1).split("&"),d=0;d<e.length;d++){var m=e[d].split("=");if(m[0]==g)return m[1]}}function rotateVector2D(g,e){return{x:e.x*Math.cos(g)+e.y*Math.sin(g),y:e.x*-Math.sin(g)+e.y*Math.cos(g)}}function normalize(g,e){0<e&&(g.x/=e,g.y/=e);return g}function length(g){return Math.sqrt(g.x*g.x+g.y*g.y)}
function findNearestIntersectingObject(g,e,d,m){var a=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,c=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,b=new THREE.Raycaster,k=new THREE.Vector3;k.x=g/a*2-1;k.y=2*-(e/c)+1;k.z=.5;b.setFromCamera(k,d);g=b.intersectObjects(m,!0);e=!1;0<g.length&&(e=g[0]);return e}function distance(g,e,d,m){g-=d;e-=m;return Math.sqrt(g*g+e*e)}function distance2(g,e,d,m){g-=d;e-=m;return g*g+e*e}
function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}
function createOrthoGraphicCamera(){var g=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,NEAR,FAR);s_iCurState===GOALKEEPER_MODE?(g.rotation.x=Math.PI/180*84,g.position.set(0,0,3)):(g.rotation.x=Math.PI/180*88.6,g.rotation.y=Math.PI/180*.03,g.position.set(CAMERA_POSITION.x,CAMERA_POSITION.y,CAMERA_POSITION.z));g.updateProjectionMatrix();g.updateMatrixWorld();return g}function rotateVector2D(g,e){return{x:e.x*Math.cos(g)+e.y*Math.sin(g),y:e.x*-Math.sin(g)+e.y*Math.cos(g),z:0}}
Math.radians=function(g){return g*Math.PI/180};Math.degrees=function(g){return 180*g/Math.PI};function linearFunction(g,e,d,m,a){return(g-e)*(a-m)/(d-e)+m}function distanceV3(g,e,d,m,a,c){g-=m;e-=a;d-=c;return Math.sqrt(g*g+e*e+d*d)}function distanceV2(g,e){var d=g.x-e.x,m=g.y-e.y;return Math.sqrt(d*d+m*m)}function clearAllItem(){localStorage.clear()}
function fullscreenHandler(){ENABLE_FULLSCREEN&&!1!==screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut(),null!==s_oSelectMenu&&s_oSelectMenu.resetFullscreenBut())}
if(screenfull.isEnabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut();null!==s_oSelectMenu&&s_oSelectMenu.resetFullscreenBut()});
function CSpriteLibrary(){var g={},e,d,m,a,c,b;this.init=function(k,h,f){e={};m=d=0;a=k;c=h;b=f};this.addSprite=function(k,h){if(!g.hasOwnProperty(k)){var f=new Image;g[k]=e[k]={szPath:h,oSprite:f,bLoaded:!1};d++}};this.getSprite=function(k){return g.hasOwnProperty(k)?g[k].oSprite:null};this._onSpritesLoaded=function(){d=0;c.call(b)};this._onSpriteLoaded=function(){a.call(b);++m===d&&this._onSpritesLoaded()};this.loadSprites=function(){for(var k in e)e[k].oSprite.oSpriteLibrary=this,e[k].oSprite.szKey=
k,e[k].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);this.oSpriteLibrary._onSpriteLoaded(this.szKey)},e[k].oSprite.onerror=function(h){var f=h.currentTarget;setTimeout(function(){e[f.szKey].oSprite.src=e[f.szKey].szPath},500)},e[k].oSprite.src=e[k].szPath};this.setLoaded=function(k){g[k].bLoaded=!0};this.isLoaded=function(k){return g[k].bLoaded};this.getNumSprites=function(){return d}}
var CANVAS_WIDTH=1280,CANVAS_HEIGHT=640,CANVAS_WIDTH_HALF=CANVAS_WIDTH/2,CANVAS_HEIGHT_HALF=CANVAS_HEIGHT/2,START_HAND_SWIPE_POS,END_HAND_SWIPE_POS,EDGEBOARD_X=100,EDGEBOARD_Y=40,DISABLE_SOUND_MOBILE=!1,PRIMARY_FONT="TradeGothic",SECONDARY_FONT="arialbold",FPS=30,FPS_DESKTOP=60,FPS_TIME=1/FPS,SOUNDTRACK_VOLUME_IN_GAME=1,ROLL_BALL_RATE=60/FPS,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=2,STATE_CHOOSE_LEVEL=3,STATE_CHOOSE_TEAM=4,STATE_GAME=5,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,
ON_DRAG_START=4,ON_DRAG_END=5,ON_TWEEN_ENDED=6,ON_BUT_NO_DOWN=7,ON_BUT_YES_DOWN=8,ON_ALERT_SKIP=9,STRIKER_GOAL_SHOOTAREA={lx:-.2,rx:.195,zmin:.07,zmax:.1865},STEP_RATE=1.5,TEXT_SIZE=[80,100,130],MS_TIME_SWIPE_END=1E3,MS_TIME_SWIPE_START=3E3,MS_TIME_FADE_HELP_TEXT=500,TEXT_EXCELLENT_COLOR=["#fff","#5d96fe"],TEXT_COLOR="#ffffff",TEXT_COLOR_1="#ff2222",OUTLINE_WIDTH=1.5,TIME_INTERVAL_STROBE=.2,PHYSICS_ACCURACY=3,MOBILE_OFFSET_GLOVES_Y=-70,BALL_VELOCITY_MULTIPLIER=1,PHYSICS_STEP=1/(FPS*STEP_RATE),MS_WAIT_SHOW_GAME_OVER_PANEL=
250,STATE_INIT=0,STATE_PLAY=1,STATE_FINISH=2,STATE_PAUSE=3,IDLE=0,RIGHT=1,LEFT=2,CENTER_DOWN=3,CENTER_UP=4,LEFT_DOWN=5,RIGHT_DOWN=6,CENTER=7,SIDE_LEFT=8,SIDE_RIGHT=9,SIDE_LEFT_UP=10,SIDE_RIGHT_UP=11,SIDE_LEFT_DOWN=12,SIDE_RIGHT_DOWN=13,LEFT_UP=14,RIGHT_UP=15,ANIM_GOAL_KEEPER_FAIL_EXCLUSION_LIST=[[LEFT_UP,LEFT,SIDE_LEFT_UP,SIDE_LEFT],[LEFT_UP,LEFT,SIDE_LEFT_UP,SIDE_LEFT,CENTER_UP],[CENTER_UP,CENTER,SIDE_LEFT_UP,SIDE_RIGHT_UP,SIDE_LEFT,SIDE_RIGHT],[RIGHT_UP,RIGHT,SIDE_RIGHT_UP,SIDE_RIGHT,CENTER_UP],
[RIGHT_UP,RIGHT,SIDE_RIGHT_UP,SIDE_RIGHT],[LEFT_UP,LEFT,SIDE_LEFT_UP,SIDE_LEFT,SIDE_LEFT_DOWN,LEFT_DOWN],[LEFT_UP,LEFT,SIDE_LEFT_UP,SIDE_LEFT,SIDE_LEFT_DOWN],[CENTER_UP,CENTER,SIDE_LEFT_UP,SIDE_RIGHT_UP,CENTER_DOWN,SIDE_RIGHT,SIDE_LEFT],[RIGHT_UP,RIGHT,SIDE_RIGHT_UP,SIDE_RIGHT,SIDE_RIGHT_DOWN],[RIGHT_UP,RIGHT,SIDE_RIGHT_UP,SIDE_RIGHT,SIDE_RIGHT_DOWN,RIGHT_DOWN],[LEFT_DOWN,LEFT,SIDE_LEFT_DOWN],[LEFT_DOWN,LEFT,SIDE_LEFT_DOWN,SIDE_LEFT,SIDE_LEFT_UP],[CENTER_DOWN,CENTER,CENTER_UP,SIDE_RIGHT,SIDE_LEFT,
SIDE_RIGHT_DOWN,SIDE_LEFT_DOWN],[RIGHT_DOWN,RIGHT,SIDE_RIGHT_DOWN,SIDE_RIGHT,SIDE_RIGHT_UP],[RIGHT_DOWN,RIGHT,SIDE_RIGHT_DOWN]],NUM_SPRITE_PLAYER=31,SPRITE_NAME_GOALKEEPER="gk_idle gk_save_right gk_save_left gk_save_center_down gk_save_center_up gk_save_down_left gk_save_down_right gk_save_center gk_save_side_left gk_save_side_right gk_save_side_up_left gk_save_side_up_right gk_save_side_low_left gk_save_side_low_right gk_save_up_left gk_save_up_right".split(" "),NUM_SPRITE_GOALKEEPER=[24,34,34,51,
25,34,34,25,30,30,30,30,51,51,36,36],OFFSET_CONTAINER_GOALKEEPER=[{x:0,y:0},{x:15,y:-29},{x:-360,y:-29},{x:-15,y:-15},{x:-20,y:-85},{x:-355,y:20},{x:21,y:20},{x:10,y:-10},{x:-140,y:-30},{x:10,y:-30},{x:-120,y:-75},{x:14,y:-75},{x:-140,y:-10},{x:30,y:-10},{x:-430,y:-56},{x:-8,y:-56}],ORIGIN_POINT_IMPACT_ANIMATION=[{x:null,y:null},{x:295.74,y:3.76},{x:-324.82,y:3.76},{x:4.8,y:null},{x:5,y:null},{x:-354,y:null},{x:334.5,y:null},{x:4.8,y:null},{x:-198.77,y:null},{x:189,y:null},{x:-208.4,y:null},{x:189,
y:null},{x:-150,y:null},{x:101.8,y:null},{x:-344,y:-88},{x:315,y:-88}],BALL_MASS=.5,BALL_LINEAR_DAMPING=.2,OBJECT,TIME_TRY_TO_SHOT_BALL_OPPONENT=.7,START_POS_FLAG={x:277,y:268},FLAG_ADDED_POS={x:61,y:69},FLAG_LIMIT_POS_X=690,TOT_TEAM=32,MIN_BALL_VEL_ROTATION=.1,SHOOT_FRAME=7,HAND_KEEPER_ANGLE_RATE=.15,TIME_POLE_COLLISION_RESET=1E3,LIMIT_HAND_RANGE_POS={x:20,zMax:7,zMin:-8.5},LEFT_RIGHT_WALL_GOAL_SIZE,NUM_AREA_GOAL={h:3,w:5},AREA_GOALS_ANIM=[LEFT_UP,SIDE_LEFT_UP,CENTER_UP,SIDE_RIGHT_UP,RIGHT_UP,LEFT,
SIDE_LEFT,CENTER,SIDE_RIGHT,RIGHT,LEFT_DOWN,SIDE_LEFT_DOWN,CENTER_DOWN,SIDE_RIGHT_DOWN,RIGHT_DOWN],BUFFER_ANIM_PLAYER=FPS,MS_EFFECT_ADD=1500,MS_ROLLING_SCORE=500,MAX_PERCENT_PROBABILITY=100,GOAL_KEEPER_TOLLERANCE_LEFT=-4,GOAL_KEEPER_TOLLERANCE_RIGHT=4,TIME_RESET_AFTER_BALL_OUT=250,TIME_RESET_AFTER_SAVE=500,AREA_GOAL_PROPERTIES={width:4,depth:1,height:2.4},POLE_RIGHT_LEFT_SIZE,COLOR_AREA_GOAL=[16711680,65280,255,16776960,16711935,65535,15790320,986895,16759705,16777215,5675280,10083618,1056896,8392736,
9017449],OFFSET_FIELD_Y=35,OFFSET_FIELD_X=35,FORCE_RATE=.0014,FORCE_MULTIPLIER_AXIS={x:.12,y:.4,z:.08},FORCE_MAX=.5,FIELD_POSITION,MAX_FORCE_Y=66,MIN_FORCE_Y=50,CALCULATE_PROBABILITY=[{xMax:-7,xMin:-11,zMax:11,zMin:8},{xMax:-3.6,xMin:-7,zMax:11,zMin:8},{xMax:3.6,xMin:-3.6,zMax:11,zMin:8},{xMax:7,xMin:3.6,zMax:11,zMin:8},{xMax:11,xMin:7,zMax:11,zMin:8},{xMax:-7,xMin:-7,zMax:8,zMin:5},{xMax:-3.6,xMin:-7,zMax:8,zMin:5},{xMax:3.6,xMin:-3.6,zMax:8,zMin:5},{xMax:7,xMin:3.6,zMax:8,zMin:5},{xMax:11,xMin:7,
zMax:8,zMin:5},{xMax:-7,xMin:-11,zMax:5,zMin:0},{xMax:-3.6,xMin:-7,zMax:5,zMin:0},{xMax:3.6,xMin:-3.6,zMax:5,zMin:0},{xMax:7,xMin:3.6,zMax:5,zMin:0},{xMax:11,xMin:7,zMax:5,zMin:0}],SHOW_AREAS_GOAL=!1,SHOW_3D_RENDER=!1,CANVAS_3D_OPACITY=.5,CAMERA_TEST_TRACKBALL=!1,CAMERA_TEST_TRANSFORM=!1,MOUSE_SENSIBILTY=.03,CAMERA_TEST_LOOK_AT={x:0,y:-500,z:-100},BALL_SCALE_FACTOR=.007,SHADOWN_FACTOR=1.1,FORCE_BALL_DISPLAY_SHOCK=[{max:55,min:MIN_FORCE_Y-1},{max:58,min:55},{max:62,min:58},{max:MAX_FORCE_Y,min:62}],
GOALKEEPER_MODE=0,STRIKER_MODE=1,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION,NUM_MATCHES=10,OFFSET_BALL_POS_X=10,HAND_KEEPER_SIZE={width:1.8,depth:.5,height:1.5},HAND_KEEPER_POSITION={x:0,y:36,z:0},CAMERA_TEST=!1,BALL_Z_FORCE_RANGE={min:3,max:10},GOAL_POSITION={x:0,y:33,z:-2.7},TIME_RESET_AFTER_KEEPER_SAVED=2,TIME_RESET_AFTER_PERFECT_KEEPER_SAVED=3,TIME_BALL_IN_HAND=1E3,NUM_KICKS=10,BALL_FORCE_X=[5,6,7,8,9,10,7,12,10,12],BALL_FORCE_Z=[{min:6,max:9},{min:5,max:9},{min:3,max:9},{min:1,max:8},{min:2,
max:8},{min:4,max:8},{min:3,max:9},{min:1,max:10},{min:5,max:8},{min:5,max:10.5}],BALL_FORCE_Y=[30,40,50,60,65,60,70,64,68,65],BALL_SAVED_POINT={x:.7,z:.6},GOAL_SCORED,GOAL_MISSED,GOAL_SAVED,GOAL_SUFFERED,LOCALSTORAGE_STRING=["penalty_challenge_"],TEXT_COLOR_STROKE,BALL_RADIUS,TIME_RESET_AFTER_GOAL,BACK_WALL_GOAL_SIZE,UP_WALL_GOAL_SIZE,BACK_WALL_GOAL_POSITION,GOAL_LINE_POS,GOAL_SPRITE_SWAP_Y,GOAL_SPRITE_SWAP_Z,FIRST_AREA_GOAL_POS,GOAL_KEEPER_DEPTH_Y,BALL_OUT_Y,POSITION_BALL,POLE_UP_SIZE,HIT_BALL_MAX_FORCE,
HIT_BALL_MIN_FORCE,INTENSITY_DISPLAY_SHOCK,CAMERA_POSITION,FOV,NEAR,FAR;
function refreshSettings(g){g===GOALKEEPER_MODE?(TEXT_COLOR_STROKE="#000000",TIME_RESET_AFTER_GOAL=BALL_RADIUS=1,BACK_WALL_GOAL_SIZE={width:21,depth:.1,height:11},UP_WALL_GOAL_SIZE={width:21,depth:25,height:.1},POLE_RIGHT_LEFT_SIZE={radius_top:.5,radius_bottom:.5,height:21.5,segments:10},BACK_WALL_GOAL_POSITION={x:0,y:8,z:-2.7},GOAL_LINE_POS={x:0,y:31,z:-2.7},POSITION_BALL={x:0,y:125,z:-9},POLE_UP_SIZE={radius_top:.5,radius_bottom:.5,height:42,segments:10},LEFT_RIGHT_WALL_GOAL_SIZE={width:.1,depth:25,
height:11},HIT_BALL_MAX_FORCE=100,HIT_BALL_MIN_FORCE=.01,INTENSITY_DISPLAY_SHOCK=[{x:30,y:20,time:75},{x:50,y:25,time:75},{x:70,y:30,time:75},{x:90,y:40,time:75}],CAMERA_POSITION={x:0,y:0,z:100},FOV=45,NEAR=10):(TEXT_COLOR_STROKE="#002a59",BALL_RADIUS=.68,TIME_RESET_AFTER_GOAL=1E3,BACK_WALL_GOAL_SIZE={width:20.5,depth:1,height:7.5},UP_WALL_GOAL_SIZE={width:20.5,depth:25,height:.1},BACK_WALL_GOAL_POSITION={x:0,y:155,z:-2.7},GOAL_LINE_POS={x:0,y:BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth+2,z:BACK_WALL_GOAL_POSITION.z},
POSITION_BALL={x:.05,y:15.4,z:-9+BALL_RADIUS},POLE_UP_SIZE={radius_top:.5,radius_bottom:.5,height:40.5,segments:10},POLE_RIGHT_LEFT_SIZE={radius_top:.5,radius_bottom:.5,height:15,segments:10},LEFT_RIGHT_WALL_GOAL_SIZE={width:.1,depth:25,height:7.5},HIT_BALL_MAX_FORCE=130,HIT_BALL_MIN_FORCE=5,INTENSITY_DISPLAY_SHOCK=[{x:10,y:7.5,time:50},{x:20,y:9,time:50},{x:30,y:12,time:50},{x:33,y:15,time:50}],CAMERA_POSITION={x:0,y:0,z:-7},FOV=15,NEAR=1);FAR=2E3;GOAL_SPRITE_SWAP_Y=GOAL_LINE_POS.y;GOAL_SPRITE_SWAP_Z=
BACK_WALL_GOAL_POSITION.z+LEFT_RIGHT_WALL_GOAL_SIZE.height;FIRST_AREA_GOAL_POS={x:-14-.5*AREA_GOAL_PROPERTIES.width,y:BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth+1.1,z:3.1-.5*AREA_GOAL_PROPERTIES.height};BALL_OUT_Y=BACK_WALL_GOAL_POSITION.y+3;GOAL_KEEPER_DEPTH_Y=BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth;START_HAND_SWIPE_POS={x:CANVAS_WIDTH_HALF,y:CANVAS_HEIGHT_HALF+200};END_HAND_SWIPE_POS=[{x:CANVAS_WIDTH_HALF-250,y:CANVAS_HEIGHT_HALF-200},{x:CANVAS_WIDTH_HALF,y:CANVAS_HEIGHT_HALF-200},
{x:CANVAS_WIDTH_HALF+250,y:CANVAS_HEIGHT_HALF-200}]}
var TEXT_PRELOADER_CONTINUE="START",TEXT_MULTIPLIER="x",TEXT_SCORE="SCORE",TEXT_LEVEL_SCORE="LEVEL SCORE",TEXT_TOTAL="TOTAL SCORE",TEXT_GOAL="GOAL!",TEXT_ARE_SURE="ARE YOU SURE YOU WANT TO EXIT THE GAME?",TEXT_CONFIRM_DELETE="ALL SAVING WILL BE DELETED! ARE YOU SURE?",TEXT_SAVED="SAVED!",TEXT_MISSED="MISS!",TEXT_HELP="SWIPE TO KICK THE BALL",TEXT_HELP_KEEPER="TAP THE SCREEN TO LET THE OPPONENT KICK",TEXT_WIN="YOU WON",TEXT_LOSE="YOU LOSE",TEXT_CREDITS_DEVELOPED="DEVELOPED BY",TEXT_VS="VS",TEXT_MATCH=
"MATCH",TEXT_SELECT_TEAM="SELECT YOUR TEAM",TEXT_MATCHES="MATCHES",TEXT_ERR_LS="YOUR WEB BROWSER DOES NOT SUPPORT LOCAL STORAGE. IF YOU'RE USING SAFARI, IT MAY BE RELATED TO PRIVATE BROWSING. AS A RESULT, SOME INFO MAY NOT BE SAVED OR SOME FEATURES MAY NOT BE AVAILABLE.",TEXT_TEAM="RUSSIA;JAPAN;IRAN;BRAZIL;MEXICO;BELGIUM;SOUTH KOREA;SAUDI ARABIA;GERMANY;ENGLAND;SPAIN;NIGERIA;COSTA RICA;POLAND;EGYPT;SERBIA;ICELAND;FRANCE;PORTUGAL;URUGUAY;ARGENTINA;COLOMBIA;PANAMA;SENEGAL;MOROCCO;TUNISIA;SWITZERLAND;CROATIA;SWEDEN;DENMARK;AUSTRALIA;PERU".split(";"),
TEXT_SHARE_IMAGE="200x200.jpg",TEXT_SHARE_TITLE="Congratulations!",TEXT_SHARE_MSG1="You collected <strong>",TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!",TEXT_SHARE_SHARE1="My score is ",TEXT_SHARE_SHARE2=" points! Can you do better?";
function CPreloader(){var g,e,d,m,a,c,b,k,h,f;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();f=new createjs.Container;s_oStage.addChild(f)};this.unload=function(){f.removeAllChildren();h.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var l=new createjs.Shape;l.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.addChild(l);l=s_oSpriteLibrary.getSprite("200x200");b=createBitmap(l);b.regX=.5*l.width;b.regY=.5*l.height;b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2-180;f.addChild(b);k=new createjs.Shape;k.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(b.x-100,b.y-100,200,200,10);f.addChild(k);b.mask=k;
l=s_oSpriteLibrary.getSprite("progress_bar");m=createBitmap(l);m.x=CANVAS_WIDTH/2-l.width/2;m.y=CANVAS_HEIGHT/2+50;f.addChild(m);g=l.width;e=l.height;a=new createjs.Shape;a.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(m.x,m.y,1,e);f.addChild(a);m.mask=a;d=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2+100;d.textBaseline="alphabetic";d.textAlign="center";f.addChild(d);l=s_oSpriteLibrary.getSprite("but_start");h=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2,l,TEXT_PRELOADER_CONTINUE,"Arial","#000",40,f);h.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);h.setVisible(!1);c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.addChild(c);createjs.Tween.get(c).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(c);f.removeChild(c)})};this._onButStartRelease=function(){s_oMain._onRemovePreloader()};this.refreshLoader=function(l){d.text=l+"%";100===l&&(s_oMain._onRemovePreloader(),h.setVisible(!1),
d.visible=!1,m.visible=!1);a.graphics.clear();l=Math.floor(l*g/100);a.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(m.x,m.y,l,e)};this._init()}
function CMain(g){var e,d=0,m=0,a=STATE_LOADING,c,b;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(canvas);createjs.Touch.enable(s_oStage,!0);s_oStage.preventSelection=!1;s_bMobile=isMobile();!1===s_bMobile?(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(h){return!1}),FPS=FPS_DESKTOP,FPS_TIME=1/FPS,PHYSICS_STEP=1/(FPS*STEP_RATE),ROLL_BALL_RATE=60/FPS):BALL_VELOCITY_MULTIPLIER=.8;s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",
this._update);createjs.Ticker.framerate=FPS;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;seekAndDestroy()?c=new CPreloader:window.location.href="http://www.codethislab.com/contact-us.html";e=!0};this.soundLoaded=function(){d++;c.refreshLoader(Math.floor(d/m*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"drop_bounce_grass",loop:!1,volume:1,ingamename:"drop_bounce_grass"});
s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,volume:1,ingamename:"click"});s_aSoundsInfo.push({path:"./sounds/",filename:"kick",loop:!1,volume:1,ingamename:"kick"});s_aSoundsInfo.push({path:"./sounds/",filename:"ball_saved",loop:!1,volume:1,ingamename:"ball_saved"});s_aSoundsInfo.push({path:"./sounds/",filename:"goal_keeper",loop:!1,volume:1,ingamename:"goal_keeper"});s_aSoundsInfo.push({path:"./sounds/",filename:"goal_striker",loop:!1,volume:1,ingamename:"goal_striker"});s_aSoundsInfo.push({path:"./sounds/",
filename:"keep_ball",loop:!1,volume:1,ingamename:"keep_ball"});s_aSoundsInfo.push({path:"./sounds/",filename:"pole",loop:!1,volume:1,ingamename:"pole"});s_aSoundsInfo.push({path:"./sounds/",filename:"win",loop:!1,volume:1,ingamename:"win"});s_aSoundsInfo.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});s_aSoundsInfo.push({path:"./sounds/",filename:"crowd",loop:!0,volume:1,ingamename:"crowd"});m+=s_aSoundsInfo.length;s_aSounds=[];for(var h=0;h<s_aSoundsInfo.length;h++)this.tryToLoadSound(s_aSoundsInfo[h],
!1)};this.tryToLoadSound=function(h,f){setTimeout(function(){s_aSounds[h.ingamename]=new Howl({src:[h.path+h.filename+".mp3"],autoplay:!1,preload:!0,loop:h.loop,volume:h.volume,onload:s_oMain.soundLoaded,onloaderror:function(l,p){for(var q=0;q<s_aSoundsInfo.length;q++)if(l===s_aSounds[s_aSoundsInfo[q].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[q],!0);break}},onplayerror:function(l){for(var p=0;p<s_aSoundsInfo.length;p++)if(l===s_aSounds[s_aSoundsInfo[p].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[p].ingamename].once("unlock",
function(){s_aSounds[s_aSoundsInfo[p].ingamename].play();"soundtrack"===s_aSoundsInfo[p].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},f?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_fullscreen",
"./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("ball","./sprites/ball.png");s_oSpriteLibrary.addSprite("ball_shadow","./sprites/ball_shadow.png");s_oSpriteLibrary.addSprite("start_ball","./sprites/start_ball.png");s_oSpriteLibrary.addSprite("hand_touch","./sprites/hand_touch.png");s_oSpriteLibrary.addSprite("cursor","./sprites/cursor.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("msg_box_small","./sprites/msg_box_small.png");s_oSpriteLibrary.addSprite("bg_levelselect",
"./sprites/bg_levelselect.jpg");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_level_locked","./sprites/but_level_locked.png");s_oSpriteLibrary.addSprite("but_next",
"./sprites/but_next.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_delete_savings","./sprites/but_delete_savings.png");s_oSpriteLibrary.addSprite("ball_kick","./sprites/ball_kick.png");s_oSpriteLibrary.addSprite("score_side_bg","./sprites/score_side_bg.png");for(var h=0;h<NUM_TEAMS;h++)s_oSpriteLibrary.addSprite("flag_"+h,"./sprites/flags/flag_"+h+".png");s_oSpriteLibrary.addSprite("bg_game_striker",
"./sprites/striker/bg_game_striker.jpg");s_oSpriteLibrary.addSprite("goal_0","./sprites/striker/goal_0.png");for(h=0;22>h;h++)for(var f=0;31>f;f++)s_oSpriteLibrary.addSprite("player_"+h+"_"+f,"./sprites/striker/player/player_"+h+"_"+f+".png");for(h=0;2>h;h++)for(f=0;f<SPRITE_NAME_GOALKEEPER.length;f++)for(var l=0;l<NUM_SPRITE_GOALKEEPER[f];l++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[f]+"_"+h+"_"+l,"./sprites/striker/goalkeeper/gk_"+h+"/"+SPRITE_NAME_GOALKEEPER[f]+"/"+SPRITE_NAME_GOALKEEPER[f]+
"_"+h+"_"+l+".png");s_oSpriteLibrary.addSprite("bg_game_gk","./sprites/goalkeeper/bg_game_gk.jpg");s_oSpriteLibrary.addSprite("gloves","./sprites/goalkeeper/gloves.png");s_oSpriteLibrary.addSprite("goal_1","./sprites/goalkeeper/goal_1.png");s_oSpriteLibrary.addSprite("help_mouse","./sprites/goalkeeper/help_mouse.png");s_oSpriteLibrary.addSprite("help_touch","./sprites/goalkeeper/help_touch.png");for(h=0;h<NUM_TEAMS;h++)s_oSpriteLibrary.addSprite("opponent_"+h,"./sprites/goalkeeper/opponent_"+h+".png");
m+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){d++;c.refreshLoader(Math.floor(d/m*100))};this._onAllImagesLoaded=function(){};this.preloaderReady=function(){d=0;!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();this._loadImages();e=!0};this._onRemovePreloader=function(){c.unload();try{saveItem("ls_available","ok")}catch(h){s_bStorageAvailable=!1}this.gotoMenu();s_oSoundtrack=playSound("soundtrack",1,!0)};this.saveMatch=function(h,f,
l,p,q){saveItem(LOCALSTORAGE_STRING+"match_"+h,JSON.stringify({opponent:f,result:l,score:q,level_score:p}))};this.saveTeam=function(h){s_iTeamSelected=h;saveItem(LOCALSTORAGE_STRING+"team",s_iTeamSelected)};this.saveLevel=function(h){s_iLastLevel=h;saveItem(LOCALSTORAGE_STRING+"level",s_iLastLevel)};this.getStoredTeamSelected=function(){return getItem(LOCALSTORAGE_STRING+"team")};this.getMatches=function(){if(null===getItem(LOCALSTORAGE_STRING+"match_1"))return null;for(var h=[],f=1;f<NUM_MATCHES+
1;f++)h.push(JSON.parse(getItem(LOCALSTORAGE_STRING+"match_"+f)));return h};this.getLastLevel=function(){var h=getItem(LOCALSTORAGE_STRING+"level");return null===h?1:h};this.getScoreMatch=function(h){h=getItem(LOCALSTORAGE_STRING+"match_"+h);return JSON.parse(h).level_score};this.getScoreTillLevel=function(h){if(!s_bStorageAvailable)return 0;for(var f=0,l=0;l<h-1;l++)f+=this.getScoreMatch(l+1);return f};this.gotoMenu=function(){new CMenu;a=STATE_MENU};this.gotoLevelPanel=function(){new CLevelMenu;
a=STATE_CHOOSE_LEVEL};this.gotoSelectTeam=function(){new CSelectTeamMenu;a=STATE_CHOOSE_TEAM};this.gotoGame=function(h){b=new CGame(k,h);a=STATE_GAME};this.gotoHelp=function(){new CHelp;a=STATE_HELP};this.stopUpdateNoBlock=function(){e=!1;createjs.Ticker.paused=!0};this.startUpdateNoBlock=function(){s_iPrevTime=(new Date).getTime();e=!0;createjs.Ticker.paused=!1};this.stopUpdate=function(){e=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||
Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();e=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(h){if(!1!==e){var f=(new Date).getTime();s_iTimeElaps=f-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=f;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);a===STATE_GAME&&b.update();s_oStage.update(h)}};s_oMain=this;var k=
g;ENABLE_FULLSCREEN=g.fullscreen;ENABLE_CHECK_ORIENTATION=g.check_orientation;s_bAudioActive=g.audio_enable_on_startup;this.initContainer()}
var s_bMobile,s_bAudioActive=!1,s_bFullscreen=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oPhysicsController,s_iCanvasResizeHeight,s_iCanvasResizeWidth,s_iCanvasOffsetHeight,s_iCanvasOffsetWidth,s_oDrawLayer,s_oStage,s_oCanvas,s_oMain,s_oSpriteLibrary,s_oSoundTrack=null,s_iLastLevel=1,s_iTeamSelected,s_aSounds,s_aSoundsInfo,s_bStorageAvailable=!0;
function CTextButton(g,e,d,m,a,c,b,k){var h,f,l,p,q,n,t,r,u,v;this._init=function(B,A,J,T,R,H,U){h=!1;f=1;l=[];p=[];v=createBitmap(J);r=new createjs.Container;r.x=B;r.y=A;r.regX=J.width/2;r.regY=J.height/2;s_bMobile||(r.cursor="pointer");r.addChild(v,u);k.addChild(r);u=new CTLText(r,40,0,J.width-80,J.height,U,"center",H,R,1,2,2,T,!0,!0,!1,!1);this._initListener()};this.unload=function(){r.off("mousedown",q);r.off("pressup",n);k.removeChild(r)};this.setVisible=function(B){r.visible=B};this.setAlign=
function(B){u.textAlign=B};this.setTextX=function(B){u.x=B};this.setScale=function(B){f=r.scaleX=r.scaleY=B};this.enable=function(){h=!1};this.disable=function(){h=!0};this._initListener=function(){q=r.on("mousedown",this.buttonDown);n=r.on("pressup",this.buttonRelease)};this.addEventListener=function(B,A,J){l[B]=A;p[B]=J};this.addEventListenerWithParams=function(B,A,J,T){l[B]=A;p[B]=J;t=T};this.buttonRelease=function(){h||(playSound("but_click",1,!1),r.scaleX=f,r.scaleY=f,l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(p[ON_MOUSE_UP],
t))};this.buttonDown=function(){h||(r.scaleX=.9*f,r.scaleY=.9*f,l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(p[ON_MOUSE_DOWN]))};this.setPosition=function(B,A){r.x=B;r.y=A};this.tweenPosition=function(B,A,J,T,R,H,U){createjs.Tween.get(r).wait(T).to({x:B,y:A},J,R).call(function(){void 0!==H&&H.call(U)})};this.changeText=function(B){u.refreshText(B)};this.setX=function(B){r.x=B};this.setY=function(B){r.y=B};this.getButtonImage=function(){return r};this.getX=function(){return r.x};this.getY=function(){return r.y};
this.getSprite=function(){return r};this.getScale=function(){return r.scaleX};this._init(g,e,d,m,a,c,b)}
function CToggle(g,e,d,m,a){var c,b,k,h,f;this._init=function(l,p,q,n,t){f=void 0!==t?t:s_oStage;b=[];k=[];t=new createjs.SpriteSheet({images:[q],frames:{width:q.width/2,height:q.height,regX:q.width/2/2,regY:q.height/2},animations:{state_true:[0],state_false:[1]}});c=n;h=createSprite(t,"state_"+c,q.width/2/2,q.height/2,q.width/2,q.height);h.x=l;h.y=p;h.stop();s_bMobile||(h.cursor="pointer");f.addChild(h);this._initListener()};this.unload=function(){h.off("mousedown",this.buttonDown);h.off("pressup",
this.buttonRelease);f.removeChild(h)};this._initListener=function(){h.on("mousedown",this.buttonDown);h.on("pressup",this.buttonRelease)};this.addEventListener=function(l,p,q){b[l]=p;k[l]=q};this.setCursorType=function(l){h.cursor=l};this.setActive=function(l){c=l;h.gotoAndStop("state_"+c)};this.buttonRelease=function(){h.scaleX=1;h.scaleY=1;playSound("click",1,!1);c=!c;h.gotoAndStop("state_"+c);b[ON_MOUSE_UP]&&b[ON_MOUSE_UP].call(k[ON_MOUSE_UP],c)};this.buttonDown=function(){h.scaleX=.9;h.scaleY=
.9;b[ON_MOUSE_DOWN]&&b[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN])};this.setPosition=function(l,p){h.x=l;h.y=p};this._init(g,e,d,m,a)}
function CGfxButton(g,e,d,m){var a,c,b,k,h,f,l=!1;this._init=function(n,t,r){a=[];c=[];k=[];b=createBitmap(r);b.x=n;b.y=t;f=h=1;b.regX=r.width/2;b.regY=r.height/2;s_bMobile||(b.cursor="pointer");p.addChild(b);this._initListener()};this.unload=function(){b.off("mousedown",this.buttonDown);b.off("pressup",this.buttonRelease);p.removeChild(b)};this.setVisible=function(n){b.visible=n};this.setCursorType=function(n){b.cursor=n};this._initListener=function(){b.on("mousedown",this.buttonDown);b.on("pressup",
this.buttonRelease)};this.addEventListener=function(n,t,r){a[n]=t;c[n]=r};this.addEventListenerWithParams=function(n,t,r,u){a[n]=t;c[n]=r;k[n]=u};this.buttonRelease=function(){l||(b.scaleX=0<h?1:-1,b.scaleY=1,playSound("click",1,!1),a[ON_MOUSE_UP]&&a[ON_MOUSE_UP].call(c[ON_MOUSE_UP],k[ON_MOUSE_UP]))};this.buttonDown=function(){l||(b.scaleX=0<h?.9:-.9,b.scaleY=.9,a[ON_MOUSE_DOWN]&&a[ON_MOUSE_DOWN].call(c[ON_MOUSE_DOWN],k[ON_MOUSE_DOWN]))};this.rotation=function(n){b.rotation=n};this.getButton=function(){return b};
this.setPosition=function(n,t){b.x=n;b.y=t};this.setX=function(n){b.x=n};this.setY=function(n){b.y=n};this.getButtonImage=function(){return b};this.block=function(n){l=n;b.scaleX=h;b.scaleY=f};this.setScaleX=function(n){h=b.scaleX=n};this.getX=function(){return b.x};this.getY=function(){return b.y};this.pulseAnimation=function(){createjs.Tween.get(b).to({scaleX:.9*h,scaleY:.9*f},850,createjs.Ease.quadOut).to({scaleX:h,scaleY:f},650,createjs.Ease.quadIn).call(function(){q.pulseAnimation()})};this.trebleAnimation=
function(){createjs.Tween.get(b).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){q.trebleAnimation()})};this.removeAllTweens=function(){createjs.Tween.removeTweens(b)};var p=void 0!==m?m:s_oStage;this._init(g,e,d);var q=this;return this}
function CMenu(){var g,e,d,m,a,c,b,k,h,f,l,p,q,n,t,r,u,v,B=null,A=null;this._init=function(){l=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(l);var J=s_oSpriteLibrary.getSprite("but_play");b=CANVAS_WIDTH/2+160;k=CANVAS_HEIGHT-130;p=new CGfxButton(b,k,J);p.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);p.pulseAnimation();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)J=s_oSpriteLibrary.getSprite("audio_icon"),h=CANVAS_WIDTH-J.height/2-10,f=J.height/2+10,u=new CToggle(h,
f,J,s_bAudioActive),u.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);J=window.document;var T=J.documentElement;B=T.requestFullscreen||T.mozRequestFullScreen||T.webkitRequestFullScreen||T.msRequestFullscreen;A=J.exitFullscreen||J.mozCancelFullScreen||J.webkitExitFullscreen||J.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(B=!1);J=s_oSpriteLibrary.getSprite("but_info");a=J.height/2+10;c=J.height/2+10;q=new CGfxButton(a,c,J,s_oStage);q.addEventListener(ON_MOUSE_UP,this._onButInfoRelease,this);B&&
screenfull.isEnabled&&(J=s_oSpriteLibrary.getSprite("but_fullscreen"),d=a+J.width/2+10,m=J.height/2+10,v=new CToggle(d,m,J,s_bFullscreen,s_oStage),v.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));J=s_oSpriteLibrary.getSprite("but_delete_savings");g=J.width/2+10;e=CANVAS_HEIGHT-J.height/2-10;n=new CGfxButton(g,e,J,s_oStage);n.addEventListener(ON_MOUSE_UP,this._onDeleteSavings,this);t=new CAreYouSurePanel(s_oStage);t.addEventListener(ON_BUT_YES_DOWN,this._onConfirmDelete,this);r=new createjs.Shape;
r.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(r);createjs.Tween.get(r).to({alpha:0},1E3).call(function(){r.visible=!1});s_bStorageAvailable||new CMsgBox(TEXT_ERR_LS,s_oStage);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(J,T){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||u.setPosition(h-J,T+f);B&&screenfull.isEnabled&&v.setPosition(d+J,m+T);q.setPosition(a+J,c+T);n.setPosition(g+J,e-T)};this.unload=function(){p.unload();p=null;
if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)u.unload(),u=null;B&&screenfull.isEnabled&&v.unload();n.unload();t.unload();s_oStage.removeAllChildren();s_oMenu=null};this._onButPlayRelease=function(){this.unload();null===s_oMain.getStoredTeamSelected()?s_oMain.gotoSelectTeam():(s_iTeamSelected=s_oMain.getStoredTeamSelected(),s_iLastLevel=s_oMain.getLastLevel(),s_oMain.gotoLevelPanel())};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButInfoRelease=
function(){new CCreditsPanel};this.resetFullscreenBut=function(){B&&screenfull.isEnabled&&v.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?A.call(window.document):B.call(window.document.documentElement);sizeHandler()};this._onDeleteSavings=function(){t.show(TEXT_CONFIRM_DELETE)};this._onConfirmDelete=function(){s_iLastLevel=1;clearAllItem()};s_oMenu=this;this._init()}var s_oMenu=null;
!function(g){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=g();else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);e.CANNON=g()}}(function(){return function a(e,d,m){function c(h,f){if(!d[h]){if(!e[h]){var l="function"==typeof require&&require;if(!f&&l)return l(h,!0);if(b)return b(h,!0);throw Error("Cannot find module '"+h+"'");}l=d[h]={exports:{}};e[h][0].call(l.exports,function(p){var q=e[h][1][p];return c(q?
q:p)},l,l.exports,a,e,d,m)}return d[h].exports}for(var b="function"==typeof require&&require,k=0;k<m.length;k++)c(m[k]);return c}({1:[function(e,d,m){d.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(e,d,m){d.exports={version:e("../package.json").version,AABB:e("./collision/AABB"),ArrayCollisionMatrix:e("./collision/ArrayCollisionMatrix"),
Body:e("./objects/Body"),Box:e("./shapes/Box"),Broadphase:e("./collision/Broadphase"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),Narrowphase:e("./world/Narrowphase"),ConeTwistConstraint:e("./constraints/ConeTwistConstraint"),ContactMaterial:e("./material/ContactMaterial"),ConvexPolyhedron:e("./shapes/ConvexPolyhedron"),Cylinder:e("./shapes/Cylinder"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventTarget:e("./utils/EventTarget"),
FrictionEquation:e("./equations/FrictionEquation"),GSSolver:e("./solver/GSSolver"),GridBroadphase:e("./collision/GridBroadphase"),Heightfield:e("./shapes/Heightfield"),HingeConstraint:e("./constraints/HingeConstraint"),LockConstraint:e("./constraints/LockConstraint"),Mat3:e("./math/Mat3"),Material:e("./material/Material"),NaiveBroadphase:e("./collision/NaiveBroadphase"),ObjectCollisionMatrix:e("./collision/ObjectCollisionMatrix"),Pool:e("./utils/Pool"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),
PointToPointConstraint:e("./constraints/PointToPointConstraint"),Quaternion:e("./math/Quaternion"),Ray:e("./collision/Ray"),RaycastVehicle:e("./objects/RaycastVehicle"),RaycastResult:e("./collision/RaycastResult"),RigidVehicle:e("./objects/RigidVehicle"),RotationalEquation:e("./equations/RotationalEquation"),RotationalMotorEquation:e("./equations/RotationalMotorEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),SPHSystem:e("./objects/SPHSystem"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),
Sphere:e("./shapes/Sphere"),SplitSolver:e("./solver/SplitSolver"),Spring:e("./objects/Spring"),Trimesh:e("./shapes/Trimesh"),Vec3:e("./math/Vec3"),Vec3Pool:e("./utils/Vec3Pool"),World:e("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(e,d,m){function a(h){h=h||{};
this.lowerBound=new c;h.lowerBound&&this.lowerBound.copy(h.lowerBound);this.upperBound=new c;h.upperBound&&this.upperBound.copy(h.upperBound)}var c=e("../math/Vec3");e("../utils/Utils");d.exports=a;var b=new c;a.prototype.setFromPoints=function(h,f,l,p){var q=this.lowerBound,n=this.upperBound;q.copy(h[0]);l&&l.vmult(q,q);n.copy(q);for(var t=1;t<h.length;t++){var r=h[t];l&&(l.vmult(r,b),r=b);r.x>n.x&&(n.x=r.x);r.x<q.x&&(q.x=r.x);r.y>n.y&&(n.y=r.y);r.y<q.y&&(q.y=r.y);r.z>n.z&&(n.z=r.z);r.z<q.z&&(q.z=
r.z)}f&&(f.vadd(q,q),f.vadd(n,n));p&&(q.x-=p,q.y-=p,q.z-=p,n.x+=p,n.y+=p,n.z+=p);return this};a.prototype.copy=function(h){this.lowerBound.copy(h.lowerBound);this.upperBound.copy(h.upperBound);return this};a.prototype.clone=function(){return(new a).copy(this)};a.prototype.extend=function(h){var f=h.lowerBound.x;this.lowerBound.x>f&&(this.lowerBound.x=f);f=h.upperBound.x;this.upperBound.x<f&&(this.upperBound.x=f);f=h.lowerBound.y;this.lowerBound.y>f&&(this.lowerBound.y=f);f=h.upperBound.y;this.upperBound.y<
f&&(this.upperBound.y=f);f=h.lowerBound.z;this.lowerBound.z>f&&(this.lowerBound.z=f);f=h.upperBound.z;this.upperBound.z<f&&(this.upperBound.z=f)};a.prototype.overlaps=function(h){var f=this.lowerBound,l=this.upperBound,p=h.lowerBound;h=h.upperBound;return(p.x<=l.x&&l.x<=h.x||f.x<=h.x&&h.x<=l.x)&&(p.y<=l.y&&l.y<=h.y||f.y<=h.y&&h.y<=l.y)&&(p.z<=l.z&&l.z<=h.z||f.z<=h.z&&h.z<=l.z)};a.prototype.contains=function(h){var f=this.lowerBound,l=this.upperBound,p=h.lowerBound;h=h.upperBound;return f.x<=p.x&&
l.x>=h.x&&f.y<=p.y&&l.y>=h.y&&f.z<=p.z&&l.z>=h.z};a.prototype.getCorners=function(h,f,l,p,q,n,t,r){var u=this.lowerBound,v=this.upperBound;h.copy(u);f.set(v.x,u.y,u.z);l.set(v.x,v.y,u.z);p.set(u.x,v.y,v.z);q.set(v.x,u.y,u.z);n.set(u.x,v.y,u.z);t.set(u.x,u.y,v.z);r.copy(v)};var k=[new c,new c,new c,new c,new c,new c,new c,new c];a.prototype.toLocalFrame=function(h,f){this.getCorners(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);for(var l=0;8!==l;l++){var p=k[l];h.pointToLocal(p,p)}return f.setFromPoints(k)};
a.prototype.toWorldFrame=function(h,f){this.getCorners(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);for(var l=0;8!==l;l++){var p=k[l];h.pointToWorld(p,p)}return f.setFromPoints(k)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(e,d,m){function a(){this.matrix=[]}d.exports=a;a.prototype.get=function(c,b){c=c.index;b=b.index;if(b>c){var k=b;b=c;c=k}return this.matrix[(c*(c+1)>>1)+b-1]};a.prototype.set=function(c,b,k){c=c.index;b=b.index;if(b>c){var h=b;b=c;c=h}this.matrix[(c*(c+1)>>1)+b-1]=k?1:0};
a.prototype.reset=function(){for(var c=0,b=this.matrix.length;c!==b;c++)this.matrix[c]=0};a.prototype.setNumObjects=function(c){this.matrix.length=c*(c-1)>>1}},{}],5:[function(e,d,m){function a(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var c=e("../objects/Body");m=e("../math/Vec3");var b=e("../math/Quaternion");e("../shapes/Shape");e("../shapes/Plane");d.exports=a;a.prototype.collisionPairs=function(n,t,r){throw Error("collisionPairs not implemented for this BroadPhase class!");};var k=
c.STATIC|c.KINEMATIC;a.prototype.needBroadphaseCollision=function(n,t){return 0!==(n.collisionFilterGroup&t.collisionFilterMask)&&0!==(t.collisionFilterGroup&n.collisionFilterMask)&&(0===(n.type&k)&&n.sleepState!==c.SLEEPING||0===(t.type&k)&&t.sleepState!==c.SLEEPING)?!0:!1};a.prototype.intersectionTest=function(n,t,r,u){this.useBoundingBoxes?this.doBoundingBoxBroadphase(n,t,r,u):this.doBoundingSphereBroadphase(n,t,r,u)};var h=new m;new m;new b;new m;a.prototype.doBoundingSphereBroadphase=function(n,
t,r,u){t.position.vsub(n.position,h);var v=Math.pow(n.boundingRadius+t.boundingRadius,2);h.norm2()<v&&(r.push(n),u.push(t))};a.prototype.doBoundingBoxBroadphase=function(n,t,r,u){n.aabbNeedsUpdate&&n.computeAABB();t.aabbNeedsUpdate&&t.computeAABB();n.aabb.overlaps(t.aabb)&&(r.push(n),u.push(t))};var f={keys:[]},l=[],p=[];a.prototype.makePairsUnique=function(n,t){for(var r=n.length,u=0;u!==r;u++)l[u]=n[u],p[u]=t[u];n.length=0;for(u=t.length=0;u!==r;u++){var v=l[u].id,B=p[u].id;v=v<B?v+","+B:B+","+
v;f[v]=u;f.keys.push(v)}for(u=0;u!==f.keys.length;u++)v=f.keys.pop(),r=f[v],n.push(l[r]),t.push(p[r]),delete f[v]};a.prototype.setWorld=function(n){};var q=new m;a.boundingSphereCheck=function(n,t){n.position.vsub(t.position,q);return Math.pow(n.shape.boundingSphereRadius+t.shape.boundingSphereRadius,2)>q.norm2()};a.prototype.aabbQuery=function(n,t,r){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,
"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(e,d,m){function a(f,l,p,q,n){c.apply(this);this.nx=p||10;this.ny=q||10;this.nz=n||10;this.aabbMin=f||new b(100,100,100);this.aabbMax=l||new b(-100,-100,-100);f=this.nx*this.ny*this.nz;if(0>=f)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=f;this.binLengths.length=f;for(l=0;l<f;l++)this.bins[l]=[],this.binLengths[l]=0}d.exports=a;var c=e("./Broadphase"),b=e("../math/Vec3"),k=e("../shapes/Shape");
a.prototype=new c;a.prototype.constructor=a;var h=new b;new b;a.prototype.collisionPairs=function(f,l,p){function q(V,ba,da,na,ua,ra,Da){V=(V-U)*N|0;ba=(ba-C)*G|0;da=(da-K)*X|0;na=w((na-U)*N);ua=w((ua-C)*G);ra=w((ra-K)*X);0>V?V=0:V>=u&&(V=u-1);0>ba?ba=0:ba>=v&&(ba=v-1);0>da?da=0:da>=B&&(da=B-1);0>na?na=0:na>=u&&(na=u-1);0>ua?ua=0:ua>=v&&(ua=v-1);0>ra?ra=0:ra>=B&&(ra=B-1);V*=A;ba*=J;da*=1;na*=A;ua*=J;for(ra*=1;V<=na;V+=A)for(var Ra=ba;Ra<=ua;Ra+=J)for(var Sa=da;Sa<=ra;Sa+=1){var Ua=V+Ra+Sa;D[Ua][y[Ua]++]=
Da}}var n=f.numObjects();f=f.bodies;var t=this.aabbMax,r=this.aabbMin,u=this.nx,v=this.ny,B=this.nz,A=v*B,J=B,T=t.x,R=t.y,H=t.z,U=r.x,C=r.y,K=r.z,N=u/(T-U),G=v/(R-C),X=B/(H-K);T=(T-U)/u;var M=(R-C)/v;H=(H-K)/B;var E=.5*Math.sqrt(T*T+M*M+H*H);R=k.types;var I=R.SPHERE,z=R.PLANE,D=this.bins,y=this.binLengths;R=this.bins.length;for(r=0;r!==R;r++)y[r]=0;var w=Math.ceil;r=Math.min;t=Math.max;for(r=0;r!==n;r++){t=f[r];var x=t.shape;switch(x.type){case I:var F=t.position.x,Q=t.position.y,P=t.position.z;x=
x.radius;q(F-x,Q-x,P-x,F+x,Q+x,P+x,t);break;case z:x.worldNormalNeedsUpdate&&x.computeWorldNormal(t.quaternion);P=x.worldNormal;x=C+.5*M-t.position.y;var L=K+.5*H-t.position.z,W=h;W.set(U+.5*T-t.position.x,x,L);for(var ca=F=0;F!==u;F++,ca+=A,W.y=x,W.x+=T)for(var O=Q=0;Q!==v;Q++,O+=J,W.z=L,W.y+=M)for(var qa=0,la=0;qa!==B;qa++,la+=1,W.z+=H)if(W.dot(P)<E){var fa=ca+O+la;D[fa][y[fa]++]=t}break;default:t.aabbNeedsUpdate&&t.computeAABB(),q(t.aabb.lowerBound.x,t.aabb.lowerBound.y,t.aabb.lowerBound.z,t.aabb.upperBound.x,
t.aabb.upperBound.y,t.aabb.upperBound.z,t)}}for(r=0;r!==R;r++)if(n=y[r],1<n)for(f=D[r],F=0;F!==n;F++)for(t=f[F],Q=0;Q!==F;Q++)T=f[Q],this.needBroadphaseCollision(t,T)&&this.intersectionTest(t,T,l,p);this.makePairsUnique(l,p)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(e,d,m){function a(){c.apply(this)}d.exports=a;var c=e("./Broadphase");e=e("./AABB");a.prototype=new c;a.prototype.constructor=a;a.prototype.collisionPairs=function(b,k,h){b=b.bodies;var f=b.length,l,p;for(l=
0;l!==f;l++)for(p=0;p!==l;p++){var q=b[l];var n=b[p];this.needBroadphaseCollision(q,n)&&this.intersectionTest(q,n,k,h)}};new e;a.prototype.aabbQuery=function(b,k,h){h=h||[];for(var f=0;f<b.bodies.length;f++){var l=b.bodies[f];l.aabbNeedsUpdate&&l.computeAABB();l.aabb.overlaps(k)&&h.push(l)}return h}},{"./AABB":3,"./Broadphase":5}],8:[function(e,d,m){function a(){this.matrix={}}d.exports=a;a.prototype.get=function(c,b){c=c.id;b=b.id;if(b>c){var k=b;b=c;c=k}return c+"-"+b in this.matrix};a.prototype.set=
function(c,b,k){c=c.id;b=b.id;if(b>c){var h=b;b=c;c=h}k?this.matrix[c+"-"+b]=!0:delete this.matrix[c+"-"+b]};a.prototype.reset=function(){this.matrix={}};a.prototype.setNumObjects=function(c){}},{}],9:[function(e,d,m){function a(D,y){this.from=D?D.clone():new b;this.to=y?y.clone():new b;this._direction=new b;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=a.ANY;this.result=new h;this.hasHit=!1;this.callback=function(w){}}
function c(D,y,w,x){x.vsub(y,I);w.vsub(y,p);D.vsub(y,q);D=I.dot(I);y=I.dot(p);w=I.dot(q);x=p.dot(p);var F=p.dot(q),Q,P;return 0<=(Q=x*w-y*F)&&0<=(P=D*F-y*w)&&Q+P<D*x-y*y}d.exports=a;var b=e("../math/Vec3");d=e("../math/Quaternion");var k=e("../math/Transform");e("../shapes/ConvexPolyhedron");e("../shapes/Box");var h=e("../collision/RaycastResult");m=e("../shapes/Shape");e=e("../collision/AABB");a.prototype.constructor=a;a.CLOSEST=1;a.ANY=2;a.ALL=4;var f=new e,l=[];a.prototype.intersectWorld=function(D,
y){this.mode=y.mode||a.ANY;this.result=y.result||new h;this.skipBackfaces=!!y.skipBackfaces;this.collisionFilterMask="undefined"!==typeof y.collisionFilterMask?y.collisionFilterMask:-1;this.collisionFilterGroup="undefined"!==typeof y.collisionFilterGroup?y.collisionFilterGroup:-1;y.from&&this.from.copy(y.from);y.to&&this.to.copy(y.to);this.callback=y.callback||function(){};this.hasHit=!1;this.result.reset();this._updateDirection();this.getAABB(f);l.length=0;D.broadphase.aabbQuery(D,f,l);this.intersectBodies(l);
return this.hasHit};var p=new b,q=new b;a.pointInTriangle=c;var n=new b,t=new d;a.prototype.intersectBody=function(D,y){y&&(this.result=y,this._updateDirection());var w=this.checkCollisionResponse;if((!w||D.collisionResponse)&&0!==(this.collisionFilterGroup&D.collisionFilterMask)&&0!==(D.collisionFilterGroup&this.collisionFilterMask))for(var x=0,F=D.shapes.length;x<F;x++){var Q=D.shapes[x];if(!w||Q.collisionResponse)if(D.quaternion.mult(D.shapeOrientations[x],t),D.quaternion.vmult(D.shapeOffsets[x],
n),n.vadd(D.position,n),this.intersectShape(Q,t,n,D),this.result._shouldStop)break}};a.prototype.intersectBodies=function(D,y){y&&(this.result=y,this._updateDirection());for(var w=0,x=D.length;!this.result._shouldStop&&w<x;w++)this.intersectBody(D[w])};a.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};a.prototype.intersectShape=function(D,y,w,x){var F=this.from,Q=this._direction;w.vsub(F,I);var P=I.dot(Q);Q.mult(P,z);z.vadd(F,z);w.distanceTo(z)>
D.boundingSphereRadius||(F=this[D.type])&&F.call(this,D,y,w,x)};new b;new b;var r=new b,u=new b,v=new b,B=new b;new b;new h;a.prototype.intersectBox=function(D,y,w,x){return this.intersectConvex(D.convexPolyhedronRepresentation,y,w,x)};a.prototype[m.types.BOX]=a.prototype.intersectBox;a.prototype.intersectPlane=function(D,y,w,x){var F=this.from,Q=this.to,P=this._direction,L=new b(0,0,1);y.vmult(L,L);var W=new b;F.vsub(w,W);y=W.dot(L);Q.vsub(w,W);W=W.dot(L);if(!(0<y*W||F.distanceTo(Q)<y||(W=L.dot(P),
Math.abs(W)<this.precision))){var ca=new b;Q=new b;y=new b;F.vsub(w,ca);w=-L.dot(ca)/W;P.scale(w,Q);F.vadd(Q,y);this.reportIntersection(L,y,D,x,-1)}};a.prototype[m.types.PLANE]=a.prototype.intersectPlane;a.prototype.getAABB=function(D){var y=this.to,w=this.from;D.lowerBound.x=Math.min(y.x,w.x);D.lowerBound.y=Math.min(y.y,w.y);D.lowerBound.z=Math.min(y.z,w.z);D.upperBound.x=Math.max(y.x,w.x);D.upperBound.y=Math.max(y.y,w.y);D.upperBound.z=Math.max(y.z,w.z)};var A={faceList:[0]};a.prototype.intersectHeightfield=
function(D,y,w,x){var F=new b,Q=new a(this.from,this.to);k.pointToLocalFrame(w,y,Q.from,Q.from);k.pointToLocalFrame(w,y,Q.to,Q.to);var P=[],L=null,W=null,ca=null,O=null,qa=D.getIndexOfPosition(Q.from.x,Q.from.y,P,!1);qa&&(L=P[0],W=P[1],ca=P[0],O=P[1]);if(qa=D.getIndexOfPosition(Q.to.x,Q.to.y,P,!1)){if(null===L||P[0]<L)L=P[0];if(null===ca||P[0]>ca)ca=P[0];if(null===W||P[1]<W)W=P[1];if(null===O||P[1]>O)O=P[1]}if(null!==L)for(D.getRectMinMax(L,W,ca,O,[]),Q=L;Q<=ca;Q++)for(P=W;P<=O;P++){if(this.result._shouldStop)return;
D.getConvexTrianglePillar(Q,P,!1);k.pointToWorldFrame(w,y,D.pillarOffset,F);this.intersectConvex(D.pillarConvex,y,F,x,A);if(this.result._shouldStop)return;D.getConvexTrianglePillar(Q,P,!0);k.pointToWorldFrame(w,y,D.pillarOffset,F);this.intersectConvex(D.pillarConvex,y,F,x,A)}};a.prototype[m.types.HEIGHTFIELD]=a.prototype.intersectHeightfield;var J=new b,T=new b;a.prototype.intersectSphere=function(D,y,w,x){y=this.from;var F=this.to,Q=Math.pow(F.x-y.x,2)+Math.pow(F.y-y.y,2)+Math.pow(F.z-y.z,2),P=2*
((F.x-y.x)*(y.x-w.x)+(F.y-y.y)*(y.y-w.y)+(F.z-y.z)*(y.z-w.z)),L=Math.pow(P,2)-4*Q*(Math.pow(y.x-w.x,2)+Math.pow(y.y-w.y,2)+Math.pow(y.z-w.z,2)-Math.pow(D.radius,2));if(!(0>L))if(0===L)y.lerp(F,L,J),J.vsub(w,T),T.normalize(),this.reportIntersection(T,J,D,x,-1);else{var W=(-P-Math.sqrt(L))/(2*Q);Q=(-P+Math.sqrt(L))/(2*Q);0<=W&&1>=W&&(y.lerp(F,W,J),J.vsub(w,T),T.normalize(),this.reportIntersection(T,J,D,x,-1));!this.result._shouldStop&&0<=Q&&1>=Q&&(y.lerp(F,Q,J),J.vsub(w,T),T.normalize(),this.reportIntersection(T,
J,D,x,-1))}};a.prototype[m.types.SPHERE]=a.prototype.intersectSphere;var R=new b;new b;new b;var H=new b;a.prototype.intersectConvex=function(D,y,w,x,F){F=F&&F.faceList||null;for(var Q=D.faces,P=D.vertices,L=D.faceNormals,W=this._direction,ca=this.from,O=ca.distanceTo(this.to),qa=F?F.length:Q.length,la=this.result,fa=0;!la._shouldStop&&fa<qa;fa++){var V=F?F[fa]:fa,ba=Q[V],da=L[V],na=y,ua=w;H.copy(P[ba[0]]);na.vmult(H,H);H.vadd(ua,H);H.vsub(ca,H);na.vmult(da,R);da=W.dot(R);if(!(Math.abs(da)<this.precision||
(da=R.dot(H)/da,0>da)))for(W.mult(da,r),r.vadd(ca,r),u.copy(P[ba[0]]),na.vmult(u,u),ua.vadd(u,u),da=1;!la._shouldStop&&da<ba.length-1;da++){v.copy(P[ba[da]]);B.copy(P[ba[da+1]]);na.vmult(v,v);na.vmult(B,B);ua.vadd(v,v);ua.vadd(B,B);var ra=r.distanceTo(ca);!c(r,u,v,B)&&!c(r,v,u,B)||ra>O||this.reportIntersection(R,r,D,x,V)}}};a.prototype[m.types.CONVEXPOLYHEDRON]=a.prototype.intersectConvex;var U=new b,C=new b,K=new b,N=new b,G=new b,X=new b;new e;var M=[],E=new k;a.prototype.intersectTrimesh=function(D,
y,w,x,F){F=D.indices;var Q=this.from,P=this.to,L=this._direction;E.position.copy(w);E.quaternion.copy(y);k.vectorToLocalFrame(w,y,L,C);k.pointToLocalFrame(w,y,Q,K);k.pointToLocalFrame(w,y,P,N);Q=K.distanceSquared(N);D.tree.rayQuery(this,E,M);P=0;for(L=M.length;!this.result._shouldStop&&P!==L;P++){var W=M[P];D.getNormal(W,U);D.getVertex(F[3*W],u);u.vsub(K,H);var ca=C.dot(U);ca=U.dot(H)/ca;0>ca||(C.scale(ca,r),r.vadd(K,r),D.getVertex(F[3*W+1],v),D.getVertex(F[3*W+2],B),ca=r.distanceSquared(K),!c(r,
v,u,B)&&!c(r,u,v,B)||ca>Q||(k.vectorToWorldFrame(y,U,G),k.pointToWorldFrame(w,y,r,X),this.reportIntersection(G,X,D,x,W)))}M.length=0};a.prototype[m.types.TRIMESH]=a.prototype.intersectTrimesh;a.prototype.reportIntersection=function(D,y,w,x,F){var Q=this.from,P=this.to,L=Q.distanceTo(y),W=this.result;if(!(this.skipBackfaces&&0<D.dot(this._direction)))switch(W.hitFaceIndex="undefined"!==typeof F?F:-1,this.mode){case a.ALL:this.hasHit=!0;W.set(Q,P,D,y,w,x,L);W.hasHit=!0;this.callback(W);break;case a.CLOSEST:if(L<
W.distance||!W.hasHit)this.hasHit=!0,W.hasHit=!0,W.set(Q,P,D,y,w,x,L);break;case a.ANY:this.hasHit=!0,W.hasHit=!0,W.set(Q,P,D,y,w,x,L),W._shouldStop=!0}};var I=new b,z=new b},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(e,d,m){function a(){this.rayFromWorld=new c;this.rayToWorld=new c;this.hitNormalWorld=new c;this.hitPointWorld=new c;this.hasHit=
!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var c=e("../math/Vec3");d.exports=a;a.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};a.prototype.abort=function(){this._shouldStop=!0};a.prototype.set=function(b,k,h,f,l,p,q){this.rayFromWorld.copy(b);this.rayToWorld.copy(k);this.hitNormalWorld.copy(h);
this.hitPointWorld.copy(f);this.shape=l;this.body=p;this.distance=q}},{"../math/Vec3":30}],11:[function(e,d,m){function a(b){c.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var k=this.axisList;this._addBodyHandler=function(h){k.push(h.body)};this._removeBodyHandler=function(h){h=k.indexOf(h.body);-1!==h&&k.splice(h,1)};b&&this.setWorld(b)}e("../shapes/Shape");var c=e("../collision/Broadphase");d.exports=a;a.prototype=new c;a.prototype.setWorld=function(b){for(var k=this.axisList.length=
0;k<b.bodies.length;k++)this.axisList.push(b.bodies[k]);b.removeEventListener("addBody",this._addBodyHandler);b.removeEventListener("removeBody",this._removeBodyHandler);b.addEventListener("addBody",this._addBodyHandler);b.addEventListener("removeBody",this._removeBodyHandler);this.world=b;this.dirty=!0};a.insertionSortX=function(b){for(var k=1,h=b.length;k<h;k++){for(var f=b[k],l=k-1;0<=l&&!(b[l].aabb.lowerBound.x<=f.aabb.lowerBound.x);l--)b[l+1]=b[l];b[l+1]=f}return b};a.insertionSortY=function(b){for(var k=
1,h=b.length;k<h;k++){for(var f=b[k],l=k-1;0<=l&&!(b[l].aabb.lowerBound.y<=f.aabb.lowerBound.y);l--)b[l+1]=b[l];b[l+1]=f}return b};a.insertionSortZ=function(b){for(var k=1,h=b.length;k<h;k++){for(var f=b[k],l=k-1;0<=l&&!(b[l].aabb.lowerBound.z<=f.aabb.lowerBound.z);l--)b[l+1]=b[l];b[l+1]=f}return b};a.prototype.collisionPairs=function(b,k,h){b=this.axisList;var f=b.length,l=this.axisIndex,p,q;this.dirty&&(this.sortList(),this.dirty=!1);for(p=0;p!==f;p++){var n=b[p];for(q=p+1;q<f;q++){var t=b[q];if(this.needBroadphaseCollision(n,
t)){if(!a.checkBounds(n,t,l))break;this.intersectionTest(n,t,k,h)}}}};a.prototype.sortList=function(){for(var b=this.axisList,k=this.axisIndex,h=b.length,f=0;f!==h;f++){var l=b[f];l.aabbNeedsUpdate&&l.computeAABB()}0===k?a.insertionSortX(b):1===k?a.insertionSortY(b):2===k&&a.insertionSortZ(b)};a.checkBounds=function(b,k,h){if(0===h){var f=b.position.x;var l=k.position.x}else 1===h?(f=b.position.y,l=k.position.y):2===h&&(f=b.position.z,l=k.position.z);return l-k.boundingRadius<f+b.boundingRadius};
a.prototype.autoDetectAxis=function(){for(var b=0,k=0,h=0,f=0,l=0,p=0,q=this.axisList,n=q.length,t=1/n,r=0;r!==n;r++){var u=q[r],v=u.position.x;b+=v;k+=v*v;v=u.position.y;h+=v;f+=v*v;u=u.position.z;l+=u;p+=u*u}b=k-b*b*t;h=f-h*h*t;l=p-l*l*t;this.axisIndex=b>h?b>l?0:2:h>l?1:2};a.prototype.aabbQuery=function(b,k,h){h=h||[];this.dirty&&(this.sortList(),this.dirty=!1);b=this.axisList;for(var f=0;f<b.length;f++){var l=b[f];l.aabbNeedsUpdate&&l.computeAABB();l.aabb.overlaps(k)&&h.push(l)}return h}},{"../collision/Broadphase":5,
"../shapes/Shape":43}],12:[function(e,d,m){function a(f,l,p){p=p||{};var q="undefined"!==typeof p.maxForce?p.maxForce:1E6,n=p.pivotA?p.pivotA.clone():new h,t=p.pivotB?p.pivotB.clone():new h;this.axisA=p.axisA?p.axisA.clone():new h;this.axisB=p.axisB?p.axisB.clone():new h;c.call(this,f,n,l,t,q);this.collideConnected=!!p.collideConnected;this.angle="undefined"!==typeof p.angle?p.angle:0;n=this.coneEquation=new b(f,l,p);f=this.twistEquation=new k(f,l,p);this.twistAngle="undefined"!==typeof p.twistAngle?
p.twistAngle:0;n.maxForce=0;n.minForce=-q;f.maxForce=0;f.minForce=-q;this.equations.push(n,f)}d.exports=a;e("./Constraint");var c=e("./PointToPointConstraint"),b=e("../equations/ConeEquation"),k=e("../equations/RotationalEquation");e("../equations/ContactEquation");var h=e("../math/Vec3");a.prototype=new c;a.constructor=a;new h;new h;a.prototype.update=function(){var f=this.bodyA,l=this.bodyB,p=this.coneEquation,q=this.twistEquation;c.prototype.update.call(this);f.vectorToWorldFrame(this.axisA,p.axisA);
l.vectorToWorldFrame(this.axisB,p.axisB);this.axisA.tangents(q.axisA,q.axisA);f.vectorToWorldFrame(q.axisA,q.axisA);this.axisB.tangents(q.axisB,q.axisB);l.vectorToWorldFrame(q.axisB,q.axisB);p.angle=this.angle;q.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(e,d,m){function a(b,k,h){h=c.defaults(h,{collideConnected:!0,wakeUpBodies:!0});
this.equations=[];this.bodyA=b;this.bodyB=k;this.id=a.idCounter++;this.collideConnected=h.collideConnected;h.wakeUpBodies&&(b&&b.wakeUp(),k&&k.wakeUp())}d.exports=a;var c=e("../utils/Utils");a.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};a.prototype.enable=function(){for(var b=this.equations,k=0;k<b.length;k++)b[k].enabled=!0};a.prototype.disable=function(){for(var b=this.equations,k=0;k<b.length;k++)b[k].enabled=!1};a.idCounter=0},{"../utils/Utils":53}],
14:[function(e,d,m){function a(k,h,f,l){c.call(this,k,h);"undefined"===typeof f&&(f=k.position.distanceTo(h.position));"undefined"===typeof l&&(l=1E6);this.distance=f;k=this.distanceEquation=new b(k,h);this.equations.push(k);k.minForce=-l;k.maxForce=l}d.exports=a;var c=e("./Constraint"),b=e("../equations/ContactEquation");a.prototype=new c;a.prototype.update=function(){var k=this.distanceEquation,h=.5*this.distance,f=k.ni;this.bodyB.position.vsub(this.bodyA.position,f);f.normalize();f.mult(h,k.ri);
f.mult(-h,k.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(e,d,m){function a(p,q,n){n=n||{};var t="undefined"!==typeof n.maxForce?n.maxForce:1E6,r=n.pivotA?n.pivotA.clone():new h,u=n.pivotB?n.pivotB.clone():new h;c.call(this,p,r,q,u,t);(this.axisA=n.axisA?n.axisA.clone():new h(1,0,0)).normalize();(this.axisB=n.axisB?n.axisB.clone():new h(1,0,0)).normalize();r=this.rotationalEquation1=new b(p,q,n);n=this.rotationalEquation2=new b(p,q,n);p=this.motorEquation=new k(p,q,t);
p.enabled=!1;this.equations.push(r,n,p)}d.exports=a;e("./Constraint");var c=e("./PointToPointConstraint"),b=e("../equations/RotationalEquation"),k=e("../equations/RotationalMotorEquation");e("../equations/ContactEquation");var h=e("../math/Vec3");a.prototype=new c;a.constructor=a;a.prototype.enableMotor=function(){this.motorEquation.enabled=!0};a.prototype.disableMotor=function(){this.motorEquation.enabled=!1};a.prototype.setMotorSpeed=function(p){this.motorEquation.targetVelocity=p};a.prototype.setMotorMaxForce=
function(p){this.motorEquation.maxForce=p;this.motorEquation.minForce=-p};var f=new h,l=new h;a.prototype.update=function(){var p=this.bodyA,q=this.bodyB,n=this.motorEquation,t=this.rotationalEquation1,r=this.rotationalEquation2,u=this.axisA,v=this.axisB;c.prototype.update.call(this);p.quaternion.vmult(u,f);q.quaternion.vmult(v,l);f.tangents(t.axisA,r.axisA);t.axisB.copy(l);r.axisB.copy(l);this.motorEquation.enabled&&(p.quaternion.vmult(this.axisA,n.axisA),q.quaternion.vmult(this.axisB,n.axisB))}},
{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(e,d,m){function a(h,f,l){l=l||{};var p="undefined"!==typeof l.maxForce?l.maxForce:1E6,q=new k,n=new k,t=new k;h.position.vadd(f.position,t);t.scale(.5,t);f.pointToLocalFrame(t,n);h.pointToLocalFrame(t,q);c.call(this,h,q,f,n,p);p=this.rotationalEquation1=new b(h,f,l);q=this.rotationalEquation2=new b(h,f,l);
h=this.rotationalEquation3=new b(h,f,l);this.equations.push(p,q,h)}d.exports=a;e("./Constraint");var c=e("./PointToPointConstraint"),b=e("../equations/RotationalEquation");e("../equations/RotationalMotorEquation");e("../equations/ContactEquation");var k=e("../math/Vec3");a.prototype=new c;a.constructor=a;new k;new k;a.prototype.update=function(){var h=this.bodyA,f=this.bodyB,l=this.rotationalEquation1,p=this.rotationalEquation2,q=this.rotationalEquation3;c.prototype.update.call(this);h.vectorToWorldFrame(k.UNIT_X,
l.axisA);f.vectorToWorldFrame(k.UNIT_Y,l.axisB);h.vectorToWorldFrame(k.UNIT_Y,p.axisA);f.vectorToWorldFrame(k.UNIT_Z,p.axisB);h.vectorToWorldFrame(k.UNIT_Z,q.axisA);f.vectorToWorldFrame(k.UNIT_X,q.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(e,d,m){function a(h,f,l,p,q){c.call(this,h,l);q="undefined"!==typeof q?q:1E6;this.pivotA=f?f.clone():
new k;this.pivotB=p?p.clone():new k;f=this.equationX=new b(h,l);p=this.equationY=new b(h,l);h=this.equationZ=new b(h,l);this.equations.push(f,p,h);f.minForce=p.minForce=h.minForce=-q;f.maxForce=p.maxForce=h.maxForce=q;f.ni.set(1,0,0);p.ni.set(0,1,0);h.ni.set(0,0,1)}d.exports=a;var c=e("./Constraint"),b=e("../equations/ContactEquation"),k=e("../math/Vec3");a.prototype=new c;a.prototype.update=function(){var h=this.bodyB,f=this.equationX,l=this.equationY,p=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,
f.ri);h.quaternion.vmult(this.pivotB,f.rj);l.ri.copy(f.ri);l.rj.copy(f.rj);p.ri.copy(f.ri);p.rj.copy(f.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(e,d,m){function a(f,l,p){p=p||{};var q="undefined"!==typeof p.maxForce?p.maxForce:1E6;b.call(this,f,l,-q,q);this.axisA=p.axisA?p.axisA.clone():new c(1,0,0);this.axisB=p.axisB?p.axisB.clone():new c(0,1,0);this.angle="undefined"!==typeof p.angle?p.angle:0}d.exports=a;var c=e("../math/Vec3");e("../math/Mat3");
var b=e("./Equation");a.prototype=new b;a.prototype.constructor=a;var k=new c,h=new c;a.prototype.computeB=function(f){var l=this.a,p=this.b,q=this.axisA,n=this.axisB,t=this.jacobianElementA,r=this.jacobianElementB;q.cross(n,k);n.cross(q,h);t.rotational.copy(h);r.rotational.copy(k);q=Math.cos(this.angle)-q.dot(n);n=this.computeGW();t=this.computeGiMf();return-q*l-n*p-f*t}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(e,d,m){function a(r,u,v){c.call(this,r,u,0,"undefined"!==
typeof v?v:1E6);this.restitution=0;this.ri=new b;this.rj=new b;this.ni=new b}d.exports=a;var c=e("./Equation"),b=e("../math/Vec3");e("../math/Mat3");a.prototype=new c;a.prototype.constructor=a;var k=new b,h=new b,f=new b;a.prototype.computeB=function(r){var u=this.a,v=this.b,B=this.bi,A=this.bj,J=this.ri,T=this.rj,R=B.velocity,H=B.angularVelocity,U=A.velocity,C=A.angularVelocity,K=this.jacobianElementA,N=this.jacobianElementB,G=this.ni;J.cross(G,k);T.cross(G,h);G.negate(K.spatial);k.negate(K.rotational);
N.spatial.copy(G);N.rotational.copy(h);f.copy(A.position);f.vadd(T,f);f.vsub(B.position,f);f.vsub(J,f);B=G.dot(f);A=this.restitution+1;R=A*U.dot(G)-A*R.dot(G)+C.dot(h)-H.dot(k);H=this.computeGiMf();return-B*u-R*v-r*H};var l=new b,p=new b,q=new b,n=new b,t=new b;a.prototype.getImpactVelocityAlongNormal=function(){this.bi.position.vadd(this.ri,q);this.bj.position.vadd(this.rj,n);this.bi.getVelocityAtWorldPoint(q,l);this.bj.getVelocityAtWorldPoint(n,p);l.vsub(p,t);return this.ni.dot(t)}},{"../math/Mat3":27,
"../math/Vec3":30,"./Equation":20}],20:[function(e,d,m){function a(n,t,r,u){this.id=a.id++;this.minForce="undefined"===typeof r?-1E6:r;this.maxForce="undefined"===typeof u?1E6:u;this.bi=n;this.bj=t;this.eps=this.b=this.a=0;this.jacobianElementA=new c;this.jacobianElementB=new c;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}d.exports=a;var c=e("../math/JacobianElement");e=e("../math/Vec3");a.prototype.constructor=a;a.id=0;a.prototype.setSpookParams=function(n,t,r){this.a=4/(r*(1+4*t));this.b=4*t/
(1+4*t);this.eps=4/(r*r*n*(1+4*t))};a.prototype.computeB=function(n,t,r){var u=this.computeGW(),v=this.computeGq(),B=this.computeGiMf();return-v*n-u*t-B*r};a.prototype.computeGq=function(){var n=this.jacobianElementB,t=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+n.spatial.dot(t)};var b=new e;a.prototype.computeGW=function(){var n=this.jacobianElementB,t=this.bi,r=this.bj,u=r.velocity;r=r.angularVelocity||b;return this.jacobianElementA.multiplyVectors(t.velocity,t.angularVelocity||
b)+n.multiplyVectors(u,r)};a.prototype.computeGWlambda=function(){var n=this.jacobianElementB,t=this.bi,r=this.bj,u=r.vlambda;r=r.wlambda||b;return this.jacobianElementA.multiplyVectors(t.vlambda,t.wlambda||b)+n.multiplyVectors(u,r)};var k=new e,h=new e,f=new e,l=new e;a.prototype.computeGiMf=function(){var n=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,u=this.bj,v=r.force,B=r.torque,A=u.force,J=u.torque,T=r.invMassSolve,R=u.invMassSolve;r.invInertiaWorldSolve?r.invInertiaWorldSolve.vmult(B,
f):f.set(0,0,0);u.invInertiaWorldSolve?u.invInertiaWorldSolve.vmult(J,l):l.set(0,0,0);v.mult(T,k);A.mult(R,h);return n.multiplyVectors(k,f)+t.multiplyVectors(h,l)};var p=new e;a.prototype.computeGiMGt=function(){var n=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,u=this.bj,v=r.invInertiaWorldSolve,B=u.invInertiaWorldSolve;r=r.invMassSolve+u.invMassSolve;v&&(v.vmult(n.rotational,p),r+=p.dot(n.rotational));B&&(B.vmult(t.rotational,p),r+=p.dot(t.rotational));return r};var q=new e;new e;new e;
new e;new e;new e;a.prototype.addToWlambda=function(n){var t=this.jacobianElementA,r=this.jacobianElementB,u=this.bi,v=this.bj;t.spatial.mult(u.invMassSolve*n,q);u.vlambda.vadd(q,u.vlambda);r.spatial.mult(v.invMassSolve*n,q);v.vlambda.vadd(q,v.vlambda);u.invInertiaWorldSolve&&(u.invInertiaWorldSolve.vmult(t.rotational,q),q.mult(n,q),u.wlambda.vadd(q,u.wlambda));v.invInertiaWorldSolve&&(v.invInertiaWorldSolve.vmult(r.rotational,q),q.mult(n,q),v.wlambda.vadd(q,v.wlambda))};a.prototype.computeC=function(){return this.computeGiMGt()+
this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(e,d,m){function a(f,l,p){c.call(this,f,l,-p,p);this.ri=new b;this.rj=new b;this.t=new b}d.exports=a;var c=e("./Equation"),b=e("../math/Vec3");e("../math/Mat3");a.prototype=new c;a.prototype.constructor=a;var k=new b,h=new b;a.prototype.computeB=function(f){var l=this.b,p=this.rj,q=this.t;this.ri.cross(q,k);p.cross(q,h);p=this.jacobianElementA;var n=this.jacobianElementB;q.negate(p.spatial);k.negate(p.rotational);n.spatial.copy(q);
n.rotational.copy(h);q=this.computeGW();p=this.computeGiMf();return-q*l-f*p}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(e,d,m){function a(f,l,p){p=p||{};var q="undefined"!==typeof p.maxForce?p.maxForce:1E6;b.call(this,f,l,-q,q);this.axisA=p.axisA?p.axisA.clone():new c(1,0,0);this.axisB=p.axisB?p.axisB.clone():new c(0,1,0);this.maxAngle=Math.PI/2}d.exports=a;var c=e("../math/Vec3");e("../math/Mat3");var b=e("./Equation");a.prototype=new b;a.prototype.constructor=a;var k=new c,
h=new c;a.prototype.computeB=function(f){var l=this.a,p=this.b,q=this.axisA,n=this.axisB,t=this.jacobianElementA,r=this.jacobianElementB;q.cross(n,k);n.cross(q,h);t.rotational.copy(h);r.rotational.copy(k);q=Math.cos(this.maxAngle)-q.dot(n);n=this.computeGW();t=this.computeGiMf();return-q*l-n*p-f*t}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(e,d,m){function a(k,h,f){f="undefined"!==typeof f?f:1E6;b.call(this,k,h,-f,f);this.axisA=new c;this.axisB=new c;this.targetVelocity=
0}d.exports=a;var c=e("../math/Vec3");e("../math/Mat3");var b=e("./Equation");a.prototype=new b;a.prototype.constructor=a;a.prototype.computeB=function(k){var h=this.b,f=this.axisB,l=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);f.negate(l.rotational);f=this.computeGW()-this.targetVelocity;l=this.computeGiMf();return-f*h-k*l}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(e,d,m){function a(b,k,h){h=c.defaults(h,{friction:.3,restitution:.3,contactEquationStiffness:1E7,
contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});this.id=a.idCounter++;this.materials=[b,k];this.friction=h.friction;this.restitution=h.restitution;this.contactEquationStiffness=h.contactEquationStiffness;this.contactEquationRelaxation=h.contactEquationRelaxation;this.frictionEquationStiffness=h.frictionEquationStiffness;this.frictionEquationRelaxation=h.frictionEquationRelaxation}var c=e("../utils/Utils");d.exports=a;a.idCounter=0},{"../utils/Utils":53}],25:[function(e,
d,m){function a(c){var b="";c=c||{};"string"===typeof c?(b=c,c={}):"object"===typeof c&&(b="");this.name=b;this.id=a.idCounter++;this.friction="undefined"!==typeof c.friction?c.friction:-1;this.restitution="undefined"!==typeof c.restitution?c.restitution:-1}d.exports=a;a.idCounter=0},{}],26:[function(e,d,m){function a(){this.spatial=new c;this.rotational=new c}d.exports=a;var c=e("./Vec3");a.prototype.multiplyElement=function(b){return b.spatial.dot(this.spatial)+b.rotational.dot(this.rotational)};
a.prototype.multiplyVectors=function(b,k){return b.dot(this.spatial)+k.dot(this.rotational)}},{"./Vec3":30}],27:[function(e,d,m){function a(b){this.elements=b?b:[0,0,0,0,0,0,0,0,0]}d.exports=a;var c=e("./Vec3");a.prototype.identity=function(){var b=this.elements;b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1};a.prototype.setZero=function(){var b=this.elements;b[0]=0;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=0;b[6]=0;b[7]=0;b[8]=0};a.prototype.setTrace=function(b){var k=this.elements;k[0]=b.x;
k[4]=b.y;k[8]=b.z};a.prototype.getTrace=function(b){b=b||new c;var k=this.elements;b.x=k[0];b.y=k[4];b.z=k[8]};a.prototype.vmult=function(b,k){k=k||new c;var h=this.elements,f=b.x,l=b.y,p=b.z;k.x=h[0]*f+h[1]*l+h[2]*p;k.y=h[3]*f+h[4]*l+h[5]*p;k.z=h[6]*f+h[7]*l+h[8]*p;return k};a.prototype.smult=function(b){for(var k=0;k<this.elements.length;k++)this.elements[k]*=b};a.prototype.mmult=function(b,k){for(var h=k||new a,f=0;3>f;f++)for(var l=0;3>l;l++){for(var p=0,q=0;3>q;q++)p+=b.elements[f+3*q]*this.elements[q+
3*l];h.elements[f+3*l]=p}return h};a.prototype.scale=function(b,k){k=k||new a;for(var h=this.elements,f=k.elements,l=0;3!==l;l++)f[3*l]=b.x*h[3*l],f[3*l+1]=b.y*h[3*l+1],f[3*l+2]=b.z*h[3*l+2];return k};a.prototype.solve=function(b,k){k=k||new c;for(var h=[],f=0;12>f;f++)h.push(0);var l;for(f=0;3>f;f++)for(l=0;3>l;l++)h[f+4*l]=this.elements[f+3*l];h[3]=b.x;h[7]=b.y;h[11]=b.z;var p=3,q=p;do{f=q-p;if(0===h[f+4*f])for(l=f+1;l<q;l++)if(0!==h[f+4*l]){var n=4;do{var t=4-n;h[t+4*f]+=h[t+4*l]}while(--n);break}if(0!==
h[f+4*f])for(l=f+1;l<q;l++){var r=h[f+4*l]/h[f+4*f];n=4;do t=4-n,h[t+4*l]=t<=f?0:h[t+4*l]-h[t+4*f]*r;while(--n)}}while(--p);k.z=h[11]/h[10];k.y=(h[7]-h[6]*k.z)/h[5];k.x=(h[3]-h[2]*k.z-h[1]*k.y)/h[0];if(isNaN(k.x)||isNaN(k.y)||isNaN(k.z)||Infinity===k.x||Infinity===k.y||Infinity===k.z)throw"Could not solve equation! Got x=["+k.toString()+"], b=["+b.toString()+"], A=["+this.toString()+"]";return k};a.prototype.e=function(b,k,h){if(void 0===h)return this.elements[k+3*b];this.elements[k+3*b]=h};a.prototype.copy=
function(b){for(var k=0;k<b.elements.length;k++)this.elements[k]=b.elements[k];return this};a.prototype.toString=function(){for(var b="",k=0;9>k;k++)b+=this.elements[k]+",";return b};a.prototype.reverse=function(b){b=b||new a;for(var k=[],h=0;18>h;h++)k.push(0);var f;for(h=0;3>h;h++)for(f=0;3>f;f++)k[h+6*f]=this.elements[h+3*f];k[3]=1;k[9]=0;k[15]=0;k[4]=0;k[10]=1;k[16]=0;k[5]=0;k[11]=0;k[17]=1;var l=3,p=l;do{h=p-l;if(0===k[h+6*h])for(f=h+1;f<p;f++)if(0!==k[h+6*f]){var q=6;do{var n=6-q;k[n+6*h]+=
k[n+6*f]}while(--q);break}if(0!==k[h+6*h])for(f=h+1;f<p;f++){var t=k[h+6*f]/k[h+6*h];q=6;do n=6-q,k[n+6*f]=n<=h?0:k[n+6*f]-k[n+6*h]*t;while(--q)}}while(--l);h=2;do{f=h-1;do{t=k[h+6*f]/k[h+6*h];q=6;do n=6-q,k[n+6*f]-=k[n+6*h]*t;while(--q)}while(f--)}while(--h);h=2;do{t=1/k[h+6*h];q=6;do n=6-q,k[n+6*h]*=t;while(--q)}while(h--);h=2;do{f=2;do{n=k[3+f+6*h];if(isNaN(n)||Infinity===n)throw"Could not reverse! A=["+this.toString()+"]";b.e(h,f,n)}while(f--)}while(h--);return b};a.prototype.setRotationFromQuaternion=
function(b){var k=b.x,h=b.y,f=b.z,l=b.w,p=k+k,q=h+h,n=f+f;b=k*p;var t=k*q;k*=n;var r=h*q;h*=n;f*=n;p*=l;q*=l;l*=n;n=this.elements;n[0]=1-(r+f);n[1]=t-l;n[2]=k+q;n[3]=t+l;n[4]=1-(b+f);n[5]=h-p;n[6]=k-q;n[7]=h+p;n[8]=1-(b+r);return this};a.prototype.transpose=function(b){b=b||new a;for(var k=b.elements,h=this.elements,f=0;3!==f;f++)for(var l=0;3!==l;l++)k[3*f+l]=h[3*l+f];return b}},{"./Vec3":30}],28:[function(e,d,m){function a(p,q,n,t){this.x=void 0!==p?p:0;this.y=void 0!==q?q:0;this.z=void 0!==n?n:
0;this.w=void 0!==t?t:1}d.exports=a;var c=e("./Vec3");a.prototype.set=function(p,q,n,t){this.x=p;this.y=q;this.z=n;this.w=t};a.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};a.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};a.prototype.setFromAxisAngle=function(p,q){var n=Math.sin(.5*q);this.x=p.x*n;this.y=p.y*n;this.z=p.z*n;this.w=Math.cos(.5*q)};a.prototype.toAxisAngle=function(p){p=p||new c;this.normalize();var q=2*Math.acos(this.w),n=Math.sqrt(1-
this.w*this.w);.001>n?(p.x=this.x,p.y=this.y,p.z=this.z):(p.x=this.x/n,p.y=this.y/n,p.z=this.z/n);return[p,q]};var b=new c,k=new c;a.prototype.setFromVectors=function(p,q){if(p.isAntiparallelTo(q))p.tangents(b,k),this.setFromAxisAngle(b,Math.PI);else{var n=p.cross(q);this.x=n.x;this.y=n.y;this.z=n.z;this.w=Math.sqrt(Math.pow(p.norm(),2)*Math.pow(q.norm(),2))+p.dot(q);this.normalize()}};var h=new c,f=new c,l=new c;a.prototype.mult=function(p,q){q=q||new a;var n=this.w;h.set(this.x,this.y,this.z);f.set(p.x,
p.y,p.z);q.w=n*p.w-h.dot(f);h.cross(f,l);q.x=n*f.x+p.w*h.x+l.x;q.y=n*f.y+p.w*h.y+l.y;q.z=n*f.z+p.w*h.z+l.z;return q};a.prototype.inverse=function(p){var q=this.x,n=this.y,t=this.z,r=this.w;p=p||new a;this.conjugate(p);q=1/(q*q+n*n+t*t+r*r);p.x*=q;p.y*=q;p.z*=q;p.w*=q;return p};a.prototype.conjugate=function(p){p=p||new a;p.x=-this.x;p.y=-this.y;p.z=-this.z;p.w=this.w;return p};a.prototype.normalize=function(){var p=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===p?this.w=this.z=
this.y=this.x=0:(p=1/p,this.x*=p,this.y*=p,this.z*=p,this.w*=p)};a.prototype.normalizeFast=function(){var p=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===p?this.w=this.z=this.y=this.x=0:(this.x*=p,this.y*=p,this.z*=p,this.w*=p)};a.prototype.vmult=function(p,q){q=q||new c;var n=p.x,t=p.y,r=p.z,u=this.x,v=this.y,B=this.z,A=this.w,J=A*n+v*r-B*t,T=A*t+B*n-u*r,R=A*r+u*t-v*n;n=-u*n-v*t-B*r;q.x=J*A+n*-u+T*-B-R*-v;q.y=T*A+n*-v+R*-u-J*-B;q.z=R*A+n*-B+J*-v-T*-u;return q};a.prototype.copy=
function(p){this.x=p.x;this.y=p.y;this.z=p.z;this.w=p.w;return this};a.prototype.toEuler=function(p,q){q=q||"YZX";var n=this.x,t=this.y,r=this.z,u=this.w;switch(q){case "YZX":var v=n*t+r*u;if(.499<v){var B=2*Math.atan2(n,u);var A=Math.PI/2;var J=0}-.499>v&&(B=-2*Math.atan2(n,u),A=-Math.PI/2,J=0);isNaN(B)&&(J=r*r,B=Math.atan2(2*t*u-2*n*r,1-2*t*t-2*J),A=Math.asin(2*v),J=Math.atan2(2*n*u-2*t*r,1-2*n*n-2*J));break;default:throw Error("Euler order "+q+" not supported yet.");}p.y=B;p.z=A;p.x=J};a.prototype.setFromEuler=
function(p,q,n,t){t=t||"XYZ";var r=Math.cos(p/2),u=Math.cos(q/2),v=Math.cos(n/2);p=Math.sin(p/2);q=Math.sin(q/2);n=Math.sin(n/2);"XYZ"===t?(this.x=p*u*v+r*q*n,this.y=r*q*v-p*u*n,this.z=r*u*n+p*q*v,this.w=r*u*v-p*q*n):"YXZ"===t?(this.x=p*u*v+r*q*n,this.y=r*q*v-p*u*n,this.z=r*u*n-p*q*v,this.w=r*u*v+p*q*n):"ZXY"===t?(this.x=p*u*v-r*q*n,this.y=r*q*v+p*u*n,this.z=r*u*n+p*q*v,this.w=r*u*v-p*q*n):"ZYX"===t?(this.x=p*u*v-r*q*n,this.y=r*q*v+p*u*n,this.z=r*u*n-p*q*v,this.w=r*u*v+p*q*n):"YZX"===t?(this.x=p*
u*v+r*q*n,this.y=r*q*v+p*u*n,this.z=r*u*n-p*q*v,this.w=r*u*v-p*q*n):"XZY"===t&&(this.x=p*u*v-r*q*n,this.y=r*q*v-p*u*n,this.z=r*u*n+p*q*v,this.w=r*u*v+p*q*n);return this};a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(e,d,m){function a(h){h=h||{};this.position=new c;h.position&&this.position.copy(h.position);this.quaternion=new b;h.quaternion&&this.quaternion.copy(h.quaternion)}var c=e("./Vec3"),b=e("./Quaternion");d.exports=a;var k=new b;a.pointToLocalFrame=
function(h,f,l,p){p=p||new c;l.vsub(h,p);f.conjugate(k);k.vmult(p,p);return p};a.prototype.pointToLocal=function(h,f){return a.pointToLocalFrame(this.position,this.quaternion,h,f)};a.pointToWorldFrame=function(h,f,l,p){p=p||new c;f.vmult(l,p);p.vadd(h,p);return p};a.prototype.pointToWorld=function(h,f){return a.pointToWorldFrame(this.position,this.quaternion,h,f)};a.prototype.vectorToWorldFrame=function(h,f){f=f||new c;this.quaternion.vmult(h,f);return f};a.vectorToWorldFrame=function(h,f,l){h.vmult(f,
l);return l};a.vectorToLocalFrame=function(h,f,l,p){p=p||new c;f.w*=-1;f.vmult(l,p);f.w*=-1;return p}},{"./Quaternion":28,"./Vec3":30}],30:[function(e,d,m){function a(f,l,p){this.x=f||0;this.y=l||0;this.z=p||0}d.exports=a;var c=e("./Mat3");a.ZERO=new a(0,0,0);a.UNIT_X=new a(1,0,0);a.UNIT_Y=new a(0,1,0);a.UNIT_Z=new a(0,0,1);a.prototype.cross=function(f,l){var p=f.x,q=f.y,n=f.z,t=this.x,r=this.y,u=this.z;l=l||new a;l.x=r*n-u*q;l.y=u*p-t*n;l.z=t*q-r*p;return l};a.prototype.set=function(f,l,p){this.x=
f;this.y=l;this.z=p;return this};a.prototype.setZero=function(){this.x=this.y=this.z=0};a.prototype.vadd=function(f,l){if(l)l.x=f.x+this.x,l.y=f.y+this.y,l.z=f.z+this.z;else return new a(this.x+f.x,this.y+f.y,this.z+f.z)};a.prototype.vsub=function(f,l){if(l)l.x=this.x-f.x,l.y=this.y-f.y,l.z=this.z-f.z;else return new a(this.x-f.x,this.y-f.y,this.z-f.z)};a.prototype.crossmat=function(){return new c([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};a.prototype.normalize=function(){var f=this.x,
l=this.y,p=this.z;f=Math.sqrt(f*f+l*l+p*p);0<f?(l=1/f,this.x*=l,this.y*=l,this.z*=l):this.z=this.y=this.x=0;return f};a.prototype.unit=function(f){f=f||new a;var l=this.x,p=this.y,q=this.z,n=Math.sqrt(l*l+p*p+q*q);0<n?(n=1/n,f.x=l*n,f.y=p*n,f.z=q*n):(f.x=1,f.y=0,f.z=0);return f};a.prototype.norm=function(){var f=this.x,l=this.y,p=this.z;return Math.sqrt(f*f+l*l+p*p)};a.prototype.length=a.prototype.norm;a.prototype.norm2=function(){return this.dot(this)};a.prototype.lengthSquared=a.prototype.norm2;
a.prototype.distanceTo=function(f){var l=this.x,p=this.y,q=this.z,n=f.x,t=f.y;f=f.z;return Math.sqrt((n-l)*(n-l)+(t-p)*(t-p)+(f-q)*(f-q))};a.prototype.distanceSquared=function(f){var l=this.x,p=this.y,q=this.z,n=f.x,t=f.y;f=f.z;return(n-l)*(n-l)+(t-p)*(t-p)+(f-q)*(f-q)};a.prototype.mult=function(f,l){l=l||new a;var p=this.y,q=this.z;l.x=f*this.x;l.y=f*p;l.z=f*q;return l};a.prototype.scale=a.prototype.mult;a.prototype.dot=function(f){return this.x*f.x+this.y*f.y+this.z*f.z};a.prototype.isZero=function(){return 0===
this.x&&0===this.y&&0===this.z};a.prototype.negate=function(f){f=f||new a;f.x=-this.x;f.y=-this.y;f.z=-this.z;return f};var b=new a,k=new a;a.prototype.tangents=function(f,l){var p=this.norm();0<p?(p=1/p,b.set(this.x*p,this.y*p,this.z*p),.9>Math.abs(b.x)?k.set(1,0,0):k.set(0,1,0),b.cross(k,f),b.cross(f,l)):(f.set(1,0,0),l.set(0,1,0))};a.prototype.toString=function(){return this.x+","+this.y+","+this.z};a.prototype.toArray=function(){return[this.x,this.y,this.z]};a.prototype.copy=function(f){this.x=
f.x;this.y=f.y;this.z=f.z;return this};a.prototype.lerp=function(f,l,p){var q=this.x,n=this.y,t=this.z;p.x=q+(f.x-q)*l;p.y=n+(f.y-n)*l;p.z=t+(f.z-t)*l};a.prototype.almostEquals=function(f,l){void 0===l&&(l=1E-6);return Math.abs(this.x-f.x)>l||Math.abs(this.y-f.y)>l||Math.abs(this.z-f.z)>l?!1:!0};a.prototype.almostZero=function(f){void 0===f&&(f=1E-6);return Math.abs(this.x)>f||Math.abs(this.y)>f||Math.abs(this.z)>f?!1:!0};var h=new a;a.prototype.isAntiparallelTo=function(f,l){this.negate(h);return h.almostEquals(f,
l)};a.prototype.clone=function(){return new a(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(e,d,m){function a(K){K=K||{};c.apply(this);this.id=a.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new b;this.collisionFilterGroup="number"===typeof K.collisionFilterGroup?K.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof K.collisionFilterMask?K.collisionFilterMask:1;this.collisionResponse=!0;this.position=new b;K.position&&this.position.copy(K.position);this.previousPosition=
new b;this.initPosition=new b;this.velocity=new b;K.velocity&&this.velocity.copy(K.velocity);this.initVelocity=new b;this.force=new b;var N="number"===typeof K.mass?K.mass:0;this.mass=N;this.invMass=0<N?1/N:0;this.material=K.material||null;this.linearDamping="number"===typeof K.linearDamping?K.linearDamping:.01;this.type=0>=N?a.STATIC:a.DYNAMIC;typeof K.type===typeof a.STATIC&&(this.type=K.type);this.allowSleep="undefined"!==typeof K.allowSleep?K.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit=
"undefined"!==typeof K.sleepSpeedLimit?K.sleepSpeedLimit:.1;this.sleepTimeLimit="undefined"!==typeof K.sleepTimeLimit?K.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new b;this.quaternion=new h;K.quaternion&&this.quaternion.copy(K.quaternion);this.initQuaternion=new h;this.angularVelocity=new b;K.angularVelocity&&this.angularVelocity.copy(K.angularVelocity);this.initAngularVelocity=new b;this.interpolatedPosition=new b;this.interpolatedQuaternion=new h;this.shapes=
[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=new b;this.invInertia=new b;this.invInertiaWorld=new k;this.invMassSolve=0;this.invInertiaSolve=new b;this.invInertiaWorldSolve=new k;this.fixedRotation="undefined"!==typeof K.fixedRotation?K.fixedRotation:!1;this.angularDamping="undefined"!==typeof K.angularDamping?K.angularDamping:.01;this.userData="undefined"!==typeof K.userData?K.userData:null;this.aabb=new f;this.aabbNeedsUpdate=!0;this.wlambda=new b;K.shape&&this.addShape(K.shape);
this.updateMassProperties()}d.exports=a;var c=e("../utils/EventTarget");e("../shapes/Shape");var b=e("../math/Vec3"),k=e("../math/Mat3"),h=e("../math/Quaternion");e("../material/Material");var f=e("../collision/AABB"),l=e("../shapes/Box");a.prototype=new c;a.prototype.constructor=a;a.DYNAMIC=1;a.STATIC=2;a.KINEMATIC=4;a.AWAKE=0;a.SLEEPY=1;a.SLEEPING=2;a.idCounter=0;a.prototype.wakeUp=function(){var K=this.sleepState;this.sleepState=0;K===a.SLEEPING&&this.dispatchEvent({type:"wakeup"})};a.prototype.sleep=
function(){this.sleepState=a.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};a.sleepyEvent={type:"sleepy"};a.sleepEvent={type:"sleep"};a.prototype.sleepTick=function(K){if(this.allowSleep){var N=this.sleepState,G=this.velocity.norm2()+this.angularVelocity.norm2(),X=Math.pow(this.sleepSpeedLimit,2);N===a.AWAKE&&G<X?(this.sleepState=a.SLEEPY,this.timeLastSleepy=K,this.dispatchEvent(a.sleepyEvent)):N===a.SLEEPY&&G>X?this.wakeUp():N===a.SLEEPY&&K-this.timeLastSleepy>this.sleepTimeLimit&&
(this.sleep(),this.dispatchEvent(a.sleepEvent))}};a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};a.prototype.pointToLocalFrame=function(K,N){N=N||new b;K.vsub(this.position,N);this.quaternion.conjugate().vmult(N,N);return N};a.prototype.vectorToLocalFrame=
function(K,N){N=N||new b;this.quaternion.conjugate().vmult(K,N);return N};a.prototype.pointToWorldFrame=function(K,N){N=N||new b;this.quaternion.vmult(K,N);N.vadd(this.position,N);return N};a.prototype.vectorToWorldFrame=function(K,N){N=N||new b;this.quaternion.vmult(K,N);return N};var p=new b,q=new h;a.prototype.addShape=function(K,N,G){var X=new b,M=new h;N&&X.copy(N);G&&M.copy(G);this.shapes.push(K);this.shapeOffsets.push(X);this.shapeOrientations.push(M);this.updateMassProperties();this.updateBoundingRadius();
this.aabbNeedsUpdate=!0;return this};a.prototype.updateBoundingRadius=function(){for(var K=this.shapes,N=this.shapeOffsets,G=K.length,X=0,M=0;M!==G;M++){var E=K[M];E.updateBoundingSphereRadius();var I=N[M].norm();E=E.boundingSphereRadius;I+E>X&&(X=I+E)}this.boundingRadius=X};var n=new f;a.prototype.computeAABB=function(){for(var K=this.shapes,N=this.shapeOffsets,G=this.shapeOrientations,X=K.length,M=this.quaternion,E=this.aabb,I=0;I!==X;I++){var z=K[I];G[I].mult(M,q);q.vmult(N[I],p);p.vadd(this.position,
p);z.calculateWorldAABB(p,q,n.lowerBound,n.upperBound);0===I?E.copy(n):E.extend(n)}this.aabbNeedsUpdate=!1};var t=new k,r=new k;new k;a.prototype.updateInertiaWorld=function(K){var N=this.invInertia;if(N.x!==N.y||N.y!==N.z||K)t.setRotationFromQuaternion(this.quaternion),t.transpose(r),t.scale(N,t),t.mmult(r,this.invInertiaWorld)};var u=new b,v=new b;a.prototype.applyForce=function(K,N){this.type===a.DYNAMIC&&(N.vsub(this.position,u),u.cross(K,v),this.force.vadd(K,this.force),this.torque.vadd(v,this.torque))};
var B=new b,A=new b;a.prototype.applyLocalForce=function(K,N){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(K,B),this.pointToWorldFrame(N,A),this.applyForce(B,A))};var J=new b,T=new b,R=new b;a.prototype.applyImpulse=function(K,N){this.type===a.DYNAMIC&&(N.vsub(this.position,J),T.copy(K),T.mult(this.invMass,T),this.velocity.vadd(T,this.velocity),J.cross(K,R),this.invInertiaWorld.vmult(R,R),this.angularVelocity.vadd(R,this.angularVelocity))};var H=new b,U=new b;a.prototype.applyLocalImpulse=function(K,
N){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(K,H),this.pointToWorldFrame(N,U),this.applyImpulse(H,U))};var C=new b;a.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var K=this.inertia,N=this.fixedRotation;this.computeAABB();C.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);l.calculateInertia(C,this.mass,K);this.invInertia.set(0<K.x&&!N?1/K.x:0,0<K.y&&!N?
1/K.y:0,0<K.z&&!N?1/K.z:0);this.updateInertiaWorld(!0)};a.prototype.getVelocityAtWorldPoint=function(K,N){var G=new b;K.vsub(this.position,G);this.angularVelocity.cross(G,N);this.velocity.vadd(N,N);return N}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(e,d,m){function a(G){this.chassisBody=G.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;
this.indexRightAxis="undefined"!==typeof G.indexRightAxis?G.indexRightAxis:1;this.indexForwardAxis="undefined"!==typeof G.indexForwardAxis?G.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof G.indexUpAxis?G.indexUpAxis:2}function c(G,X,M){var E=T,I=R,z=H,D=U;X.vsub(G.position,E);E.cross(M,I);G.invInertiaWorld.vmult(I,D);D.cross(E,z);return G.invMass+M.dot(z)}e("./Body");var b=e("../math/Vec3"),k=e("../math/Quaternion");e("../collision/RaycastResult");m=e("../collision/Ray");var h=e("../objects/WheelInfo");
d.exports=a;new b;new b;new b;var f=new b,l=new b,p=new b;new m;a.prototype.addWheel=function(G){G=G||{};G=new h(G);var X=this.wheelInfos.length;this.wheelInfos.push(G);return X};a.prototype.setSteeringValue=function(G,X){this.wheelInfos[X].steering=G};new b;a.prototype.applyEngineForce=function(G,X){this.wheelInfos[X].engineForce=G};a.prototype.setBrake=function(G,X){this.wheelInfos[X].brake=G};a.prototype.addToWorld=function(G){G.add(this.chassisBody);var X=this;this.preStepCallback=function(){X.updateVehicle(G.dt)};
G.addEventListener("preStep",this.preStepCallback);this.world=G};a.prototype.getVehicleAxisWorld=function(G,X){X.set(0===G?1:0,1===G?1:0,2===G?1:0);this.chassisBody.vectorToWorldFrame(X,X)};a.prototype.updateVehicle=function(G){for(var X=this.wheelInfos,M=X.length,E=this.chassisBody,I=0;I<M;I++)this.updateWheelTransform(I);this.currentVehicleSpeedKmHour=3.6*E.velocity.norm();I=new b;this.getVehicleAxisWorld(this.indexForwardAxis,I);0>I.dot(E.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(I=0;I<
M;I++)this.castRay(X[I]);this.updateSuspension(G);var z=new b,D=new b;for(I=0;I<M;I++){var y=X[I],w=y.suspensionForce;w>y.maxSuspensionForce&&(w=y.maxSuspensionForce);y.raycastResult.hitNormalWorld.scale(w*G,z);y.raycastResult.hitPointWorld.vsub(E.position,D);E.applyImpulse(z,y.raycastResult.hitPointWorld)}this.updateFriction(G);z=new b;D=new b;w=new b;for(I=0;I<M;I++){y=X[I];E.getVelocityAtWorldPoint(y.chassisConnectionPointWorld,w);var x=1;switch(this.indexUpAxis){case 1:x=-1}if(y.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,
D);var F=D.dot(y.raycastResult.hitNormalWorld);y.raycastResult.hitNormalWorld.scale(F,z);D.vsub(z,D);F=D.dot(w);y.deltaRotation=x*F*G/y.radius}!y.sliding&&y.isInContact||0===y.engineForce||!y.useCustomSlidingRotationalSpeed||(y.deltaRotation=(0<y.engineForce?1:-1)*y.customSlidingRotationalSpeed*G);Math.abs(y.brake)>Math.abs(y.engineForce)&&(y.deltaRotation=0);y.rotation+=y.deltaRotation;y.deltaRotation*=.99}};a.prototype.updateSuspension=function(G){G=this.chassisBody.mass;for(var X=this.wheelInfos,
M=X.length,E=0;E<M;E++){var I=X[E];if(I.isInContact){var z=I.suspensionStiffness*(I.suspensionRestLength-I.suspensionLength)*I.clippedInvContactDotSuspension;var D=I.suspensionRelativeVelocity;z-=(0>D?I.dampingCompression:I.dampingRelaxation)*D;I.suspensionForce=z*G;0>I.suspensionForce&&(I.suspensionForce=0)}else I.suspensionForce=0}};a.prototype.removeFromWorld=function(G){G.remove(this.chassisBody);G.removeEventListener("preStep",this.preStepCallback);this.world=null};var q=new b,n=new b;a.prototype.castRay=
function(G){this.updateWheelTransformWorld(G);var X=this.chassisBody,M=-1;G.directionWorld.scale(G.suspensionRestLength+G.radius,q);var E=G.chassisConnectionPointWorld;E.vadd(q,n);var I=G.raycastResult;I.reset();var z=X.collisionResponse;X.collisionResponse=!1;this.world.rayTest(E,n,I);X.collisionResponse=z;E=I.body;G.raycastResult.groundObject=0;E?(M=I.distance,G.raycastResult.hitNormalWorld=I.hitNormalWorld,G.isInContact=!0,G.suspensionLength=I.distance-G.radius,I=G.suspensionRestLength-G.maxSuspensionTravel,
E=G.suspensionRestLength+G.maxSuspensionTravel,G.suspensionLength<I&&(G.suspensionLength=I),G.suspensionLength>E&&(G.suspensionLength=E,G.raycastResult.reset()),I=G.raycastResult.hitNormalWorld.dot(G.directionWorld),E=new b,X.getVelocityAtWorldPoint(G.raycastResult.hitPointWorld,E),X=G.raycastResult.hitNormalWorld.dot(E),-.1<=I?(G.suspensionRelativeVelocity=0,G.clippedInvContactDotSuspension=10):(I=-1/I,G.suspensionRelativeVelocity=X*I,G.clippedInvContactDotSuspension=I)):(G.suspensionLength=G.suspensionRestLength+
0*G.maxSuspensionTravel,G.suspensionRelativeVelocity=0,G.directionWorld.scale(-1,G.raycastResult.hitNormalWorld),G.clippedInvContactDotSuspension=1);return M};a.prototype.updateWheelTransformWorld=function(G){G.isInContact=!1;var X=this.chassisBody;X.pointToWorldFrame(G.chassisConnectionPointLocal,G.chassisConnectionPointWorld);X.vectorToWorldFrame(G.directionLocal,G.directionWorld);X.vectorToWorldFrame(G.axleLocal,G.axleWorld)};a.prototype.updateWheelTransform=function(G){G=this.wheelInfos[G];this.updateWheelTransformWorld(G);
G.directionLocal.scale(-1,f);l.copy(G.axleLocal);f.cross(l,p);p.normalize();l.normalize();var X=G.steering,M=new k;M.setFromAxisAngle(f,X);X=new k;X.setFromAxisAngle(l,G.rotation);var E=G.worldTransform.quaternion;this.chassisBody.quaternion.mult(M,E);E.mult(X,E);E.normalize();M=G.worldTransform.position;M.copy(G.directionWorld);M.scale(G.suspensionLength,M);M.vadd(G.chassisConnectionPointWorld,M)};var t=[new b(1,0,0),new b(0,1,0),new b(0,0,1)];a.prototype.getWheelTransformWorld=function(G){return this.wheelInfos[G].worldTransform};
var r=new b,u=[],v=[];a.prototype.updateFriction=function(G){for(var X=this.wheelInfos,M=X.length,E=this.chassisBody,I=0,z=0;z<M;z++){var D=X[z],y=D.raycastResult.body;y&&I++;D.sideImpulse=0;D.forwardImpulse=0;v[z]||(v[z]=new b);u[z]||(u[z]=new b)}for(z=0;z<M;z++)if(D=X[z],y=D.raycastResult.body){var w=u[z];this.getWheelTransformWorld(z).vectorToWorldFrame(t[this.indexRightAxis],w);I=D.raycastResult.hitNormalWorld;var x=w.dot(I);I.scale(x,r);w.vsub(r,w);w.normalize();I.cross(w,v[z]);v[z].normalize();
I=D;x=E;var F=D.raycastResult.hitPointWorld,Q=D.raycastResult.hitPointWorld;if(1.1<w.norm2())y=0;else{var P=C,L=K,W=N;x.getVelocityAtWorldPoint(F,P);y.getVelocityAtWorldPoint(Q,L);P.vsub(L,W);y=-.2*w.dot(W)*(1/(x.invMass+y.invMass))}I.sideImpulse=y;D.sideImpulse*=1}this.sliding=!1;for(z=0;z<M;z++){D=X[z];y=D.raycastResult.body;x=0;D.slipInfo=1;if(y){I=D.brake?D.brake:0;P=E;F=y;Q=D.raycastResult.hitPointWorld;w=v[z];x=I;L=Q;W=B;var ca=A,O=J;P.getVelocityAtWorldPoint(L,W);F.getVelocityAtWorldPoint(L,
ca);W.vsub(ca,O);L=w.dot(O);P=c(P,Q,w);F=c(F,Q,w);F=1/(P+F)*-L;x<F&&(F=x);F<-x&&(F=-x);x=F;x+=D.engineForce*G;I/=x;D.slipInfo*=I}D.forwardImpulse=0;D.skidInfo=1;y&&(D.skidInfo=1,y=D.suspensionForce*G*D.frictionSlip,I=y*y,D.forwardImpulse=x,x=.5*D.forwardImpulse,F=1*D.sideImpulse,x=x*x+F*F,D.sliding=!1,x>I&&(this.sliding=!0,D.sliding=!0,I=y/Math.sqrt(x),D.skidInfo*=I))}if(this.sliding)for(z=0;z<M;z++)D=X[z],0!==D.sideImpulse&&1>D.skidInfo&&(D.forwardImpulse*=D.skidInfo,D.sideImpulse*=D.skidInfo);for(z=
0;z<M;z++)D=X[z],G=new b,G.copy(D.raycastResult.hitPointWorld),0!==D.forwardImpulse&&(y=new b,v[z].scale(D.forwardImpulse,y),E.applyImpulse(y,G)),0!==D.sideImpulse&&(y=D.raycastResult.body,I=new b,I.copy(D.raycastResult.hitPointWorld),x=new b,u[z].scale(D.sideImpulse,x),E.pointToLocalFrame(G,G),G["xyz"[this.indexUpAxis]]*=D.rollInfluence,E.pointToWorldFrame(G,G),E.applyImpulse(x,G),x.scale(-1,x),y.applyImpulse(x,I))};var B=new b,A=new b,J=new b,T=new b,R=new b,H=new b,U=new b,C=new b,K=new b,N=new b},
{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(e,d,m){function a(q){this.wheelBodies=[];this.coordinateSystem="undefined"===typeof q.coordinateSystem?new h(1,2,3):q.coordinateSystem.clone();this.chassisBody=q.chassisBody;this.chassisBody||(q=new k(new h(5,2,.5)),this.chassisBody=new c(1,q));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var c=e("./Body"),b=e("../shapes/Sphere"),k=e("../shapes/Box"),
h=e("../math/Vec3"),f=e("../constraints/HingeConstraint");d.exports=a;a.prototype.addWheel=function(q){q=q||{};var n=q.body;n||(n=new c(1,new b(1.2)));this.wheelBodies.push(n);this.wheelForces.push(0);new h;var t="undefined"!==typeof q.position?q.position.clone():new h,r=new h;this.chassisBody.pointToWorldFrame(t,r);n.position.set(r.x,r.y,r.z);q="undefined"!==typeof q.axis?q.axis.clone():new h(0,1,0);this.wheelAxes.push(q);n=new f(this.chassisBody,n,{pivotA:t,axisA:q,pivotB:h.ZERO,axisB:q,collideConnected:!1});
this.constraints.push(n);return this.wheelBodies.length-1};a.prototype.setSteeringValue=function(q,n){var t=this.wheelAxes[n],r=Math.cos(q),u=Math.sin(q),v=t.x;t=t.y;this.constraints[n].axisA.set(r*v-u*t,u*v+r*t,0)};a.prototype.setMotorSpeed=function(q,n){var t=this.constraints[n];t.enableMotor();t.motorTargetVelocity=q};a.prototype.disableMotor=function(q){this.constraints[q].disableMotor()};var l=new h;a.prototype.setWheelForce=function(q,n){this.wheelForces[n]=q};a.prototype.applyWheelForce=function(q,
n){var t=this.wheelBodies[n],r=t.torque;this.wheelAxes[n].scale(q,l);t.vectorToWorldFrame(l,l);r.vadd(l,r)};a.prototype.addToWorld=function(q){for(var n=this.constraints,t=this.wheelBodies.concat([this.chassisBody]),r=0;r<t.length;r++)q.add(t[r]);for(r=0;r<n.length;r++)q.addConstraint(n[r]);q.addEventListener("preStep",this._update.bind(this))};a.prototype._update=function(){for(var q=this.wheelForces,n=0;n<q.length;n++)this.applyWheelForce(q[n],n)};a.prototype.removeFromWorld=function(q){for(var n=
this.constraints,t=this.wheelBodies.concat([this.chassisBody]),r=0;r<t.length;r++)q.remove(t[r]);for(r=0;r<n.length;r++)q.removeConstraint(n[r])};var p=new h;a.prototype.getWheelSpeed=function(q){var n=this.wheelBodies[q].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[q],p);return n.dot(p)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(e,d,m){function a(){this.particles=[];this.speedOfSound=this.smoothingRadius=
this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}d.exports=a;e("../shapes/Shape");d=e("../math/Vec3");e("../math/Quaternion");e("../shapes/Particle");e("../objects/Body");e("../material/Material");a.prototype.add=function(q){this.particles.push(q);this.neighbors.length<this.particles.length&&this.neighbors.push([])};a.prototype.remove=function(q){q=this.particles.indexOf(q);-1!==q&&(this.particles.splice(q,1),this.neighbors.length>this.particles.length&&
this.neighbors.pop())};var c=new d;a.prototype.getNeighbors=function(q,n){for(var t=this.particles.length,r=q.id,u=this.smoothingRadius*this.smoothingRadius,v=0;v!==t;v++){var B=this.particles[v];B.position.vsub(q.position,c);r!==B.id&&c.norm2()<u&&n.push(B)}};var b=new d,k=new d,h=new d,f=new d,l=new d,p=new d;a.prototype.update=function(){for(var q=this.particles.length,n=this.speedOfSound,t=this.eps,r=0;r!==q;r++){var u=this.particles[r],v=this.neighbors[r];v.length=0;this.getNeighbors(u,v);v.push(this.particles[r]);
for(var B=v.length,A=0,J=0;J!==B;J++){u.position.vsub(v[J].position,b);var T=b.norm();T=this.w(T);A+=v[J].mass*T}this.densities[r]=A;this.pressures[r]=n*n*(this.densities[r]-this.density)}for(r=0;r!==q;r++){n=this.particles[r];k.set(0,0,0);h.set(0,0,0);v=this.neighbors[r];B=v.length;for(J=0;J!==B;J++)A=v[J],n.position.vsub(A.position,l),T=l.norm(),u=-A.mass*(this.pressures[r]/(this.densities[r]*this.densities[r]+t)+this.pressures[J]/(this.densities[J]*this.densities[J]+t)),this.gradw(l,f),f.mult(u,
f),k.vadd(f,k),A.velocity.vsub(n.velocity,p),p.mult(1/(1E-4+this.densities[r]*this.densities[J])*this.viscosity*A.mass,p),u=this.nablaw(T),p.mult(u,p),h.vadd(p,h);h.mult(n.mass,h);k.mult(n.mass,k);n.force.vadd(h,n.force);n.force.vadd(k,n.force)}};a.prototype.w=function(q){var n=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(n,9))*Math.pow(n*n-q*q,3)};a.prototype.gradw=function(q,n){var t=q.norm(),r=this.smoothingRadius;q.mult(945/(32*Math.PI*Math.pow(r,9))*Math.pow(r*r-t*t,2),n)};a.prototype.nablaw=
function(q){var n=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(n,9))*(n*n-q*q)*(7*q*q-3*n*n)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(e,d,m){function a(v,B,A){A=A||{};this.restLength="number"===typeof A.restLength?A.restLength:1;this.stiffness=A.stiffness||100;this.damping=A.damping||1;this.bodyA=v;this.bodyB=B;this.localAnchorA=new c;this.localAnchorB=new c;A.localAnchorA&&this.localAnchorA.copy(A.localAnchorA);
A.localAnchorB&&this.localAnchorB.copy(A.localAnchorB);A.worldAnchorA&&this.setWorldAnchorA(A.worldAnchorA);A.worldAnchorB&&this.setWorldAnchorB(A.worldAnchorB)}var c=e("../math/Vec3");d.exports=a;a.prototype.setWorldAnchorA=function(v){this.bodyA.pointToLocalFrame(v,this.localAnchorA)};a.prototype.setWorldAnchorB=function(v){this.bodyB.pointToLocalFrame(v,this.localAnchorB)};a.prototype.getWorldAnchorA=function(v){this.bodyA.pointToWorldFrame(this.localAnchorA,v)};a.prototype.getWorldAnchorB=function(v){this.bodyB.pointToWorldFrame(this.localAnchorB,
v)};var b=new c,k=new c,h=new c,f=new c,l=new c,p=new c,q=new c,n=new c,t=new c,r=new c,u=new c;a.prototype.applyForce=function(){var v=this.stiffness,B=this.damping,A=this.restLength,J=this.bodyA,T=this.bodyB;this.getWorldAnchorA(l);this.getWorldAnchorB(p);l.vsub(J.position,q);p.vsub(T.position,n);p.vsub(l,b);var R=b.norm();k.copy(b);k.normalize();T.velocity.vsub(J.velocity,h);T.angularVelocity.cross(n,u);h.vadd(u,h);J.angularVelocity.cross(q,u);h.vsub(u,h);k.mult(-v*(R-A)-B*h.dot(k),f);J.force.vsub(f,
J.force);T.force.vadd(f,T.force);q.cross(f,t);n.cross(f,r);J.torque.vsub(t,J.torque);T.torque.vadd(r,T.torque)}},{"../math/Vec3":30}],36:[function(e,d,m){function a(p){p=h.defaults(p,{chassisConnectionPointLocal:new c,chassisConnectionPointWorld:new c,directionLocal:new c,directionWorld:new c,axleLocal:new c,axleWorld:new c,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,
rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=p.maxSuspensionTravel;this.customSlidingRotationalSpeed=p.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=p.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=
p.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=p.chassisConnectionPointWorld.clone();this.directionLocal=p.directionLocal.clone();this.directionWorld=p.directionWorld.clone();this.axleLocal=p.axleLocal.clone();this.axleWorld=p.axleWorld.clone();this.suspensionRestLength=p.suspensionRestLength;this.suspensionMaxLength=p.suspensionMaxLength;this.radius=p.radius;this.suspensionStiffness=p.suspensionStiffness;this.dampingCompression=p.dampingCompression;this.dampingRelaxation=
p.dampingRelaxation;this.frictionSlip=p.frictionSlip;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=p.rollInfluence;this.maxSuspensionForce=p.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=p.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new k;this.worldTransform=new b;this.isInContact=!1}var c=e("../math/Vec3"),
b=e("../math/Transform"),k=e("../collision/RaycastResult"),h=e("../utils/Utils");d.exports=a;var f=new c,l=new c;f=new c;a.prototype.updateWheel=function(p){var q=this.raycastResult;if(this.isInContact){var n=q.hitNormalWorld.dot(q.directionWorld);q.hitPointWorld.vsub(p.position,l);p.getVelocityAtWorldPoint(l,f);p=q.hitNormalWorld.dot(f);-.1<=n?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(n=-1/n,this.suspensionRelativeVelocity=p*n,this.clippedInvContactDotSuspension=
n)}else q.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,q.directionWorld.scale(-1,q.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(e,d,m){function a(l){c.call(this);this.type=c.types.BOX;this.halfExtents=l;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}d.exports=a;var c=e("./Shape"),
b=e("../math/Vec3"),k=e("./ConvexPolyhedron");a.prototype=new c;a.prototype.constructor=a;a.prototype.updateConvexPolyhedronRepresentation=function(){var l=this.halfExtents.x,p=this.halfExtents.y,q=this.halfExtents.z;l=[new b(-l,-p,-q),new b(l,-p,-q),new b(l,p,-q),new b(-l,p,-q),new b(-l,-p,q),new b(l,-p,q),new b(l,p,q),new b(-l,p,q)];new b(0,0,1);new b(0,1,0);new b(1,0,0);this.convexPolyhedronRepresentation=l=new k(l,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]);l.material=this.material};
a.prototype.calculateLocalInertia=function(l,p){p=p||new b;a.calculateInertia(this.halfExtents,l,p);return p};a.calculateInertia=function(l,p,q){q.x=1/12*p*(4*l.y*l.y+4*l.z*l.z);q.y=1/12*p*(4*l.x*l.x+4*l.z*l.z);q.z=1/12*p*(4*l.y*l.y+4*l.x*l.x)};a.prototype.getSideNormals=function(l,p){var q=this.halfExtents;l[0].set(q.x,0,0);l[1].set(0,q.y,0);l[2].set(0,0,q.z);l[3].set(-q.x,0,0);l[4].set(0,-q.y,0);l[5].set(0,0,-q.z);if(void 0!==p)for(q=0;q!==l.length;q++)p.vmult(l[q],l[q]);return l};a.prototype.volume=
function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var h=new b;new b;a.prototype.forEachWorldCorner=function(l,p,q){var n=this.halfExtents;n=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]];for(var t=0;t<n.length;t++)h.set(n[t][0],n[t][1],n[t][2]),p.vmult(h,h),l.vadd(h,h),q(h.x,h.y,h.z)};var f=[new b,
new b,new b,new b,new b,new b,new b,new b];a.prototype.calculateWorldAABB=function(l,p,q,n){var t=this.halfExtents;f[0].set(t.x,t.y,t.z);f[1].set(-t.x,t.y,t.z);f[2].set(-t.x,-t.y,t.z);f[3].set(-t.x,-t.y,-t.z);f[4].set(t.x,-t.y,-t.z);f[5].set(t.x,t.y,-t.z);f[6].set(-t.x,t.y,-t.z);f[7].set(t.x,-t.y,t.z);var r=f[0];p.vmult(r,r);l.vadd(r,r);n.copy(r);q.copy(r);for(t=1;8>t;t++){r=f[t];p.vmult(r,r);l.vadd(r,r);var u=r.x,v=r.y;r=r.z;u>n.x&&(n.x=u);v>n.y&&(n.y=v);r>n.z&&(n.z=r);u<q.x&&(q.x=u);v<q.y&&(q.y=
v);r<q.z&&(q.z=r)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(e,d,m){function a(w,x,F){c.call(this);this.type=c.types.CONVEXPOLYHEDRON;this.vertices=w||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=x||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=F?F.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}d.exports=a;var c=e("./Shape"),b=e("../math/Vec3");
e("../math/Quaternion");var k=e("../math/Transform");a.prototype=new c;a.prototype.constructor=a;var h=new b;a.prototype.computeEdges=function(){for(var w=this.faces,x=this.vertices,F=this.uniqueEdges,Q=F.length=0;Q!==w.length;Q++)for(var P=w[Q],L=P.length,W=0;W!==L;W++){x[P[W]].vsub(x[P[(W+1)%L]],h);h.normalize();for(var ca=!1,O=0;O!==F.length;O++)if(F[O].almostEquals(h)||F[O].almostEquals(h)){ca=!0;break}ca||F.push(h.clone())}};a.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;
for(var w=0;w<this.faces.length;w++){for(var x=0;x<this.faces[w].length;x++)if(!this.vertices[this.faces[w][x]])throw Error("Vertex "+this.faces[w][x]+" not found!");x=this.faceNormals[w]||new b;this.getFaceNormal(w,x);x.negate(x);this.faceNormals[w]=x;if(0>x.dot(this.vertices[this.faces[w][0]]))for(console.error(".faceNormals["+w+"] = Vec3("+x.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),x=0;x<
this.faces[w].length;x++)console.warn(".vertices["+this.faces[w][x]+"] = Vec3("+this.vertices[this.faces[w][x]].toString()+")")}};var f=new b,l=new b;a.computeNormal=function(w,x,F,Q){x.vsub(w,l);F.vsub(x,f);f.cross(l,Q);Q.isZero()||Q.normalize()};a.prototype.getFaceNormal=function(w,x){var F=this.faces[w];return a.computeNormal(this.vertices[F[0]],this.vertices[F[1]],this.vertices[F[2]],x)};var p=new b;a.prototype.clipAgainstHull=function(w,x,F,Q,P,L,W,ca,O){for(var qa=-1,la=-Number.MAX_VALUE,fa=
0;fa<F.faces.length;fa++){p.copy(F.faceNormals[fa]);P.vmult(p,p);var V=p.dot(L);V>la&&(la=V,qa=fa)}la=[];fa=F.faces[qa];V=fa.length;for(var ba=0;ba<V;ba++){var da=F.vertices[fa[ba]],na=new b;na.copy(da);P.vmult(na,na);Q.vadd(na,na);la.push(na)}0<=qa&&this.clipFaceAgainstHull(L,w,x,la,W,ca,O)};var q=new b,n=new b,t=new b,r=new b,u=new b,v=new b;a.prototype.findSeparatingAxis=function(w,x,F,Q,P,L,W,ca){var O=Number.MAX_VALUE,qa=0;if(this.uniqueAxes)for(fa=0;fa!==this.uniqueAxes.length;fa++){F.vmult(this.uniqueAxes[fa],
q);V=this.testSepAxis(q,w,x,F,Q,P);if(!1===V)return!1;V<O&&(O=V,L.copy(q))}else for(var la=W?W.length:this.faces.length,fa=0;fa<la;fa++){V=W?W[fa]:fa;q.copy(this.faceNormals[V]);F.vmult(q,q);var V=this.testSepAxis(q,w,x,F,Q,P);if(!1===V)return!1;V<O&&(O=V,L.copy(q))}if(w.uniqueAxes)for(fa=0;fa!==w.uniqueAxes.length;fa++){P.vmult(w.uniqueAxes[fa],n);qa++;V=this.testSepAxis(n,w,x,F,Q,P);if(!1===V)return!1;V<O&&(O=V,L.copy(n))}else for(W=ca?ca.length:w.faces.length,fa=0;fa<W;fa++){V=ca?ca[fa]:fa;n.copy(w.faceNormals[V]);
P.vmult(n,n);qa++;V=this.testSepAxis(n,w,x,F,Q,P);if(!1===V)return!1;V<O&&(O=V,L.copy(n))}for(ca=0;ca!==this.uniqueEdges.length;ca++)for(F.vmult(this.uniqueEdges[ca],r),qa=0;qa!==w.uniqueEdges.length;qa++)if(P.vmult(w.uniqueEdges[qa],u),r.cross(u,v),!v.almostZero()){v.normalize();fa=this.testSepAxis(v,w,x,F,Q,P);if(!1===fa)return!1;fa<O&&(O=fa,L.copy(v))}Q.vsub(x,t);0<t.dot(L)&&L.negate(L);return!0};var B=[],A=[];a.prototype.testSepAxis=function(w,x,F,Q,P,L){a.project(this,w,F,Q,B);a.project(x,w,
P,L,A);F=B[0];w=B[1];x=A[0];Q=A[1];if(F<Q||x<w)return!1;F-=Q;w=x-w;return F<w?F:w};var J=new b,T=new b;a.prototype.calculateLocalInertia=function(w,x){this.computeLocalAABB(J,T);var F=T.x-J.x,Q=T.y-J.y,P=T.z-J.z;x.x=1/12*w*(4*Q*Q+4*P*P);x.y=1/12*w*(4*F*F+4*P*P);x.z=1/12*w*(4*Q*Q+4*F*F)};a.prototype.getPlaneConstantOfFace=function(w){return-this.faceNormals[w].dot(this.vertices[this.faces[w][0]])};var R=new b,H=new b,U=new b,C=new b,K=new b,N=new b,G=new b,X=new b;a.prototype.clipFaceAgainstHull=function(w,
x,F,Q,P,L,W){for(var ca=[],O=-1,qa=Number.MAX_VALUE,la=0;la<this.faces.length;la++){R.copy(this.faceNormals[la]);F.vmult(R,R);var fa=R.dot(w);fa<qa&&(qa=fa,O=la)}if(!(0>O)){w=this.faces[O];w.connectedFaces=[];for(qa=0;qa<this.faces.length;qa++)for(la=0;la<this.faces[qa].length;la++)-1!==w.indexOf(this.faces[qa][la])&&qa!==O&&-1===w.connectedFaces.indexOf(qa)&&w.connectedFaces.push(qa);qa=w.length;for(la=0;la<qa;la++){fa=this.vertices[w[la]];fa.vsub(this.vertices[w[(la+1)%qa]],H);U.copy(H);F.vmult(U,
U);x.vadd(U,U);C.copy(this.faceNormals[O]);F.vmult(C,C);x.vadd(C,C);U.cross(C,K);K.negate(K);N.copy(fa);F.vmult(N,N);x.vadd(N,N);N.dot(K);fa=w.connectedFaces[la];G.copy(this.faceNormals[fa]);fa=this.getPlaneConstantOfFace(fa);X.copy(G);F.vmult(X,X);fa-=X.dot(x);for(this.clipFaceAgainstPlane(Q,ca,X,fa);Q.length;)Q.shift();for(;ca.length;)Q.push(ca.shift())}G.copy(this.faceNormals[O]);fa=this.getPlaneConstantOfFace(O);X.copy(G);F.vmult(X,X);fa-=X.dot(x);for(qa=0;qa<Q.length;qa++)x=X.dot(Q[qa])+fa,x<=
P&&(console.log("clamped: depth="+x+" to minDist="+(P+"")),x=P),x<=L&&(F=Q[qa],0>=x&&W.push({point:F,normal:X,depth:x}))}};a.prototype.clipFaceAgainstPlane=function(w,x,F,Q){var P=w.length;if(2>P)return x;var L=w[w.length-1];var W=F.dot(L)+Q;for(var ca=0;ca<P;ca++){var O=w[ca];var qa=F.dot(O)+Q;if(0>W){if(0>qa){var la=new b;la.copy(O)}else la=new b,L.lerp(O,W/(W-qa),la);x.push(la)}else 0>qa&&(la=new b,L.lerp(O,W/(W-qa),la),x.push(la),x.push(O));L=O;W=qa}return x};a.prototype.computeWorldVertices=
function(w,x){for(var F=this.vertices.length;this.worldVertices.length<F;)this.worldVertices.push(new b);for(var Q=this.vertices,P=this.worldVertices,L=0;L!==F;L++)x.vmult(Q[L],P[L]),w.vadd(P[L],P[L]);this.worldVerticesNeedsUpdate=!1};new b;a.prototype.computeLocalAABB=function(w,x){var F=this.vertices.length,Q=this.vertices;w.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);x.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var P=0;P<F;P++){var L=Q[P];L.x<w.x?w.x=L.x:L.x>x.x&&
(x.x=L.x);L.y<w.y?w.y=L.y:L.y>x.y&&(x.y=L.y);L.z<w.z?w.z=L.z:L.z>x.z&&(x.z=L.z)}};a.prototype.computeWorldFaceNormals=function(w){for(var x=this.faceNormals.length;this.worldFaceNormals.length<x;)this.worldFaceNormals.push(new b);for(var F=this.faceNormals,Q=this.worldFaceNormals,P=0;P!==x;P++)w.vmult(F[P],Q[P]);this.worldFaceNormalsNeedsUpdate=!1};a.prototype.updateBoundingSphereRadius=function(){for(var w=0,x=this.vertices,F=0,Q=x.length;F!==Q;F++){var P=x[F].norm2();P>w&&(w=P)}this.boundingSphereRadius=
Math.sqrt(w)};var M=new b;a.prototype.calculateWorldAABB=function(w,x,F,Q){for(var P=this.vertices.length,L=this.vertices,W,ca,O,qa,la,fa,V=0;V<P;V++){M.copy(L[V]);x.vmult(M,M);w.vadd(M,M);var ba=M;if(ba.x<W||void 0===W)W=ba.x;else if(ba.x>qa||void 0===qa)qa=ba.x;if(ba.y<ca||void 0===ca)ca=ba.y;else if(ba.y>la||void 0===la)la=ba.y;if(ba.z<O||void 0===O)O=ba.z;else if(ba.z>fa||void 0===fa)fa=ba.z}F.set(W,ca,O);Q.set(qa,la,fa)};a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/
3};a.prototype.getAveragePointLocal=function(w){w=w||new b;for(var x=this.vertices.length,F=this.vertices,Q=0;Q<x;Q++)w.vadd(F[Q],w);w.mult(1/x,w);return w};a.prototype.transformAllPoints=function(w,x){var F=this.vertices.length,Q=this.vertices;if(x){for(var P=0;P<F;P++){var L=Q[P];x.vmult(L,L)}for(P=0;P<this.faceNormals.length;P++)L=this.faceNormals[P],x.vmult(L,L)}if(w)for(P=0;P<F;P++)L=Q[P],L.vadd(w,L)};var E=new b,I=new b,z=new b;a.prototype.pointIsInside=function(w){var x=this.vertices,F=this.faces,
Q=this.faceNormals,P=this.faces.length;this.getAveragePointLocal(E);for(var L=0;L<P;L++){var W=Q[L];var ca=x[F[L][0]],O=I;w.vsub(ca,O);O=W.dot(O);var qa=z;E.vsub(ca,qa);W=W.dot(qa);if(0>O&&0<W||0<O&&0>W)return!1}return-1};new b;var D=new b,y=new b;a.project=function(w,x,F,Q,P){var L=w.vertices.length;w=w.vertices;y.setZero();k.vectorToLocalFrame(F,Q,x,D);k.pointToLocalFrame(F,Q,y,y);Q=y.dot(D);F=x=w[0].dot(D);for(var W=1;W<L;W++){var ca=w[W].dot(D);ca>x&&(x=ca);ca<F&&(F=ca)}F-=Q;x-=Q;F>x&&(L=F,F=
x,x=L);P[0]=x;P[1]=F}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(e,d,m){function a(h,f,l,p){var q=[],n=[],t=[],r=[],u=[],v=Math.cos,B=Math.sin;q.push(new b(f*v(0),f*B(0),.5*-l));r.push(0);q.push(new b(h*v(0),h*B(0),.5*l));u.push(1);for(var A=0;A<p;A++){var J=2*Math.PI/p*(A+1),T=2*Math.PI/p*(A+.5);A<p-1?(q.push(new b(f*v(J),f*B(J),.5*-l)),r.push(2*A+2),q.push(new b(h*v(J),h*B(J),.5*l)),u.push(2*A+3),t.push([2*A+2,2*A+3,2*A+1,2*A])):t.push([0,1,2*
A+1,2*A]);(1===p%2||A<p/2)&&n.push(new b(v(T),B(T),0))}t.push(u);n.push(new b(0,0,1));h=[];for(A=0;A<r.length;A++)h.push(r[r.length-A-1]);t.push(h);this.type=c.types.CONVEXPOLYHEDRON;k.call(this,q,t,n)}d.exports=a;var c=e("./Shape"),b=e("../math/Vec3");e("../math/Quaternion");var k=e("./ConvexPolyhedron");a.prototype=new k},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(e,d,m){function a(f,l){l=h.defaults(l,{maxValue:null,minValue:null,elementSize:1});
this.data=f;this.maxValue=l.maxValue;this.minValue=l.minValue;this.elementSize=l.elementSize;null===l.minValue&&this.updateMinValue();null===l.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;c.call(this);this.pillarConvex=new b;this.pillarOffset=new k;this.type=c.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var c=e("./Shape"),b=e("./ConvexPolyhedron"),k=e("../math/Vec3"),h=e("../utils/Utils");d.exports=a;a.prototype=new c;a.prototype.update=function(){this._cachedPillars=
{}};a.prototype.updateMinValue=function(){for(var f=this.data,l=f[0][0],p=0;p!==f.length;p++)for(var q=0;q!==f[p].length;q++){var n=f[p][q];n<l&&(l=n)}this.minValue=l};a.prototype.updateMaxValue=function(){for(var f=this.data,l=f[0][0],p=0;p!==f.length;p++)for(var q=0;q!==f[p].length;q++){var n=f[p][q];n>l&&(l=n)}this.maxValue=l};a.prototype.setHeightValueAtIndex=function(f,l,p){this.data[f][l]=p;this.clearCachedConvexTrianglePillar(f,l,!1);0<f&&(this.clearCachedConvexTrianglePillar(f-1,l,!0),this.clearCachedConvexTrianglePillar(f-
1,l,!1));0<l&&(this.clearCachedConvexTrianglePillar(f,l-1,!0),this.clearCachedConvexTrianglePillar(f,l-1,!1));0<l&&0<f&&this.clearCachedConvexTrianglePillar(f-1,l-1,!0)};a.prototype.getRectMinMax=function(f,l,p,q,n){n=n||[];for(var t=this.data,r=this.minValue;f<=p;f++)for(var u=l;u<=q;u++){var v=t[f][u];v>r&&(r=v)}n[0]=this.minValue;n[1]=r};a.prototype.getIndexOfPosition=function(f,l,p,q){var n=this.elementSize,t=this.data;f=Math.floor(f/n);l=Math.floor(l/n);p[0]=f;p[1]=l;q&&(0>f&&(f=0),0>l&&(l=0),
f>=t.length-1&&(f=t.length-1),l>=t[0].length-1&&(l=t[0].length-1));return 0>f||0>l||f>=t.length-1||l>=t[0].length-1?!1:!0};a.prototype.getHeightAt=function(f,l,p){var q=[];this.getIndexOfPosition(f,l,q,p);f=[];this.getRectMinMax(q[0],q[1]+1,q[0],q[1]+1,f);return(f[0]+f[1])/2};a.prototype.getCacheConvexTrianglePillarKey=function(f,l,p){return f+"_"+l+"_"+(p?1:0)};a.prototype.getCachedConvexTrianglePillar=function(f,l,p){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(f,l,p)]};a.prototype.setCachedConvexTrianglePillar=
function(f,l,p,q,n){this._cachedPillars[this.getCacheConvexTrianglePillarKey(f,l,p)]={convex:q,offset:n}};a.prototype.clearCachedConvexTrianglePillar=function(f,l,p){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(f,l,p)]};a.prototype.getConvexTrianglePillar=function(f,l,p){var q=this.pillarConvex,n=this.pillarOffset;if(this.cacheEnabled){var t=this.getCachedConvexTrianglePillar(f,l,p);if(t){this.pillarConvex=t.convex;this.pillarOffset=t.offset;return}q=new b;n=new k;this.pillarConvex=
q;this.pillarOffset=n}t=this.data;var r=this.elementSize,u=q.faces;q.vertices.length=6;for(var v=0;6>v;v++)q.vertices[v]||(q.vertices[v]=new k);u.length=5;for(v=0;5>v;v++)u[v]||(u[v]=[]);v=q.vertices;var B=(Math.min(t[f][l],t[f+1][l],t[f][l+1],t[f+1][l+1])-this.minValue)/2+this.minValue;p?(n.set((f+.75)*r,(l+.75)*r,B),v[0].set(.25*r,.25*r,t[f+1][l+1]-B),v[1].set(-.75*r,.25*r,t[f][l+1]-B),v[2].set(.25*r,-.75*r,t[f+1][l]-B),v[3].set(.25*r,.25*r,-B-1),v[4].set(-.75*r,.25*r,-B-1),v[5].set(.25*r,-.75*
r,-B-1),u[0][0]=0,u[0][1]=1,u[0][2]=2,u[1][0]=5,u[1][1]=4,u[1][2]=3,u[2][0]=2,u[2][1]=5,u[2][2]=3,u[2][3]=0,u[3][0]=3,u[3][1]=4,u[3][2]=1,u[3][3]=0,u[4][0]=1,u[4][1]=4,u[4][2]=5,u[4][3]=2):(n.set((f+.25)*r,(l+.25)*r,B),v[0].set(-.25*r,-.25*r,t[f][l]-B),v[1].set(.75*r,-.25*r,t[f+1][l]-B),v[2].set(-.25*r,.75*r,t[f][l+1]-B),v[3].set(-.25*r,-.25*r,-B-1),v[4].set(.75*r,-.25*r,-B-1),v[5].set(-.25*r,.75*r,-B-1),u[0][0]=0,u[0][1]=1,u[0][2]=2,u[1][0]=5,u[1][1]=4,u[1][2]=3,u[2][0]=0,u[2][1]=2,u[2][2]=5,u[2][3]=
3,u[3][0]=1,u[3][1]=0,u[3][2]=3,u[3][3]=4,u[4][0]=4,u[4][1]=5,u[4][2]=2,u[4][3]=1);q.computeNormals();q.computeEdges();q.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(f,l,p,q,n)};a.prototype.calculateLocalInertia=function(f,l){l=l||new k;l.set(0,0,0);return l};a.prototype.volume=function(){return Number.MAX_VALUE};a.prototype.calculateWorldAABB=function(f,l,p,q){p.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);q.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};
a.prototype.updateBoundingSphereRadius=function(){var f=this.data,l=this.elementSize;this.boundingSphereRadius=(new k(f.length*l,f[0].length*l,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(e,d,m){function a(){c.call(this);this.type=c.types.PARTICLE}d.exports=a;var c=e("./Shape"),b=e("../math/Vec3");a.prototype=new c;a.prototype.constructor=a;a.prototype.calculateLocalInertia=function(k,
h){h=h||new b;h.set(0,0,0);return h};a.prototype.volume=function(){return 0};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};a.prototype.calculateWorldAABB=function(k,h,f,l){f.copy(k);l.copy(k)}},{"../math/Vec3":30,"./Shape":43}],42:[function(e,d,m){function a(){c.call(this);this.type=c.types.PLANE;this.worldNormal=new b;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}d.exports=a;var c=e("./Shape"),b=e("../math/Vec3");a.prototype=new c;a.prototype.constructor=
a;a.prototype.computeWorldNormal=function(h){var f=this.worldNormal;f.set(0,0,1);h.vmult(f,f);this.worldNormalNeedsUpdate=!1};a.prototype.calculateLocalInertia=function(h,f){return f=f||new b};a.prototype.volume=function(){return Number.MAX_VALUE};var k=new b;a.prototype.calculateWorldAABB=function(h,f,l,p){k.set(0,0,1);f.vmult(k,k);f=Number.MAX_VALUE;l.set(-f,-f,-f);p.set(f,f,f);1===k.x&&(p.x=h.x);1===k.y&&(p.y=h.y);1===k.z&&(p.z=h.z);-1===k.x&&(l.x=h.x);-1===k.y&&(l.y=h.y);-1===k.z&&(l.z=h.z)};
a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(e,d,m){function a(){this.id=a.idCounter++;this.boundingSphereRadius=this.type=0;this.collisionResponse=!0;this.material=null}d.exports=a;a=e("./Shape");e("../math/Vec3");e("../math/Quaternion");e("../material/Material");a.prototype.constructor=a;a.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+
this.type;};a.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};a.prototype.calculateLocalInertia=function(c,b){throw"calculateLocalInertia() not implemented for shape type "+this.type;};a.idCounter=0;a.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(e,d,m){function a(k){c.call(this);this.radius=void 0!==
k?Number(k):1;this.type=c.types.SPHERE;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}d.exports=a;var c=e("./Shape"),b=e("../math/Vec3");a.prototype=new c;a.prototype.constructor=a;a.prototype.calculateLocalInertia=function(k,h){h=h||new b;var f=2*k*this.radius*this.radius/5;h.x=f;h.y=f;h.z=f;return h};a.prototype.volume=function(){return 4*Math.PI*this.radius/3};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};
a.prototype.calculateWorldAABB=function(k,h,f,l){h=this.radius;for(var p=["x","y","z"],q=0;q<p.length;q++){var n=p[q];f[n]=k[n]-h;l[n]=k[n]+h}}},{"../math/Vec3":30,"./Shape":43}],45:[function(e,d,m){function a(H,U){c.call(this);this.type=c.types.TRIMESH;this.vertices=new Float32Array(H);this.indices=new Int16Array(U);this.normals=new Float32Array(U.length);this.aabb=new h;this.edges=null;this.scale=new b(1,1,1);this.tree=new f;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();
this.updateTree()}d.exports=a;var c=e("./Shape"),b=e("../math/Vec3");e("../math/Quaternion");var k=e("../math/Transform"),h=e("../collision/AABB"),f=e("../utils/Octree");a.prototype=new c;a.prototype.constructor=a;var l=new b;a.prototype.updateTree=function(){var H=this.tree;H.reset();H.aabb.copy(this.aabb);var U=this.scale;H.aabb.lowerBound.x*=1/U.x;H.aabb.lowerBound.y*=1/U.y;H.aabb.lowerBound.z*=1/U.z;H.aabb.upperBound.x*=1/U.x;H.aabb.upperBound.y*=1/U.y;H.aabb.upperBound.z*=1/U.z;U=new h;for(var C=
new b,K=new b,N=new b,G=[C,K,N],X=0;X<this.indices.length/3;X++){var M=3*X;this._getUnscaledVertex(this.indices[M],C);this._getUnscaledVertex(this.indices[M+1],K);this._getUnscaledVertex(this.indices[M+2],N);U.setFromPoints(G);H.insert(U,X)}H.removeEmptyNodes()};var p=new h;a.prototype.getTrianglesInAABB=function(H,U){p.copy(H);var C=this.scale,K=C.x,N=C.y;C=C.z;var G=p.lowerBound,X=p.upperBound;G.x/=K;G.y/=N;G.z/=C;X.x/=K;X.y/=N;X.z/=C;return this.tree.aabbQuery(p,U)};a.prototype.setScale=function(H){var U=
H.x===H.y===H.z;this.scale.x===this.scale.y===this.scale.z&&U||this.updateNormals();this.scale.copy(H);this.updateAABB();this.updateBoundingSphereRadius()};a.prototype.updateNormals=function(){for(var H=this.normals,U=0;U<this.indices.length/3;U++){var C=3*U,K=this.indices[C+1],N=this.indices[C+2];this.getVertex(this.indices[C],u);this.getVertex(K,v);this.getVertex(N,B);a.computeNormal(v,u,B,l);H[C]=l.x;H[C+1]=l.y;H[C+2]=l.z}};a.prototype.updateEdges=function(){for(var H={},U=function(X,M){H[N<G?
N+"_"+G:G+"_"+N]=!0},C=0;C<this.indices.length/3;C++){var K=3*C,N=this.indices[K],G=this.indices[K+1];K=this.indices[K+2];U(N,G);U(G,K);U(K,N)}U=Object.keys(H);this.edges=new Int16Array(2*U.length);for(C=0;C<U.length;C++)K=U[C].split("_"),this.edges[2*C]=parseInt(K[0],10),this.edges[2*C+1]=parseInt(K[1],10)};a.prototype.getEdgeVertex=function(H,U,C){this.getVertex(this.edges[2*H+(U?1:0)],C)};var q=new b,n=new b;a.prototype.getEdgeVector=function(H,U){this.getEdgeVertex(H,0,q);this.getEdgeVertex(H,
1,n);n.vsub(q,U)};var t=new b,r=new b;a.computeNormal=function(H,U,C,K){U.vsub(H,r);C.vsub(U,t);t.cross(r,K);K.isZero()||K.normalize()};var u=new b,v=new b,B=new b;a.prototype.getVertex=function(H,U){var C=this.scale;this._getUnscaledVertex(H,U);U.x*=C.x;U.y*=C.y;U.z*=C.z;return U};a.prototype._getUnscaledVertex=function(H,U){var C=3*H,K=this.vertices;return U.set(K[C],K[C+1],K[C+2])};a.prototype.getWorldVertex=function(H,U,C,K){this.getVertex(H,K);k.pointToWorldFrame(U,C,K,K);return K};a.prototype.getTriangleVertices=
function(H,U,C,K){H*=3;this.getVertex(this.indices[H],U);this.getVertex(this.indices[H+1],C);this.getVertex(this.indices[H+2],K)};a.prototype.getNormal=function(H,U){var C=3*H;return U.set(this.normals[C],this.normals[C+1],this.normals[C+2])};var A=new h;a.prototype.calculateLocalInertia=function(H,U){this.computeLocalAABB(A);var C=A.upperBound.x-A.lowerBound.x,K=A.upperBound.y-A.lowerBound.y,N=A.upperBound.z-A.lowerBound.z;return U.set(1/12*H*(4*K*K+4*N*N),1/12*H*(4*C*C+4*N*N),1/12*H*(4*K*K+4*C*
C))};var J=new b;a.prototype.computeLocalAABB=function(H){var U=H.lowerBound;H=H.upperBound;var C=this.vertices.length;this.getVertex(0,J);U.copy(J);H.copy(J);for(var K=0;K!==C;K++)this.getVertex(K,J),J.x<U.x?U.x=J.x:J.x>H.x&&(H.x=J.x),J.y<U.y?U.y=J.y:J.y>H.y&&(H.y=J.y),J.z<U.z?U.z=J.z:J.z>H.z&&(H.z=J.z)};a.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};a.prototype.updateBoundingSphereRadius=function(){var H=0,U=this.vertices,C=new b,K=0;for(U=U.length/3;K!==U;K++){this.getVertex(K,
C);var N=C.norm2();N>H&&(H=N)}this.boundingSphereRadius=Math.sqrt(H)};new b;var T=new k,R=new h;a.prototype.calculateWorldAABB=function(H,U,C,K){T.position=H;T.quaternion=U;this.aabb.toWorldFrame(T,R);C.copy(R.lowerBound);K.copy(R.upperBound)};a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.createTorus=function(H,U,C,K,N){H=H||1;U=U||.5;C=C||8;K=K||6;N=N||2*Math.PI;for(var G=[],X=[],M=0;M<=C;M++)for(var E=0;E<=K;E++){var I=E/K*N,z=M/C*Math.PI*2;G.push((H+U*Math.cos(z))*
Math.cos(I),(H+U*Math.cos(z))*Math.sin(I),U*Math.sin(z))}for(M=1;M<=C;M++)for(E=1;E<=K;E++)H=(K+1)*(M-1)+E-1,U=(K+1)*(M-1)+E,N=(K+1)*M+E,X.push((K+1)*M+E-1,H,N),X.push(H,U,N);return new a(G,X)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(e,d,m){function a(){c.call(this);this.iterations=10;this.tolerance=1E-7}d.exports=a;e("../math/Vec3");e("../math/Quaternion");var c=e("./Solver");a.prototype=new c;var b=
[],k=[],h=[];a.prototype.solve=function(f,l){var p=0,q=this.iterations,n=this.tolerance*this.tolerance,t=this.equations,r=t.length,u=l.bodies,v=u.length,B;if(0!==r)for(B=0;B!==v;B++)u[B].updateSolveMassProperties();k.length=r;h.length=r;b.length=r;for(B=0;B!==r;B++){var A=t[B];b[B]=0;h[B]=A.computeB(f);k[B]=1/A.computeC()}if(0!==r){for(B=0;B!==v;B++)A=u[B],p=A.wlambda,A.vlambda.set(0,0,0),p&&p.set(0,0,0);for(p=0;p!==q;p++){for(var J=B=0;J!==r;J++){A=t[J];var T=h[J];var R=k[J];var H=b[J];var U=A.computeGWlambda();
T=R*(T-U-A.eps*H);H+T<A.minForce?T=A.minForce-H:H+T>A.maxForce&&(T=A.maxForce-H);b[J]+=T;B+=0<T?T:-T;A.addToWlambda(T)}if(B*B<n)break}for(B=0;B!==v;B++)A=u[B],q=A.velocity,n=A.angularVelocity,q.vadd(A.vlambda,q),n&&n.vadd(A.wlambda,n)}return p}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(e,d,m){function a(){this.equations=[]}d.exports=a;a.prototype.solve=function(c,b){return 0};a.prototype.addEquation=function(c){c.enabled&&this.equations.push(c)};a.prototype.removeEquation=
function(c){var b=this.equations;c=b.indexOf(c);-1!==c&&b.splice(c,1)};a.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(e,d,m){function a(t,r,u){h.call(this);this.iterations=r;this.tolerance=u;this.subsolver=t;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function c(t){for(var r=t.length,u=0;u!==r;u++){var v=t[u];if(!(v.visited||v.body.type&q))return v}return!1}function b(t,r,u){r.push(t.body);r=t.eqs.length;
for(var v=0;v!==r;v++){var B=t.eqs[v];-1===u.indexOf(B)&&u.push(B)}}function k(t,r){return r.id-t.id}d.exports=a;e("../math/Vec3");e("../math/Quaternion");var h=e("./Solver");e=e("../objects/Body");a.prototype=new h;var f=[],l=[],p={bodies:[]},q=e.STATIC,n=[];a.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};a.prototype.solve=function(t,r){for(var u=this.nodePool,v=r.bodies,B=this.equations,A=B.length,J=v.length,T=this.subsolver;u.length<J;)u.push(this.createNode());
f.length=J;for(var R=0;R<J;R++)f[R]=u[R];for(R=0;R!==J;R++)u=f[R],u.body=v[R],u.children.length=0,u.eqs.length=0,u.visited=!1;for(J=0;J!==A;J++){u=B[J];R=v.indexOf(u.bi);var H=v.indexOf(u.bj);R=f[R];H=f[H];R.children.push(H);R.eqs.push(u);H.children.push(R);H.eqs.push(u)}v=0;B=l;T.tolerance=this.tolerance;for(T.iterations=this.iterations;R=c(f);){B.length=0;p.bodies.length=0;u=R;R=b;A=p.bodies;J=B;n.push(u);u.visited=!0;for(R(u,A,J);n.length;)for(u=n.pop();H=c(u.children);)H.visited=!0,R(H,A,J),n.push(H);
A=B.length;B=B.sort(k);for(R=0;R!==A;R++)T.addEquation(B[R]);T.solve(t,p);T.removeAllEquations();v++}return v}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(e,d,m){e=function(){};d.exports=e;e.prototype={constructor:e,addEventListener:function(a,c){void 0===this._listeners&&(this._listeners={});var b=this._listeners;void 0===b[a]&&(b[a]=[]);-1===b[a].indexOf(c)&&b[a].push(c);return this},hasEventListener:function(a,c){if(void 0===this._listeners)return!1;
var b=this._listeners;return void 0!==b[a]&&-1!==b[a].indexOf(c)?!0:!1},removeEventListener:function(a,c){if(void 0===this._listeners)return this;var b=this._listeners;if(void 0===b[a])return this;var k=b[a].indexOf(c);-1!==k&&b[a].splice(k,1);return this},dispatchEvent:function(a){if(void 0===this._listeners)return this;var c=this._listeners[a.type];if(void 0!==c){a.target=this;for(var b=0,k=c.length;b<k;b++)c[b].call(this,a)}return this}}},{}],50:[function(e,d,m){function a(l){l=l||{};this.root=
l.root||null;this.aabb=l.aabb?l.aabb.clone():new b;this.data=[];this.children=[]}function c(l,p){p=p||{};p.root=null;p.aabb=l;a.call(this,p);this.maxDepth="undefined"!==typeof p.maxDepth?p.maxDepth:8}var b=e("../collision/AABB"),k=e("../math/Vec3");d.exports=c;c.prototype=new a;a.prototype.reset=function(l,p){this.children.length=this.data.length=0};a.prototype.insert=function(l,p,q){var n=this.data;q=q||0;if(!this.aabb.contains(l))return!1;var t=this.children;if(q<(this.maxDepth||this.root.maxDepth)){var r=
!1;t.length||(this.subdivide(),r=!0);for(var u=0;8!==u;u++)if(t[u].insert(l,p,q+1))return!0;r&&(t.length=0)}n.push(p);return!0};var h=new k;a.prototype.subdivide=function(){var l=this.aabb,p=l.lowerBound,q=l.upperBound;l=this.children;l.push(new a({aabb:new b({lowerBound:new k(0,0,0)})}),new a({aabb:new b({lowerBound:new k(1,0,0)})}),new a({aabb:new b({lowerBound:new k(1,1,0)})}),new a({aabb:new b({lowerBound:new k(1,1,1)})}),new a({aabb:new b({lowerBound:new k(0,1,1)})}),new a({aabb:new b({lowerBound:new k(0,
0,1)})}),new a({aabb:new b({lowerBound:new k(1,0,1)})}),new a({aabb:new b({lowerBound:new k(0,1,0)})}));q.vsub(p,h);h.scale(.5,h);q=this.root||this;for(var n=0;8!==n;n++){var t=l[n];t.root=q;var r=t.aabb.lowerBound;r.x*=h.x;r.y*=h.y;r.z*=h.z;r.vadd(p,r);r.vadd(h,t.aabb.upperBound)}};a.prototype.aabbQuery=function(l,p){for(var q=[this];q.length;){var n=q.pop();n.aabb.overlaps(l)&&Array.prototype.push.apply(p,n.data);Array.prototype.push.apply(q,n.children)}return p};var f=new b;a.prototype.rayQuery=
function(l,p,q){l.getAABB(f);f.toLocalFrame(p,f);this.aabbQuery(f,q);return q};a.prototype.removeEmptyNodes=function(){for(var l=[this];l.length;){for(var p=l.pop(),q=p.children.length-1;0<=q;q--)p.children[q].data.length||p.children.splice(q,1);Array.prototype.push.apply(l,p.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(e,d,m){function a(){this.objects=[];this.type=Object}d.exports=a;a.prototype.release=function(){for(var c=arguments.length,b=0;b!==c;b++)this.objects.push(arguments[b])};
a.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};a.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");}},{}],52:[function(e,d,m){function a(){this.data={keys:[]}}d.exports=a;a.prototype.get=function(c,b){if(c>b){var k=b;b=c;c=k}return this.data[c+"-"+b]};a.prototype.set=function(c,b,k){if(c>b){var h=b;b=c;c=h}h=c+"-"+b;this.get(c,b)||this.data.keys.push(h);this.data[h]=k};a.prototype.reset=
function(){for(var c=this.data,b=c.keys;0<b.length;){var k=b.pop();delete c[k]}}},{}],53:[function(e,d,m){function a(){}d.exports=a;a.defaults=function(c,b){c=c||{};for(var k in b)k in c||(c[k]=b[k]);return c}},{}],54:[function(e,d,m){function a(){b.call(this);this.type=c}d.exports=a;var c=e("../math/Vec3"),b=e("./Pool");a.prototype=new b;a.prototype.constructObject=function(){return new c}},{"../math/Vec3":30,"./Pool":51}],55:[function(e,d,m){function a(S){this.contactPointPool=[];this.frictionEquationPool=
[];this.result=[];this.frictionResult=[];this.v3pool=new f;this.world=S;this.currentContactMaterial=null;this.enableFrictionReduction=!1}d.exports=a;d=e("../collision/AABB");m=e("../shapes/Shape");var c=e("../collision/Ray"),b=e("../math/Vec3"),k=e("../math/Transform");e("../shapes/ConvexPolyhedron");var h=e("../math/Quaternion");e("../solver/Solver");var f=e("../utils/Vec3Pool"),l=e("../equations/ContactEquation"),p=e("../equations/FrictionEquation");a.prototype.createContactEquation=function(S,
Y,ha,ja,aa,ea){if(this.contactPointPool.length){var ka=this.contactPointPool.pop();ka.bi=S;ka.bj=Y}else ka=new l(S,Y);ka.enabled=S.collisionResponse&&Y.collisionResponse&&ha.collisionResponse&&ja.collisionResponse;var pa=this.currentContactMaterial;ka.restitution=pa.restitution;ka.setSpookParams(pa.contactEquationStiffness,pa.contactEquationRelaxation,this.world.dt);S=ha.material||S.material;Y=ja.material||Y.material;S&&Y&&0<=S.restitution&&0<=Y.restitution&&(ka.restitution=S.restitution*Y.restitution);
ka.si=aa||ha;ka.sj=ea||ja;return ka};a.prototype.createFrictionEquationsFromContact=function(S,Y){var ha=S.bi,ja=S.bj,aa=this.world,ea=this.currentContactMaterial,ka=ea.friction,pa=S.si.material||ha.material,ma=S.sj.material||ja.material;pa&&ma&&0<=pa.friction&&0<=ma.friction&&(ka=pa.friction*ma.friction);if(0<ka){ka*=aa.gravity.length();pa=ha.invMass+ja.invMass;0<pa&&(pa=1/pa);var ia=this.frictionEquationPool;ma=ia.length?ia.pop():new p(ha,ja,ka*pa);ia=ia.length?ia.pop():new p(ha,ja,ka*pa);ma.bi=
ia.bi=ha;ma.bj=ia.bj=ja;ma.minForce=ia.minForce=-ka*pa;ma.maxForce=ia.maxForce=ka*pa;ma.ri.copy(S.ri);ma.rj.copy(S.rj);ia.ri.copy(S.ri);ia.rj.copy(S.rj);S.ni.tangents(ma.t,ia.t);ma.setSpookParams(ea.frictionEquationStiffness,ea.frictionEquationRelaxation,aa.dt);ia.setSpookParams(ea.frictionEquationStiffness,ea.frictionEquationRelaxation,aa.dt);ma.enabled=ia.enabled=S.enabled;Y.push(ma,ia);return!0}return!1};var q=new b,n=new b,t=new b;a.prototype.createFrictionFromAverage=function(S){var Y=this.result[this.result.length-
1];if(this.createFrictionEquationsFromContact(Y,this.frictionResult)&&1!==S){var ha=this.frictionResult[this.frictionResult.length-2],ja=this.frictionResult[this.frictionResult.length-1];q.setZero();n.setZero();t.setZero();for(var aa=Y.bi,ea=0;ea!==S;ea++)Y=this.result[this.result.length-1-ea],Y.bodyA!==aa?(q.vadd(Y.ni,q),n.vadd(Y.ri,n),t.vadd(Y.rj,t)):(q.vsub(Y.ni,q),n.vadd(Y.rj,n),t.vadd(Y.ri,t));S=1/S;n.scale(S,ha.ri);t.scale(S,ha.rj);ja.ri.copy(ha.ri);ja.rj.copy(ha.rj);q.normalize();q.tangents(ha.t,
ja.t)}};var r=new b,u=new b,v=new h,B=new h;a.prototype.getContacts=function(S,Y,ha,ja,aa,ea,ka){this.contactPointPool=aa;this.frictionEquationPool=ka;this.result=ja;this.frictionResult=ea;ja=0;for(aa=S.length;ja!==aa;ja++){ea=S[ja];ka=Y[ja];var pa=null;ea.material&&ka.material&&(pa=ha.getContactMaterial(ea.material,ka.material)||null);for(var ma=0;ma<ea.shapes.length;ma++){ea.quaternion.mult(ea.shapeOrientations[ma],v);ea.quaternion.vmult(ea.shapeOffsets[ma],r);r.vadd(ea.position,r);for(var ia=ea.shapes[ma],
Z=0;Z<ka.shapes.length;Z++){ka.quaternion.mult(ka.shapeOrientations[Z],B);ka.quaternion.vmult(ka.shapeOffsets[Z],u);u.vadd(ka.position,u);var sa=ka.shapes[Z];if(!(r.distanceTo(u)>ia.boundingSphereRadius+sa.boundingSphereRadius)){var oa=null;ia.material&&sa.material&&(oa=ha.getContactMaterial(ia.material,sa.material)||null);this.currentContactMaterial=oa||pa||ha.defaultContactMaterial;(oa=this[ia.type|sa.type])&&(ia.type<sa.type?oa.call(this,ia,sa,r,u,v,B,ea,ka,ia,sa):oa.call(this,sa,ia,u,r,B,v,ka,
ea,ia,sa))}}}}};a.prototype[m.types.BOX|m.types.BOX]=a.prototype.boxBox=function(S,Y,ha,ja,aa,ea,ka,pa){S.convexPolyhedronRepresentation.material=S.material;Y.convexPolyhedronRepresentation.material=Y.material;S.convexPolyhedronRepresentation.collisionResponse=S.collisionResponse;Y.convexPolyhedronRepresentation.collisionResponse=Y.collisionResponse;this.convexConvex(S.convexPolyhedronRepresentation,Y.convexPolyhedronRepresentation,ha,ja,aa,ea,ka,pa,S,Y)};a.prototype[m.types.BOX|m.types.CONVEXPOLYHEDRON]=
a.prototype.boxConvex=function(S,Y,ha,ja,aa,ea,ka,pa){S.convexPolyhedronRepresentation.material=S.material;S.convexPolyhedronRepresentation.collisionResponse=S.collisionResponse;this.convexConvex(S.convexPolyhedronRepresentation,Y,ha,ja,aa,ea,ka,pa,S,Y)};a.prototype[m.types.BOX|m.types.PARTICLE]=a.prototype.boxParticle=function(S,Y,ha,ja,aa,ea,ka,pa){S.convexPolyhedronRepresentation.material=S.material;S.convexPolyhedronRepresentation.collisionResponse=S.collisionResponse;this.convexParticle(S.convexPolyhedronRepresentation,
Y,ha,ja,aa,ea,ka,pa,S,Y)};a.prototype[m.types.SPHERE]=a.prototype.sphereSphere=function(S,Y,ha,ja,aa,ea,ka,pa){aa=this.createContactEquation(ka,pa,S,Y);ja.vsub(ha,aa.ni);aa.ni.normalize();aa.ri.copy(aa.ni);aa.rj.copy(aa.ni);aa.ri.mult(S.radius,aa.ri);aa.rj.mult(-Y.radius,aa.rj);aa.ri.vadd(ha,aa.ri);aa.ri.vsub(ka.position,aa.ri);aa.rj.vadd(ja,aa.rj);aa.rj.vsub(pa.position,aa.rj);this.result.push(aa);this.createFrictionEquationsFromContact(aa,this.frictionResult)};var A=new b,J=new b,T=new b;a.prototype[m.types.PLANE|
m.types.TRIMESH]=a.prototype.planeTrimesh=function(S,Y,ha,ja,aa,ea,ka,pa){var ma=new b;A.set(0,0,1);aa.vmult(A,A);for(aa=0;aa<Y.vertices.length/3;aa++){Y.getVertex(aa,ma);var ia=new b;ia.copy(ma);k.pointToWorldFrame(ja,ea,ia,ma);ia=J;ma.vsub(ha,ia);if(0>=A.dot(ia)){var Z=this.createContactEquation(ka,pa,S,Y);Z.ni.copy(A);var sa=T;A.scale(ia.dot(A),sa);ma.vsub(sa,sa);Z.ri.copy(sa);Z.ri.vsub(ka.position,Z.ri);Z.rj.copy(ma);Z.rj.vsub(pa.position,Z.rj);this.result.push(Z);this.createFrictionEquationsFromContact(Z,
this.frictionResult)}}};var R=new b,H=new b;new b;var U=new b,C=new b,K=new b,N=new b,G=new b,X=new b,M=new b,E=new b,I=new b,z=new b,D=new b,y=new d,w=[];a.prototype[m.types.SPHERE|m.types.TRIMESH]=a.prototype.sphereTrimesh=function(S,Y,ha,ja,aa,ea,ka,pa){k.pointToLocalFrame(ja,ea,ha,M);aa=S.radius;y.lowerBound.set(M.x-aa,M.y-aa,M.z-aa);y.upperBound.set(M.x+aa,M.y+aa,M.z+aa);Y.getTrianglesInAABB(y,w);var ma=S.radius*S.radius;for(aa=0;aa<w.length;aa++)for(var ia=0;3>ia;ia++)if(Y.getVertex(Y.indices[3*
w[aa]+ia],U),U.vsub(M,H),H.norm2()<=ma){C.copy(U);k.pointToWorldFrame(ja,ea,C,U);U.vsub(ha,H);var Z=this.createContactEquation(ka,pa,S,Y);Z.ni.copy(H);Z.ni.normalize();Z.ri.copy(Z.ni);Z.ri.scale(S.radius,Z.ri);Z.ri.vadd(ha,Z.ri);Z.ri.vsub(ka.position,Z.ri);Z.rj.copy(U);Z.rj.vsub(pa.position,Z.rj);this.result.push(Z);this.createFrictionEquationsFromContact(Z,this.frictionResult)}for(aa=0;aa<w.length;aa++)for(ia=0;3>ia;ia++)Y.getVertex(Y.indices[3*w[aa]+ia],K),Y.getVertex(Y.indices[3*w[aa]+(ia+1)%3],
N),N.vsub(K,G),M.vsub(N,E),ha=E.dot(G),M.vsub(K,E),Z=E.dot(G),0<Z&&0>ha&&(M.vsub(K,E),X.copy(G),X.normalize(),Z=E.dot(X),X.scale(Z,E),E.vadd(K,E),ha=E.distanceTo(M),ha<S.radius&&(Z=this.createContactEquation(ka,pa,S,Y),E.vsub(M,Z.ni),Z.ni.normalize(),Z.ni.scale(S.radius,Z.ri),k.pointToWorldFrame(ja,ea,E,E),E.vsub(pa.position,Z.rj),k.vectorToWorldFrame(ea,Z.ni,Z.ni),k.vectorToWorldFrame(ea,Z.ri,Z.ri),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult)));aa=0;for(ia=w.length;aa!==
ia;aa++)Y.getTriangleVertices(w[aa],I,z,D),Y.getNormal(w[aa],R),M.vsub(I,E),ha=E.dot(R),R.scale(ha,E),M.vsub(E,E),ha=E.distanceTo(M),c.pointInTriangle(E,I,z,D)&&ha<S.radius&&(Z=this.createContactEquation(ka,pa,S,Y),E.vsub(M,Z.ni),Z.ni.normalize(),Z.ni.scale(S.radius,Z.ri),k.pointToWorldFrame(ja,ea,E,E),E.vsub(pa.position,Z.rj),k.vectorToWorldFrame(ea,Z.ni,Z.ni),k.vectorToWorldFrame(ea,Z.ri,Z.ri),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult));w.length=0};var x=
new b,F=new b;a.prototype[m.types.SPHERE|m.types.PLANE]=a.prototype.spherePlane=function(S,Y,ha,ja,aa,ea,ka,pa){Y=this.createContactEquation(ka,pa,S,Y);Y.ni.set(0,0,1);ea.vmult(Y.ni,Y.ni);Y.ni.negate(Y.ni);Y.ni.normalize();Y.ni.mult(S.radius,Y.ri);ha.vsub(ja,x);Y.ni.mult(Y.ni.dot(x),F);x.vsub(F,Y.rj);-x.dot(Y.ni)<=S.radius&&(S=Y.ri,ea=Y.rj,S.vadd(ha,S),S.vsub(ka.position,S),ea.vadd(ja,ea),ea.vsub(pa.position,ea),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult))};
var Q=new b,P=new b,L=new b,W=new b,ca=new b,O=new b,qa=new b,la=[new b,new b,new b,new b,new b,new b],fa=new b,V=new b,ba=new b,da=new b;a.prototype[m.types.SPHERE|m.types.BOX]=a.prototype.sphereBox=function(S,Y,ha,ja,aa,ea,ka,pa){aa=this.v3pool;ha.vsub(ja,W);Y.getSideNormals(la,ea);ea=S.radius;for(var ma=!1,ia=null,Z=0,sa=0,oa=0,va=null,wa=0,xa=la.length;wa!==xa&&!1===ma;wa++){var ya=ca;ya.copy(la[wa]);var za=ya.norm();ya.normalize();var ta=W.dot(ya);if(ta<za+ea&&0<ta){var Aa=O,Ba=qa;Aa.copy(la[(wa+
1)%3]);Ba.copy(la[(wa+2)%3]);var Ca=Aa.norm(),Ga=Ba.norm();Aa.normalize();Ba.normalize();var Ea=W.dot(Aa),Fa=W.dot(Ba);Ea<Ca&&Ea>-Ca&&Fa<Ga&&Fa>-Ga&&(ta=Math.abs(ta-za-ea),null===va||ta<va)&&(va=ta,sa=Ea,oa=Fa,ia=za,V.copy(ya),ba.copy(Aa),da.copy(Ba),Z++)}}Z&&(ma=!0,Z=this.createContactEquation(ka,pa,S,Y),V.mult(-ea,Z.ri),Z.ni.copy(V),Z.ni.negate(Z.ni),V.mult(ia,V),ba.mult(sa,ba),V.vadd(ba,V),da.mult(oa,da),V.vadd(da,Z.rj),Z.ri.vadd(ha,Z.ri),Z.ri.vsub(ka.position,Z.ri),Z.rj.vadd(ja,Z.rj),Z.rj.vsub(pa.position,
Z.rj),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult));ta=aa.get();for(ia=0;2!==ia&&!ma;ia++)for(sa=0;2!==sa&&!ma;sa++)for(oa=0;2!==oa&&!ma;oa++)ta.set(0,0,0),ia?ta.vadd(la[0],ta):ta.vsub(la[0],ta),sa?ta.vadd(la[1],ta):ta.vsub(la[1],ta),oa?ta.vadd(la[2],ta):ta.vsub(la[2],ta),ja.vadd(ta,fa),fa.vsub(ha,fa),fa.norm2()<ea*ea&&(ma=!0,Z=this.createContactEquation(ka,pa,S,Y),Z.ri.copy(fa),Z.ri.normalize(),Z.ni.copy(Z.ri),Z.ri.mult(ea,Z.ri),Z.rj.copy(ta),Z.ri.vadd(ha,Z.ri),
Z.ri.vsub(ka.position,Z.ri),Z.rj.vadd(ja,Z.rj),Z.rj.vsub(pa.position,Z.rj),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult));aa.release(ta);va=aa.get();wa=aa.get();Z=aa.get();xa=aa.get();ta=aa.get();ya=la.length;for(ia=0;ia!==ya&&!ma;ia++)for(sa=0;sa!==ya&&!ma;sa++)if(ia%3!==sa%3){la[sa].cross(la[ia],va);va.normalize();la[ia].vadd(la[sa],wa);Z.copy(ha);Z.vsub(wa,Z);Z.vsub(ja,Z);za=Z.dot(va);va.mult(za,xa);for(oa=0;oa===ia%3||oa===sa%3;)oa++;ta.copy(ha);ta.vsub(xa,
ta);ta.vsub(wa,ta);ta.vsub(ja,ta);za=Math.abs(za);Aa=ta.norm();za<la[oa].norm()&&Aa<ea&&(ma=!0,oa=this.createContactEquation(ka,pa,S,Y),wa.vadd(xa,oa.rj),oa.rj.copy(oa.rj),ta.negate(oa.ni),oa.ni.normalize(),oa.ri.copy(oa.rj),oa.ri.vadd(ja,oa.ri),oa.ri.vsub(ha,oa.ri),oa.ri.normalize(),oa.ri.mult(ea,oa.ri),oa.ri.vadd(ha,oa.ri),oa.ri.vsub(ka.position,oa.ri),oa.rj.vadd(ja,oa.rj),oa.rj.vsub(pa.position,oa.rj),this.result.push(oa),this.createFrictionEquationsFromContact(oa,this.frictionResult))}aa.release(va,
wa,Z,xa,ta)};var na=new b,ua=new b,ra=new b,Da=new b,Ra=new b,Sa=new b,Ua=new b,eb=new b,fb=new b,gb=new b;a.prototype[m.types.SPHERE|m.types.CONVEXPOLYHEDRON]=a.prototype.sphereConvex=function(S,Y,ha,ja,aa,ea,ka,pa){aa=this.v3pool;ha.vsub(ja,na);for(var ma=Y.faceNormals,ia=Y.faces,Z=Y.vertices,sa=S.radius,oa=0;oa!==Z.length;oa++){var va=Ra;ea.vmult(Z[oa],va);ja.vadd(va,va);var wa=Da;va.vsub(ha,wa);if(wa.norm2()<sa*sa){S=this.createContactEquation(ka,pa,S,Y);S.ri.copy(wa);S.ri.normalize();S.ni.copy(S.ri);
S.ri.mult(sa,S.ri);va.vsub(ja,S.rj);S.ri.vadd(ha,S.ri);S.ri.vsub(ka.position,S.ri);S.rj.vadd(ja,S.rj);S.rj.vsub(pa.position,S.rj);this.result.push(S);this.createFrictionEquationsFromContact(S,this.frictionResult);return}}oa=0;for(va=ia.length;oa!==va;oa++){wa=ia[oa];var xa=Sa;ea.vmult(ma[oa],xa);var ya=Ua;ea.vmult(Z[wa[0]],ya);ya.vadd(ja,ya);var za=eb;xa.mult(-sa,za);ha.vadd(za,za);var ta=fb;za.vsub(ya,ta);za=ta.dot(xa);ta=gb;ha.vsub(ya,ta);if(0>za&&0<ta.dot(xa)){ya=[];ta=0;for(var Aa=wa.length;ta!==
Aa;ta++){var Ba=aa.get();ea.vmult(Z[wa[ta]],Ba);ja.vadd(Ba,Ba);ya.push(Ba)}a:{ta=ya;Aa=xa;Ba=ha;for(var Ca=null,Ga=ta.length,Ea=0;Ea!==Ga;Ea++){var Fa=ta[Ea],Ta=Q;ta[(Ea+1)%Ga].vsub(Fa,Ta);var $a=P;Ta.cross(Aa,$a);Ta=L;Ba.vsub(Fa,Ta);Fa=$a.dot(Ta);if(null===Ca||0<Fa&&!0===Ca||0>=Fa&&!1===Ca)null===Ca&&(Ca=0<Fa);else{ta=!1;break a}}ta=!0}if(ta){S=this.createContactEquation(ka,pa,S,Y);xa.mult(-sa,S.ri);xa.negate(S.ni);Y=aa.get();xa.mult(-za,Y);ea=aa.get();xa.mult(-sa,ea);ha.vsub(ja,S.rj);S.rj.vadd(ea,
S.rj);S.rj.vadd(Y,S.rj);S.rj.vadd(ja,S.rj);S.rj.vsub(pa.position,S.rj);S.ri.vadd(ha,S.ri);S.ri.vsub(ka.position,S.ri);aa.release(Y);aa.release(ea);this.result.push(S);this.createFrictionEquationsFromContact(S,this.frictionResult);ta=0;for(wa=ya.length;ta!==wa;ta++)aa.release(ya[ta]);break}else for(ta=0;ta!==wa.length;ta++){xa=aa.get();za=aa.get();ea.vmult(Z[wa[(ta+1)%wa.length]],xa);ea.vmult(Z[wa[(ta+2)%wa.length]],za);ja.vadd(xa,xa);ja.vadd(za,za);Ga=ua;za.vsub(xa,Ga);Ca=ra;Ga.unit(Ca);Aa=aa.get();
Ba=aa.get();ha.vsub(xa,Ba);Ea=Ba.dot(Ca);Ca.mult(Ea,Aa);Aa.vadd(xa,Aa);Ca=aa.get();Aa.vsub(ha,Ca);if(0<Ea&&Ea*Ea<Ga.norm2()&&Ca.norm2()<sa*sa){S=this.createContactEquation(ka,pa,S,Y);Aa.vsub(ja,S.rj);Aa.vsub(ha,S.ni);S.ni.normalize();S.ni.mult(sa,S.ri);S.rj.vadd(ja,S.rj);S.rj.vsub(pa.position,S.rj);S.ri.vadd(ha,S.ri);S.ri.vsub(ka.position,S.ri);this.result.push(S);this.createFrictionEquationsFromContact(S,this.frictionResult);ta=0;for(wa=ya.length;ta!==wa;ta++)aa.release(ya[ta]);aa.release(xa);aa.release(za);
aa.release(Aa);aa.release(Ca);aa.release(Ba);return}aa.release(xa);aa.release(za);aa.release(Aa);aa.release(Ca);aa.release(Ba)}ta=0;for(wa=ya.length;ta!==wa;ta++)aa.release(ya[ta])}}};new b;new b;a.prototype[m.types.PLANE|m.types.BOX]=a.prototype.planeBox=function(S,Y,ha,ja,aa,ea,ka,pa){Y.convexPolyhedronRepresentation.material=Y.material;Y.convexPolyhedronRepresentation.collisionResponse=Y.collisionResponse;this.planeConvex(S,Y.convexPolyhedronRepresentation,ha,ja,aa,ea,ka,pa)};var Ha=new b,Ia=new b,
Xa=new b,hb=new b;a.prototype[m.types.PLANE|m.types.CONVEXPOLYHEDRON]=a.prototype.planeConvex=function(S,Y,ha,ja,aa,ea,ka,pa){Ia.set(0,0,1);aa.vmult(Ia,Ia);for(var ma=aa=0;ma!==Y.vertices.length;ma++)if(Ha.copy(Y.vertices[ma]),ea.vmult(Ha,Ha),ja.vadd(Ha,Ha),Ha.vsub(ha,Xa),0>=Ia.dot(Xa)){var ia=this.createContactEquation(ka,pa,S,Y),Z=hb;Ia.mult(Ia.dot(Xa),Z);Ha.vsub(Z,Z);Z.vsub(ha,ia.ri);ia.ni.copy(Ia);Ha.vsub(ja,ia.rj);ia.ri.vadd(ha,ia.ri);ia.ri.vsub(ka.position,ia.ri);ia.rj.vadd(ja,ia.rj);ia.rj.vsub(pa.position,
ia.rj);this.result.push(ia);aa++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(ia,this.frictionResult)}this.enableFrictionReduction&&aa&&this.createFrictionFromAverage(aa)};var Ya=new b,Va=new b;a.prototype[m.types.CONVEXPOLYHEDRON]=a.prototype.convexConvex=function(S,Y,ha,ja,aa,ea,ka,pa,ma,ia,Z,sa){if(!(ha.distanceTo(ja)>S.boundingSphereRadius+Y.boundingSphereRadius)&&S.findSeparatingAxis(Y,ha,aa,ja,ea,Ya,Z,sa)){Z=[];S.clipAgainstHull(ha,aa,Y,ja,ea,Ya,-100,100,Z);for(ea=aa=
0;ea!==Z.length;ea++){sa=this.createContactEquation(ka,pa,S,Y,ma,ia);var oa=sa.ri,va=sa.rj;Ya.negate(sa.ni);Z[ea].normal.negate(Va);Va.mult(Z[ea].depth,Va);Z[ea].point.vadd(Va,oa);va.copy(Z[ea].point);oa.vsub(ha,oa);va.vsub(ja,va);oa.vadd(ha,oa);oa.vsub(ka.position,oa);va.vadd(ja,va);va.vsub(pa.position,va);this.result.push(sa);aa++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(sa,this.frictionResult)}this.enableFrictionReduction&&aa&&this.createFrictionFromAverage(aa)}};var Ja=
new b,ab=new b,Wa=new b;a.prototype[m.types.PLANE|m.types.PARTICLE]=a.prototype.planeParticle=function(S,Y,ha,ja,aa,ea,ka,pa){Ja.set(0,0,1);ka.quaternion.vmult(Ja,Ja);ja.vsub(ka.position,ab);0>=Ja.dot(ab)&&(S=this.createContactEquation(pa,ka,Y,S),S.ni.copy(Ja),S.ni.negate(S.ni),S.ri.set(0,0,0),Ja.mult(Ja.dot(ja),Wa),ja.vsub(Wa,Wa),S.rj.copy(Wa),this.result.push(S),this.createFrictionEquationsFromContact(S,this.frictionResult))};var Ma=new b;a.prototype[m.types.PARTICLE|m.types.SPHERE]=a.prototype.sphereParticle=
function(S,Y,ha,ja,aa,ea,ka,pa){Ma.set(0,0,1);ja.vsub(ha,Ma);Ma.norm2()<=S.radius*S.radius&&(Y=this.createContactEquation(pa,ka,Y,S),Ma.normalize(),Y.rj.copy(Ma),Y.rj.mult(S.radius,Y.rj),Y.ni.copy(Ma),Y.ni.negate(Y.ni),Y.ri.set(0,0,0),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult))};var bb=new h,Na=new b;new b;var Za=new b,cb=new b,Oa=new b;a.prototype[m.types.PARTICLE|m.types.CONVEXPOLYHEDRON]=a.prototype.convexParticle=function(S,Y,ha,ja,aa,ea,ka,pa){var ma=-1;
ea=null;var ia=0;Na.copy(ja);Na.vsub(ha,Na);aa.conjugate(bb);bb.vmult(Na,Na);if(S.pointIsInside(Na)){S.worldVerticesNeedsUpdate&&S.computeWorldVertices(ha,aa);S.worldFaceNormalsNeedsUpdate&&S.computeWorldFaceNormals(aa);aa=0;for(var Z=S.faces.length;aa!==Z;aa++){var sa=S.worldFaceNormals[aa];ja.vsub(S.worldVertices[S.faces[aa][0]],cb);var oa=-sa.dot(cb);if(null===ea||Math.abs(oa)<Math.abs(ea))ea=oa,ma=aa,Za.copy(sa),ia++}-1!==ma?(S=this.createContactEquation(pa,ka,Y,S),Za.mult(ea,Oa),Oa.vadd(ja,Oa),
Oa.vsub(ha,Oa),S.rj.copy(Oa),Za.negate(S.ni),S.ri.set(0,0,0),Y=S.ri,ea=S.rj,Y.vadd(ja,Y),Y.vsub(pa.position,Y),ea.vadd(ha,ea),ea.vsub(ka.position,ea),this.result.push(S),this.createFrictionEquationsFromContact(S,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};a.prototype[m.types.BOX|m.types.HEIGHTFIELD]=a.prototype.boxHeightfield=function(S,Y,ha,ja,aa,ea,ka,pa){S.convexPolyhedronRepresentation.material=S.material;S.convexPolyhedronRepresentation.collisionResponse=
S.collisionResponse;this.convexHeightfield(S.convexPolyhedronRepresentation,Y,ha,ja,aa,ea,ka,pa)};var Ka=new b,Pa=new b,db=[0];a.prototype[m.types.CONVEXPOLYHEDRON|m.types.HEIGHTFIELD]=a.prototype.convexHeightfield=function(S,Y,ha,ja,aa,ea,ka,pa){var ma=Y.data,ia=Y.elementSize,Z=S.boundingSphereRadius;k.pointToLocalFrame(ja,ea,ha,Ka);var sa=Math.floor((Ka.x-Z)/ia)-1,oa=Math.ceil((Ka.x+Z)/ia)+1,va=Math.floor((Ka.y-Z)/ia)-1;ia=Math.ceil((Ka.y+Z)/ia)+1;if(!(0>oa||0>ia||sa>ma.length||va>ma[0].length)){0>
sa&&(sa=0);0>oa&&(oa=0);0>va&&(va=0);0>ia&&(ia=0);sa>=ma.length&&(sa=ma.length-1);oa>=ma.length&&(oa=ma.length-1);ia>=ma[0].length&&(ia=ma[0].length-1);va>=ma[0].length&&(va=ma[0].length-1);ma=[];Y.getRectMinMax(sa,va,oa,ia,ma);var wa=ma[0];if(!(Ka.z-Z>ma[1]||Ka.z+Z<wa))for(Z=sa;Z<oa;Z++)for(sa=va;sa<ia;sa++)Y.getConvexTrianglePillar(Z,sa,!1),k.pointToWorldFrame(ja,ea,Y.pillarOffset,Pa),ha.distanceTo(Pa)<Y.pillarConvex.boundingSphereRadius+S.boundingSphereRadius&&this.convexConvex(S,Y.pillarConvex,
ha,Pa,aa,ea,ka,pa,null,null,db,null),Y.getConvexTrianglePillar(Z,sa,!0),k.pointToWorldFrame(ja,ea,Y.pillarOffset,Pa),ha.distanceTo(Pa)<Y.pillarConvex.boundingSphereRadius+S.boundingSphereRadius&&this.convexConvex(S,Y.pillarConvex,ha,Pa,aa,ea,ka,pa,null,null,db,null)}};var La=new b,Qa=new b;a.prototype[m.types.SPHERE|m.types.HEIGHTFIELD]=a.prototype.sphereHeightfield=function(S,Y,ha,ja,aa,ea,ka,pa){var ma=Y.data,ia=S.radius,Z=Y.elementSize;k.pointToLocalFrame(ja,ea,ha,La);var sa=Math.floor((La.x-ia)/
Z)-1,oa=Math.ceil((La.x+ia)/Z)+1,va=Math.floor((La.y-ia)/Z)-1;Z=Math.ceil((La.y+ia)/Z)+1;if(!(0>oa||0>Z||sa>ma.length||Z>ma[0].length)){0>sa&&(sa=0);0>oa&&(oa=0);0>va&&(va=0);0>Z&&(Z=0);sa>=ma.length&&(sa=ma.length-1);oa>=ma.length&&(oa=ma.length-1);Z>=ma[0].length&&(Z=ma[0].length-1);va>=ma[0].length&&(va=ma[0].length-1);ma=[];Y.getRectMinMax(sa,va,oa,Z,ma);var wa=ma[0];if(!(La.z-ia>ma[1]||La.z+ia<wa))for(ia=this.result;sa<oa;sa++)for(ma=va;ma<Z;ma++)if(wa=ia.length,Y.getConvexTrianglePillar(sa,
ma,!1),k.pointToWorldFrame(ja,ea,Y.pillarOffset,Qa),ha.distanceTo(Qa)<Y.pillarConvex.boundingSphereRadius+S.boundingSphereRadius&&this.sphereConvex(S,Y.pillarConvex,ha,Qa,aa,ea,ka,pa),Y.getConvexTrianglePillar(sa,ma,!0),k.pointToWorldFrame(ja,ea,Y.pillarOffset,Qa),ha.distanceTo(Qa)<Y.pillarConvex.boundingSphereRadius+S.boundingSphereRadius&&this.sphereConvex(S,Y.pillarConvex,ha,Qa,aa,ea,ka,pa),2<ia.length-wa)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,
"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(e,d,m){function a(){h.apply(this);this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new c;this.broadphase=new u;this.bodies=[];this.solver=new b;this.constraints=[];this.narrowphase=
new k(this);this.collisionMatrix=new f;this.collisionMatrixPrevious=new f;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new n;this.defaultMaterial=new l("default");this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",
body:null}}d.exports=a;e("../shapes/Shape");var c=e("../math/Vec3");d=e("../math/Quaternion");var b=e("../solver/GSSolver");e("../utils/Vec3Pool");e("../equations/ContactEquation");e("../equations/FrictionEquation");var k=e("./Narrowphase"),h=e("../utils/EventTarget"),f=e("../collision/ArrayCollisionMatrix"),l=e("../material/Material"),p=e("../material/ContactMaterial"),q=e("../objects/Body"),n=e("../utils/TupleDictionary"),t=e("../collision/RaycastResult");m=e("../collision/AABB");var r=e("../collision/Ray"),
u=e("../collision/NaiveBroadphase");a.prototype=new h;new m;var v=new r;a.prototype.getContactMaterial=function(M,E){return this.contactMaterialTable.get(M.id,E.id)};a.prototype.numObjects=function(){return this.bodies.length};a.prototype.collisionMatrixTick=function(){var M=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=M;this.collisionMatrix.reset()};a.prototype.add=a.prototype.addBody=function(M){-1===this.bodies.indexOf(M)&&(M.index=this.bodies.length,
this.bodies.push(M),M.world=this,M.initPosition.copy(M.position),M.initVelocity.copy(M.velocity),M.timeLastSleepy=this.time,M instanceof q&&(M.initAngularVelocity.copy(M.angularVelocity),M.initQuaternion.copy(M.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=M,this.dispatchEvent(this.addBodyEvent))};a.prototype.addConstraint=function(M){this.constraints.push(M)};a.prototype.removeConstraint=function(M){M=this.constraints.indexOf(M);-1!==M&&this.constraints.splice(M,
1)};a.prototype.rayTest=function(M,E,I){I instanceof t?this.raycastClosest(M,E,{skipBackfaces:!0},I):this.raycastAll(M,E,{skipBackfaces:!0},I)};a.prototype.raycastAll=function(M,E,I,z){I.mode=r.ALL;I.from=M;I.to=E;I.callback=z;return v.intersectWorld(this,I)};a.prototype.raycastAny=function(M,E,I,z){I.mode=r.ANY;I.from=M;I.to=E;I.result=z;return v.intersectWorld(this,I)};a.prototype.raycastClosest=function(M,E,I,z){I.mode=r.CLOSEST;I.from=M;I.to=E;I.result=z;return v.intersectWorld(this,I)};a.prototype.remove=
function(M){M.world=null;var E=this.bodies.length-1,I=this.bodies,z=I.indexOf(M);if(-1!==z){I.splice(z,1);for(z=0;z!==I.length;z++)I[z].index=z;this.collisionMatrix.setNumObjects(E);this.removeBodyEvent.body=M;this.dispatchEvent(this.removeBodyEvent)}};a.prototype.removeBody=a.prototype.remove;a.prototype.addMaterial=function(M){this.materials.push(M)};a.prototype.addContactMaterial=function(M){this.contactmaterials.push(M);this.contactMaterialTable.set(M.materials[0].id,M.materials[1].id,M)};"undefined"===
typeof performance&&(performance={});if(!performance.now){var B=Date.now();performance.timing&&performance.timing.navigationStart&&(B=performance.timing.navigationStart);performance.now=function(){return Date.now()-B}}var A=new c;a.prototype.step=function(M,E,I){I=I||10;E=E||0;if(0===E)this.internalStep(M),this.time+=M;else{var z=Math.floor((this.time+E)/M)-Math.floor(this.time/M);z=Math.min(z,I);I=performance.now();for(var D=0;D!==z&&!(this.internalStep(M),performance.now()-I>1E3*M);D++);this.time+=
E;M=this.time%M/M;E=this.bodies;for(z=0;z!==E.length;z++)I=E[z],I.type!==q.STATIC&&I.sleepState!==q.SLEEPING?(I.position.vsub(I.previousPosition,A),A.scale(M,A),I.position.vadd(A,I.interpolatedPosition)):(I.interpolatedPosition.copy(I.position),I.interpolatedQuaternion.copy(I.quaternion))}};var J={type:"postStep"},T={type:"preStep"},R={type:"collide",body:null,contact:null},H=[],U=[],C=[],K=[];new c;new c;new c;new c;new c;new c;new c;new c;new c;new d;var N=new d,G=new d,X=new c;a.prototype.internalStep=
function(M){this.dt=M;var E=this.contacts,I=this.numObjects(),z=this.bodies,D=this.solver,y=this.gravity,w=this.doProfiling,x=this.profile,F=q.DYNAMIC,Q,P=this.constraints;y.norm();var L=y.x,W=y.y,ca=y.z;w&&(Q=performance.now());for(y=0;y!==I;y++){var O=z[y];if(O.type&F){var qa=O.force;O=O.mass;qa.x+=O*L;qa.y+=O*W;qa.z+=O*ca}}y=0;for(O=this.subsystems.length;y!==O;y++)this.subsystems[y].update();w&&(Q=performance.now());C.length=0;K.length=0;this.broadphase.collisionPairs(this,C,K);w&&(x.broadphase=
performance.now()-Q);O=P.length;for(y=0;y!==O;y++)if(L=P[y],!L.collideConnected)for(W=C.length-1;0<=W;--W)if(L.bodyA===C[W]&&L.bodyB===K[W]||L.bodyB===C[W]&&L.bodyA===K[W])C.splice(W,1),K.splice(W,1);this.collisionMatrixTick();w&&(Q=performance.now());O=E.length;for(y=0;y!==O;y++)H.push(E[y]);E.length=0;O=this.frictionEquations.length;for(y=0;y!==O;y++)U.push(this.frictionEquations[y]);this.frictionEquations.length=0;this.narrowphase.getContacts(C,K,this,E,H,this.frictionEquations,U);w&&(x.narrowphase=
performance.now()-Q);w&&(Q=performance.now());for(y=0;y<this.frictionEquations.length;y++)D.addEquation(this.frictionEquations[y]);y=E.length;for(W=0;W!==y;W++)L=E[W],O=L.bi,ca=L.bj,O.material&&ca.material&&this.getContactMaterial(O.material,ca.material),O.material&&ca.material&&0<=O.material.restitution&&0<=ca.material.restitution&&(L.restitution=O.material.restitution*ca.material.restitution),D.addEquation(L),O.allowSleep&&O.type===q.DYNAMIC&&O.sleepState===q.SLEEPING&&ca.sleepState===q.AWAKE&&
ca.type!==q.STATIC&&ca.velocity.norm2()+ca.angularVelocity.norm2()>=2*Math.pow(ca.sleepSpeedLimit,2)&&(O._wakeUpAfterNarrowphase=!0),ca.allowSleep&&ca.type===q.DYNAMIC&&ca.sleepState===q.SLEEPING&&O.sleepState===q.AWAKE&&O.type!==q.STATIC&&O.velocity.norm2()+O.angularVelocity.norm2()>=2*Math.pow(O.sleepSpeedLimit,2)&&(ca._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(O,ca,!0),this.collisionMatrixPrevious.get(O,ca)||(R.body=ca,R.contact=L,O.dispatchEvent(R),R.body=O,ca.dispatchEvent(R));w&&(x.makeContactConstraints=
performance.now()-Q,Q=performance.now());for(y=0;y!==I;y++)O=z[y],O._wakeUpAfterNarrowphase&&(O.wakeUp(),O._wakeUpAfterNarrowphase=!1);O=P.length;for(y=0;y!==O;y++)for(L=P[y],L.update(),W=0,E=L.equations.length;W!==E;W++)D.addEquation(L.equations[W]);D.solve(M,this);w&&(x.solve=performance.now()-Q);D.removeAllEquations();D=Math.pow;for(y=0;y!==I;y++)if(O=z[y],O.type&F&&(P=D(1-O.linearDamping,M),E=O.velocity,E.mult(P,E),P=O.angularVelocity))E=D(1-O.angularDamping,M),P.mult(E,P);this.dispatchEvent(T);
for(y=0;y!==I;y++)O=z[y],O.preStep&&O.preStep.call(O);w&&(Q=performance.now());F=q.DYNAMIC|q.KINEMATIC;D=0===this.stepnumber%(this.quatNormalizeSkip+1);P=this.quatNormalizeFast;E=.5*M;for(y=0;y!==I;y++)if(O=z[y],L=O.force,W=O.torque,O.type&F&&O.sleepState!==q.SLEEPING){ca=O.velocity;qa=O.angularVelocity;var la=O.position,fa=O.quaternion,V=O.invMass,ba=O.invInertiaWorld;ca.x+=L.x*V*M;ca.y+=L.y*V*M;ca.z+=L.z*V*M;O.angularVelocity&&(ba.vmult(W,X),X.mult(M,X),X.vadd(qa,qa));la.x+=ca.x*M;la.y+=ca.y*M;
la.z+=ca.z*M;O.angularVelocity&&(N.set(qa.x,qa.y,qa.z,0),N.mult(fa,G),fa.x+=E*G.x,fa.y+=E*G.y,fa.z+=E*G.z,fa.w+=E*G.w,D&&(P?fa.normalizeFast():fa.normalize()));O.aabb&&(O.aabbNeedsUpdate=!0);O.updateInertiaWorld&&O.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;w&&(x.integrate=performance.now()-Q);this.time+=M;this.stepnumber+=1;this.dispatchEvent(J);for(y=0;y!==I;y++)O=z[y],(M=O.postStep)&&M.call(O);if(this.allowSleep)for(y=0;y!==I;y++)z[y].sleepTick(this.time)};a.prototype.clearForces=
function(){for(var M=this.bodies,E=M.length,I=0;I!==E;I++){var z=M[I];z.force.set(0,0,0);z.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,
"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)});CANNON=CANNON||{};var camera,scene,renderer,controls=null,s_oRender;
CANNON.Demo=function(g){function e(){if(J){for(var V in J.__controllers)J.__controllers[V].updateDisplay();for(var ba in J.__folders)for(V in J.__folders[ba].__controllers)J.__folders[ba].__controllers[V].updateDisplay()}}function d(V){function ba(na,ua){na.material&&(na.material=ua);for(var ra=0;ra<na.children.length;ra++)ba(na.children[ra],ua)}if(-1===F.indexOf(V))throw Error("Render mode "+V+" not found!");switch(V){case "solid":n.currentMaterial=C;Q.intensity=1;P.color.setHex(2236962);break;case "wireframe":n.currentMaterial=
K,Q.intensity=0,P.color.setHex(16777215)}for(var da=0;da<B.length;da++)ba(B[da],n.currentMaterial);r.rendermode=V}function m(){for(var V=v.length,ba=0;ba<V;ba++){var da=v[ba];da.position.copy(da.initPosition);da.velocity.copy(da.initVelocity);da.initAngularVelocity&&(da.angularVelocity.copy(da.initAngularVelocity),da.quaternion.copy(da.initQuaternion))}}function a(V){0===V.x&&(V.x=1E-6);0===V.y&&(V.y=1E-6);0===V.z&&(V.z=1E-6)}function c(){for(var V=v.length,ba=0;ba<V;ba++){var da=v[ba],na=B[ba];na.position.copy(da.position);
da.quaternion&&na.quaternion.copy(da.quaternion)}G.restart();if(r.contacts)for(ba=0;ba<x.contacts.length;ba++)for(V=0;2>V;V++){na=G.request();var ua=x.contacts[ba];da=0===V?ua.bi:ua.bj;var ra=0===V?ua.ri:ua.rj;na.position.set(da.position.x+ra.x,da.position.y+ra.y,da.position.z+ra.z)}G.hideCached();X.restart();if(r.cm2contact)for(ba=0;ba<x.contacts.length;ba++)for(V=0;2>V;V++)na=X.request(),ua=x.contacts[ba],da=0===V?ua.bi:ua.bj,ra=0===V?ua.ri:ua.rj,na.scale.set(ra.x,ra.y,ra.z),a(na.scale),na.position.copy(da.position);
X.hideCached();z.restart();D.restart();if(r.constraints){for(ba=0;ba<x.constraints.length;ba++)ua=x.constraints[ba],ua instanceof CANNON.DistanceConstraint&&(da=ua.equations.normal,V=da.bi,da=da.bj,na=z.request(),da=da.position?da.position:da,na.scale.set(da.x-V.position.x,da.y-V.position.y,da.z-V.position.z),a(na.scale),na.position.copy(V.position));for(ba=0;ba<x.constraints.length;ba++)if(ua=x.constraints[ba],ua instanceof CANNON.PointToPointConstraint){ra=ua.equations.normal;V=ra.bi;da=ra.bj;na=
D.request();ua=D.request();var Da=D.request();na.scale.set(ra.ri.x,ra.ri.y,ra.ri.z);ua.scale.set(ra.rj.x,ra.rj.y,ra.rj.z);Da.scale.set(-ra.penetrationVec.x,-ra.penetrationVec.y,-ra.penetrationVec.z);a(na.scale);a(ua.scale);a(Da.scale);na.position.copy(V.position);ua.position.copy(da.position);ra.bj.position.vadd(ra.rj,Da.position)}}D.hideCached();z.hideCached();y.restart();if(r.normals)for(ba=0;ba<x.contacts.length;ba++)ua=x.contacts[ba],V=ua.bi,na=y.request(),ra=ua.ni,da=V,na.scale.set(ra.x,ra.y,
ra.z),a(na.scale),na.position.copy(da.position),ua.ri.vadd(na.position,na.position);y.hideCached();w.restart();if(r.axes)for(V=0;V<v.length;V++)da=v[V],na=w.request(),na.position.copy(da.position),da.quaternion&&na.quaternion.copy(da.quaternion);w.hideCached();I.restart();if(r.aabbs)for(ba=0;ba<v.length;ba++)da=v[ba],da.computeAABB&&(da.aabbNeedsUpdate&&da.computeAABB(),isFinite(da.aabb.lowerBound.x)&&isFinite(da.aabb.lowerBound.y)&&isFinite(da.aabb.lowerBound.z)&&isFinite(da.aabb.upperBound.x)&&
isFinite(da.aabb.upperBound.y)&&isFinite(da.aabb.upperBound.z)&&0!=da.aabb.lowerBound.x-da.aabb.upperBound.x&&0!=da.aabb.lowerBound.y-da.aabb.upperBound.y&&0!=da.aabb.lowerBound.z-da.aabb.upperBound.z&&(na=I.request(),na.scale.set(da.aabb.lowerBound.x-da.aabb.upperBound.x,da.aabb.lowerBound.y-da.aabb.upperBound.y,da.aabb.lowerBound.z-da.aabb.upperBound.z),na.position.set(.5*(da.aabb.lowerBound.x+da.aabb.upperBound.x),.5*(da.aabb.lowerBound.y+da.aabb.upperBound.y),.5*(da.aabb.lowerBound.z+da.aabb.upperBound.z))));
I.hideCached()}function b(){requestAnimationFrame(b);r.paused||c();f();L.update()}function k(V){mouseX=V.clientX-la;mouseY=V.clientY-fa}function h(V){ca=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth;O=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight;CAMERA_TEST_TRACKBALL&&(controls.screen.width=ca,controls.screen.height=O)}function f(){(CAMERA_TEST_TRACKBALL||CAMERA_TEST_TRANSFORM&&null!==controls)&&controls.update();renderer.clear();renderer.render(n.scene,camera)}function l(V){n.dispatchEvent({type:"destroy"});
r.paused=!1;e();p(V)}function p(V){for(var ba=B.length,da=0;da<ba;da++){x.remove(v.pop());var na=B.pop();n.scene.remove(na)}for(;x.constraints.length;)x.removeConstraint(x.constraints[0]);A[V]();r.iterations=x.solver.iterations;r.gx=x.gravity.x+0;r.gy=x.gravity.y+0;r.gz=x.gravity.z+0;r.quatNormalizeSkip=x.quatNormalizeSkip;r.quatNormalizeFast=x.quatNormalizeFast;e();G.restart();G.hideCached();X.restart();X.hideCached();z.restart();z.hideCached();y.restart();y.hideCached()}function q(V){var ba=[],
da=[];this.request=function(){geo=ba.length?ba.pop():V();scene.add(geo);da.push(geo);return geo};this.restart=function(){for(;da.length;)ba.push(da.pop())};this.hideCached=function(){for(var na=0;na<ba.length;na++)scene.remove(ba[na])}}var n=this;this.addScene=function(V,ba){if("string"!==typeof V)throw Error("1st argument of Demo.addScene(title,initfunc) must be a string!");if("function"!==typeof ba)throw Error("2nd argument of Demo.addScene(title,initfunc) must be a function!");A.push(ba);var da=
A.length-1;H[V]=function(){l(da)};t.add(H,V)};this.restartCurrentScene=m;this.changeScene=l;this.start=function(){p(0)};var t,r=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:!0,gx:0,gy:0,gz:0,iterations:3,tolerance:1E-4,k:1E6,d:3,scene:0,paused:!1,rendermode:"solid",constraints:!1,contacts:!1,cm2contact:!1,normals:!1,axes:!1,particleSize:.1,shadows:!1,aabbs:!1,profiling:!1,maxSubSteps:3};g=g||{};for(var u in g)u in r&&(r[u]=g[u]);if(0!==r.stepFrequency%60)throw Error("stepFrequency must be a multiple of 60.");
var v=this.bodies=[],B=this.visuals=[],A=[],J=null,T=null,R=null,H={},U=new THREE.SphereGeometry(.1,6,6);this.particleGeo=new THREE.SphereGeometry(1,16,8);var C=new THREE.MeshPhongMaterial({color:11184810,specular:1118481,shininess:50}),K=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0});this.currentMaterial=C;var N=new THREE.MeshPhongMaterial({color:16711680});this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});var G=new q(function(){return new THREE.Mesh(U,N)}),X=new q(function(){var V=
new THREE.Geometry;V.vertices.push(new THREE.Vector3(0,0,0));V.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(V,new THREE.LineBasicMaterial({color:16711680}))}),M=new THREE.BoxGeometry(1,1,1),E=new THREE.MeshBasicMaterial({color:11184810,wireframe:!0}),I=new q(function(){return new THREE.Mesh(M,E)}),z=new q(function(){var V=new THREE.Geometry;V.vertices.push(new THREE.Vector3(0,0,0));V.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(V,new THREE.LineBasicMaterial({color:16711680}))}),
D=new q(function(){var V=new THREE.Geometry;V.vertices.push(new THREE.Vector3(0,0,0));V.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(V,new THREE.LineBasicMaterial({color:16711680}))}),y=new q(function(){var V=new THREE.Geometry;V.vertices.push(new THREE.Vector3(0,0,0));V.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(V,new THREE.LineBasicMaterial({color:65280}))}),w=new q(function(){var V=new THREE.Object3D,ba=new THREE.Vector3(0,0,0),da=new THREE.Geometry,na=new THREE.Geometry,
ua=new THREE.Geometry;da.vertices.push(ba);na.vertices.push(ba);ua.vertices.push(ba);da.vertices.push(new THREE.Vector3(1,0,0));na.vertices.push(new THREE.Vector3(0,1,0));ua.vertices.push(new THREE.Vector3(0,0,1));ba=new THREE.Line(da,new THREE.LineBasicMaterial({color:16711680}));na=new THREE.Line(na,new THREE.LineBasicMaterial({color:65280}));ua=new THREE.Line(ua,new THREE.LineBasicMaterial({color:255}));V.add(ba);V.add(na);V.add(ua);return V}),x=this.world=new CANNON.World;x.broadphase=new CANNON.NaiveBroadphase;
var F=["solid","wireframe"],Q,P,L,W;Detector.webgl||Detector.addGetWebGLMessage();var ca=s_iCanvasResizeWidth+s_iCanvasOffsetWidth,O=s_iCanvasResizeHeight+s_iCanvasOffsetHeight,qa,la=ca/2,fa=O/2;(function(){qa=document.createElement("div");document.body.appendChild(qa);CAMERA_TEST_TRACKBALL?(NEAR=1,camera=new THREE.PerspectiveCamera(45,ca/O,NEAR,FAR),camera.lookAt(new THREE.Vector3(CAMERA_TEST_LOOK_AT.x,CAMERA_TEST_LOOK_AT.y,CAMERA_TEST_LOOK_AT.z)),camera.position.set(0,500,500),camera.up.set(0,0,
1)):camera=createOrthoGraphicCamera();scene=n.scene=new THREE.Scene;scene.fog=new THREE.Fog(8306926,.5*FAR,FAR);P=new THREE.AmbientLight(4473924);scene.add(P);Q=new THREE.DirectionalLight(16777181,1);Q.position.set(180,0,180);Q.target.position.set(0,0,0);Q.castShadow=!0;Q.shadow.camera.near=10;Q.shadow.camera.far=100;Q.shadow.camera.fov=FOV;Q.shadowMapBias=.0139;Q.shadowMapDarkness=.1;Q.shadow.mapSize.width=1024;Q.shadow.mapSize.height=1024;new THREE.CameraHelper(Q.shadow.camera);scene.add(Q);scene.add(camera);
renderer=SHOW_3D_RENDER?new THREE.WebGLRenderer({clearColor:0,clearAlpha:.5,antialias:!0,alpha:!0}):new THREE.CanvasRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0});renderer.setSize(ca,O);renderer.domElement.style.position="relative";renderer.domElement.style.top="0px";renderer.domElement.style.opacity=CANVAS_3D_OPACITY;qa.appendChild(renderer.domElement);W=document.createElement("div");W.style.position="absolute";W.style.top="10px";W.style.width="100%";W.style.textAlign="center";W.innerHTML=
'<a href="http://github.com/schteppe/cannon.js">cannon.js</a> - javascript 3d physics';qa.appendChild(W);document.addEventListener("mousemove",k);window.addEventListener("resize",h);renderer.setClearColor(scene.fog.color,1);renderer.autoClear=!1;R=document.createElement("canvas");R.width=ca;R.height=O;R.style.opacity=.5;R.style.position="absolute";R.style.top="0px";R.style.zIndex=90;qa.appendChild(R);T=new SmoothieChart({labelOffsetY:50,maxDataSetLength:100,millisPerPixel:2,grid:{strokeStyle:"none",
fillStyle:"none",lineWidth:1,millisPerLine:250,verticalSections:6},labels:{fillStyle:"rgb(180, 180, 180)"}});T.streamTo(R);var V={},ba=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255]],da=0,na;for(na in x.profile){var ua=ba[da%ba.length];V[na]=new TimeSeries({label:na,fillStyle:"rgb("+ua[0]+","+ua[1]+","+ua[2]+")",maxDataLength:500});da++}x.addEventListener("postStep",function(ra){for(var Da in x.profile)V[Da].append(1E3*x.time,x.profile[Da])});da=0;for(na in x.profile)ua=ba[da%
ba.length],T.addTimeSeries(V[na],{strokeStyle:"rgb("+ua[0]+","+ua[1]+","+ua[2]+")",lineWidth:2}),da++;x.doProfiling=!1;T.stop();R.style.display="none";L=new Stats;L.domElement.style.position="absolute";L.domElement.style.top="0px";L.domElement.style.zIndex=100;qa.appendChild(L.domElement);void 0!=window.dat&&(J=new dat.GUI,J.domElement.parentNode.style.zIndex=120,ba=J.addFolder("Rendering"),ba.add(r,"rendermode",{Solid:"solid",Wireframe:"wireframe"}).onChange(function(ra){d(ra)}),ba.add(r,"contacts"),
ba.add(r,"cm2contact"),ba.add(r,"normals"),ba.add(r,"constraints"),ba.add(r,"axes"),ba.add(r,"particleSize").min(0).max(1).onChange(function(ra){for(var Da=0;Da<B.length;Da++)v[Da]instanceof CANNON.Particle&&B[Da].scale.set(ra,ra,ra)}),ba.add(r,"shadows").onChange(function(ra){ra?renderer.shadowMapAutoUpdate=!0:(renderer.shadowMapAutoUpdate=!1,renderer.clearTarget(Q.shadowMap))}),ba.add(r,"aabbs"),ba.add(r,"profiling").onChange(function(ra){ra?(x.doProfiling=!0,T.start(),R.style.display="block"):
(x.doProfiling=!1,T.stop(),R.style.display="none")}),ba=J.addFolder("World"),ba.add(r,"paused").onChange(function(ra){}),ba.add(r,"stepFrequency",60,600).step(60),ba.add(r,"gx",-100,100).onChange(function(ra){isNaN(ra)||x.gravity.set(ra,r.gy,r.gz)}),ba.add(r,"gy",-100,100).onChange(function(ra){isNaN(ra)||x.gravity.set(r.gx,ra,r.gz)}),ba.add(r,"gz",-100,100).onChange(function(ra){isNaN(ra)||x.gravity.set(r.gx,r.gy,ra)}),ba.add(r,"quatNormalizeSkip",0,50).step(1).onChange(function(ra){isNaN(ra)||(x.quatNormalizeSkip=
ra)}),ba.add(r,"quatNormalizeFast").onChange(function(ra){x.quatNormalizeFast=!!ra}),ba=J.addFolder("Solver"),ba.add(r,"iterations",1,50).step(1).onChange(function(ra){x.solver.iterations=ra}),ba.add(r,"k",10,1E7).onChange(function(ra){n.setGlobalSpookParams(r.k,r.d,1/r.stepFrequency)}),ba.add(r,"d",0,20).step(.1).onChange(function(ra){n.setGlobalSpookParams(r.k,r.d,1/r.stepFrequency)}),ba.add(r,"tolerance",0,10).step(.01).onChange(function(ra){x.solver.tolerance=ra}),t=J.addFolder("Scenes"),t.open());
CAMERA_TEST_TRACKBALL&&(controls=new THREE.TrackballControls(camera,renderer.domElement),controls.rotateSpeed=1,controls.zoomSpeed=1.2,controls.panSpeed=.2,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!1,controls.dynamicDampingFactor=.3,controls.minDistance=0,controls.maxDistance=1E5,controls.keys=[65,83,68],controls.screen.width=ca,controls.screen.height=O)})();b();s_oRender=f;document.addEventListener("keypress",function(V){if(V.keyCode)switch(V.keyCode){case 32:m();break;case 104:"none"==
L.domElement.style.display?(L.domElement.style.display="block",W.style.display="block"):(L.domElement.style.display="none",W.style.display="none");break;case 97:r.aabbs=!r.aabbs;e();break;case 99:r.constraints=!r.constraints;e();break;case 112:r.paused=!r.paused;e();break;case 115:x.step(1/r.stepFrequency);c();break;case 109:V=F.indexOf(r.rendermode);V++;V%=F.length;d(F[V]);e();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:A.length>V.keyCode-49&&!document.activeElement.localName.match(/input/)&&
l(V.keyCode-49)}})};CANNON.Demo.prototype=new CANNON.EventTarget;CANNON.Demo.constructor=CANNON.Demo;
CANNON.Demo.prototype.setGlobalSpookParams=function(g,e,d){for(var m=this.world,a=0;a<m.constraints.length;a++)for(var c=m.constraints[a],b=0;b<c.equations.length;b++)c.equations[b].setSpookParams(g,e,d);for(a=0;a<m.contactmaterials.length;a++)d=m.contactmaterials[a],d.contactEquationStiffness=g,d.frictionEquationStiffness=g,d.contactEquationRelaxation=e,d.frictionEquationRelaxation=e;m.defaultContactMaterial.contactEquationStiffness=g;m.defaultContactMaterial.frictionEquationStiffness=g;m.defaultContactMaterial.contactEquationRelaxation=
e;m.defaultContactMaterial.frictionEquationRelaxation=e};
CANNON.Demo.prototype.createTransformControl=function(g,e){controls=new THREE.TransformControls(camera,renderer.domElement);scene.add(g);controls.attach(g,e);scene.add(controls);console.log("CREATE");window.addEventListener("keydown",function(d){switch(d.keyCode){case 81:controls.setSpace("local"===controls.space?"world":"local");break;case 17:controls.setTranslationSnap(100);controls.setRotationSnap(THREE.Math.degToRad(15));break;case 87:controls.setMode("translate");break;case 69:controls.setMode("rotate");
break;case 82:controls.setMode("scale");break;case 187:case 107:controls.setSize(controls.size+.1);break;case 189:case 109:controls.setSize(Math.max(controls.size-.1,.1))}});window.addEventListener("keyup",function(d){switch(d.keyCode){case 17:controls.setTranslationSnap(null),controls.setRotationSnap(null)}})};CANNON.Demo.prototype.getWorld=function(){return this.world};
CANNON.Demo.prototype.addVisual=function(g,e){var d;g instanceof CANNON.Body&&(d=this.shape2mesh(g,e));d&&(this.bodies.push(g),this.visuals.push(d),g.visualref=d,g.visualref.visualId=this.bodies.length-1,this.scene.add(d));return d};CANNON.Demo.prototype.addVisuals=function(g){for(var e=0;e<g.length;e++)this.addVisual(g[e])};
CANNON.Demo.prototype.removeVisual=function(g){if(g.visualref){for(var e=this.bodies,d=this.visuals,m=[],a=[],c=e.length,b=0;b<c;b++)m.unshift(e.pop()),a.unshift(d.pop());c=g.visualref.visualId;for(var k=0;k<m.length;k++)k!==c&&(b=k>c?k-1:k,e[b]=m[k],d[b]=a[k],e[b].visualref=m[k].visualref,e[b].visualref.visualId=b);g.visualref.visualId=null;this.scene.remove(g.visualref);g.visualref=null}};CANNON.Demo.prototype.removeAllVisuals=function(){for(;this.bodies.length;)this.removeVisual(this.bodies[0])};
CANNON.Demo.prototype.shape2mesh=function(g,e){for(var d=new THREE.Object3D,m=0;m<g.shapes.length;m++){var a=g.shapes[m];switch(a.type){case CANNON.Shape.types.SPHERE:var c=new THREE.SphereGeometry(a.radius,8,8);a=void 0===e?new THREE.Mesh(c,this.currentMaterial):new THREE.Mesh(c,e);a.castShadow=!0;break;case CANNON.Shape.types.PARTICLE:a=new THREE.Mesh(this.particleGeo,this.particleMaterial);c=this.settings;a.scale.set(c.particleSize,c.particleSize,c.particleSize);break;case CANNON.Shape.types.PLANE:var b=
new THREE.PlaneGeometry(10,10,4,4);a=new THREE.Object3D;c=new THREE.Object3D;b=void 0===e?new THREE.Mesh(b,this.currentMaterial):new THREE.Mesh(b,e);b.scale.set(100,100,100);c.add(b);b.castShadow=!1;b.receiveShadow=!0;a.add(c);break;case CANNON.Shape.types.BOX:c=new THREE.BoxGeometry(2*a.halfExtents.x,2*a.halfExtents.y,2*a.halfExtents.z);a=void 0===e?new THREE.Mesh(c,this.currentMaterial):new THREE.Mesh(c,e);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:b=new THREE.Geometry;for(c=0;c<a.vertices.length;c++){var k=
a.vertices[c];b.vertices.push(new THREE.Vector3(k.x,k.y,k.z))}for(c=0;c<a.faces.length;c++){var h=a.faces[c],f=h[0];for(k=1;k<h.length-1;k++)b.faces.push(new THREE.Face3(f,h[k],h[k+1]))}b.computeBoundingSphere();b.computeFaceNormals();a=void 0===e?new THREE.Mesh(b,this.currentMaterial):new THREE.Mesh(b,e);break;case CANNON.Shape.types.HEIGHTFIELD:b=new THREE.Geometry;h=new CANNON.Vec3;f=new CANNON.Vec3;var l=new CANNON.Vec3;for(k=0;k<a.data.length-1;k++)for(var p=0;p<a.data[k].length-1;p++)for(var q=
0;2>q;q++)a.getConvexTrianglePillar(k,p,0===q),h.copy(a.pillarConvex.vertices[0]),f.copy(a.pillarConvex.vertices[1]),l.copy(a.pillarConvex.vertices[2]),h.vadd(a.pillarOffset,h),f.vadd(a.pillarOffset,f),l.vadd(a.pillarOffset,l),b.vertices.push(new THREE.Vector3(h.x,h.y,h.z),new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(l.x,l.y,l.z)),c=b.vertices.length-3,b.faces.push(new THREE.Face3(c,c+1,c+2));b.computeBoundingSphere();b.computeFaceNormals();a=void 0===e?new THREE.Mesh(b,this.currentMaterial):
new THREE.Mesh(b,e);break;case CANNON.Shape.types.TRIMESH:b=new THREE.Geometry;h=new CANNON.Vec3;f=new CANNON.Vec3;l=new CANNON.Vec3;for(c=0;c<a.indices.length/3;c++)a.getTriangleVertices(c,h,f,l),b.vertices.push(new THREE.Vector3(h.x,h.y,h.z),new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(l.x,l.y,l.z)),k=b.vertices.length-3,b.faces.push(new THREE.Face3(k,k+1,k+2));b.computeBoundingSphere();b.computeFaceNormals();a=void 0===e?new THREE.Mesh(b,this.currentMaterial):new THREE.Mesh(b,e);break;default:throw"Visual type not recognized: "+
a.type;}a.receiveShadow=!0;a.castShadow=!0;if(a.children)for(c=0;c<a.children.length;c++)if(a.children[c].castShadow=!0,a.children[c].receiveShadow=!0,a.children[c])for(k=0;k<a.children[c].length;k++)a.children[c].children[k].castShadow=!0,a.children[c].children[k].receiveShadow=!0;c=g.shapeOffsets[m];b=g.shapeOrientations[m];a.position.set(c.x,c.y,c.z);a.quaternion.set(b.x,b.y,b.z,b.w);d.add(a)}this.camera=function(){return camera};this.getScene=function(){return scene};return d};
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(g){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var g=document.createElement("div");g.id="webgl-error-message";g.style.fontFamily="monospace";g.style.fontSize="13px";g.style.fontWeight="normal";g.style.textAlign="center";g.style.background=
"#fff";g.style.color="#000";g.style.padding="1.5em";g.style.width="400px";g.style.margin="5em auto 0";this.webgl||(g.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return g},addGetWebGLMessage:function(g){g=g||{};var e=void 0!==g.parent?g.parent:document.body;g=void 0!==g.id?g.id:"oldie";var d=Detector.getWebGLErrorMessage();d.id=g;e.appendChild(d)}};
function TimeSeries(g){g=g||{};g.resetBoundsInterval=g.resetBoundsInterval||3E3;g.resetBounds=void 0===g.resetBounds?!0:g.resetBounds;this.options=g;this.data=[];this.label=g.label||"";this.maxDataLength=g.maxDataLength||1E3;this.dataPool=[];this.minValue=this.maxValue=Number.NaN;g.resetBounds&&(this.boundsTimer=setInterval(function(e){return function(){e.resetBounds()}}(this),g.resetBoundsInterval))}
TimeSeries.prototype.resetBounds=function(){this.minValue=this.maxValue=Number.NaN;for(var g=0;g<this.data.length;g++)this.maxValue=isNaN(this.maxValue)?this.data[g][1]:Math.max(this.maxValue,this.data[g][1]),this.minValue=isNaN(this.minValue)?this.data[g][1]:Math.min(this.minValue,this.data[g][1])};
TimeSeries.prototype.append=function(g,e){this.lastTimeStamp=g;var d=this.dataPool.length?this.dataPool.pop():[g,e];d[0]=g;d[1]=e;this.data.push(d);this.maxValue=isNaN(this.maxValue)?e:Math.max(this.maxValue,e);for(this.minValue=isNaN(this.minValue)?e:Math.min(this.minValue,e);this.data.length>this.maxDataLength;)this.dataPool.push(this.data.shift())};
function SmoothieChart(g){g=g||{};g.grid=g.grid||{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,millisPerLine:1E3,verticalSections:2};g.millisPerPixel=g.millisPerPixel||20;g.fps=g.fps||50;g.maxValueScale=g.maxValueScale||1;g.minValue=g.minValue;g.maxValue=g.maxValue;g.labels=g.labels||{fillStyle:"#ffffff"};g.interpolation=g.interpolation||"bezier";g.scaleSmoothing=g.scaleSmoothing||.125;g.maxDataSetLength=g.maxDataSetLength||2;g.timestampFormatter=g.timestampFormatter||null;this.options=g;
this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}SmoothieChart.prototype.addTimeSeries=function(g,e){this.seriesSet.push({timeSeries:g,options:e||{}})};SmoothieChart.prototype.removeTimeSeries=function(g){this.seriesSet.splice(this.seriesSet.indexOf(g),1)};SmoothieChart.prototype.streamTo=function(g,e){var d=this;this.render_on_tick=function(){d.render(g,d.seriesSet[0].timeSeries.lastTimeStamp)};this.start()};
SmoothieChart.prototype.start=function(){this.timer||(this.timer=setInterval(this.render_on_tick,1E3/this.options.fps))};SmoothieChart.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)};SmoothieChart.timeFormatter=function(g){function e(d){return(10>d?"0":"")+d}return e(g.getHours())+":"+e(g.getMinutes())+":"+e(g.getSeconds())};
SmoothieChart.prototype.render=function(g,e){var d=g.getContext("2d"),m=this.options,a=g.clientWidth,c=g.clientHeight;d.save();e-=e%m.millisPerPixel;d.translate(0,0);d.beginPath();d.rect(0,0,a,c);d.clip();d.save();d.fillStyle=m.grid.fillStyle;d.clearRect(0,0,a,c);d.fillRect(0,0,a,c);d.restore();d.save();d.lineWidth=m.grid.lineWidth||1;d.strokeStyle=m.grid.strokeStyle||"#ffffff";if(0<m.grid.millisPerLine)for(var b=e-e%m.grid.millisPerLine;b>=e-a*m.millisPerPixel;b-=m.grid.millisPerLine){d.beginPath();
var k=Math.round(a-(e-b)/m.millisPerPixel);d.moveTo(k,0);d.lineTo(k,c);d.stroke();if(m.timestampFormatter){var h=m.timestampFormatter(new Date(b)),f=d.measureText(h).width/2+d.measureText(B).width+4;k<a-f&&(d.fillStyle=m.labels.fillStyle,d.fillText(h,k-d.measureText(h).width/2,c-2))}d.closePath()}for(B=1;B<m.grid.verticalSections;B++)b=Math.round(B*c/m.grid.verticalSections),d.beginPath(),d.moveTo(0,b),d.lineTo(a,b),d.stroke(),d.closePath();d.beginPath();d.strokeRect(0,0,a,c);d.closePath();d.restore();
B=k=Number.NaN;for(h=0;h<this.seriesSet.length;h++){var l=this.seriesSet[h].timeSeries;isNaN(l.maxValue)||(k=isNaN(k)?l.maxValue:Math.max(k,l.maxValue));isNaN(l.minValue)||(B=isNaN(B)?l.minValue:Math.min(B,l.minValue))}if(!isNaN(k)||!isNaN(B)){k=null!=m.maxValue?m.maxValue:k*m.maxValueScale;null!=m.minValue&&(B=m.minValue);this.currentValueRange+=m.scaleSmoothing*(k-B-this.currentValueRange);this.currentVisMinValue+=m.scaleSmoothing*(B-this.currentVisMinValue);f=this.currentValueRange;var p=this.currentVisMinValue;
for(h=0;h<this.seriesSet.length;h++){d.save();l=this.seriesSet[h].timeSeries;l=l.data;for(var q=this.seriesSet[h].options;l.length>=m.maxDataSetLength&&l[1][0]<e-a*m.millisPerPixel;)l.splice(0,1);d.lineWidth=q.lineWidth||1;d.fillStyle=q.fillStyle;d.strokeStyle=q.strokeStyle||"#ffffff";d.beginPath();var n=0,t=0,r=0;for(b=0;b<l.length;b++){var u=Math.round(a-(e-l[b][0])/m.millisPerPixel),v=l[b][1]-p;v=Math.max(Math.min(c-(f?Math.round(v/f*c):0),c-1),1);if(0==b)n=u,d.moveTo(u,v);else switch(m.interpolation){case "line":d.lineTo(u,
v);break;default:d.bezierCurveTo(Math.round((t+u)/2),r,Math.round(t+u)/2,v,u,v)}t=u;r=v}0<l.length&&q.fillStyle&&(d.lineTo(a+q.lineWidth+1,r),d.lineTo(a+q.lineWidth+1,c+q.lineWidth+1),d.lineTo(n,c+q.lineWidth),d.fill());d.stroke();d.closePath();d.restore()}if(!m.labels.disabled){m.labelOffsetY||(m.labelOffsetY=0);d.fillStyle=m.labels.fillStyle;b=parseFloat(k).toFixed(2);var B=parseFloat(B).toFixed(2);d.fillText(b,a-d.measureText(b).width-2,10);d.fillText(B,a-d.measureText(B).width-2,c-2);for(b=0;b<
this.seriesSet.length;b++)l=this.seriesSet[b].timeSeries,a=l.label,d.fillStyle=l.options.fillStyle||"rgb(255,255,255)",a&&d.fillText(a,2,10*(b+1)+m.labelOffsetY)}}d.restore()};
var Stats=function(){var g=0,e=0,d=Date.now(),m=d,a=d,c=0,b=1E3,k=0,h=[[16,16,48],[0,255,255]],f=0,l=1E3,p=0,q=[[16,48,16],[0,255,0]];var n=document.createElement("div");n.style.cursor="pointer";n.style.width="80px";n.style.opacity="0.9";n.style.zIndex="10001";n.addEventListener("mousedown",function(T){T.preventDefault();g=(g+1)%2;0==g?(t.style.display="block",B.style.display="none"):(t.style.display="none",B.style.display="block")},!1);var t=document.createElement("div");t.style.textAlign="left";
t.style.lineHeight="1.2em";t.style.backgroundColor="rgb("+Math.floor(h[0][0]/2)+","+Math.floor(h[0][1]/2)+","+Math.floor(h[0][2]/2)+")";t.style.padding="0 0 3px 3px";n.appendChild(t);var r=document.createElement("div");r.style.fontFamily="Helvetica, Arial, sans-serif";r.style.fontSize="9px";r.style.color="rgb("+h[1][0]+","+h[1][1]+","+h[1][2]+")";r.style.fontWeight="bold";r.innerHTML="FPS";t.appendChild(r);var u=document.createElement("div");u.style.position="relative";u.style.width="74px";u.style.height=
"30px";u.style.backgroundColor="rgb("+h[1][0]+","+h[1][1]+","+h[1][2]+")";for(t.appendChild(u);74>u.children.length;){var v=document.createElement("span");v.style.width="1px";v.style.height="30px";v.style.cssFloat="left";v.style.backgroundColor="rgb("+h[0][0]+","+h[0][1]+","+h[0][2]+")";u.appendChild(v)}var B=document.createElement("div");B.style.textAlign="left";B.style.lineHeight="1.2em";B.style.backgroundColor="rgb("+Math.floor(q[0][0]/2)+","+Math.floor(q[0][1]/2)+","+Math.floor(q[0][2]/2)+")";
B.style.padding="0 0 3px 3px";B.style.display="none";n.appendChild(B);var A=document.createElement("div");A.style.fontFamily="Helvetica, Arial, sans-serif";A.style.fontSize="9px";A.style.color="rgb("+q[1][0]+","+q[1][1]+","+q[1][2]+")";A.style.fontWeight="bold";A.innerHTML="MS";B.appendChild(A);var J=document.createElement("div");J.style.position="relative";J.style.width="74px";J.style.height="30px";J.style.backgroundColor="rgb("+q[1][0]+","+q[1][1]+","+q[1][2]+")";for(B.appendChild(J);74>J.children.length;)v=
document.createElement("span"),v.style.width="1px",v.style.height=30*Math.random()+"px",v.style.cssFloat="left",v.style.backgroundColor="rgb("+q[0][0]+","+q[0][1]+","+q[0][2]+")",J.appendChild(v);return{domElement:n,update:function(){d=Date.now();f=d-m;l=Math.min(l,f);p=Math.max(p,f);A.textContent=f+" MS ("+l+"-"+p+")";var T=Math.min(30,30-f/200*30);J.appendChild(J.firstChild).style.height=T+"px";m=d;e++;d>a+1E3&&(c=Math.round(1E3*e/(d-a)),b=Math.min(b,c),k=Math.max(k,c),r.textContent=c+" FPS ("+
b+"-"+k+")",T=Math.min(30,30-c/100*30),u.appendChild(u.firstChild).style.height=T+"px",a=d,e=0)}}};
THREE.TrackballControls=function(g,e){function d(C){!1!==b.enabled&&(window.removeEventListener("keydown",d),l=f,f===k.NONE)&&(C.keyCode!==b.keys[k.ROTATE]||b.noRotate?C.keyCode!==b.keys[k.ZOOM]||b.noZoom?C.keyCode!==b.keys[k.PAN]||b.noPan||(f=k.PAN):f=k.ZOOM:f=k.ROTATE)}function m(C){!1!==b.enabled&&(C.preventDefault(),C.stopPropagation(),f!==k.ROTATE||b.noRotate?f!==k.ZOOM||b.noZoom?f!==k.PAN||b.noPan||A.copy(H(C.pageX,C.pageY)):r.copy(H(C.pageX,C.pageY)):n.copy(U(C.pageX,C.pageY)))}function a(C){!1!==
b.enabled&&(C.preventDefault(),C.stopPropagation(),f=k.NONE,document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",a),b.dispatchEvent(R))}function c(C){if(!1!==b.enabled){C.preventDefault();C.stopPropagation();var K=0;C.wheelDelta?K=C.wheelDelta/40:C.detail&&(K=-C.detail/3);t.y+=.01*K;b.dispatchEvent(T);b.dispatchEvent(R)}}var b=this,k={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=g;this.domElement=void 0!==e?e:document;this.enabled=!0;this.screen=
{left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var h=new THREE.Vector3,f=k.NONE,l=k.NONE,p=new THREE.Vector3,q=new THREE.Vector3,n=new THREE.Vector3,t=new THREE.Vector2,r=new THREE.Vector2,u=0,v=0,B=new THREE.Vector2,A=new THREE.Vector2;this.target0=this.target.clone();
this.position0=this.object.position.clone();this.up0=this.object.up.clone();var J={type:"change"},T={type:"start"},R={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var C=this.domElement.getBoundingClientRect(),K=this.domElement.ownerDocument.documentElement;this.screen.left=C.left+window.pageXOffset-K.clientLeft;this.screen.top=C.top+window.pageYOffset-K.clientTop;
this.screen.width=C.width;this.screen.height=C.height}};this.handleEvent=function(C){if("function"==typeof this[C.type])this[C.type](C)};var H=function(){var C=new THREE.Vector2;return function(K,N){C.set((K-b.screen.left)/b.screen.width,(N-b.screen.top)/b.screen.height);return C}}(),U=function(){var C=new THREE.Vector3,K=new THREE.Vector3,N=new THREE.Vector3;return function(G,X){N.set((G-.5*b.screen.width-b.screen.left)/(.5*b.screen.width),(.5*b.screen.height+b.screen.top-X)/(.5*b.screen.height),
0);var M=N.length();b.noRoll?N.z=M<Math.SQRT1_2?Math.sqrt(1-M*M):.5/M:1<M?N.normalize():N.z=Math.sqrt(1-M*M);p.copy(b.object.position).sub(b.target);C.copy(b.object.up).setLength(N.y);C.add(K.copy(b.object.up).cross(p).setLength(N.x));C.add(p.setLength(N.z));return C}}();this.rotateCamera=function(){var C=new THREE.Vector3,K=new THREE.Quaternion;return function(){var N=Math.acos(q.dot(n)/q.length()/n.length());N&&(C.crossVectors(q,n).normalize(),N*=b.rotateSpeed,K.setFromAxisAngle(C,-N),p.applyQuaternion(K),
b.object.up.applyQuaternion(K),n.applyQuaternion(K),b.staticMoving?q.copy(n):(K.setFromAxisAngle(C,N*(b.dynamicDampingFactor-1)),q.applyQuaternion(K)))}}();this.zoomCamera=function(){if(f===k.TOUCH_ZOOM_PAN){var C=u/v;u=v;p.multiplyScalar(C)}else C=1+(r.y-t.y)*b.zoomSpeed,1!==C&&0<C&&(p.multiplyScalar(C),b.staticMoving?t.copy(r):t.y+=(r.y-t.y)*this.dynamicDampingFactor)};this.panCamera=function(){var C=new THREE.Vector2,K=new THREE.Vector3,N=new THREE.Vector3;return function(){C.copy(A).sub(B);C.lengthSq()&&
(C.multiplyScalar(p.length()*b.panSpeed),N.copy(p).cross(b.object.up).setLength(C.x),N.add(K.copy(b.object.up).setLength(C.y)),b.object.position.add(N),b.target.add(N),b.staticMoving?B.copy(A):B.add(C.subVectors(A,B).multiplyScalar(b.dynamicDampingFactor)))}}();this.checkDistances=function(){b.noZoom&&b.noPan||(p.lengthSq()>b.maxDistance*b.maxDistance&&b.object.position.addVectors(b.target,p.setLength(b.maxDistance)),p.lengthSq()<b.minDistance*b.minDistance&&b.object.position.addVectors(b.target,
p.setLength(b.minDistance)))};this.update=function(){p.subVectors(b.object.position,b.target);b.noRotate||b.rotateCamera();b.noZoom||b.zoomCamera();b.noPan||b.panCamera();b.object.position.addVectors(b.target,p);b.checkDistances();b.object.lookAt(b.target);1E-6<h.distanceToSquared(b.object.position)&&(b.dispatchEvent(J),h.copy(b.object.position))};this.reset=function(){l=f=k.NONE;b.target.copy(b.target0);b.object.position.copy(b.position0);b.object.up.copy(b.up0);p.subVectors(b.object.position,b.target);
b.object.lookAt(b.target);b.dispatchEvent(J);h.copy(b.object.position)};this.domElement.addEventListener("contextmenu",function(C){C.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(C){!1!==b.enabled&&(C.preventDefault(),C.stopPropagation(),f===k.NONE&&(f=C.button),f!==k.ROTATE||b.noRotate?f!==k.ZOOM||b.noZoom?f!==k.PAN||b.noPan||(B.copy(H(C.pageX,C.pageY)),A.copy(B)):(t.copy(H(C.pageX,C.pageY)),r.copy(t)):(q.copy(U(C.pageX,C.pageY)),n.copy(q)),document.addEventListener("mousemove",
m,!1),document.addEventListener("mouseup",a,!1),b.dispatchEvent(T))},!1);this.domElement.addEventListener("mousewheel",c,!1);this.domElement.addEventListener("DOMMouseScroll",c,!1);this.domElement.addEventListener("touchstart",function(C){if(!1!==b.enabled){switch(C.touches.length){case 1:f=k.TOUCH_ROTATE;q.copy(U(C.touches[0].pageX,C.touches[0].pageY));n.copy(q);break;case 2:f=k.TOUCH_ZOOM_PAN;var K=C.touches[0].pageX-C.touches[1].pageX,N=C.touches[0].pageY-C.touches[1].pageY;v=u=Math.sqrt(K*K+N*
N);B.copy(H((C.touches[0].pageX+C.touches[1].pageX)/2,(C.touches[0].pageY+C.touches[1].pageY)/2));A.copy(B);break;default:f=k.NONE}b.dispatchEvent(T)}},!1);this.domElement.addEventListener("touchend",function(C){if(!1!==b.enabled){switch(C.touches.length){case 1:n.copy(U(C.touches[0].pageX,C.touches[0].pageY));q.copy(n);break;case 2:u=v=0,A.copy(H((C.touches[0].pageX+C.touches[1].pageX)/2,(C.touches[0].pageY+C.touches[1].pageY)/2)),B.copy(A)}f=k.NONE;b.dispatchEvent(R)}},!1);this.domElement.addEventListener("touchmove",
function(C){if(!1!==b.enabled)switch(C.preventDefault(),C.stopPropagation(),C.touches.length){case 1:n.copy(U(C.touches[0].pageX,C.touches[0].pageY));break;case 2:var K=C.touches[0].pageX-C.touches[1].pageX,N=C.touches[0].pageY-C.touches[1].pageY;v=Math.sqrt(K*K+N*N);A.copy(H((C.touches[0].pageX+C.touches[1].pageX)/2,(C.touches[0].pageY+C.touches[1].pageY)/2));break;default:f=k.NONE}},!1);window.addEventListener("keydown",d,!1);window.addEventListener("keyup",function(C){!1!==b.enabled&&(f=l,window.addEventListener("keydown",
d,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(g,e){e=e||document;var d=e.createElement("link");d.type="text/css";d.rel="stylesheet";d.href=g;e.getElementsByTagName("head")[0].appendChild(d)},inject:function(g,e){e=e||document;var d=document.createElement("style");d.type="text/css";d.innerHTML=g;e.getElementsByTagName("head")[0].appendChild(d)}}}();
dat.utils.common=function(){var g=Array.prototype.forEach,e=Array.prototype.slice;return{BREAK:{},extend:function(d){this.each(e.call(arguments,1),function(m){for(var a in m)this.isUndefined(m[a])||(d[a]=m[a])},this);return d},defaults:function(d){this.each(e.call(arguments,1),function(m){for(var a in m)this.isUndefined(d[a])&&(d[a]=m[a])},this);return d},compose:function(){var d=e.call(arguments);return function(){for(var m=e.call(arguments),a=d.length-1;0<=a;a--)m=[d[a].apply(this,m)];return m[0]}},
each:function(d,m,a){if(g&&d.forEach===g)d.forEach(m,a);else if(d.length===d.length+0)for(var c=0,b=d.length;c<b&&!(c in d&&m.call(a,d[c],c)===this.BREAK);c++);else for(c in d)if(m.call(a,d[c],c)===this.BREAK)break},defer:function(d){setTimeout(d,0)},toArray:function(d){return d.toArray?d.toArray():e.call(d)},isUndefined:function(d){return void 0===d},isNull:function(d){return null===d},isNaN:function(d){return d!==d},isArray:Array.isArray||function(d){return d.constructor===Array},isObject:function(d){return d===
Object(d)},isNumber:function(d){return d===d+0},isString:function(d){return d===d+""},isBoolean:function(d){return!1===d||!0===d},isFunction:function(d){return"[object Function]"===Object.prototype.toString.call(d)}}}();
dat.controllers.Controller=function(g){var e=function(d,m){this.initialValue=d[m];this.domElement=document.createElement("div");this.object=d;this.property=m;this.__onFinishChange=this.__onChange=void 0};g.extend(e.prototype,{onChange:function(d){this.__onChange=d;return this},onFinishChange:function(d){this.__onFinishChange=d;return this},setValue:function(d){this.object[this.property]=d;this.__onChange&&this.__onChange.call(this,d);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return e}(dat.utils.common);
dat.dom.dom=function(g){function e(c){if("0"===c||g.isUndefined(c))return 0;c=c.match(m);return g.isNull(c)?0:parseFloat(c[1])}var d={};g.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(c,b){g.each(c,function(k){d[k]=b})});var m=/(\d+(\.\d+)?)px/,a={makeSelectable:function(c,b){void 0!==c&&void 0!==c.style&&(c.onselectstart=b?function(){return!1}:function(){},c.style.MozUserSelect=b?"auto":"none",c.style.KhtmlUserSelect=
b?"auto":"none",c.unselectable=b?"on":"off")},makeFullscreen:function(c,b,k){g.isUndefined(b)&&(b=!0);g.isUndefined(k)&&(k=!0);c.style.position="absolute";b&&(c.style.left=0,c.style.right=0);k&&(c.style.top=0,c.style.bottom=0)},fakeEvent:function(c,b,k,h){k=k||{};var f=d[b];if(!f)throw Error("Event type "+b+" not supported.");var l=document.createEvent(f);switch(f){case "MouseEvents":l.initMouseEvent(b,k.bubbles||!1,k.cancelable||!0,window,k.clickCount||1,0,0,k.x||k.clientX||0,k.y||k.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":f=l.initKeyboardEvent||l.initKeyEvent;g.defaults(k,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});f(b,k.bubbles||!1,k.cancelable,window,k.ctrlKey,k.altKey,k.shiftKey,k.metaKey,k.keyCode,k.charCode);break;default:l.initEvent(b,k.bubbles||!1,k.cancelable||!0)}g.defaults(l,h);c.dispatchEvent(l)},bind:function(c,b,k,h){c.addEventListener?c.addEventListener(b,k,h||!1):c.attachEvent&&c.attachEvent("on"+b,k);return a},
unbind:function(c,b,k,h){c.removeEventListener?c.removeEventListener(b,k,h||!1):c.detachEvent&&c.detachEvent("on"+b,k);return a},addClass:function(c,b){if(void 0===c.className)c.className=b;else if(c.className!==b){var k=c.className.split(/ +/);-1==k.indexOf(b)&&(k.push(b),c.className=k.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return a},removeClass:function(c,b){if(b){if(void 0!==c.className)if(c.className===b)c.removeAttribute("class");else{var k=c.className.split(/ +/),h=k.indexOf(b);-1!=
h&&(k.splice(h,1),c.className=k.join(" "))}}else c.className=void 0;return a},hasClass:function(c,b){return(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)")).test(c.className)||!1},getWidth:function(c){c=getComputedStyle(c);return e(c["border-left-width"])+e(c["border-right-width"])+e(c["padding-left"])+e(c["padding-right"])+e(c.width)},getHeight:function(c){c=getComputedStyle(c);return e(c["border-top-width"])+e(c["border-bottom-width"])+e(c["padding-top"])+e(c["padding-bottom"])+e(c.height)},getOffset:function(c){var b=
{left:0,top:0};if(c.offsetParent){do b.left+=c.offsetLeft,b.top+=c.offsetTop;while(c=c.offsetParent)}return b},isActive:function(c){return c===document.activeElement&&(c.type||c.href)}};return a}(dat.utils.common);
dat.controllers.OptionController=function(g,e,d){var m=function(a,c,b){m.superclass.call(this,a,c);var k=this;this.__select=document.createElement("select");if(d.isArray(b)){var h={};d.each(b,function(f){h[f]=f});b=h}d.each(b,function(f,l){var p=document.createElement("option");p.innerHTML=l;p.setAttribute("value",f);k.__select.appendChild(p)});this.updateDisplay();e.bind(this.__select,"change",function(){k.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
m.superclass=g;d.extend(m.prototype,g.prototype,{setValue:function(a){a=m.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return m.superclass.prototype.updateDisplay.call(this)}});return m}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(g,e){var d=function(m,a,c){d.superclass.call(this,m,a);c=c||{};this.__min=c.min;this.__max=c.max;this.__step=c.step;e.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;m=this.__impliedStep;m=m.toString();m=-1<m.indexOf(".")?m.length-m.indexOf(".")-1:0;this.__precision=m};d.superclass=g;e.extend(d.prototype,g.prototype,{setValue:function(m){void 0!==
this.__min&&m<this.__min?m=this.__min:void 0!==this.__max&&m>this.__max&&(m=this.__max);void 0!==this.__step&&0!=m%this.__step&&(m=Math.round(m/this.__step)*this.__step);return d.superclass.prototype.setValue.call(this,m)},min:function(m){this.__min=m;return this},max:function(m){this.__max=m;return this},step:function(m){this.__step=m;return this}});return d}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(g,e,d){var m=function(a,c,b){function k(){var q=parseFloat(l.__input.value);d.isNaN(q)||l.setValue(q)}function h(q){var n=p-q.clientY;l.setValue(l.getValue()+n*l.__impliedStep);p=q.clientY}function f(){e.unbind(window,"mousemove",h);e.unbind(window,"mouseup",f)}this.__truncationSuspended=!1;m.superclass.call(this,a,c,b);var l=this,p;this.__input=document.createElement("input");this.__input.setAttribute("type","text");e.bind(this.__input,"change",k);e.bind(this.__input,
"blur",function(){k();l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())});e.bind(this.__input,"mousedown",function(q){e.bind(window,"mousemove",h);e.bind(window,"mouseup",f);p=q.clientY});e.bind(this.__input,"keydown",function(q){13===q.keyCode&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};m.superclass=g;d.extend(m.prototype,g.prototype,{updateDisplay:function(){var a=this.__input;if(this.__truncationSuspended)var c=
this.getValue();else{c=this.getValue();var b=Math.pow(10,this.__precision);c=Math.round(c*b)/b}a.value=c;return m.superclass.prototype.updateDisplay.call(this)}});return m}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(g,e,d,m,a){function c(k,h,f,l,p){return l+(k-h)/(f-h)*(p-l)}var b=function(k,h,f,l,p){function q(r){r.preventDefault();var u=e.getOffset(t.__background),v=e.getWidth(t.__background);t.setValue(c(r.clientX,u.left,u.left+v,t.__min,t.__max));return!1}function n(){e.unbind(window,"mousemove",q);e.unbind(window,"mouseup",n);t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}b.superclass.call(this,k,h,{min:f,max:l,step:p});var t=this;this.__background=
document.createElement("div");this.__foreground=document.createElement("div");e.bind(this.__background,"mousedown",function(r){e.bind(window,"mousemove",q);e.bind(window,"mouseup",n);q(r)});e.addClass(this.__background,"slider");e.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};b.superclass=g;b.useDefaultStyles=function(){d.inject(a)};m.extend(b.prototype,g.prototype,{updateDisplay:function(){var k=
(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=100*k+"%";return b.superclass.prototype.updateDisplay.call(this)}});return b}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(g,e,d){var m=function(a,c,b){m.superclass.call(this,a,c);var k=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===b?"Fire":b;e.bind(this.__button,"click",function(h){h.preventDefault();k.fire();return!1});e.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};m.superclass=g;d.extend(m.prototype,g.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return m}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(g,e,d){var m=function(a,c){m.superclass.call(this,a,c);var b=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");e.bind(this.__checkbox,"change",function(){b.setValue(!b.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};m.superclass=g;d.extend(m.prototype,g.prototype,{setValue:function(a){a=m.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return m.superclass.prototype.updateDisplay.call(this)}});return m}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(g){return function(e){if(1==e.a||g.isUndefined(e.a)){for(e=e.hex.toString(16);6>e.length;)e="0"+e;return"#"+e}return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}}(dat.utils.common);
dat.color.interpret=function(g,e){var d,m,a=[{litmus:e.isString,conversions:{THREE_CHAR_HEX:{read:function(c){c=c.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===c?!1:{space:"HEX",hex:parseInt("0x"+c[1].toString()+c[1].toString()+c[2].toString()+c[2].toString()+c[3].toString()+c[3].toString())}},write:g},SIX_CHAR_HEX:{read:function(c){c=c.match(/^#([A-F0-9]{6})$/i);return null===c?!1:{space:"HEX",hex:parseInt("0x"+c[1].toString())}},write:g},CSS_RGB:{read:function(c){c=c.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===c?!1:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3])}},write:g},CSS_RGBA:{read:function(c){c=c.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===c?!1:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3]),a:parseFloat(c[4])}},write:g}}},{litmus:e.isNumber,conversions:{HEX:{read:function(c){return{space:"HEX",hex:c,conversionName:"HEX"}},write:function(c){return c.hex}}}},{litmus:e.isArray,conversions:{RGB_ARRAY:{read:function(c){return 3!=
c.length?!1:{space:"RGB",r:c[0],g:c[1],b:c[2]}},write:function(c){return[c.r,c.g,c.b]}},RGBA_ARRAY:{read:function(c){return 4!=c.length?!1:{space:"RGB",r:c[0],g:c[1],b:c[2],a:c[3]}},write:function(c){return[c.r,c.g,c.b,c.a]}}}},{litmus:e.isObject,conversions:{RGBA_OBJ:{read:function(c){return e.isNumber(c.r)&&e.isNumber(c.g)&&e.isNumber(c.b)&&e.isNumber(c.a)?{space:"RGB",r:c.r,g:c.g,b:c.b,a:c.a}:!1},write:function(c){return{r:c.r,g:c.g,b:c.b,a:c.a}}},RGB_OBJ:{read:function(c){return e.isNumber(c.r)&&
e.isNumber(c.g)&&e.isNumber(c.b)?{space:"RGB",r:c.r,g:c.g,b:c.b}:!1},write:function(c){return{r:c.r,g:c.g,b:c.b}}},HSVA_OBJ:{read:function(c){return e.isNumber(c.h)&&e.isNumber(c.s)&&e.isNumber(c.v)&&e.isNumber(c.a)?{space:"HSV",h:c.h,s:c.s,v:c.v,a:c.a}:!1},write:function(c){return{h:c.h,s:c.s,v:c.v,a:c.a}}},HSV_OBJ:{read:function(c){return e.isNumber(c.h)&&e.isNumber(c.s)&&e.isNumber(c.v)?{space:"HSV",h:c.h,s:c.s,v:c.v}:!1},write:function(c){return{h:c.h,s:c.s,v:c.v}}}}}];return function(){m=!1;
var c=1<arguments.length?e.toArray(arguments):arguments[0];e.each(a,function(b){if(b.litmus(c))return e.each(b.conversions,function(k,h){d=k.read(c);if(!1===m&&!1!==d)return m=d,d.conversionName=h,d.conversion=k,e.BREAK}),e.BREAK});return m}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(g,e,d,m,a,c,b,k,h,f,l,p,q,n,t){function r(z,D,y,w){if(void 0===D[y])throw Error("Object "+D+' has no property "'+y+'"');w.color?D=new l(D,y):(D=[D,y].concat(w.factoryArgs),D=m.apply(z,D));w.before instanceof a&&(w.before=w.before.__li);B(z,D);n.addClass(D.domElement,"c");y=document.createElement("span");n.addClass(y,"property-name");y.innerHTML=D.property;var x=document.createElement("div");x.appendChild(y);x.appendChild(D.domElement);w=u(z,x,w.before);n.addClass(w,I.CLASS_CONTROLLER_ROW);
n.addClass(w,typeof D.getValue());v(z,w,D);z.__controllers.push(D);return D}function u(z,D,y){var w=document.createElement("li");D&&w.appendChild(D);y?z.__ul.insertBefore(w,params.before):z.__ul.appendChild(w);z.onResize();return w}function v(z,D,y){y.__li=D;y.__gui=z;t.extend(y,{options:function(F){if(1<arguments.length)return y.remove(),r(z,y.object,y.property,{before:y.__li.nextElementSibling,factoryArgs:[t.toArray(arguments)]});if(t.isArray(F)||t.isObject(F))return y.remove(),r(z,y.object,y.property,
{before:y.__li.nextElementSibling,factoryArgs:[F]})},name:function(F){y.__li.firstElementChild.firstElementChild.innerHTML=F;return y},listen:function(){y.__gui.listen(y);return y},remove:function(){y.__gui.remove(y);return y}});if(y instanceof h){var w=new k(y.object,y.property,{min:y.__min,max:y.__max,step:y.__step});t.each(["updateDisplay","onChange","onFinishChange"],function(F){var Q=y[F],P=w[F];y[F]=w[F]=function(){var L=Array.prototype.slice.call(arguments);Q.apply(y,L);return P.apply(w,L)}});
n.addClass(D,"has-slider");y.domElement.insertBefore(w.domElement,y.domElement.firstElementChild)}else if(y instanceof k){var x=function(F){return t.isNumber(y.__min)&&t.isNumber(y.__max)?(y.remove(),r(z,y.object,y.property,{before:y.__li.nextElementSibling,factoryArgs:[y.__min,y.__max,y.__step]})):F};y.min=t.compose(x,y.min);y.max=t.compose(x,y.max)}else y instanceof c?(n.bind(D,"click",function(){n.fakeEvent(y.__checkbox,"click")}),n.bind(y.__checkbox,"click",function(F){F.stopPropagation()})):
y instanceof b?(n.bind(D,"click",function(){n.fakeEvent(y.__button,"click")}),n.bind(D,"mouseover",function(){n.addClass(y.__button,"hover")}),n.bind(D,"mouseout",function(){n.removeClass(y.__button,"hover")})):y instanceof l&&(n.addClass(D,"color"),y.updateDisplay=t.compose(function(F){D.style.borderLeftColor=y.__color.toString();return F},y.updateDisplay),y.updateDisplay());y.setValue=t.compose(function(F){z.getRoot().__preset_select&&y.isModified()&&U(z.getRoot(),!0);return F},y.setValue)}function B(z,
D){var y=z.getRoot(),w=y.__rememberedObjects.indexOf(D.object);if(-1!=w){var x=y.__rememberedObjectIndecesToControllers[w];void 0===x&&(x={},y.__rememberedObjectIndecesToControllers[w]=x);x[D.property]=D;if(y.load&&y.load.remembered){y=y.load.remembered;if(y[z.preset])y=y[z.preset];else if(y.Default)y=y.Default;else return;y[w]&&void 0!==y[w][D.property]&&(w=y[w][D.property],D.initialValue=w,D.setValue(w))}}}function A(z){var D=z.__save_row=document.createElement("li");n.addClass(z.domElement,"has-save");
z.__ul.insertBefore(D,z.__ul.firstChild);n.addClass(D,"save-row");var y=document.createElement("span");y.innerHTML="&nbsp;";n.addClass(y,"button gears");var w=document.createElement("span");w.innerHTML="Save";n.addClass(w,"button");n.addClass(w,"save");var x=document.createElement("span");x.innerHTML="New";n.addClass(x,"button");n.addClass(x,"save-as");var F=document.createElement("span");F.innerHTML="Revert";n.addClass(F,"button");n.addClass(F,"revert");var Q=z.__preset_select=document.createElement("select");
z.load&&z.load.remembered?t.each(z.load.remembered,function(ca,O){H(z,O,O==z.preset)}):H(z,"Default",!1);n.bind(Q,"change",function(){for(var ca=0;ca<z.__preset_select.length;ca++)z.__preset_select[ca].innerHTML=z.__preset_select[ca].value;z.preset=this.value});D.appendChild(Q);D.appendChild(y);D.appendChild(w);D.appendChild(x);D.appendChild(F);if(K){var P=function(){L.style.display=z.useLocalStorage?"block":"none"};D=document.getElementById("dg-save-locally");var L=document.getElementById("dg-local-explain");
D.style.display="block";D=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&D.setAttribute("checked","checked");P();n.bind(D,"change",function(){z.useLocalStorage=!z.useLocalStorage;P()})}var W=document.getElementById("dg-new-constructor");n.bind(W,"keydown",function(ca){!ca.metaKey||67!==ca.which&&67!=ca.keyCode||N.hide()});n.bind(y,"click",function(){W.innerHTML=JSON.stringify(z.getSaveObject(),void 0,2);N.show();W.focus();W.select()});
n.bind(w,"click",function(){z.save()});n.bind(x,"click",function(){var ca=prompt("Enter a new preset name.");ca&&z.saveAs(ca)});n.bind(F,"click",function(){z.revert()})}function J(z){function D(F){F.preventDefault();x=F.clientX;n.addClass(z.__closeButton,I.CLASS_DRAG);n.bind(window,"mousemove",y);n.bind(window,"mouseup",w);return!1}function y(F){F.preventDefault();z.width+=x-F.clientX;z.onResize();x=F.clientX;return!1}function w(){n.removeClass(z.__closeButton,I.CLASS_DRAG);n.unbind(window,"mousemove",
y);n.unbind(window,"mouseup",w)}z.__resize_handle=document.createElement("div");t.extend(z.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var x;n.bind(z.__resize_handle,"mousedown",D);n.bind(z.__closeButton,"mousedown",D);z.domElement.insertBefore(z.__resize_handle,z.domElement.firstElementChild)}function T(z,D){z.domElement.style.width=D+"px";z.__save_row&&z.autoPlace&&(z.__save_row.style.width=D+"px");z.__closeButton&&(z.__closeButton.style.width=
D+"px")}function R(z,D){var y={};t.each(z.__rememberedObjects,function(w,x){var F={};t.each(z.__rememberedObjectIndecesToControllers[x],function(Q,P){F[P]=D?Q.initialValue:Q.getValue()});y[x]=F});return y}function H(z,D,y){var w=document.createElement("option");w.innerHTML=D;w.value=D;z.__preset_select.appendChild(w);y&&(z.__preset_select.selectedIndex=z.__preset_select.length-1)}function U(z,D){var y=z.__preset_select[z.__preset_select.selectedIndex];y.innerHTML=D?y.value+"*":y.value}function C(z){0!=
z.length&&p(function(){C(z)});t.each(z,function(D){D.updateDisplay()})}g.inject(d);try{var K="localStorage"in window&&null!==window.localStorage}catch(z){K=!1}var N,G=!0,X,M=!1,E=[],I=function(z){function D(){localStorage.setItem(document.location.href+".gui",JSON.stringify(w.getSaveObject()))}function y(){var P=w.getRoot();P.width+=1;t.defer(function(){--P.width})}var w=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);
n.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];z=z||{};z=t.defaults(z,{autoPlace:!0,width:I.DEFAULT_WIDTH});z=t.defaults(z,{resizable:z.autoPlace,hideable:z.autoPlace});t.isUndefined(z.load)?z.load={preset:"Default"}:z.preset&&(z.load.preset=z.preset);t.isUndefined(z.parent)&&z.hideable&&E.push(this);z.resizable=t.isUndefined(z.parent)&&z.resizable;z.autoPlace&&t.isUndefined(z.scrollable)&&
(z.scrollable=!0);var x=K&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return z.parent}},scrollable:{get:function(){return z.scrollable}},autoPlace:{get:function(){return z.autoPlace}},preset:{get:function(){return w.parent?w.getRoot().preset:z.load.preset},set:function(P){w.parent?w.getRoot().preset=P:z.load.preset=P;for(P=0;P<this.__preset_select.length;P++)this.__preset_select[P].value==this.preset&&(this.__preset_select.selectedIndex=
P);w.revert()}},width:{get:function(){return z.width},set:function(P){z.width=P;T(w,P)}},name:{get:function(){return z.name},set:function(P){z.name=P;Q&&(Q.innerHTML=z.name)}},closed:{get:function(){return z.closed},set:function(P){z.closed=P;z.closed?n.addClass(w.__ul,I.CLASS_CLOSED):n.removeClass(w.__ul,I.CLASS_CLOSED);this.onResize();w.__closeButton&&(w.__closeButton.innerHTML=P?I.TEXT_OPEN:I.TEXT_CLOSED)}},load:{get:function(){return z.load}},useLocalStorage:{get:function(){return x},set:function(P){K&&
((x=P)?n.bind(window,"unload",D):n.unbind(window,"unload",D),localStorage.setItem(document.location.href+".isLocal",P))}}});if(t.isUndefined(z.parent)){z.closed=!1;n.addClass(this.domElement,I.CLASS_MAIN);n.makeSelectable(this.domElement,!1);if(K&&x){w.useLocalStorage=!0;var F=localStorage.getItem(document.location.href+".gui");F&&(z.load=JSON.parse(F))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=I.TEXT_CLOSED;n.addClass(this.__closeButton,I.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
n.bind(this.__closeButton,"click",function(){w.closed=!w.closed})}else{void 0===z.closed&&(z.closed=!0);var Q=document.createTextNode(z.name);n.addClass(Q,"controller-name");F=u(w,Q);n.addClass(this.__ul,I.CLASS_CLOSED);n.addClass(F,"title");n.bind(F,"click",function(P){P.preventDefault();w.closed=!w.closed;return!1});z.closed||(this.closed=!1)}z.autoPlace&&(t.isUndefined(z.parent)&&(G&&(X=document.createElement("div"),n.addClass(X,"dg"),n.addClass(X,I.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(X),
G=!1),X.appendChild(this.domElement),n.addClass(this.domElement,I.CLASS_AUTO_PLACE)),this.parent||T(w,z.width));n.bind(window,"resize",function(){w.onResize()});n.bind(this.__ul,"webkitTransitionEnd",function(){w.onResize()});n.bind(this.__ul,"transitionend",function(){w.onResize()});n.bind(this.__ul,"oTransitionEnd",function(){w.onResize()});this.onResize();z.resizable&&J(this);w.getRoot();z.parent||y()};I.toggleHide=function(){M=!M;t.each(E,function(z){z.domElement.style.zIndex=M?-999:999;z.domElement.style.opacity=
M?0:1})};I.CLASS_AUTO_PLACE="a";I.CLASS_AUTO_PLACE_CONTAINER="ac";I.CLASS_MAIN="main";I.CLASS_CONTROLLER_ROW="cr";I.CLASS_TOO_TALL="taller-than-window";I.CLASS_CLOSED="closed";I.CLASS_CLOSE_BUTTON="close-button";I.CLASS_DRAG="drag";I.DEFAULT_WIDTH=245;I.TEXT_CLOSED="Close Controls";I.TEXT_OPEN="Open Controls";n.bind(window,"keydown",function(z){"text"===document.activeElement.type||72!==z.which&&72!=z.keyCode||I.toggleHide()},!1);t.extend(I.prototype,{add:function(z,D){return r(this,z,D,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(z,D){return r(this,z,D,{color:!0})},remove:function(z){this.__ul.removeChild(z.__li);this.__controllers.slice(this.__controllers.indexOf(z),1);var D=this;t.defer(function(){D.onResize()})},destroy:function(){this.autoPlace&&X.removeChild(this.domElement)},addFolder:function(z){if(void 0!==this.__folders[z])throw Error('You already have a folder in this GUI by the name "'+z+'"');var D={name:z,parent:this};D.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[z]&&
(D.closed=this.load.folders[z].closed,D.load=this.load.folders[z]);D=new I(D);this.__folders[z]=D;z=u(this,D.domElement);n.addClass(z,"folder");return D},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var z=this.getRoot();if(z.scrollable){var D=n.getOffset(z.__ul).top,y=0;t.each(z.__ul.childNodes,function(w){z.autoPlace&&w===z.__save_row||(y+=n.getHeight(w))});window.innerHeight-D-20<y?(n.addClass(z.domElement,I.CLASS_TOO_TALL),z.__ul.style.height=window.innerHeight-
D-20+"px"):(n.removeClass(z.domElement,I.CLASS_TOO_TALL),z.__ul.style.height="auto")}z.__resize_handle&&t.defer(function(){z.__resize_handle.style.height=z.__ul.offsetHeight+"px"});z.__closeButton&&(z.__closeButton.style.width=z.width+"px")},remember:function(){t.isUndefined(N)&&(N=new q,N.domElement.innerHTML=e);if(this.parent)throw Error("You can only call remember on a top level GUI.");var z=this;t.each(Array.prototype.slice.call(arguments),function(D){0==z.__rememberedObjects.length&&A(z);-1==
z.__rememberedObjects.indexOf(D)&&z.__rememberedObjects.push(D)});this.autoPlace&&T(this,this.width)},getRoot:function(){for(var z=this;z.parent;)z=z.parent;return z},getSaveObject:function(){var z=this.load;z.closed=this.closed;0<this.__rememberedObjects.length&&(z.preset=this.preset,z.remembered||(z.remembered={}),z.remembered[this.preset]=R(this));z.folders={};t.each(this.__folders,function(D,y){z.folders[y]=D.getSaveObject()});return z},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=R(this);U(this,!1)},saveAs:function(z){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=R(this,!0));this.load.remembered[z]=R(this);this.preset=z;H(this,z,!0)},revert:function(z){t.each(this.__controllers,function(D){this.getRoot().load.remembered?B(z||this.getRoot(),D):D.setValue(D.initialValue)},this);t.each(this.__folders,function(D){D.revert(D)});z||U(this.getRoot(),!1)},listen:function(z){var D=0==this.__listening.length;this.__listening.push(z);
D&&C(this.__listening)}});return I}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(g,e,d,m,a,c,b){return function(k,h,f,l){var p=k[h];if(b.isArray(f)||b.isObject(f))return new g(k,h,f);if(b.isNumber(p))return b.isNumber(f)&&b.isNumber(l)?new d(k,h,f,l):new e(k,h,{min:f,max:l});if(b.isString(p))return new m(k,h);if(b.isFunction(p))return new a(k,h,"");if(b.isBoolean(p))return new c(k,h)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(g,e,d){var m=
function(a,c){function b(){k.setValue(k.__input.value)}m.superclass.call(this,a,c);var k=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");e.bind(this.__input,"keyup",b);e.bind(this.__input,"change",b);e.bind(this.__input,"blur",function(){k.__onFinishChange&&k.__onFinishChange.call(k,k.getValue())});e.bind(this.__input,"keydown",function(h){13===h.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};m.superclass=g;d.extend(m.prototype,
g.prototype,{updateDisplay:function(){e.isActive(this.__input)||(this.__input.value=this.getValue());return m.superclass.prototype.updateDisplay.call(this)}});return m}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(g,e,d,m,a){function c(f,l,p,q){f.style.background="";a.each(h,function(n){f.style.cssText+="background: "+n+"linear-gradient("+l+", "+p+" 0%, "+q+" 100%); "})}function b(f){f.style.background="";f.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";f.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
f.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";f.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";f.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var k=function(f,l){function p(A){r(A);e.bind(window,"mousemove",r);e.bind(window,
"mouseup",q)}function q(){e.unbind(window,"mousemove",r);e.unbind(window,"mouseup",q)}function n(){var A=m(this.value);!1!==A?(v.__color.__state=A,v.setValue(v.__color.toOriginal())):this.value=v.__color.toString()}function t(){e.unbind(window,"mousemove",u);e.unbind(window,"mouseup",t)}function r(A){A.preventDefault();var J=e.getWidth(v.__saturation_field),T=e.getOffset(v.__saturation_field),R=(A.clientX-T.left+document.body.scrollLeft)/J;A=1-(A.clientY-T.top+document.body.scrollTop)/J;1<A?A=1:0>
A&&(A=0);1<R?R=1:0>R&&(R=0);v.__color.v=A;v.__color.s=R;v.setValue(v.__color.toOriginal());return!1}function u(A){A.preventDefault();var J=e.getHeight(v.__hue_field),T=e.getOffset(v.__hue_field);A=1-(A.clientY-T.top+document.body.scrollTop)/J;1<A?A=1:0>A&&(A=0);v.__color.h=360*A;v.setValue(v.__color.toOriginal());return!1}k.superclass.call(this,f,l);this.__color=new d(this.getValue());this.__temp=new d(0);var v=this;this.domElement=document.createElement("div");e.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";e.bind(this.__input,"keydown",function(A){13===A.keyCode&&n.call(this)});e.bind(this.__input,"blur",n);e.bind(this.__selector,"mousedown",function(A){e.addClass(this,"drag").bind(window,"mouseup",function(J){e.removeClass(v.__selector,"drag")})});var B=document.createElement("div");a.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});a.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});a.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});a.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});a.extend(B.style,{width:"100%",height:"100%",
background:"none"});c(B,"top","rgba(0,0,0,0)","#000");a.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});b(this.__hue_field);a.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});e.bind(this.__saturation_field,"mousedown",p);e.bind(this.__field_knob,"mousedown",p);e.bind(this.__hue_field,"mousedown",function(A){u(A);e.bind(window,
"mousemove",u);e.bind(window,"mouseup",t)});this.__saturation_field.appendChild(B);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};k.superclass=g;a.extend(k.prototype,g.prototype,{updateDisplay:function(){var f=m(this.getValue());if(!1!==f){var l=!1;
a.each(d.COMPONENTS,function(n){if(!a.isUndefined(f[n])&&!a.isUndefined(this.__color.__state[n])&&f[n]!==this.__color.__state[n])return l=!0,{}},this);l&&a.extend(this.__color.__state,f)}a.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var p=.5>this.__color.v||.5<this.__color.s?255:0,q=255-p;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+p+
","+p+","+p+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;c(this.__saturation_field,"left","#fff",this.__temp.toString());a.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+p+","+p+","+p+")",textShadow:this.__input_textShadow+"rgba("+q+","+q+","+q+",.7)"})}});var h=["-moz-","-o-","-webkit-","-ms-",""];return k}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(g,e,d,m){function a(f,
l,p){Object.defineProperty(f,l,{get:function(){if("RGB"===this.__state.space)return this.__state[l];b(this,l,p);return this.__state[l]},set:function(q){"RGB"!==this.__state.space&&(b(this,l,p),this.__state.space="RGB");this.__state[l]=q}})}function c(f,l){Object.defineProperty(f,l,{get:function(){if("HSV"===this.__state.space)return this.__state[l];k(this);return this.__state[l]},set:function(p){"HSV"!==this.__state.space&&(k(this),this.__state.space="HSV");this.__state[l]=p}})}function b(f,l,p){if("HEX"===
f.__state.space)f.__state[l]=e.component_from_hex(f.__state.hex,p);else if("HSV"===f.__state.space)m.extend(f.__state,e.hsv_to_rgb(f.__state.h,f.__state.s,f.__state.v));else throw"Corrupted color state";}function k(f){var l=e.rgb_to_hsv(f.r,f.g,f.b);m.extend(f.__state,{s:l.s,v:l.v});m.isNaN(l.h)?m.isUndefined(f.__state.h)&&(f.__state.h=0):f.__state.h=l.h}var h=function(){this.__state=g.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};h.COMPONENTS="r g b h s v hex a".split(" ");m.extend(h.prototype,{toString:function(){return d(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(h.prototype,"r",2);a(h.prototype,"g",1);a(h.prototype,"b",0);c(h.prototype,"h");c(h.prototype,"s");c(h.prototype,"v");Object.defineProperty(h.prototype,"a",{get:function(){return this.__state.a},set:function(f){this.__state.a=f}});Object.defineProperty(h.prototype,"hex",{get:function(){this.__state.hex=e.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(f){this.__state.space="HEX";this.__state.hex=f}});return h}(dat.color.interpret,dat.color.math=function(){var g;return{hsv_to_rgb:function(e,d,m){var a=e/60-Math.floor(e/60),c=m*(1-d),b=m*(1-a*d);d=m*(1-(1-a)*d);e=[[m,d,c],[b,m,c],[c,m,d],[c,b,m],[d,c,m],[m,c,b]][Math.floor(e/60)%6];return{r:255*e[0],g:255*e[1],b:255*e[2]}},rgb_to_hsv:function(e,d,m){var a=Math.max(e,d,m),c=a-Math.min(e,d,m);if(0==a)return{h:NaN,s:0,v:0};e=(e==a?(d-m)/c:d==a?2+(m-e)/c:
4+(e-d)/c)/6;0>e&&(e+=1);return{h:360*e,s:c/a,v:a/255}},rgb_to_hex:function(e,d,m){e=this.hex_with_component(0,2,e);e=this.hex_with_component(e,1,d);return e=this.hex_with_component(e,0,m)},component_from_hex:function(e,d){return e>>8*d&255},hex_with_component:function(e,d,m){return m<<(g=8*d)|e&~(255<<g)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(g,e){window.setTimeout(g,1E3/60)}}(),dat.dom.CenteredDiv=function(g,e){var d=function(){this.backgroundElement=document.createElement("div");e.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});g.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");
e.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var m=this;g.bind(this.backgroundElement,"click",function(){m.hide()})};d.prototype.show=function(){var m=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform=
"scale(1.1)";this.layout();e.defer(function(){m.backgroundElement.style.opacity=1;m.domElement.style.opacity=1;m.domElement.style.webkitTransform="scale(1)"})};d.prototype.hide=function(){var m=this,a=function(){m.domElement.style.display="none";m.backgroundElement.style.display="none";g.unbind(m.domElement,"webkitTransitionEnd",a);g.unbind(m.domElement,"transitionend",a);g.unbind(m.domElement,"oTransitionEnd",a)};g.bind(this.domElement,"webkitTransitionEnd",a);g.bind(this.domElement,"transitionend",
a);g.bind(this.domElement,"oTransitionEnd",a);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};d.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-g.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-g.getHeight(this.domElement)/2+"px"};return d}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
function CVector2(g,e){var d,m;this._init=function(a,c){d=a;m=c};this.add=function(a,c){d+=a;m+=c};this.addV=function(a){d+=a.getX();m+=a.getY()};this.scalarDivision=function(a){d/=a;m/=a};this.subtract=function(a){d-=a.getX();m-=a.getY()};this.scalarProduct=function(a){d*=a;m*=a};this.invert=function(){d*=-1;m*=-1};this.dotProduct=function(a){return d*a.getX()+m*a.getY()};this.set=function(a,c){d=a;m=c};this.setV=function(a){d=a.getX();m=a.getY()};this.length=function(){return Math.sqrt(d*d+m*m)};
this.length2=function(){return d*d+m*m};this.normalize=function(){var a=this.length();0<a&&(d/=a,m/=a)};this.angleBetweenVectors=function(a){a=Math.acos(this.dotProduct(a)/(this.length()*a.length()));return!0===isNaN(a)?0:a};this.getNormalize=function(a){this.length();a.set(d,m);a.normalize()};this.rot90CCW=function(){var a=d;d=-m;m=a};this.rot90CW=function(){var a=d;d=m;m=-a};this.getRotCCW=function(a){a.set(d,m);a.rot90CCW()};this.getRotCW=function(a){a.set(d,m);a.rot90CW()};this.ceil=function(){d=
Math.ceil(d);m=Math.ceil(m)};this.round=function(){d=Math.round(d);m=Math.round(m)};this.toString=function(){return"Vector2: "+d+", "+m};this.print=function(){trace("Vector2: "+d+", "+m)};this.getX=function(){return d};this.getY=function(){return m};this.rotate=function(a){var c=d,b=m;d=c*Math.cos(a)-b*Math.sin(a);m=c*Math.sin(a)+b*Math.cos(a)};this._init(g,e)}
function CAreYouSurePanel(g){var e,d,m,a,c,b,k,h,f=this;this._init=function(){e=[];d=[];k=new createjs.Container;k.visible=!1;l.addChild(k);h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.alpha=.5;h.on("click",function(){});k.addChild(h);var p=s_oSpriteLibrary.getSprite("msg_box_small");m=createBitmap(p);m.x=CANVAS_WIDTH_HALF;m.y=CANVAS_HEIGHT_HALF;m.regX=.5*p.width;m.regY=.5*p.height;k.addChild(m);p=p.width-100;a=new CTLText(k,CANVAS_WIDTH/2-p/2,CANVAS_HEIGHT/
2-80-60,p,160,60,"center","#fff",PRIMARY_FONT,1,2,2,TEXT_ARE_SURE,!0,!0,!0,!1);c=new CGfxButton(CANVAS_WIDTH/2+180,.5*CANVAS_HEIGHT+100,s_oSpriteLibrary.getSprite("but_yes"),k);c.addEventListener(ON_MOUSE_UP,this._onButYes,this);b=new CGfxButton(CANVAS_WIDTH/2-180,.5*CANVAS_HEIGHT+100,s_oSpriteLibrary.getSprite("but_no"),k);b.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this.addEventListener=function(p,q,n){e[p]=q;d[p]=n};this.show=function(p){a.text=p;k.alpha=0;k.visible=!0;createjs.Tween.get(k).to({alpha:1},
300,createjs.Ease.quartOut).call(function(){s_oMain.stopUpdateNoBlock()})};this.hide=function(){s_oMain.startUpdateNoBlock();createjs.Tween.get(k).to({alpha:0},500,createjs.Ease.quartOut).call(function(){k.visible=!1})};this.unload=function(){b.unload();c.unload()};this._onButYes=function(){f.hide();e[ON_BUT_YES_DOWN]&&e[ON_BUT_YES_DOWN].call(d[ON_BUT_YES_DOWN])};this._onButNo=function(){f.hide()};var l=g;this._init()}
function CInterface(g,e,d){var m,a,c,b,k,h,f,l,p,q,n,t,r,u,v,B,A,J,T,R,H,U,C,K,N,G=null,X=null;this._init=function(M){k=CANVAS_WIDTH-20;h=CANVAS_HEIGHT-20;t=new createjs.Text(TEXT_SCORE+" "+e,"42px "+PRIMARY_FONT,"#fff");t.x=k;t.y=h;t.textAlign="right";t.textBaseline="alphabetic";t.shadow=new createjs.Shadow("#000000",2,2,4);d.addChild(t);N=new createjs.Container;N.x=CANVAS_WIDTH+100;N.y=t.y-50;d.addChild(N);u=new createjs.Text("x2","42px "+PRIMARY_FONT,"#000");u.textAlign="right";u.outline=2;u.textBaseline=
"alphabetic";N.addChild(u);r=new createjs.Text("x2","42px "+PRIMARY_FONT,"#fff");r.textAlign="right";r.textBaseline="alphabetic";N.addChild(r);var E=s_oSpriteLibrary.getSprite("but_exit");m=CANVAS_WIDTH-E.height/2-10;a=E.height/2+10;v=new CGfxButton(m,a,E,d);v.addEventListener(ON_MOUSE_UP,this._onExit,this);!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(E=s_oSpriteLibrary.getSprite("audio_icon"),p=m-E.width/2-10,q=a,A=new CToggle(p,q,E,s_bAudioActive,d),A.addEventListener(ON_MOUSE_UP,this._onAudioToggle,
this),E=s_oSpriteLibrary.getSprite("but_fullscreen"),f=p-E.width/2-10,l=q):(E=s_oSpriteLibrary.getSprite("but_fullscreen"),f=m-E.width/2-10,l=a);var I=window.document,z=I.documentElement;G=z.requestFullscreen||z.mozRequestFullScreen||z.webkitRequestFullScreen||z.msRequestFullscreen;X=I.exitFullscreen||I.mozCancelFullScreen||I.webkitExitFullscreen||I.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(G=!1);G&&screenfull.isEnabled&&(B=new CToggle(f,l,E,s_bFullscreen,d),B.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,
this));J=new CScoreBoard(M,{x:10,y:4},d);n=[];E=0;I=s_oSpriteLibrary.getSprite("ball_kick");c=I.width/3/2+10;b=CANVAS_HEIGHT-I.height/2-10;R=new createjs.Container;R.x=c;R.y=b;d.addChild(R);z=new createjs.SpriteSheet({images:[I],frames:{width:I.width/3,height:I.height,regX:I.width/3/2,regY:I.height/2},animations:{empty:0,state_0:1,state_1:2}});for(var D=0;5>D;D++){var y=new CKickIcon(E,0,z,R);n.push(y);E+=I.width/3+5}T=new CResultPanel(M,d);H=new CHelpText(d);C=new CVersusPanel(d);U=new CFinalPanel(M,
d);K=new CAreYouSurePanel(s_oStage);K.addEventListener(ON_BUT_YES_DOWN,s_oGame.onExit,s_oGame);this.refreshButtonPos()};this.refreshButtonPos=function(){v.setPosition(m-s_iOffsetX,a+s_iOffsetY);t.x=k-s_iOffsetX;t.y=h-s_iOffsetY;N.y=t.y-50;!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||A.setPosition(p-s_iOffsetX,s_iOffsetY+q);G&&screenfull.isEnabled&&B.setPosition(f-s_iOffsetX,l+s_iOffsetY);R.x=c+s_iOffsetX;R.y=b-s_iOffsetY;J.refreshButtonPos()};this.unload=function(){if(!1===DISABLE_SOUND_MOBILE||!1===
s_bMobile)A.unload(),A=null;G&&screenfull.isEnabled&&(B.unload(),B=null);v.unload();v=null;U.unload();K.unload();s_oInterface=null};this.reset=function(M,E){T.reset(M);J.reset(M);for(var I=0;I<n.length;I++)n[I].changeState("empty");this.showVsPanel(M,E)};this.showMultiplierAnim=function(M){r.text=u.text="X"+M;createjs.Tween.get(N).to({x:t.x},250,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(N).wait(1E3).to({x:CANVAS_WIDTH+100},250,createjs.Ease.cubicIn).call(function(){})})};this.showVsPanel=
function(M,E){C.show(M,E)};this.resetFullscreenBut=function(){G&&screenfull.isEnabled&&B.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?X.call(window.document):G.call(window.document.documentElement);sizeHandler()};this.refreshScoreBoard=function(M,E,I){J.setScore(E,I);T.show(M,E,I)};this.refreshKicks=function(M){for(var E=0;E<n.length;E++)E<M.length?n[E].changeState("state_"+M[E]):n[E].changeState("empty")};this.refreshScore=function(M){t.text=TEXT_SCORE+" "+M};this.showHelpText=
function(M){H.show(M)};this.hideHelpText=function(){H.hide()};this.showFinalPanel=function(M,E,I,z,D,y){U.show(M,E,I,z,D,y)};this.isHelpTextVisible=function(){return H.visible};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){K.show(TEXT_ARE_SURE)};s_oInterface=this;this._init(g)}var s_oInterface=null;
function CGame(g,e){var d,m,a,c,b,k,h,f,l,p,q,n,t=null,r,u;this._init=function(v){$(s_oMain).trigger("start_session");$(s_oMain).trigger("start_level",v);b=v;this.reset();q=[];if(s_bMobile)for(var B=0;B<BALL_FORCE_Y.length;B++)BALL_FORCE_Y[B]*=BALL_VELOCITY_MULTIPLIER,BALL_FORCE_Z[B].min/=BALL_VELOCITY_MULTIPLIER+.1,BALL_FORCE_Z[B].max*=BALL_VELOCITY_MULTIPLIER+.1,BALL_FORCE_X[B]*=BALL_VELOCITY_MULTIPLIER;u=new createjs.Container;s_oStage.addChild(u);B=new createjs.Shape;B.graphics.beginFill("black").drawRect(0,
0,CANVAS_WIDTH,CANVAS_HEIGHT);u.addChild(B);r=new createjs.Container;u.addChild(r);n=new CInterface(b,h,u);t=new CGameStriker(r,b);n.showVsPanel(s_aMatches[v-1],b)};this.reset=function(){h=s_oMain.getScoreTillLevel(b);d=!1;s_iCurState=STRIKER_MODE;a=k=m=0;f=c=1;l=[];p=[];refreshSettings(s_iCurState);setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME);playSound("crowd",1,!0)};this.unload=function(){t.unload();n.unload();s_oStage.removeChild(u)};this.changeScenario=function(){c++;if(s_iCurState===GOALKEEPER_MODE&&
c>NUM_KICKS&&a!==m){q.push({player:m,cpu:a});var v=!1;m<a&&(v=!0);var B=!1;b===NUM_MATCHES?B=!0:v||s_oMain.saveLevel(b+1);setVolume("soundtrack",1);stopSound("crowd");$(s_oMain).trigger("end_level",b);n.showFinalPanel(m+"-"+a,h,k,v,B,b);s_oMain.saveMatch(b,s_aMatches[b-1],m+"-"+a,k,h)}else t.unload(),t=null,s_iCurState===STRIKER_MODE?(s_iCurState=GOALKEEPER_MODE,refreshSettings(s_iCurState),c>NUM_KICKS&&(d=!0,BALL_FORCE_Y[b]<HIT_BALL_MAX_FORCE&&(BALL_FORCE_Y[b]+=2)),n.refreshKicks(p),t=new CGameGoalkeeper(b,
BALL_FORCE_Y[b-1],r)):(s_iCurState=STRIKER_MODE,refreshSettings(s_iCurState),c>NUM_KICKS&&(d=!0),n.refreshKicks(l),t=new CGameStriker(r,b))};this.endShotPlayer=function(v,B){v?(l.push(1),m++,d||(this.increaseScore(GOAL_SCORED*f),this._increaseMultiplier())):(f=1,d||this.increaseScore(GOAL_MISSED),l.push(0));n.refreshKicks(l);var A=TEXT_MISSED;v?A=TEXT_GOAL:B&&(A=TEXT_SAVED);n.refreshScoreBoard(A,m,a)};this.endShotCpu=function(v,B){v?(p.push(1),a++,f=1,d||this.increaseScore(GOAL_SUFFERED)):(p.push(0),
d||(this.increaseScore(GOAL_SAVED*f),this._increaseMultiplier()));n.refreshKicks(p);var A=TEXT_MISSED;v?A=TEXT_GOAL:B&&(A=TEXT_SAVED);n.refreshScoreBoard(A,m,a)};this._increaseMultiplier=function(){1<f&&n.showMultiplierAnim(f);f++};this.increaseScore=function(v){k+=v;h+=v;0>h&&(k=h=0);n.refreshScore(h)};this.nextRound=function(){b++;this.reset();n.reset(s_aMatches[b-1],b);t=new CGameStriker(r,b)};this.retryLevel=function(){b--;this.nextRound();$(s_oMain).trigger("restart_level",b)};this.onExit=function(){this.unload();
$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");setVolume("soundtrack",1);s_oMain.gotoMenu()};this.update=function(){null!==t&&t.update()};GOAL_SCORED=g.score_goal;GOAL_MISSED=g.score_goal_missed;GOAL_SAVED=g.score_ball_saved;GOAL_SUFFERED=g.score_goal_opponent;AREAS_INFO=g.area_goal;s_oGame=this;this._init(e)}var s_iCurState,s_oGame=null;
function CScoreBoard(g,e,d){var m,a,c,b,k,h;this._init=function(f,l){m=l;h=new createjs.Container;h.x=l.x;h.y=l.y;d.addChild(h);var p=s_oSpriteLibrary.getSprite("score_side_bg"),q=createBitmap(p);h.addChild(q);k=new createjs.Container;k.x=p.width/2;h.addChild(k);b=new createjs.Text("0\n0","44px "+PRIMARY_FONT,TEXT_COLOR);b.y=44;b.textAlign="right";b.textBaseline="alphabetic";k.addChild(b);p=createBitmap(s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_iTeamSelected]));p.scaleX=p.scaleY=.4;p.x=b.x-
b.getBounds().width-50;p.y=18;k.addChild(p);a=createBitmap(s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_aMatches[f-1]]));a.scaleX=a.scaleY=.4;a.x=p.x;a.y=p.y+42;k.addChild(a);q=new createjs.Text(TEXT_TEAM[s_iTeamSelected],"32px "+PRIMARY_FONT,TEXT_COLOR);q.x=p.x-15;q.y=40;q.textAlign="right";q.textBaseline="alphabetic";k.addChild(q);c=new createjs.Text(TEXT_TEAM[s_aMatches[f-1]],"32px "+PRIMARY_FONT,TEXT_COLOR);c.x=p.x-15;c.y=q.y+42;c.textAlign="right";c.textBaseline="alphabetic";k.addChild(c);
k.regX=-k.getBounds().width/2};this.reset=function(f){c.text=TEXT_TEAM[f];a.image=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[f]);b.text="0\n0";k.regX=-k.getBounds().width/2};this.refreshButtonPos=function(){h.x=m.x+s_iOffsetX;h.y=m.y+s_iOffsetY};this.setScore=function(f,l){b.text=f+"\n"+l};this.darken=function(){h.alpha=.7};this.show=function(){h.visible=!0};this.hide=function(){h.visible=!1};this._init(g,e);return this}
function CResultPanel(g,e){var d,m,a,c;this._init=function(b){c=new createjs.Container;c.visible=!1;c.x=CANVAS_WIDTH_HALF;c.y=CANVAS_HEIGHT_HALF;c.regX=CANVAS_WIDTH_HALF;c.regY=CANVAS_HEIGHT_HALF;e.addChild(c);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=.01;d.on("click",function(){});c.addChild(d);var k=s_oSpriteLibrary.getSprite("msg_box_small"),h=createBitmap(k);h.x=CANVAS_WIDTH_HALF+6;h.y=CANVAS_HEIGHT_HALF;h.regX=k.width/2;h.regY=k.height/
2;c.addChild(h);m=new createjs.Text("GOAL!","85px "+PRIMARY_FONT,"#fff");m.x=CANVAS_WIDTH_HALF;m.y=CANVAS_HEIGHT_HALF-50;m.textAlign="center";m.textBaseline="alphabetic";c.addChild(m);a=new CScoreBoard(b,{x:CANVAS_WIDTH_HALF-140,y:CANVAS_HEIGHT_HALF},c)};this.show=function(b,k,h){m.text=b;a.setScore(k,h);c.alpha=0;c.visible=!0;createjs.Tween.get(c).to({alpha:1},500,createjs.Ease.quartOut);var f=this;setTimeout(function(){f.hide()},2500)};this.hide=function(){createjs.Tween.get(c).to({alpha:0},500,
createjs.Ease.quartOut).call(function(){c.visible=!1;s_oGame.changeScenario()})};this.reset=function(b){a.reset(b)};this._init(g)}
function CFinalPanel(g,e){var d,m,a,c,b,k,h,f,l,p,q,n,t=this;this._init=function(r){n=new createjs.Container;n.visible=!1;e.addChild(n);q=new createjs.Shape;d=q.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);q.alpha=.5;q.on("click",function(){});n.addChild(q);var u=s_oSpriteLibrary.getSprite("msg_box"),v=createBitmap(u);v.x=CANVAS_WIDTH_HALF;v.y=CANVAS_HEIGHT_HALF;v.regX=u.width/2;v.regY=u.height/2;n.addChild(v);u=700;v=120;k=new CTLText(n,CANVAS_WIDTH/2-u/2,-v/2+130,u,v,130,
"center",TEXT_COLOR,PRIMARY_FONT,1,2,2,TEXT_WIN,!0,!0,!0,!1);b=new createjs.Text("YOU 3-2 CPU","80px "+PRIMARY_FONT,"#fff");b.x=CANVAS_WIDTH_HALF;b.y=260;b.textAlign="center";b.textBaseline="alphabetic";n.addChild(b);u=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_iTeamSelected]);l=createBitmap(u);l.x=CANVAS_WIDTH_HALF-120;l.y=b.y-22;l.regX=u.width/2;l.regY=u.height/2;n.addChild(l);u=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_aMatches[r-1]]);p=createBitmap(u);p.x=CANVAS_WIDTH_HALF+120;p.y=
b.y-22;p.regX=u.width/2;p.regY=u.height/2;n.addChild(p);u=500;v=48;h=new CTLText(n,CANVAS_WIDTH/2-u/2,CANVAS_HEIGHT/2-v/2+30,u,v,48,"center","#fff",PRIMARY_FONT,1,2,2,TEXT_LEVEL_SCORE+" 9999",!0,!0,!0,!1);u=550;v=58;f=new CTLText(n,CANVAS_WIDTH/2-u/2,CANVAS_HEIGHT/2-v/2+80,u,v,58,"center","#fff",PRIMARY_FONT,1,2,2,TEXT_TOTAL+" 999999",!0,!0,!0,!1);c=new CGfxButton(CANVAS_WIDTH_HALF-130,CANVAS_HEIGHT_HALF+190,s_oSpriteLibrary.getSprite("but_home"),n);c.addEventListener(ON_MOUSE_UP,this._onHome,this);
a=new CGfxButton(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF+190,s_oSpriteLibrary.getSprite("but_restart"),n);a.addEventListener(ON_MOUSE_UP,this._onRetry,this);m=new CGfxButton(CANVAS_WIDTH_HALF+130,CANVAS_HEIGHT_HALF+190,s_oSpriteLibrary.getSprite("but_next"),n);m.addEventListener(ON_MOUSE_UP,this._onNext,this)};this.unload=function(){m.unload();c.unload();a.unload();q.off("click",d);e.removeChild(n)};this.show=function(r,u,v,B,A,J){setVolume("soundtrack",1);b.text=r;B?(k.refreshText(TEXT_LOSE),m.setVisible(!1),
c.setX(CANVAS_WIDTH_HALF-100),a.setX(CANVAS_WIDTH_HALF+100)):(k.refreshText(TEXT_WIN),m.setVisible(!0),A?(m.setVisible(!1),c.setX(CANVAS_WIDTH_HALF-80),a.setX(CANVAS_WIDTH_HALF+80)):(c.setX(CANVAS_WIDTH_HALF-130),a.setX(CANVAS_WIDTH_HALF),m.setX(CANVAS_WIDTH_HALF+130)));trace("TEAM_LABEL[s_aMatches["+(J-1)+"]] "+TEAM_LABEL[s_aMatches[J-1]]);p.image=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_aMatches[J-1]]);h.refreshText(TEXT_LEVEL_SCORE+" "+v);f.refreshText(TEXT_TOTAL+" "+u);n.alpha=0;n.visible=
!0;createjs.Tween.get(n).to({alpha:1},500,createjs.Ease.quartOut);$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("save_score",u);$(s_oMain).trigger("share_event",u)};this.hide=function(){createjs.Tween.get(n).to({alpha:0},500,createjs.Ease.quartOut).call(function(){n.visible=!1})};this.hideScoreBoards=function(){for(var r=0;r<_aScoreBoards.length;r++)_aScoreBoards[r].hide()};this._onConfirmExit=function(){s_oGame.onExit()};this._onNext=function(){t.hide();s_oGame.nextRound()};this._onRetry=
function(){t.hide();s_oGame.retryLevel()};this._onHome=function(){s_oGame.onExit()};this._init(g)}var NUM_ROWS_PAGE_LEVEL=2,NUM_COLS_PAGE_LEVEL=5;
function CLevelMenu(){var g,e,d,m,a,c,b,k,h,f,l,p,q,n,t,r,u=null,v,B,A,J=null,T=null,R,H,U,C=null,K=null;this._init=function(){var N=s_oMain.getMatches();if(null===N)this._extractMatches();else{s_aMatches=[];t=[];for(var G=0;G<N.length;G++){s_aMatches[G]=N[G].opponent;var X=N[G].result;""===X?t.push(["",""]):(X=X.split("-"),t.push(X))}}f=0;R=new createjs.Container;s_oStage.addChild(R);G=createBitmap(s_oSpriteLibrary.getSprite("bg_levelselect"));R.addChild(G);G=s_oSpriteLibrary.getSprite("msg_box");
N=createBitmap(G);N.x=CANVAS_WIDTH_HALF;N.y=CANVAS_HEIGHT_HALF+30;N.regX=.5*G.width;N.regY=.5*G.height;R.addChild(N);G=700;(new CTLText(R,CANVAS_WIDTH/2-G/2,40,G,60,50,"center","#fff",PRIMARY_FONT,1,2,2,TEXT_MATCHES,!0,!0,!0,!1)).setShadow("#000000",2,2,4);G=s_oSpriteLibrary.getSprite("but_exit");k=CANVAS_WIDTH-G.height/2-10;h=G.height/2+10;B=new CGfxButton(k,h,G,s_oStage);B.addEventListener(ON_MOUSE_UP,this._onExit,this);l=G.height;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)c=B.getX()-G.width-
10,b=G.height/2+10,A=new CToggle(c,b,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive),A.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);G=window.document;N=G.documentElement;C=N.requestFullscreen||N.mozRequestFullScreen||N.webkitRequestFullScreen||N.msRequestFullscreen;K=G.exitFullscreen||G.mozCancelFullScreen||G.webkitExitFullscreen||G.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(C=!1);C&&screenfull.isEnabled&&(G=s_oSpriteLibrary.getSprite("but_fullscreen"),g=G.width/4+10,e=h,U=new CToggle(g,
e,G,s_bFullscreen,s_oStage),U.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this._checkBoundLimits();n=[];G=CANVAS_WIDTH+EDGEBOARD_X;N=Math.floor(G/NUM_COLS_PAGE_LEVEL)/2;X=.7*-EDGEBOARD_X;for(G=0;G<NUM_COLS_PAGE_LEVEL;G++)n.push(X),X+=N;r=[];this._createNewLevelPage(0,NUM_MATCHES);if(1<r.length){for(G=1;G<r.length;G++)r[G].visible=!1;m=CANVAS_WIDTH-180;a=CANVAS_HEIGHT_HALF;J=new CGfxButton(m,a,s_oSpriteLibrary.getSprite("arrow_right"),s_oStage);J.addEventListener(ON_MOUSE_UP,this._onRight,
this);d=CANVAS_HEIGHT_HALF;T=new CGfxButton(180,d,s_oSpriteLibrary.getSprite("arrow_left"),s_oStage);T.addEventListener(ON_MOUSE_UP,this._onLeft,this)}H=new createjs.Shape;H.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(H);createjs.Tween.get(H).to({alpha:0},1E3).call(function(){s_oStage.removeChild(H);H=null});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){for(var N=0;N<q.length;N++)q[N].unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)A.unload(),
A=null;C&&screenfull.isEnabled&&U.unload();B.unload();B=null;null!==T&&(T.unload(),J.unload());null!==u&&v.off("click",u);s_oLevelMenu=null;s_oStage.removeAllChildren()};this.refreshButtonPos=function(){B.setPosition(k-s_iOffsetX,h+s_iOffsetY);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||A.setPosition(c-s_iOffsetX,s_iOffsetY+b);C&&screenfull.isEnabled&&U.setPosition(g+s_iOffsetX,e+s_iOffsetY)};this._extractMatches=function(){s_aMatches=[];t=[];for(var N=4;0<N;){var G=Math.floor(Math.random()*EASY_TEAM.length);
EASY_TEAM[G]!==s_iTeamSelected&&(s_aMatches.push(EASY_TEAM[G]),s_oMain.saveMatch(s_aMatches.length,EASY_TEAM[G],"",0,0),N--,EASY_TEAM.splice(G,1),t.push(["",""]))}for(N=3;0<N;)G=Math.floor(Math.random()*MEDIUM_TEAM.length),MEDIUM_TEAM[G]!==s_iTeamSelected&&(s_aMatches.push(MEDIUM_TEAM[G]),s_oMain.saveMatch(s_aMatches.length,MEDIUM_TEAM[G],"",0,0),N--,MEDIUM_TEAM.splice(G,1),t.push(["",""]));for(N=3;0<N;)G=Math.floor(Math.random()*HARD_TEAM.length),HARD_TEAM[G]!==s_iTeamSelected&&(s_aMatches.push(HARD_TEAM[G]),
s_oMain.saveMatch(s_aMatches.length,HARD_TEAM[G],"",0,0),N--,HARD_TEAM.splice(G,1),t.push(["",""]))};this._checkBoundLimits=function(){for(var N=s_oSpriteLibrary.getSprite("but_level"),G=0,X=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*l,M=0;G<X;)G+=N.height+20,M++;NUM_ROWS_PAGE_LEVEL>M&&(NUM_ROWS_PAGE_LEVEL=M);X=G=0;M=CANVAS_WIDTH-2*EDGEBOARD_X;for(N=s_oSpriteLibrary.getSprite("but_level");X<M;)X+=N.width/2+5,G++;NUM_COLS_PAGE_LEVEL>G&&(NUM_COLS_PAGE_LEVEL=G)};this._createNewLevelPage=function(N,G){var X=new createjs.Container;
R.addChild(X);r.push(X);q=[];for(var M=0,E=50,I=1,z=!1,D=s_oSpriteLibrary.getSprite("but_level"),y=N;y<G;y++){var w=new CLevelBut(n[M]+D.width/2,E+D.height/2,s_aMatches[y],t[y],y+1,D,y+1>s_iLastLevel?!1:!0,X);w.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,y+1);q.push(w);M++;if(M===n.length&&(M=0,E+=D.height+50,I++,I>NUM_ROWS_PAGE_LEVEL&&y<G-1)){z=!0;break}}X.x=CANVAS_WIDTH/2+D.width/2;X.y=CANVAS_HEIGHT/2;X.regX=X.getBounds().width/2;X.regY=X.getBounds().height/2;z&&this._createNewLevelPage(y+
1,G)};this._onRight=function(){r[f].visible=!1;f++;f>=r.length&&(f=0);r[f].visible=!0};this._onLeft=function(){r[f].visible=!1;f--;0>f&&(f=r.length-1);r[f].visible=!0};this._onButLevelRelease=function(N){p=N;if(null===s_oSpriteLibrary.getSprite("player_"+TEAM_INFO[s_iTeamSelected].player+"_0")){v=new createjs.Shape;u=v.on("click",function(){});v.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);v.alpha=.5;R.addChild(v);s_oSpriteLibrary.init(function(){},this._onAllImagesLoaded,
this);for(N=0;31>N;N++)s_oSpriteLibrary.addSprite("player_"+TEAM_INFO[s_iTeamSelected].player+"_"+N,"./sprites/striker/player/player_"+TEAM_INFO[s_iTeamSelected].player+"_"+N+".png");s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()}else s_oLevelMenu.unload(),s_oMain.gotoGame(N)};this._onAllImagesLoaded=function(){s_oLevelMenu.unload();s_oMain.gotoGame(p)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){this.unload();
s_oMain.gotoMenu()};this.resetFullscreenBut=function(){C&&screenfull.isEnabled&&U.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?K.call(window.document):C.call(window.document.documentElement);sizeHandler()};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(g,e,d,m,a,c,b,k){var h,f,l,p=[],q,n,t,r,u,v,B,A;this._init=function(T,R,H,U,C,K,N){f=[];l=[];v=new createjs.Container;v.x=T;v.y=R;J.addChild(v);h=N;r=createBitmap(K);r.mouseEnabled=N;r.regX=K.width/2;r.regY=K.height/2;v.addChild(r);T=s_oSpriteLibrary.getSprite("flag_"+s_iTeamSelected);R=createBitmap(T);R.y=-30;R.regX=T.width/2;R.regY=T.height/2;R.scaleX=R.scaleY=.5;v.addChild(R);T=new createjs.Text(TEXT_VS,"20px "+PRIMARY_FONT,TEXT_COLOR);T.y=3;T.textAlign="center";T.textBaseline=
"alphabetic";v.addChild(T);T=s_oSpriteLibrary.getSprite("flag_"+H);H=createBitmap(T);H.y=24;H.regX=T.width/2;H.regY=T.height/2;H.scaleX=H.scaleY=.5;v.addChild(H);n=new createjs.Text(U[0],"30px "+PRIMARY_FONT,TEXT_COLOR);n.x=40;n.y=-20;n.textAlign="center";n.textBaseline="alphabetic";v.addChild(n);t=new createjs.Text(U[1],"30px "+PRIMARY_FONT,TEXT_COLOR);t.x=40;t.y=32;t.textAlign="center";t.textBaseline="alphabetic";v.addChild(t);U=s_oSpriteLibrary.getSprite("but_level_locked");u=createBitmap(U);u.regX=
U.width/2;u.regY=U.height/2;v.addChild(u);q=new CTLText(v,-58,-91,120,30,22,"center",TEXT_COLOR,PRIMARY_FONT,1,2,2,TEXT_MATCH+" "+C,!0,!0,!0,!1);N?(v.cursor="pointer",u.visible=!1):(q.setColor("#b4b4b4"),v.cursor="default");this._initListener()};this.unload=function(){v.off("mousedown",B);v.off("pressup",A);v.removeChild(r)};this._initListener=function(){B=v.on("mousedown",this.buttonDown);A=v.on("pressup",this.buttonRelease)};this.viewBut=function(T){v.addChild(T)};this.addEventListener=function(T,
R,H){f[T]=R;l[T]=H};this.addEventListenerWithParams=function(T,R,H,U){f[T]=R;l[T]=H;p=U};this.ifClickable=function(){return!0===v.mouseEnabled?1:0};this.setActive=function(T){h=T;r.mouseEnabled=!0;h?(u.visible=!1,q.setColor("#69b8d5")):(u.visible=!0,q.setColor("#b4b4b4"))};this.setScore=function(T,R){n.text=T;t.text=R};this.buttonRelease=function(){h&&f[ON_MOUSE_UP]&&f[ON_MOUSE_UP].call(l[ON_MOUSE_UP],p)};this.buttonDown=function(){f[ON_MOUSE_DOWN]&&f[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN],p)};this.setPosition=
function(T,R){v.x=T;v.y=R};this.setVisible=function(T){v.visible=T};var J=k;this._init(g,e,d,m,a,c,b,k)}
function CCreditsPanel(){var g,e,d,m,a,c,b,k;this._init=function(){k=new createjs.Container;s_oStage.addChild(k);var h=s_oSpriteLibrary.getSprite("msg_box_small");c=new createjs.Shape;c.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=.5;c.on("click",this._onLogoButRelease);c.cursor="pointer";k.addChild(c);e=createBitmap(h);e.x=CANVAS_WIDTH_HALF;e.y=CANVAS_HEIGHT_HALF;e.regX=.5*h.width;e.regY=.5*h.height;k.addChild(e);h=s_oSpriteLibrary.getSprite("but_exit");g=.5*CANVAS_WIDTH+
290;m=new CGfxButton(g,150,h,k);m.addEventListener(ON_MOUSE_UP,this.unload,this);a=new createjs.Text(TEXT_CREDITS_DEVELOPED,"50px "+PRIMARY_FONT,"#ffffff");a.textAlign="center";a.textBaseline="alphabetic";a.x=CANVAS_WIDTH/2;a.y=250;k.addChild(a);h=s_oSpriteLibrary.getSprite("logo_ctl");d=createBitmap(h);d.regX=h.width/2;d.regY=h.height/2;d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2;k.addChild(d);b=new createjs.Text("WWW.CODETHISLAB.COM","44px "+PRIMARY_FONT,"#ffffff");b.textAlign="center";b.textBaseline=
"alphabetic";b.x=CANVAS_WIDTH/2;b.y=420;k.addChild(b)};this.unload=function(){c.off("click",this._onLogoButRelease);m.unload();m=null;s_oStage.removeChild(k)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CSelectTeamMenu(){var g,e,d,m,a,c,b,k,h,f,l=null,p=null,q,n,t=this;this._init=function(){n=new createjs.Container;s_oStage.addChild(n);var r=createBitmap(s_oSpriteLibrary.getSprite("bg_levelselect"));n.addChild(r);r=s_oSpriteLibrary.getSprite("msg_box");var u=createBitmap(r);u.x=CANVAS_WIDTH_HALF;u.y=CANVAS_HEIGHT_HALF+30;u.regX=.5*r.width;u.regY=.5*r.height;n.addChild(u);(new CTLText(n,CANVAS_WIDTH/2-350,40,700,60,50,"center","#fff",PRIMARY_FONT,1,2,2,TEXT_SELECT_TEAM,!0,!0,!0,!1)).setShadow("#000000",
2,2,4);q=new createjs.Container;q.x=CANVAS_WIDTH_HALF+50;q.y=CANVAS_HEIGHT_HALF+33;n.addChild(q);b=[];r=0;u=30;for(var v=0;v<NUM_TEAMS;v++){var B=new CButTeam(r,u,v,q);B.addEventListener(ON_MOUSE_UP,this._onSelectFlag,this);b[v]=B;0<v&&0===(v+1)%8?(r=0,u+=120):r+=106}q.regX=q.getBounds().width/2;q.regY=q.getBounds().height/2;r=s_oSpriteLibrary.getSprite("but_exit");a=CANVAS_WIDTH-r.height/2-10;c=r.height/2+10;k=new CGfxButton(a,c,r,s_oStage);k.addEventListener(ON_MOUSE_UP,this._onExit,this);if(!1===
DISABLE_SOUND_MOBILE||!1===s_bMobile)d=k.getX()-r.width-10,m=r.height/2+10,h=new CToggle(d,m,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive),h.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);r=window.document;u=r.documentElement;l=u.requestFullscreen||u.mozRequestFullScreen||u.webkitRequestFullScreen||u.msRequestFullscreen;p=r.exitFullscreen||r.mozCancelFullScreen||r.webkitExitFullscreen||r.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(l=!1);l&&screenfull.isEnabled&&(r=s_oSpriteLibrary.getSprite("but_fullscreen"),
g=r.width/4+10,e=c,f=new CToggle(g,e,r,s_bFullscreen,s_oStage),f.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this.refreshButtonPos()};this.unload=function(){for(var r=0;r<b.length;r++)b[r].unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)h.unload(),h=null;l&&screenfull.isEnabled&&f.unload();k.unload();k=null;s_oStage.removeAllChildren();s_oSelectMenu=null};this.refreshButtonPos=function(){k.setPosition(a-s_iOffsetX,c+s_iOffsetY);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||h.setPosition(d-
s_iOffsetX,s_iOffsetY+m);l&&screenfull.isEnabled&&f.setPosition(g+s_iOffsetX,e+s_iOffsetY)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this.resetFullscreenBut=function(){l&&screenfull.isEnabled&&f.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?p.call(window.document):l.call(window.document.documentElement);sizeHandler()};this._onSelectFlag=function(r){s_oMain.saveTeam(r);
t.unload();s_oMain.gotoLevelPanel()};s_oSelectMenu=this;this._init()}var s_oSelectMenu=null;
function CButTeam(g,e,d,m){var a,c,b,k,h,f,l,p,q,n=!1;this._init=function(t,r,u){a=u;c=[];b=[];f=[];p=l=1;h=new createjs.Container;h.x=t;h.y=r;m.addChild(h);t=s_oSpriteLibrary.getSprite("flag_"+u);h.regX=t.width/2;h.regY=t.height/2;h.scaleX=l;h.scaleY=p;h.cursor="pointer";k=createBitmap(t);h.addChild(k);new CTLText(h,t.width/2-50,t.height/2-11+44,100,22,20,"center","#fff",PRIMARY_FONT,1,2,2,TEXT_TEAM[a],!0,!0,!0,!1);this._initListener()};this.unload=function(){h.off("mousedown",q[0]);h.off("pressup",
q[1]);!1===s_bMobile&&(h.off("mouseover",q[2]),h.off("mouseout",q[3]));m.removeChild(h)};this.setVisible=function(t){h.visible=t};this._initListener=function(){q=[];q[0]=h.on("mousedown",this.buttonDown);q[1]=h.on("pressup",this.buttonRelease);!1===s_bMobile&&(q[2]=h.on("mouseover",this.buttonOver),q[3]=h.on("mouseout",this.buttonOut))};this.addEventListener=function(t,r,u){c[t]=r;b[t]=u};this.buttonRelease=function(){n||(playSound("click",1,!1),c[ON_MOUSE_UP]&&c[ON_MOUSE_UP].call(b[ON_MOUSE_UP],
a))};this.buttonDown=function(){n||c[ON_MOUSE_DOWN]&&c[ON_MOUSE_DOWN].call(b[ON_MOUSE_DOWN],f[ON_MOUSE_DOWN])};this.buttonOver=function(){createjs.Tween.get(h).to({scaleX:1.1,scaleY:1.1},300,createjs.Ease.quartOut)};this.buttonOut=function(){createjs.Tween.get(h).to({scaleX:l,scaleY:p},300,createjs.Ease.quartOut)};this.block=function(t){n=t;h.scaleX=l;h.scaleY=p};this._init(g,e,d)}
var TEAM_LABEL=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],TEAM_INFO=[{goalkeeper:0,player:0,opponent:0},{goalkeeper:0,player:1,opponent:1},{goalkeeper:0,player:2,opponent:2},{goalkeeper:0,player:3,opponent:3},{goalkeeper:0,player:4,opponent:4},{goalkeeper:0,player:5,opponent:5},{goalkeeper:0,player:4,opponent:6},{goalkeeper:0,player:6,opponent:7},{goalkeeper:0,player:7,opponent:8},{goalkeeper:0,player:8,opponent:9},{goalkeeper:0,player:9,opponent:10},{goalkeeper:1,
player:10,opponent:11},{goalkeeper:1,player:3,opponent:12},{goalkeeper:0,player:11,opponent:13},{goalkeeper:0,player:12,opponent:14},{goalkeeper:0,player:13,opponent:15},{goalkeeper:0,player:1,opponent:16},{goalkeeper:0,player:14,opponent:17},{goalkeeper:0,player:15,opponent:18},{goalkeeper:0,player:7,opponent:19},{goalkeeper:0,player:7,opponent:20},{goalkeeper:1,player:9,opponent:21},{goalkeeper:1,player:17,opponent:22},{goalkeeper:1,player:16,opponent:23},{goalkeeper:0,player:18,opponent:24},{goalkeeper:0,
player:19,opponent:25},{goalkeeper:0,player:4,opponent:26},{goalkeeper:0,player:14,opponent:27},{goalkeeper:0,player:21,opponent:28},{goalkeeper:0,player:4,opponent:29},{goalkeeper:0,player:20,opponent:30},{goalkeeper:0,player:19,opponent:31}],NUM_TEAMS=TEAM_INFO.length,EASY_TEAM=[2,6,7,12,14,16,22,23,24,25,31],MEDIUM_TEAM=[0,1,4,5,11,13,15,19,21,26,27,28,29,30],HARD_TEAM=[3,8,9,10,17,18,20];
function CKickIcon(g,e,d,m){var a;this._init=function(c,b,k){var h=k.getFrameBounds(0).width/3,f=k.getFrameBounds(0).height;a=createSprite(k,"empty",h/2,f/2,h,f);a.x=c;a.y=b;m.addChild(a)};this.changeState=function(c){a.gotoAndStop(c)};this._init(g,e,d)}
function CVersusPanel(g){var e,d,m,a,c,b,k,h=this;this._init=function(){k=new createjs.Container;k.visible=!1;g.addChild(k);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=.5;e=d.on("click",function(){});k.addChild(d);var f=s_oSpriteLibrary.getSprite("msg_box_small"),l=createBitmap(f);l.x=CANVAS_WIDTH_HALF;l.y=CANVAS_HEIGHT_HALF;l.regX=f.width/2;l.regY=f.height/2;k.addChild(l);f=s_oSpriteLibrary.getSprite("flag_"+s_iTeamSelected);m=createBitmap(f);
m.y=CANVAS_HEIGHT_HALF-6;k.addChild(m);f=s_oSpriteLibrary.getSprite("flag_0");a=createBitmap(f);a.y=CANVAS_HEIGHT_HALF-6;k.addChild(a);c=new createjs.Text(TEXT_VS,"82px "+PRIMARY_FONT,"#fff");c.x=CANVAS_WIDTH_HALF;c.y=CANVAS_HEIGHT_HALF+44;c.textAlign="center";c.textBaseline="middle";k.addChild(c);b=new CTLText(k,CANVAS_WIDTH/2-200,195,400,70,82,"center","#fff",PRIMARY_FONT,1,2,2,TEXT_MATCH,!0,!0,!0,!1)};this.unload=function(){d.off("click",e)};this.show=function(f,l){b.refreshText(TEXT_MATCH+" "+
l);a.image=s_oSpriteLibrary.getSprite("flag_"+f);m.x=-200;a.x=CANVAS_WIDTH+200;c.scaleX=c.scaleY=3;c.alpha=0;k.alpha=0;k.visible=!0;createjs.Tween.get(k).to({alpha:1},500,createjs.Ease.cubicOut).call(function(){h.playAnims()})};this.hide=function(){createjs.Tween.get(k).to({alpha:0},500,createjs.Ease.quartOut).call(function(){k.visible=!1})};this.playAnims=function(){createjs.Tween.get(m).to({x:CANVAS_WIDTH_HALF-176},300,createjs.Ease.cubicOut);createjs.Tween.get(a).to({x:CANVAS_WIDTH_HALF+80},300,
createjs.Ease.cubicOut);createjs.Tween.get(c).wait(300).to({scaleX:1,scaleY:1,alpha:1},200,createjs.Ease.cubicOut).call(function(){setTimeout(function(){h.hide()},2500)})};this._init()}
function CMsgBox(g,e){var d,m,a;this._init=function(k){a=new createjs.Container;b.addChild(a);var h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.alpha=.5;h.on("click",function(){});a.addChild(h);h=s_oSpriteLibrary.getSprite("msg_box_small");var f=createBitmap(h);f.x=.5*CANVAS_WIDTH;f.y=.5*CANVAS_HEIGHT;f.regX=.5*h.width;f.regY=.5*h.height;a.addChild(f);d=new CTLText(a,CANVAS_WIDTH/2-250,CANVAS_HEIGHT/2-90-60,500,180,22,"center","#fff",PRIMARY_FONT,1,
2,2,k,!0,!0,!0,!1);d.setShadow("#000000",2,2,4);m=new CGfxButton(CANVAS_WIDTH/2,410,s_oSpriteLibrary.getSprite("but_yes"),a);m.addEventListener(ON_MOUSE_UP,this._onButOk,this)};this._onButOk=function(){c.unload()};this.unload=function(){m.unload();b.removeChild(a)};var c=this;var b=e;this._init(g)}
function CBallStriker(g,e,d,m,a){var c,b,k,h=null,f=FOV*BALL_RADIUS,l=0,p=0;this._init=function(t,r,u){k=new createjs.Container;n.addChild(k);var v=new createjs.SpriteSheet({images:[u],frames:{width:u.width/7,height:u.height,regX:u.width/2/7,regY:u.height/2}});c=createSprite(v,0,u.width/2/7,u.height/2,u.width/7,u.height/2);c.stop();this.scale(f);u=s_oSpriteLibrary.getSprite("ball_shadow");b=createBitmap(u);b.x=t;b.y=r;b.regX=.5*u.width;b.regY=.5*u.height;this.scaleShadow(f);k.addChild(b,c)};this.rolls=
function(){c.rotation=Math.degrees(Math.sin(-(.15*q.velocity.x)));var t=Math.abs(q.angularVelocity.x),r=this._goToPrevFrame;0>q.angularVelocity.x&&(r=this._goToNextFrame);7<t?r():3<t?(l++,l>2/ROLL_BALL_RATE&&(r(),l=0)):1<t?(l++,l>3/ROLL_BALL_RATE&&(r(),l=0)):t>MIN_BALL_VEL_ROTATION&&(l++,l>4/ROLL_BALL_RATE&&(r(),l=0))};this._goToPrevFrame=function(){0===p?p=6:p--;c.gotoAndStop(p)};this._goToNextFrame=function(){7===p?p=1:p++;c.gotoAndStop(p)};this.unload=function(){c.removeAllEventListeners();n.removeChild(c)};
this.setVisible=function(t){k.visible=t};this.getStartScale=function(){return f};this.startPosShadowY=function(t){h=t};this.getStartShadowYPos=function(){return h};this.fadeAnimation=function(t,r,u){this.tweenFade(t,r,u)};this.tweenFade=function(t,r,u){createjs.Tween.get(k,{override:!0}).wait(u).to({alpha:t},r).call(function(){})};this.setPositionShadow=function(t,r){b.x=t;b.y=r};this.setPosition=function(t,r){c.x=t;c.y=r};this.getPhysics=function(){return q};this.setAngle=function(t){c.rotation=
t};this.getX=function(){return c.x};this.getY=function(){return c.y};this.getStartScale=function(){return f};this.scale=function(t){c.scaleX=t;c.scaleY=t};this.scaleShadow=function(t){.08<t?(b.scaleX=t,b.scaleY=t):(b.scaleX=.08,b.scaleY=.08)};this.setAlphaByHeight=function(t){b.alpha=t};this.getScale=function(){return c.scaleX};this.getObject=function(){return k};this.getDepthPos=function(){return q.position.y};var q=m;var n=a;this._init(g,e,d);return this}
function CGameStriker(g,e){var d,m,a,c,b,k,h=null,f,l,p,q,n,t=null,r,u,v=!1,B=!1,A=!1,J=!1,T=!1,R=!1,H=!1,U=!1,C=!1,K,N=0,G,X,M,E,I,z=STATE_INIT,D,y=null,w;this._init=function(){this.pause(!0);E=[];f=new createjs.Container;g.addChild(f);a=createBitmap(s_oSpriteLibrary.getSprite("bg_game_striker"));a.cache(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.addChild(a);c=new CScenarioStriker(e);y=SHOW_3D_RENDER?camera:createOrthoGraphicCamera();var x=s_oSpriteLibrary.getSprite("goal_0");u=new CGoalStriker(251,28,x,
f);d=x.width-15;m=x.height-7.5;h=new CGoalKeeper(CANVAS_WIDTH_HALF-100,CANVAS_HEIGHT_HALF-225,TEAM_INFO[s_aMatches[e-1]].goalkeeper,f);E.push(h);x=s_oSpriteLibrary.getSprite("ball");b=new CBallStriker(0,0,x,c.ballBody(),f);E.push(b);this.ballPosition();b.setVisible(!1);M=MS_TIME_SWIPE_START;k=new CStartBall(CANVAS_WIDTH_HALF+55,CANVAS_HEIGHT_HALF+168,f);n=new CPlayer(CANVAS_WIDTH_HALF-150,CANVAS_HEIGHT_HALF-320,f);n.setVisible(!1);x="cursor";s_bMobile&&(x="hand_touch");r=new CHandSwipeAnim(START_HAND_SWIPE_POS,
END_HAND_SWIPE_POS,s_oSpriteLibrary.getSprite(x),g);r.animAllSwipe();D=new createjs.Shape;D.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);D.alpha=1;g.addChild(D);resizeCanvas3D();I=new CANNON.Vec3(0,0,0);this.onExitHelp();createjs.Tween.get(D).to({alpha:0},300,createjs.cubicOut);s_oInterface.showHelpText(TEXT_HELP)};this.createControl=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onPressMove),window.addEventListener("mouseup",
this.onPressUp)):(q=new createjs.Shape,q.graphics.beginFill("rgba(255,0,0,0.01)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),f.addChild(q),q.on("mousedown",this.onMouseDown),q.on("pressmove",this.onPressMove),q.on("pressup",this.onPressUp))};this.sortDepth=function(x,F){x.getDepthPos()>F.getDepthPos()?f.getChildIndex(x.getObject())>f.getChildIndex(F.getObject())&&f.swapChildren(x.getObject(),F.getObject()):x.getDepthPos()<F.getDepthPos()&&f.getChildIndex(F.getObject())>f.getChildIndex(x.getObject())&&
f.swapChildren(F.getObject(),x.getObject())};this.onExitHelp=function(){this.createControl();this.pause(!1)};this.poleCollide=function(){X=TIME_POLE_COLLISION_RESET;C=!0;playSound("pole",.4,!1)};this.fieldCollision=function(){null===t&&B&&(t=playSound("drop_bounce_grass",.3,!1),t.on("end",function(){t=null}))};this.ballPosition=function(){var x=c.ballBody(),F=this.convert3dPosTo2dScreen(x.position,y),Q=F.z*(BALL_SCALE_FACTOR-b.getStartScale())+b.getStartScale();b.setPosition(F.x,F.y);b.scale(Q);this.refreshShadowCast(b,
x,Q)};this.onMouseDown=function(x){B||(M=MS_TIME_SWIPE_START,r.removeTweens(),r.setVisible(!1),l={x:s_oStage.mouseX,y:s_oStage.mouseY},p={x:s_oStage.mouseX,y:s_oStage.mouseY})};this.onPressMove=function(){p={x:s_oStage.mouseX,y:s_oStage.mouseY};N+=s_iTimeElaps};this.onPressUp=function(){if(!(B||l.y<p.y||0===p.x&&0===p.y)){var x=Math.ceil(distanceV2(l,p))*FORCE_RATE;x>FORCE_MAX&&(x=FORCE_MAX);1E3<N&&(N=1E3);var F=new CVector2(l.x-p.x,l.y-p.y);F.scalarProduct(x);x=F.length();x>HIT_BALL_MIN_FORCE&&(x>
HIT_BALL_MAX_FORCE&&(F.normalize(),F.scalarProduct(HIT_BALL_MAX_FORCE)),T=!0,n.setVisible(!0),x=N/10,x>MAX_FORCE_Y?x=MAX_FORCE_Y:x<MIN_FORCE_Y&&(x=MIN_FORCE_Y),I.set(-F.getX()*FORCE_MULTIPLIER_AXIS.x,x,F.getY()*FORCE_MULTIPLIER_AXIS.z),U=s_oGameStriker.goalProbability());p.x=0;p.y=0}};this.refreshShadowCast=function(x,F,Q){var P=c.getFieldBody();if(F.position.z<P.position.z)x.scaleShadow(0);else{var L=this.convert3dPosTo2dScreen({x:F.position.x,y:F.position.y,z:P.position.z},y);F=(F.position.z-BALL_RADIUS)*
(P.position.z-SHADOWN_FACTOR-P.position.z)+P.position.z;Q*=F;x.scaleShadow(Q);0>Q||(x.setAlphaByHeight(F),x.setPositionShadow(L.x,L.y))}};this.getLevel=function(){return e};this.unload=function(){g.removeAllChildren();SHOW_3D_RENDER||q.removeAllEventListeners();c.destroyWorld();c=null};this.resetValues=function(){};this.wallSoundCollision=function(){};this.areaGoal=function(){v||H||(U?(v=!0,G=TIME_RESET_AFTER_GOAL,playSound("goal_striker",1,!1)):this.goalKeeperSave())};this.goalKeeperSave=function(){H=
!0;G=TIME_RESET_AFTER_SAVE;playSound("ball_saved",1,!1);this.rejectBall()};this.rejectBall=function(){b.getPhysics().velocity.negate(b.getPhysics().velocity);switch(K){case 12:b.getPhysics().velocity=b.getPhysics().velocity.vadd(new CANNON.Vec3(.4*b.getPhysics().velocity.x,.4*b.getPhysics().velocity.y,.4*b.getPhysics().velocity.z));break;default:b.getPhysics().velocity.vsub(new CANNON.Vec3(0,50,0))}};this.goalProbability=function(){K=-1;this.calculateAreaGoal(I);if(-1===K)return!1;for(var x=[],F=
0;F<MAX_PERCENT_PROBABILITY;F++)x.push(!1);for(F=0;F<AREAS_INFO[K].probability;F++)x[F]=!0;return x[Math.floor(Math.random()*x.length)]};this.addImpulseToBall=function(x){if(!B&&z===STATE_PLAY){var F=c.ballBody();c.addImpulse(F,x);c.setElementAngularVelocity(F,{x:0,y:0,z:0});B=!0;b.setVisible(!0);k.setVisible(!1);setTimeout(function(){s_oGameStriker.chooseDirectionGoalKeeper(x)},100);playSound("kick",1,!1)}};this.predictBallGoalPos=function(x){var F=x.z/x.y;return{x:linearFunction(x.x/x.y,STRIKER_GOAL_SHOOTAREA.lx,
STRIKER_GOAL_SHOOTAREA.rx,-d/2,d/2),y:-m/Math.pow(STRIKER_GOAL_SHOOTAREA.zmax,2)*F*F+m/2}};this.calculateAreaGoal=function(x){w=!1;K=-1;x=this.predictBallGoalPos(x);var F=-d/2,Q=-m/2;F=linearFunction(x.x,F,F+d,0,NUM_AREA_GOAL.w);F=Math.floor(F);F>NUM_AREA_GOAL.w-1?(F=NUM_AREA_GOAL.w-1,w=!0):0>F&&(F=0,w=!0);x=linearFunction(x.y,Q,Q+m,0,NUM_AREA_GOAL.h);x=Math.floor(x);x>NUM_AREA_GOAL.h-1?x=NUM_AREA_GOAL.h-1:0>x&&(x=0,w=!0);return K=x*NUM_AREA_GOAL.w+F};this.chooseDirectionGoalKeeper=function(){var x=
this.predictBallGoalPos(I);if(U)this.chooseWrongDirGK();else{var F=K;75>x.y&&(14===K&&(F=9),10===K&&(F=5));w?this.chooseWrongDirGK():h.runAnimAndShift(AREA_GOALS_ANIM[F],x)}R=!0};this.chooseWrongDirGK=function(){for(var x=ANIM_GOAL_KEEPER_FAIL_EXCLUSION_LIST[K],F=[],Q=1;Q<=AREA_GOALS_ANIM.length;Q++)-1===x.indexOf(Q)&&F.push(Q);h.runAnim(F[Math.floor(Math.random()*F.length)])};this.pause=function(x){z=x?STATE_PAUSE:STATE_PLAY;createjs.Ticker.paused=x};this.onExit=function(){this.unload();setVolume("soundtrack",
1);s_oMain.gotoMenu()};this.restartLevel=function(){this.resetValues();this.resetScene();z=STATE_PLAY;this.startOpponentShot()};this.resetBallPosition=function(){var x=c.ballBody();x.position.set(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);c.setElementVelocity(x,{x:0,y:0,z:0});c.setElementAngularVelocity(x,{x:0,y:0,z:0});b.fadeAnimation(1,500,0);b.setVisible(!1);k.setVisible(!0);k.setAlpha(0);k.fadeAnim(1,500,0)};this.ballFadeForReset=function(){H&&v&&A&&!J&&(b.fadeAnimation(0,300,10),J=!0)};
this._updateInit=function(){c.update();this._updateBall2DPosition();z=STATE_PLAY};this.convert2dScreenPosTo3d=function(x){x=new THREE.Vector3(x.x/s_iCanvasResizeWidth*2-1,2*-(x.y/s_iCanvasResizeHeight)+1,-1);x.unproject(y);x.sub(y.position);x.normalize();x.multiply(new THREE.Vector3(0,1,0));return x};this.convert3dPosTo2dScreen=function(x,F){var Q=(new THREE.Vector3(x.x,x.y,x.z)).project(F),P=.5*Math.floor(s_iCanvasResizeWidth),L=.5*Math.floor(s_iCanvasResizeHeight);Q.x=(Q.x*P+P)*s_fInverseScaling;
Q.y=(-(Q.y*L)+L)*s_fInverseScaling;return Q};this.timeReset=function(){0<G?G-=s_iTimeElaps:this.endTurn()};this.restartGame=function(){this.resetValues();this.resetScene();z=STATE_PLAY;B=!1};this.endTurn=function(){s_oGame.endShotPlayer(v,H);this.resetScene()};this.goalAnimation=function(x){x>FORCE_BALL_DISPLAY_SHOCK[0].min&&x<FORCE_BALL_DISPLAY_SHOCK[0].max?this.displayShock(INTENSITY_DISPLAY_SHOCK[0].time,INTENSITY_DISPLAY_SHOCK[0].x,INTENSITY_DISPLAY_SHOCK[0].y):x>FORCE_BALL_DISPLAY_SHOCK[1].min&&
x<FORCE_BALL_DISPLAY_SHOCK[1].max?this.displayShock(INTENSITY_DISPLAY_SHOCK[1].time,INTENSITY_DISPLAY_SHOCK[1].x,INTENSITY_DISPLAY_SHOCK[1].y):x>FORCE_BALL_DISPLAY_SHOCK[2].min&&x<FORCE_BALL_DISPLAY_SHOCK[2].max?this.displayShock(INTENSITY_DISPLAY_SHOCK[2].time,INTENSITY_DISPLAY_SHOCK[2].x,INTENSITY_DISPLAY_SHOCK[2].y):x>FORCE_BALL_DISPLAY_SHOCK[3].min&&this.displayShock(INTENSITY_DISPLAY_SHOCK[3].time,INTENSITY_DISPLAY_SHOCK[3].x,INTENSITY_DISPLAY_SHOCK[3].y)};this.displayShock=function(x,F,Q){createjs.Tween.get(f).to({x:Math.round(Math.random()*
F),y:Math.round(Math.random()*Q)},x).call(function(){createjs.Tween.get(f).to({x:Math.round(Math.random()*F*.8),y:-Math.round(Math.random()*Q*.8)},x).call(function(){createjs.Tween.get(f).to({x:Math.round(Math.random()*F*.6),y:Math.round(Math.random()*Q*.6)},x).call(function(){createjs.Tween.get(f).to({x:Math.round(Math.random()*F*.4),y:-Math.round(Math.random()*Q*.4)},x).call(function(){createjs.Tween.get(f).to({x:Math.round(Math.random()*F*.2),y:Math.round(Math.random()*Q*.2)},x).call(function(){createjs.Tween.get(f).to({y:0,
x:0},x).call(function(){})})})})})})};this.resetScene=function(){J=C=U=H=A=v=!1;h.fadeAnimation(1);this.resetBallPosition();this.sortDepth(b,u)};this._onEnd=function(){this.onExit()};this.swapChildrenIndex=function(){for(var x=0;x<E.length-1;x++)for(var F=x+1;F<E.length;F++)E[x].getObject().visible&&E[F].getObject().visible&&this.sortDepth(E[x],E[F])};this.ballOut=function(){if(!A&&!v&&!H){var x=b.getPhysics().position;if(x.y>BALL_OUT_Y||x.x>BACK_WALL_GOAL_SIZE.width||x.x<-BACK_WALL_GOAL_SIZE.width)A=
!0,G=TIME_RESET_AFTER_BALL_OUT,playSound("ball_saved",1,!1)}};this.animPlayer=function(){T?(T=n.animPlayer(),n.getFrame()===SHOOT_FRAME&&(this.addImpulseToBall({x:I.x,y:I.y,z:I.z}),N=0,this.goalAnimation(I.y),s_oInterface.hideHelpText())):n.setVisible(!1)};this.animGoalKeeper=function(){B?R&&(R=h.update(),R||(h.viewFrame(h.getAnimArray(),h.getAnimArray().length-1),h.hideFrame(h.getAnimArray(),0))):h.update()};this.resetPoleCollision=function(){0<X?X-=s_iTimeElaps:v&&H||(playSound("ball_saved",1,!1),
this.endTurn(),X=TIME_POLE_COLLISION_RESET)};this.handSwipeAnim=function(){r.isAnimate()||B||(0<M?M-=s_iTimeElaps:(r.animAllSwipe(),r.setVisible(!0),M=MS_TIME_SWIPE_START))};this.swapGoal=function(){b.getPhysics().position.z>GOAL_SPRITE_SWAP_Z&&this.sortDepth(b,u)};this._updatePlay=function(){for(var x=0;x<PHYSICS_ACCURACY;x++)c.update();this.ballOut();v||A||H?this.timeReset():C&&this.resetPoleCollision();this.animGoalKeeper();this.animPlayer();this._updateBall2DPosition();this.handSwipeAnim();this.swapChildrenIndex();
this.swapGoal()};this.update=function(){switch(z){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};this._updateBall2DPosition=function(){this.ballPosition();b.rolls();y.updateProjectionMatrix();y.updateMatrixWorld()};s_oGameStriker=this;this._init()}var s_oGameStriker;
function CGoalStriker(g,e,d,m){var a;this._init=function(b,k,h){a=createBitmap(h);this.setPosition(b,k);a.cache(0,0,h.width,h.height);c.addChild(a)};this.unload=function(){c.removeChild(a)};this.setPosition=function(b,k){a.x=b;a.y=k};this.getDepthPos=function(){return GOAL_SPRITE_SWAP_Y};this.getObject=function(){return a};var c=m;this._init(g,e,d);return this}
function CGoalKeeper(g,e,d,m){var a,c,b,k,h,f,l=0,p=0,q=IDLE;this._init=function(n,t,r){h=r;a=n;c=t;b=new createjs.Container;b.x=a;b.y=c;h.addChild(b);b.tickChildren=!1;f=[];k=[];for(r=t=n=0;r<NUM_SPRITE_GOALKEEPER.length;r++){k[r]=new createjs.Container;k[r].regX=-OFFSET_CONTAINER_GOALKEEPER[r].x;k[r].regY=-OFFSET_CONTAINER_GOALKEEPER[r].y;f.push(this.loadAnim(SPRITE_NAME_GOALKEEPER[r],NUM_SPRITE_GOALKEEPER[r],k[r]));b.addChild(k[r]);var u=s_oSpriteLibrary.getSprite(SPRITE_NAME_GOALKEEPER[r]+"_"+
d+"_0");u.width>n&&(n=u.width);u.height>t&&(t=u.height)}b.cache(-n,-t,2*n,2*t);f[IDLE][0].visible=!0};this.getAnimType=function(){return q};this.getAnimArray=function(){return f[q]};this.loadAnim=function(n,t,r){for(var u=[],v=0;v<t;v++)u.push(createBitmap(s_oSpriteLibrary.getSprite(n+"_"+d+"_"+v))),u[v].visible=!1,r.addChild(u[v]);return u};this.getX=function(){return b.x};this.getY=function(){return b.y};this.disableAllAnim=function(){for(var n=0;n<k.length;n++)k[n].visible=!1};this.setPosition=
function(n,t){b.x=n;b.y=t};this.resetPosition=function(){b.x=a;b.y=c};this.setVisible=function(n){b.visible=n};this.fadeAnimation=function(n){createjs.Tween.get(b,{override:!0}).to({alpha:n},500)};this.setAlpha=function(n){b.alpha=n};this.getObject=function(){return b};this.getFrame=function(){return p};this.viewFrame=function(n,t){n[t].visible=!0};this.hideFrame=function(n,t){n[t].visible=!1};this.getDepthPos=function(){return GOAL_KEEPER_DEPTH_Y};this.animGoalKeeper=function(n,t){l+=s_iTimeElaps;
if(l>BUFFER_ANIM_PLAYER){this.hideFrame(n,p);if(p+1<t)this.viewFrame(n,p+1),p++;else return l=p=0,this.viewFrame(n,p),!1;l=0;b.updateCache()}return!0};this.resetAnimation=function(n){this.resetAnimFrame(f[n],NUM_SPRITE_GOALKEEPER[n])};this.resetAnimFrame=function(n,t){for(var r=1;r<t;r++)n[r].visible=!1;n[0].visible=!0};this.setVisibleContainer=function(n,t){k[n].visible=t};this.runAnim=function(n){this.disableAllAnim();this.resetAnimation(n);this.setVisibleContainer(n,!0);q=n;p=0};this.runAnimAndShift=
function(n,t){this.disableAllAnim();this.resetAnimation(n);this.setVisibleContainer(n,!0);q=n;p=0;var r=ORIGIN_POINT_IMPACT_ANIMATION[n],u=t.x-r.x;null===r.x&&(u=0);var v=t.y-r.y;null===r.y&&(v=0);r=u;u=v;createjs.Tween.get(b).to({x:a+r,y:c+u},600).call(function(){0!==v&&createjs.Tween.get(b).to({x:a,y:c},300)})};this.update=function(){return this.animGoalKeeper(f[q],NUM_SPRITE_GOALKEEPER[q])};this._init(g,e,m);return this}
function CHandSwipeAnim(g,e,d,m){var a,c,b=!1;this._init=function(k){c=new createjs.Container;a=createBitmap(k);a.x=g.x;a.y=g.y;a.regX=.5*k.width;a.regY=.5*k.height;a.alpha=0;m.addChild(c);c.addChild(a)};this.animAllSwipe=function(){b=!0;var k=this;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:e[0].x,y:e[0].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=g.x;
a.y=g.y;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:e[1].x,y:e[1].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=g.x;a.y=g.y;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:e[2].x,y:e[2].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=
g.x;a.y=g.y;k.animAllSwipe()})})})};this.fadeAnim=function(k){createjs.Tween.get(c,{override:!0}).to({alpha:k},250)};this.isAnimate=function(){return b};this.setVisible=function(k){a.visible=k};this.removeTweens=function(){createjs.Tween.removeTweens(a);b=!1};this._init(d);return this}
function CPlayer(g,e,d){var m,a=[],c,b=0,k=0;this._init=function(h,f){m={x:h,y:f};c=new createjs.Container;c.x=m.x;c.y=m.y;d.addChild(c);for(var l=0;l<NUM_SPRITE_PLAYER;l++)a.push(createBitmap(s_oSpriteLibrary.getSprite("player_"+TEAM_INFO[s_iTeamSelected].player+"_"+l))),a[l].visible=!1,c.addChild(a[l]);l=s_oSpriteLibrary.getSprite("player_"+TEAM_INFO[s_iTeamSelected].player+"_0");c.cache(0,0,l.width,l.height);a[0].visible=!0};this.setPosition=function(h,f){c.x=h;c.y=f};this.getX=function(){return c.x};
this.getY=function(){return c.y};this.getStartPos=function(){return m};this.setVisible=function(h){c.visible=h};this.animFade=function(h){var f=this;createjs.Tween.get(c).to({alpha:h},250).call(function(){0===h&&(c.visible=!1,f.hideCharacter(NUM_SPRITE_PLAYER-1),f.viewCharacter(b))})};this.viewCharacter=function(h){a[h].visible=!0};this.hideCharacter=function(h){a[h].visible=!1};this.getFrame=function(){return b};this.animPlayer=function(){k+=s_iTimeElaps;if(k>BUFFER_ANIM_PLAYER){this.hideCharacter(b);
if(b+1<NUM_SPRITE_PLAYER)this.viewCharacter(b+1),b++;else return this.viewCharacter(b),k=b=0,!1;c.updateCache();k=0}return!0};this._init(g,e);return this}
function CScenarioStriker(){var g,e,d,m,a,c,b,k,h,f,l,p,q,n,t,r;if(SHOW_3D_RENDER)var u=new CANNON.Demo;this.getDemo=function(){return u};this._init=function(){g=SHOW_3D_RENDER?u.getWorld():new CANNON.World;g.gravity.set(0,0,-9.81);g.broadphase=new CANNON.NaiveBroadphase;g.solver.iterations=50;g.solver.tolerance=1E-5;e=new CANNON.Material;d=new CANNON.Material;m=new CANNON.Material;var v=new CANNON.ContactMaterial(d,m,{friction:.1,restitution:.01}),B=new CANNON.ContactMaterial(d,e,{friction:.2,restitution:.3});
g.addContactMaterial(v);g.addContactMaterial(B);s_oScenario._createBallBody();s_oScenario._createFieldBody();s_oScenario._createGoal();s_oScenario.createBackGoalWall();SHOW_AREAS_GOAL?s_oScenario.createAreasGoal():s_oScenario.createAreaGoal(GOAL_LINE_POS,BACK_WALL_GOAL_SIZE,COLOR_AREA_GOAL[0],null)};this.createAreasGoal=function(){for(var v=0,B=FIRST_AREA_GOAL_POS.x,A=FIRST_AREA_GOAL_POS.z,J=0;J<NUM_AREA_GOAL.h;J++){for(var T=0;T<NUM_AREA_GOAL.w;T++)s_oScenario.createAreaGoal({x:B,y:FIRST_AREA_GOAL_POS.y,
z:A},AREA_GOAL_PROPERTIES,COLOR_AREA_GOAL[v],AREAS_INFO[v]),B+=2*AREA_GOAL_PROPERTIES.width,v++;B=FIRST_AREA_GOAL_POS.x;A-=2*AREA_GOAL_PROPERTIES.height}};this._createFieldBody=function(){k=new CANNON.Plane;h=new CANNON.Body({mass:0,material:e});h.addShape(k);h.position.z=-9;h.addEventListener("collide",function(B){s_oScenario.fieldCollision()});g.addBody(h);if(SHOW_3D_RENDER){var v=new THREE.MeshPhongMaterial({color:5803568,specular:1118481,shininess:10});u.addVisual(h,v)}};this._createGoal=function(){f=
new CANNON.Cylinder(POLE_RIGHT_LEFT_SIZE.radius_top,POLE_RIGHT_LEFT_SIZE.radius_bottom,POLE_RIGHT_LEFT_SIZE.height,POLE_RIGHT_LEFT_SIZE.segments);p=new CANNON.Body({mass:0});l=new CANNON.Cylinder(POLE_UP_SIZE.radius_top,POLE_UP_SIZE.radius_bottom,POLE_UP_SIZE.height,POLE_UP_SIZE.segments);var v=new CANNON.Quaternion;v.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI/2);l.transformAllPoints(new CANNON.Vec3,v);p.addShape(f,new CANNON.Vec3(.5*POLE_UP_SIZE.height,0,0));p.addShape(f,new CANNON.Vec3(.5*
-POLE_UP_SIZE.height,0,0));p.addShape(l,new CANNON.Vec3(0,0,.5*POLE_RIGHT_LEFT_SIZE.height));p.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_POSITION.z);p.addEventListener("collide",function(B){s_oScenario.poleCollision()});g.addBody(p);SHOW_3D_RENDER&&(v=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:50}),u.addVisual(p,v))};this.createBackGoalWall=function(){q=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,
BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));n=new CANNON.Box(new CANNON.Vec3(LEFT_RIGHT_WALL_GOAL_SIZE.width,LEFT_RIGHT_WALL_GOAL_SIZE.depth,LEFT_RIGHT_WALL_GOAL_SIZE.height));t=new CANNON.Box(new CANNON.Vec3(UP_WALL_GOAL_SIZE.width,UP_WALL_GOAL_SIZE.depth,UP_WALL_GOAL_SIZE.height));r=new CANNON.Body({mass:0,material:m});r.addShape(q);r.addShape(n,new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,0,0));r.addShape(n,new CANNON.Vec3(-BACK_WALL_GOAL_SIZE.width,0,0));r.addShape(t,new CANNON.Vec3(0,
0,BACK_WALL_GOAL_SIZE.height));r.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y,BACK_WALL_GOAL_POSITION.z);g.addBody(r);SHOW_3D_RENDER&&u.addVisual(r)};this.createAreaGoal=function(v,B,A,J){B=new CANNON.Box(new CANNON.Vec3(B.width,B.depth,B.height));J=new CANNON.Body({mass:0,userData:J});J.addShape(B);J.position.set(v.x,v.y,v.z);J.collisionResponse=0;J.addEventListener("collide",function(T){s_oScenario.lineGoalCollision(T)});g.addBody(J);SHOW_3D_RENDER&&(v=new THREE.MeshPhongMaterial({color:A,
specular:1118481,shininess:70}),u.addVisual(J,v));return J};this._createBallBody=function(){a=new CANNON.Sphere(BALL_RADIUS);c=new CANNON.Body({mass:BALL_MASS,material:d,linearDamping:BALL_LINEAR_DAMPING,angularDamping:2*BALL_LINEAR_DAMPING});var v=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);c.position.copy(v);c.addShape(a);g.add(c);SHOW_3D_RENDER&&(v=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:70}),b=u.addVisual(c,v))};this.addImpulse=function(v,B){var A=
new CANNON.Vec3(0,0,BALL_RADIUS),J=new CANNON.Vec3(B.x,B.y,B.z);v.applyImpulse(J,A)};this.addForce=function(v,B){var A=new CANNON.Vec3(0,0,0),J=new CANNON.Vec3(B.x,B.y,B.z);v.applyForce(J,A)};this.getBodyVelocity=function(v){return v.velocity};this.ballBody=function(){return c};this.ballMesh=function(){return b};this.getCamera=function(){return u.camera()};this.fieldCollision=function(){s_oGameStriker.fieldCollision();s_oGameStriker.ballFadeForReset()};this.setElementAngularVelocity=function(v,B){v.angularVelocity.set(B.x,
B.y,B.z)};this.setElementVelocity=function(v,B){var A=new CANNON.Vec3(B.x,B.y,B.z);v.velocity=A};this.setElementLinearDamping=function(v,B){v.linearDamping=B};this.getFieldBody=function(){return h};this.lineGoalCollision=function(v){s_oGameStriker.areaGoal(v.contact.bj.userData)};this.update=function(){g.step(PHYSICS_STEP)};this.getGoalBody=function(){return p};this.poleCollision=function(){s_oGameStriker.poleCollide()};this.destroyWorld=function(){for(var v=g.bodies,B=0;B<v.length;B++)g.remove(v[B]);
g=null};s_oScenario=this;SHOW_3D_RENDER?(u.addScene("Test",this._init),u.start()):this._init()}var s_oScenario;
function CStartBall(g,e,d){var m;this._init=function(){var a=s_oSpriteLibrary.getSprite("start_ball");m=createBitmap(a);m.regX=.5*a.width;m.regY=.5*a.height;this.setPosition(g,e);d.addChild(m)};this.setPosition=function(a,c){m.x=a;m.y=c};this.fadeAnim=function(a,c,b){createjs.Tween.get(m,{override:!0}).wait(b).to({alpha:a},c)};this.setAlpha=function(a){m.alpha=a};this.setVisible=function(a){m.visible=a};this._init();return this}
function CBallKeeper(g,e,d,m,a){var c,b,k,h=null,f=0,l=0,p=null,q;this._init=function(r,u,v){k=new createjs.Container;t.addChild(k);var B=new createjs.SpriteSheet({images:[v],frames:{width:v.width/7,height:v.height,regX:v.width/2/7,regY:v.height/2}});c=createSprite(B,0,v.width/2/7,v.height/2,v.width/7,v.height/2);c.stop();this.scale(.66);v=s_oSpriteLibrary.getSprite("ball_shadow");b=createBitmap(v);b.x=r;b.y=u;b.regX=.5*v.width;b.regY=.5*v.height;this.scaleShadow(.6);k.addChild(b,c)};this.rolls=function(){c.rotation=
Math.degrees(Math.sin(.15*n.velocity.x));var r=Math.abs(n.angularVelocity.x),u=this._goToPrevFrame;0>n.angularVelocity.x&&(u=this._goToNextFrame);7<r?u():3<r?(f++,f>2/ROLL_BALL_RATE&&(u(),f=0)):1<r?(f++,f>3/ROLL_BALL_RATE&&(u(),f=0)):r>MIN_BALL_VEL_ROTATION&&(f++,f>4/ROLL_BALL_RATE&&(u(),f=0))};this._goToPrevFrame=function(){0===l?l=6:l--;c.gotoAndStop(l)};this._goToNextFrame=function(){7===l?l=1:l++;c.gotoAndStop(l)};this.unload=function(){c.removeAllEventListeners();t.removeChild(c)};this.setVisible=
function(r){c.visible=r};this.startPosShadowY=function(r){h=r};this.getStartShadowYPos=function(){return h};this.fadeAnimation=function(r,u,v){r!==q&&(null!==p&&createjs.Tween.removeTweens(k),this.tweenFade(r,u,v),q=r)};this.tweenFade=function(r,u,v){p=createjs.Tween.get(k).wait(v).to({alpha:r},u).call(function(){p=null})};this.setPositionShadow=function(r,u){b.x=r;b.y=u};this.setPosition=function(r,u){c.x=r;c.y=u};this.getPhysics=function(){return n};this.setAngle=function(r){c.rotation=r};this.getX=
function(){return c.x};this.getY=function(){return c.y};this.getStartScale=function(){return.66};this.scale=function(r){c.scaleX=r;c.scaleY=r};this.scaleShadow=function(r){.08<r?(b.scaleX=r,b.scaleY=r):(b.scaleX=.08,b.scaleY=.08)};this.setAlphaByHeight=function(r){b.alpha=r};this.getScale=function(){return c.scaleX};this.getObject=function(){return c};this.getDepthPos=function(){return n.position.y};var n=m;var t=a;this._init(g,e,d);return this}
function CGameGoalkeeper(g,e,d){var m,a,c,b,k=null,h,f=null,l,p,q,n=!1,t=!1,r=!1,u=!1,v=!1,B,A=0,J=0,T=0,R,H,U,C=STATE_INIT,K=null,N,G,X,M;this._init=function(E,I){this.pause(!0);R=I;M=X=G=!1;U=[];B=E;q=new createjs.Container;d.addChild(q);m=createBitmap(s_oSpriteLibrary.getSprite("bg_game_gk"));q.addChild(m);a=new CScenarioKeeper;K=SHOW_3D_RENDER?camera:createOrthoGraphicCamera();var z=s_oSpriteLibrary.getSprite("opponent_"+TEAM_INFO[s_aMatches[B-1]].opponent);k=new COpponent(600,340,z,q);z=s_oSpriteLibrary.getSprite("ball");
b=new CBallKeeper(0,0,z,a.ballBody(),q);U.push(b);this.ballPosition();resizeCanvas3D();z=s_oSpriteLibrary.getSprite("gloves");c=new CGloves(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF,z,a.getHandKeeperBody(),q);U.push(c);z=s_oSpriteLibrary.getSprite("goal_1");h=new CGoalGoalkeeper(0,0,z,a.getGoalBody(),q);U.push(h);N=new createjs.Shape;N.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);N.alpha=1;d.addChild(N);createjs.Tween.get(N).to({alpha:0},300,createjs.cubicOut);this.startGame();
s_oInterface.showHelpText(TEXT_HELP_KEEPER)};this.sortDepth=function(E,I){null!==E&&null!==I&&(E.getDepthPos()>I.getDepthPos()?q.getChildIndex(E.getObject())>q.getChildIndex(I.getObject())&&q.swapChildren(E.getObject(),I.getObject()):E.getDepthPos()<I.getDepthPos()&&q.getChildIndex(I.getObject())>q.getChildIndex(E.getObject())&&q.swapChildren(I.getObject(),E.getObject()))};this.startGame=function(){this.pause(!1)};this.activeEventListeners=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",
this.addImpulseToBall),window.addEventListener("mousemove",this.onHandKeeper)):(l=q.on("mousedown",this.onMouseDown),p=q.on("click",this.clickStage))};this.onMouseDown=function(){null===f&&(f=s_oStage.on("stagemousemove",s_oGameKeeper.onHandKeeper));q.off("mousedown",l)};this.clickStage=function(){q.off("click",p);s_oGameKeeper.startOpponentShot()};this.deactiveEventListeners=function(){SHOW_3D_RENDER?(window.removeEventListener("mousedown",this.addImpulseToBall),window.removeEventListener("mousemove",
this.onHandKeeper)):(s_oStage.off("stagemousemove",f),f=null)};this.ballPosition=function(){var E=a.ballBody(),I=this.convert3dPosTo2dScreen(E.position,K),z=I.z*(BALL_SCALE_FACTOR-b.getStartScale())+b.getStartScale();this.shadowBall(E,z);b.scale(z);b.setPosition(I.x,I.y)};this.shadowBall=function(E,I){var z=a.getFieldBody(),D=this.convert3dPosTo2dScreen({x:E.position.x,y:E.position.y,z:z.position.z},K);b.scaleShadow(I/(E.position.z-z.position.z));b.setAlphaByHeight(.1*(-E.position.z-.1*z.position.z));
b.setPositionShadow(D.x,D.y)};this.unload=function(){C=-1;d.removeAllChildren();a.destroyWorld();a=null;this.deactiveEventListeners()};this.resetValues=function(){T=A=J=0};this.wallSoundCollision=function(){};this.goal=function(){n||(n=!0,H=TIME_RESET_AFTER_GOAL,playSound("goal_keeper",1,!1))};this.keeperSave=function(E){n||t||(E.x>-BALL_SAVED_POINT.x&&E.x<BALL_SAVED_POINT.x&&E.z>-BALL_SAVED_POINT.z&&E.z<BALL_SAVED_POINT.z?(r=!0,b.getPhysics().mass=0,H=TIME_RESET_AFTER_PERFECT_KEEPER_SAVED,T++,c.changeState("perfect"),
createjs.Tween.get(q).wait(TIME_BALL_IN_HAND).call(function(){r=!1;b.getPhysics().mass=BALL_MASS;c.changeState("normal")})):(r=!1,H=TIME_RESET_AFTER_KEEPER_SAVED),t=!0,playSound("kick",.65,!1),playSound("keep_ball",1,!1))};this.addImpulseToBall=function(){if(!u&&C===STATE_PLAY){var E={x:Math.random()*(BALL_FORCE_X[B-1]+BALL_FORCE_X[B-1])-BALL_FORCE_X[B-1],y:-R,z:Math.random()*(BALL_FORCE_Z[B-1].max-BALL_FORCE_Z[B-1].min)+BALL_FORCE_Z[B-1].min},I=a.ballBody();a.addImpulse(I,E);a.setElementAngularVelocity(I,
{x:0,y:0,z:0});u=!0}};this.pause=function(E){E?(C=STATE_PAUSE,null!==k&&k.stopAnimation(),this.deactiveEventListeners()):(C=STATE_PLAY,null!==k&&k.playAnimation(),this.activeEventListeners());createjs.Ticker.paused=E};this.startOpponentShot=function(){k.changeState("shot");k.fadeAnimation(1);k.onFinishAnimation();s_oInterface.hideHelpText()};this.onExit=function(){this.unload();setVolume("soundtrack",1);s_oMain.changeCanvasSize(1360,640);s_oMain.gotoMenu()};this.restartLevel=function(){this.resetValues();
this.resetScene();this.activeEventListeners();C=STATE_PLAY;this.startOpponentShot()};this.resetBallPosition=function(){var E=a.ballBody();E.position.set(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);a.setElementVelocity(E,{x:0,y:0,z:0});a.setElementAngularVelocity(E,{x:0,y:0,z:0});b.fadeAnimation(1,500,0)};this.ballFadeForReset=function(){if(n||t){var E=1E3;n&&(E=100);v||(b.fadeAnimation(0,300,E),v=!0)}G&&b.setVisible(!1)};this._updateInit=function(){a.update();this._updateBall2DPosition();C=STATE_PLAY};
this.onHandKeeper=function(E){var I=a.getHandKeeperBody();E=SHOW_3D_RENDER?{x:E.clientX-s_iCanvasOffsetWidth,y:E.clientY-s_iCanvasOffsetHeight}:{x:E.stageX/s_fInverseScaling,y:E.stageY/s_fInverseScaling};s_bMobile&&(E.y+=MOBILE_OFFSET_GLOVES_Y);E=s_oGameKeeper.convert2dScreenPosTo3d(E,I);I.position.x=E.x<LIMIT_HAND_RANGE_POS.x&&E.x>-LIMIT_HAND_RANGE_POS.x?E.x:E.x<LIMIT_HAND_RANGE_POS.x?-LIMIT_HAND_RANGE_POS.x:LIMIT_HAND_RANGE_POS.x;I.position.z=E.z>LIMIT_HAND_RANGE_POS.zMin&&E.z<LIMIT_HAND_RANGE_POS.zMax?
E.z:E.z>LIMIT_HAND_RANGE_POS.zMin?LIMIT_HAND_RANGE_POS.zMax:LIMIT_HAND_RANGE_POS.zMin;E=s_oGameKeeper.convert3dPosTo2dScreen(I.position,K);c.setPosition(E.x,E.y);r&&s_oGameKeeper.ballInHand(I.position)};this.ballInHand=function(E){var I=a.ballBody();I.position.x=E.x;I.position.y=E.y+.7*BALL_RADIUS;I.position.z=E.z;E=this.convert3dPosTo2dScreen(I.position,K);var z=b.getStartScale()-E.z;this.shadowBall(I,z);b.setPosition(E.x,E.y)};this.convert2dScreenPosTo3d=function(E){E=new THREE.Vector3(E.x/s_iCanvasResizeWidth*
2-1,2*-(E.y/s_iCanvasResizeHeight)+1,-1);E.unproject(K);E.sub(K.position);E.normalize();E.multiply(new THREE.Vector3(34,1,34));return E};this.convert3dPosTo2dScreen=function(E,I){var z=(new THREE.Vector3(E.x,E.y,E.z)).project(I),D=.5*Math.floor(s_iCanvasResizeWidth),y=.5*Math.floor(s_iCanvasResizeHeight);z.x=(z.x*D+D)*s_fInverseScaling;z.y=(-(z.y*y)+y)*s_fInverseScaling;return z};this.timeReset=function(){0<H?H-=FPS_TIME:(n?J++:A++,s_oGame.endShotCpu(n,t),this.resetScene(),u=!1)};this.goalAnimation=
function(E){500<E&&1E3>E?this.displayShock(INTENSITY_DISPLAY_SHOCK[0].time,INTENSITY_DISPLAY_SHOCK[0].x,INTENSITY_DISPLAY_SHOCK[0].y):999<E&&2E3>E?this.displayShock(INTENSITY_DISPLAY_SHOCK[1].time,INTENSITY_DISPLAY_SHOCK[1].x,INTENSITY_DISPLAY_SHOCK[1].y):1999<E&&3E3>E?this.displayShock(INTENSITY_DISPLAY_SHOCK[2].time,INTENSITY_DISPLAY_SHOCK[2].x,INTENSITY_DISPLAY_SHOCK[2].y):2999<E&&this.displayShock(INTENSITY_DISPLAY_SHOCK[3].time,INTENSITY_DISPLAY_SHOCK[3].x,INTENSITY_DISPLAY_SHOCK[3].y)};this.displayShock=
function(E,I,z){createjs.Tween.get(q).to({x:Math.round(Math.random()*I),y:Math.round(Math.random()*z)},E).call(function(){createjs.Tween.get(q).to({x:Math.round(Math.random()*I*.8),y:-Math.round(Math.random()*z*.8)},E).call(function(){createjs.Tween.get(q).to({x:Math.round(Math.random()*I*.6),y:Math.round(Math.random()*z*.6)},E).call(function(){createjs.Tween.get(q).to({x:Math.round(Math.random()*I*.4),y:-Math.round(Math.random()*z*.4)},E).call(function(){createjs.Tween.get(q).to({x:Math.round(Math.random()*
I*.2),y:Math.round(Math.random()*z*.2)},E).call(function(){createjs.Tween.get(q).to({y:0,x:0},E).call(function(){})})})})})})};this.resetScene=function(){t=n=G=X=M=!1;this.resetBallPosition()};this._onEnd=function(){this.onExit()};this.swapChildrenIndex=function(){for(var E=0;E<U.length-1;E++)for(var I=E+1;I<U.length;I++)this.sortDepth(U[E],U[I])};this.rotateGuantes=function(){var E=(c.getX()-CANVAS_WIDTH_HALF)*HAND_KEEPER_ANGLE_RATE;c.setRotation(E)};this._goalMiss=function(){X=M=!0};this._ballOut=
function(){G=!0};this._checkBallState=function(){var E=a.ballBody();E.position.y<GOAL_LINE_POS.y&&!n&&!G?this._ballOut():.01>E.velocity.lengthSquared()&&(!u||M||G||n||this._goalMiss())};this._updatePlay=function(){for(var E=0;E<PHYSICS_ACCURACY;E++)a.update();this._updateBall2DPosition();(t||n||G||X)&&this.timeReset();this.rotateGuantes();this.swapChildrenIndex();this._checkBallState()};this.update=function(){switch(C){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};
this._updateBall2DPosition=function(){r||(this.ballPosition(),b.rolls());G&&b.setVisible(!1);K.updateProjectionMatrix();K.updateMatrixWorld()};s_oGameKeeper=this;this._init(g,e)}var s_oGameKeeper;
function CGloves(g,e,d,m,a){var c;this._init=function(h,f,l){var p=new createjs.SpriteSheet({images:[l],frames:{width:l.width/2,height:l.height,regX:l.width/2/2,regY:l.height/2},animations:{normal:[0],perfect:[1]}});c=createSprite(p,"normal",l.width/2/2,l.height/2,l.width/2,l.height);this.setPosition(h,f);k.addChild(c)};this.unload=function(){k.removeChild(c)};this.setPosition=function(h,f){c.x=h;c.y=f};this.getObject=function(){return c};this.getDepthPos=function(){return b.position.y};this.getX=
function(){return c.x};this.getY=function(){return c.y};this.changeState=function(h){c.gotoAndStop(h)};this.getPhysics=function(){return b};this.setRotation=function(h){c.rotation=h};var b=m;var k=a;this._init(g,e,d);return this}
function CGoalGoalkeeper(g,e,d,m,a){var c;this._init=function(h,f,l){c=createBitmap(l);this.setPosition(h,f);k.addChild(c)};this.unload=function(){k.removeChild(c)};this.setPosition=function(h,f){c.x=h;c.y=f};this.getObject=function(){return c};this.getDepthPos=function(){return b.position.y};this.getPhysics=function(){return b};this.getX=function(){return c.x};this.getY=function(){return c.y};var b=m;var k=a;this._init(g,e,d);return this}
function COpponent(g,e,d,m){var a,c;this._init=function(b,k,h,f){c=f;f=new createjs.SpriteSheet({images:[h],frames:{width:h.width/13,height:h.height/7,regX:h.width/2/13,regY:h.height/7},animations:{start:0,shot:[0,44,"stay",30/FPS],stay:[45,79,"remain",30/FPS],remain:[79]}});a=createSprite(f,"start",h.width/2/13,h.height/7,h.width/13,h.height/7);a.scaleX=a.scaleY=.9;a.x=b;a.y=k;c.addChild(a)};this.getX=function(){return a.x};this.getY=function(){return a.y};this.setPosition=function(b,k){null!==b&&
(a.x=b);null!==k&&(a.y=k)};this.rotate=function(b){a.scaleX=b};this.setVisible=function(b){a.visible=b};this.changeState=function(b){a.gotoAndPlay(b)};this.stopAnimation=function(){a.stop()};this.playAnimation=function(){a.play()};this.onFinishAnimation=function(){a.on("animationend",function(){s_oGameKeeper.addImpulseToBall();playSound("kick",.3,!1);a.removeAllEventListeners()})};this.fadeAnimation=function(b){createjs.Tween.get(a).to({alpha:b},500)};this.removeTweens=function(){createjs.Tween.removeTweens(a)};
this._init(g,e,d,m);return this}
function CScenarioKeeper(){var g,e,d,m,a,c,b,k,h,f,l,p,q,n,t,r,u,v,B,A,J,T,R;SHOW_3D_RENDER&&(R=new CANNON.Demo);this.getDemo=function(){return R};this._init=function(){g=SHOW_3D_RENDER?R.getWorld():new CANNON.World;g.gravity.set(0,0,-9.81);g.broadphase=new CANNON.NaiveBroadphase;g.solver.iterations=50;g.solver.tolerance=1E-5;e=new CANNON.Material;d=new CANNON.Material;m=new CANNON.Material;a=new CANNON.Material;var H=new CANNON.ContactMaterial(d,m,{friction:.1,restitution:.5}),U=new CANNON.ContactMaterial(d,
e,{friction:.2,restitution:.3}),C=new CANNON.ContactMaterial(d,a,{friction:.5,restitution:.1});g.addContactMaterial(H);g.addContactMaterial(U);g.addContactMaterial(C);s_oScenario._createBallBody();s_oScenario._createFieldBody();s_oScenario._createGoal();s_oScenario.createBackGoalWall();s_oScenario.createLineOfGoal();s_oScenario.createHandGoalKeeper()};this._createFieldBody=function(){h=new CANNON.Plane;f=new CANNON.Body({mass:0,material:e});f.addShape(h);f.position.z=-10;f.addEventListener("collide",
function(H){s_oScenario.fieldCollision()});g.addBody(f);SHOW_3D_RENDER&&R.addVisual(f)};this._createGoal=function(){l=new CANNON.Cylinder(POLE_RIGHT_LEFT_SIZE.radius_top,POLE_RIGHT_LEFT_SIZE.radius_bottom,POLE_RIGHT_LEFT_SIZE.height,POLE_RIGHT_LEFT_SIZE.segments);q=new CANNON.Body({mass:0});p=new CANNON.Cylinder(POLE_UP_SIZE.radius_top,POLE_UP_SIZE.radius_bottom,POLE_UP_SIZE.height,POLE_UP_SIZE.segments);var H=new CANNON.Quaternion;H.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI/2);p.transformAllPoints(new CANNON.Vec3,
H);q.addShape(l,new CANNON.Vec3(.5*POLE_UP_SIZE.height,0,0));q.addShape(l,new CANNON.Vec3(.5*-POLE_UP_SIZE.height,0,0));q.addShape(p,new CANNON.Vec3(0,0,.5*POLE_RIGHT_LEFT_SIZE.height));q.position.set(GOAL_POSITION.x,GOAL_POSITION.y,GOAL_POSITION.z);q.addEventListener("collide",function(U){s_oScenario.poleCollision()});g.addBody(q);SHOW_3D_RENDER&&R.addVisual(q)};this.createBackGoalWall=function(){n=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));
t=new CANNON.Box(new CANNON.Vec3(LEFT_RIGHT_WALL_GOAL_SIZE.width,LEFT_RIGHT_WALL_GOAL_SIZE.depth,LEFT_RIGHT_WALL_GOAL_SIZE.height));r=new CANNON.Box(new CANNON.Vec3(UP_WALL_GOAL_SIZE.width,UP_WALL_GOAL_SIZE.depth,UP_WALL_GOAL_SIZE.height));u=new CANNON.Body({mass:0,material:m});u.addShape(n);u.addShape(t,new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,0,0));u.addShape(t,new CANNON.Vec3(-BACK_WALL_GOAL_SIZE.width,0,0));u.addShape(r,new CANNON.Vec3(0,0,BACK_WALL_GOAL_SIZE.height));u.addEventListener("collide",
function(H){s_oScenario.goalCollision(H)});u.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y,BACK_WALL_GOAL_POSITION.z);g.addBody(u)};this.createLineOfGoal=function(){v=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));B=new CANNON.Body({mass:0});B.addShape(v);B.position.set(GOAL_LINE_POS.x,GOAL_LINE_POS.y,GOAL_LINE_POS.z);B.collisionResponse=0;B.addEventListener("collide",function(H){s_oScenario.lineGoalCollision()});
g.addBody(B)};this.createHandGoalKeeper=function(){A=new CANNON.Box(new CANNON.Vec3(HAND_KEEPER_SIZE.width,HAND_KEEPER_SIZE.depth,HAND_KEEPER_SIZE.height));J=new CANNON.Body({mass:0,material:a});J.addShape(A);J.position.set(HAND_KEEPER_POSITION.x,HAND_KEEPER_POSITION.y,HAND_KEEPER_POSITION.z);J.addEventListener("collide",function(H){s_oScenario.handCollision(H)});g.addBody(J);SHOW_3D_RENDER&&(T=R.addVisual(J))};this._createBallBody=function(){c=new CANNON.Sphere(BALL_RADIUS);b=new CANNON.Body({mass:BALL_MASS,
material:d,linearDamping:BALL_LINEAR_DAMPING,angularDamping:2*BALL_LINEAR_DAMPING});var H=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);b.position.copy(H);b.addShape(c);g.add(b);SHOW_3D_RENDER&&(k=R.addVisual(b))};this.addImpulse=function(H,U){var C=new CANNON.Vec3(0,0,BALL_RADIUS),K=new CANNON.Vec3(U.x,U.y,U.z);H.applyImpulse(K,C)};this.addForce=function(H,U){var C=new CANNON.Vec3(0,0,0),K=new CANNON.Vec3(U.x,U.y,U.z);H.applyForce(K,C)};this.getBodyVelocity=function(H){return H.velocity};
this.ballBody=function(){return b};this.ballMesh=function(){return k};this.getCamera=function(){return R.camera()};this.fieldCollision=function(){s_oGameKeeper.ballFadeForReset();!1===s_oInterface.isHelpTextVisible()&&playSound("drop_bounce_grass",1,!1)};this.collisionWithBall=function(){s_oGameKeeper.lineGoalCollision()};this.setElementAngularVelocity=function(H,U){H.angularVelocity.set(U.x,U.y,U.z)};this.setElementVelocity=function(H,U){var C=new CANNON.Vec3(U.x,U.y,U.z);H.velocity=C};this.setElementLinearDamping=
function(H,U){H.linearDamping=U};this.getFieldBody=function(){return f};this.lineGoalCollision=function(){s_oGameKeeper.goal()};this.handCollision=function(H){s_oGameKeeper.keeperSave(H.contact.rj)};this.update=function(){g.step(PHYSICS_STEP)};this.getHandKeeperBody=function(){return J};this.getHandKeeperMesh=function(){return T};this.getGoalBody=function(){return q};this.goalCollision=function(H){s_oGameKeeper.goalAnimation(H.body.velocity.x*H.body.velocity.x+H.body.velocity.y*H.body.velocity.y)};
this.poleCollision=function(){playSound("kick",1,!1)};this.destroyWorld=function(){for(var H=g.bodies,U=[],C=0;C<H.length;C++)U[C]=H[C];H=H.length;for(C=0;C<H;C++)g.removeBody(U[C]);g=null};s_oScenario=this;SHOW_3D_RENDER?(R.addScene("Test",this._init),R.start()):this._init()}function extractHostname(g){g=-1<g.indexOf("://")?g.split("/")[2]:g.split("/")[0];g=g.split(":")[0];return g=g.split("?")[0]}
function extractRootDomain(g){g=extractHostname(g);var e=g.split("."),d=e.length;2<d&&(g=e[d-2]+"."+e[d-1]);return g}
var getClosestTop=function(){var g=window,e=!1;try{for(;g.parent.document!==g.document;)if(g.parent.document)g=g.parent;else{e=!0;break}}catch(d){e=!0}return{topFrame:g,err:e}},getBestPageUrl=function(g){var e=g.topFrame,d="";if(g.err)try{try{d=window.top.location.href}catch(a){var m=window.location.ancestorOrigins;d=m[m.length-1]}}catch(a){d=e.document.referrer}else d=e.location.href;return d},TOPFRAMEOBJ=getClosestTop(),PAGE_URL=getBestPageUrl(TOPFRAMEOBJ);
function seekAndDestroy(){for(var g=extractRootDomain(PAGE_URL),e=[String.fromCharCode(99,111,100,101,116,104,105,115,108,97,98,46,99,111,109),String.fromCharCode(101,110,118,97,116,111,46,99,111,109),String.fromCharCode(99,111,100,101,99,97,110,121,111,110,46,99,111,109),String.fromCharCode(99,111,100,101,99,97,110,121,111,110,46,110,101,116)],d=0;d<e.length;d++)if(e[d]===g)return!0;return!1};